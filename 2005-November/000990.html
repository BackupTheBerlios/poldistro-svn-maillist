<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Poldistro-svn] r1017 - in trunk/096/pkg: . multis multis/boat multis/housing multis/housing/commands multis/housing/commands/gm systems
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/poldistro-svn/2005-November/index.html" >
   <LINK REL="made" HREF="mailto:poldistro-svn%40lists.berlios.de?Subject=Re%3A%20%5BPoldistro-svn%5D%20r1017%20-%20in%20trunk/096/pkg%3A%20.%20multis%20multis/boat%20multis/housing%20multis/housing/commands%20multis/housing/commands/gm%20systems&In-Reply-To=%3C200511191258.jAJCwOKV025558%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000989.html">
   <LINK REL="Next"  HREF="000991.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Poldistro-svn] r1017 - in trunk/096/pkg: . multis multis/boat multis/housing multis/housing/commands multis/housing/commands/gm systems</H1>
    <B>austin at BerliOS</B> 
    <A HREF="mailto:poldistro-svn%40lists.berlios.de?Subject=Re%3A%20%5BPoldistro-svn%5D%20r1017%20-%20in%20trunk/096/pkg%3A%20.%20multis%20multis/boat%20multis/housing%20multis/housing/commands%20multis/housing/commands/gm%20systems&In-Reply-To=%3C200511191258.jAJCwOKV025558%40sheep.berlios.de%3E"
       TITLE="[Poldistro-svn] r1017 - in trunk/096/pkg: . multis multis/boat multis/housing multis/housing/commands multis/housing/commands/gm systems">austin at berlios.de
       </A><BR>
    <I>Sat Nov 19 13:58:24 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000989.html">[Poldistro-svn] r1016 - trunk/096/pkg/items/hair/hairdye
</A></li>
        <LI>Next message: <A HREF="000991.html">[Poldistro-svn] r1018 - trunk/096/pkg/commands
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#990">[ date ]</a>
              <a href="thread.html#990">[ thread ]</a>
              <a href="subject.html#990">[ subject ]</a>
              <a href="author.html#990">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: austin
Date: 2005-11-19 13:58:15 +0100 (Sat, 19 Nov 2005)
New Revision: 1017

Added:
   trunk/096/pkg/multis/
   trunk/096/pkg/multis/boat/
   trunk/096/pkg/multis/boat/boat.src
   trunk/096/pkg/multis/boat/itemdesc.cfg
   trunk/096/pkg/multis/boat/pkg.cfg
   trunk/096/pkg/multis/boat/plank.src
   trunk/096/pkg/multis/boat/plankControl.src
   trunk/096/pkg/multis/boat/plankUtil.inc
   trunk/096/pkg/multis/boat/plankWalk.src
   trunk/096/pkg/multis/boat/shipDeed.src
   trunk/096/pkg/multis/boat/tillerman.src
   trunk/096/pkg/multis/housing/
   trunk/096/pkg/multis/housing/changeOwner.src
   trunk/096/pkg/multis/housing/commands/
   trunk/096/pkg/multis/housing/commands/gm/
   trunk/096/pkg/multis/housing/commands/gm/destroyMulti.src
   trunk/096/pkg/multis/housing/commands/gm/makeMulti.src
   trunk/096/pkg/multis/housing/houseBanning.src
   trunk/096/pkg/multis/housing/houseDeed.src
   trunk/096/pkg/multis/housing/itemdesc.cfg
   trunk/096/pkg/multis/housing/pkg.cfg
   trunk/096/pkg/multis/housing/secureCont.src
   trunk/096/pkg/multis/housing/sign.src
   trunk/096/pkg/multis/housing/signControl.src
Removed:
   trunk/096/pkg/systems/boat/
   trunk/096/pkg/systems/housing/
Log:
Took housing and boats out of 'systems' and added a 'multis' category

Added: trunk/096/pkg/multis/boat/boat.src
===================================================================
--- trunk/096/pkg/multis/boat/boat.src	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/boat/boat.src	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,790 @@
+////////////////
+//	boat.src 
+//
+//	control script for boats
+//
+//	Header replaced by Racalac 9/15/02
+//
+//	Todo/Fix: Course nav needs the &quot;goto #&quot; command implimented.
+//			  Tillerman string recognition causes boat to pause
+////////////////
+
+use os;
+use uo;
+use util;
+use boat;
+
+include &quot;include/OLD/eventID&quot;;
+include &quot;include/sysEvent&quot;;
+include &quot;:itemutils:myUtil&quot;;
+include &quot;include/client&quot;;
+include &quot;include/OLD/sound&quot;;
+include &quot;:gumps:yesno&quot;;
+include &quot;util/key&quot;;
+include &quot;plankUtil&quot;;
+
+const STATE_STATIONARY := 0;
+const STATE_MOVING := 1;
+const STATE_DRIFTING := 2;
+const STATE_FOLLOWING_COURSE := 3; //NOTE NEW STATE
+const DELAY_DRIFTING := 15000;
+
+/*NOTE NEW CONSTANTS*/
+const NEGONE := -1;
+const ZERO := 0;
+const POSONE := 1;
+
+var state := STATE_STATIONARY;
+var relative_direction;
+var ms_delay_between_moves := 200;
+var boat;
+var tillerman;
+var owner := GetObjProperty(boat.hold,&quot;owner&quot;);
+var decay := GetObjProperty(boat.tillerman, &quot;decay&quot;);
+
+/*NOTE NEW GLOBAL*/
+var first_move_toward_waypoint := 1;
+
+program autostart_boat(param)
+  boat := param;
+  if(!boat)
+    syslog( &quot;[ERROR] [boat.src] Boat script running, but boat not found!&quot; );
+    return;
+  endif
+  tillerman := boat.tillerman;
+  if(!tillerman)
+    syslog( &quot;[ERROR] [boat.src] No tillerman for boat at: &quot; +(boat.x-1) +&quot;,&quot;+ boat.y +&quot;,&quot;+ boat.z + &quot;; destroying the boat...&quot; );
+    DestroyMulti(boat);
+    return;
+  endif
+  EnableEvents(SYSEVENT_SPEECH, 15);
+  RegisterForSpeechEvents(tillerman, 15);
+  var nextencounter := ReadGameClock()+(RandomInt(120) + 120);
+  var nextsound := ReadGameClock()+5;
+  var driftcounter := 1;
+  //set_critical(1);
+  var x,y;
+  while(boat)
+    if(GetObjProperty(boat.hold, &quot;#speed&quot;))
+      state := STATE_MOVING;
+      ms_delay_between_moves := GetObjProperty(boat.hold, &quot;#speed&quot;); 
+      relative_direction := GetObjProperty(boat.hold, &quot;#relativedir&quot;);
+      eraseobjproperty(boat.hold, &quot;#speed&quot;);
+      eraseobjproperty(boat.hold, &quot;#relativedir&quot;);    
+    endif     
+    decay := getobjproperty(boat.tillerman,&quot;decay&quot;);
+    if((decay) and(!getobjproperty(tillerman,&quot;nodecay&quot;)))
+      if(ReadGameClock() &gt; decay)
+        PrintTextAbove(tillerman, &quot;Arrrrrgh!  She's going down, Captain!  Abandon ship!&quot;);
+        sleep(4);
+        foreach item in EnumerateItemsInContainer( boat.hold )
+          DestroyItem(item);
+        endforeach
+        foreach mob in(boat.items)
+          DestroyItem(mob);
+        endforeach        
+        foreach mob in(boat.mobiles)
+          MoveCharacterToLocation(mob, 1, 1, 0,  MOVECHAR_FORCELOCATION );
+          SendSysMessage(mob, &quot;Your ship, badly in need of maintenance, sinks beneath the waves!&quot;);
+          SendSysMessage(mob, &quot;You awake on a distant shore...&quot;);
+        endforeach
+        if(boat.has_offline_mobiles)
+          foreach mob in(boat.offline_mobiles)
+            MoveCharacterToLocation(mob, 1, 1, 0,  MOVECHAR_FORCELOCATION );
+          endforeach
+        endif
+        DestroyMulti(boat);
+      endif
+    endif    
+    case(state)
+      STATE_MOVING:   if(ReadGameClock() &gt; nextsound)
+                        PlayBoatSounds();
+                        nextsound := ReadGameClock()+5;
+                      endif
+                      x := boat.x;
+                      y := boat.y;
+                      MoveBoatRelative(boat, relative_direction);
+                      if(boat.x == 6 or boat.x == 5097 or boat.y == 6 or boat.y == 4089)   
+                        WorldWrap();
+                      endif
+                      if((x == boat.x) &amp;&amp;(y == boat.y))
+                        ms_delay_between_moves := 1000;
+                        state := STATE_DRIFTING;
+                        PrintTextAbove(tillerman, &quot;Aaargh!  We've run ashore!&quot;);
+                        //SmackEveryone();
+                      endif
+                      sleepms(ms_delay_between_moves);
+                      if(ReadGameClock() &gt; nextencounter)
+                        DoEncounter();
+                        nextencounter := ReadGameClock()+120;
+                      endif
+                      while(events_waiting())
+                        process_event(wait_for_event(0));
+                      endwhile
+      STATE_DRIFTING:   if(ReadGameClock() &gt; nextsound)
+                          PlayBoatSounds();
+                          nextsound := ReadGameClock()+5;
+                        endif
+                        if(driftcounter &gt; 15)
+                          MoveBoatRelative(boat, RandomInt(8));
+                          driftcounter := 1;
+                        else
+                          driftcounter := driftcounter + 1;
+                        endif
+                        sleepms(1000);
+                        while(events_waiting())
+                          process_event(wait_for_event(0));
+                        endwhile
+      STATE_STATIONARY: var ev := wait_for_event(120);
+                        if(ev)
+                          process_event(ev);
+                        endif
+/*NOTE NEW BOAT STATE*/
+      STATE_FOLLOWING_COURSE:
+        		x := boat.x;
+        		y := boat.y;
+        		BoatFollowCourse(boat);
+        				
+        		sleepms(ms_delay_between_moves);
+                        while(events_waiting())
+                          process_event(wait_for_event(0));
+                        endwhile
+/*END NEW BOAT STATE*/
+    endcase
+    if(ReadGameClock() &gt; nextencounter)
+      checkres();
+      nextencounter := ReadGameClock()+120;
+    endif
+  endwhile
+endprogram
+
+function handle_speech(event)
+  var text := lower(event.text);
+  if(text[&quot;drift&quot;] || text[&quot;raise anchor&quot;])
+    ms_delay_between_moves := 1000;
+    state := STATE_DRIFTING;
+    PrintTextAbove(tillerman, &quot;Aye Aye, Captain!&quot;);
+  elseif(text[&quot;forward&quot;])
+    if(state == STATE_STATIONARY)
+      PrintTextAbove(tillerman, &quot;The anchor is down, Captain!&quot;);
+    else
+      PrintTextAbove(tillerman, &quot;Aye Aye, Captain!&quot;);
+      state := STATE_MOVING;
+      if(text[&quot;left&quot;])
+        relative_direction := 7;
+      elseif(text[&quot;right&quot;])
+        relative_direction := 1;
+      else
+        relative_direction := 0;
+      endif
+    endif
+  elseif(text[&quot;back&quot;])
+    if(state == STATE_STATIONARY)
+      PrintTextAbove(tillerman, &quot;The anchor is down, Captain!&quot;);
+    else
+      PrintTextAbove(tillerman, &quot;Aye Aye, Captain!&quot;);
+      state := STATE_MOVING;
+      if(text[&quot;left&quot;])
+        relative_direction := 5;
+      elseif(text[&quot;right&quot;])
+        relative_direction := 3;
+      else
+        relative_direction := 4;
+      endif
+    endif
+  elseif(text[&quot;stop&quot;] || text[&quot;furl sail&quot;] || text[&quot;furl&quot;])
+    PrintTextAbove(tillerman, &quot;Aye Aye, Captain!&quot;);
+    ms_delay_between_moves := 1000;
+    state := STATE_DRIFTING;
+  elseif(text[&quot;drop anchor&quot;])
+    PrintTextAbove(tillerman, &quot;Aye Aye, Captain! Anchor dropped.&quot;);
+    ms_delay_between_moves := 1000;
+    state := STATE_STATIONARY;
+  elseif(text[&quot;turn right&quot;] || text[&quot;starboard&quot;])
+    if(state == STATE_STATIONARY)
+      PrintTextAbove(tillerman, &quot;The anchor is down, Captain!&quot;);
+    else
+      PrintTextAbove(tillerman, &quot;Aye Aye, Captain!&quot;);
+      TurnBoat(boat, 1);
+    endif
+  elseif(text[&quot;right&quot;])
+    if(state == STATE_STATIONARY)
+      PrintTextAbove(tillerman, &quot;The anchor is down, Captain!&quot;);
+    else
+      PrintTextAbove(tillerman, &quot;Aye Aye, Captain!&quot;);
+      state := STATE_MOVING;
+      relative_direction := 2;
+    endif
+  elseif(text[&quot;turn left&quot;] || text[&quot;port&quot;])
+    if(state == STATE_STATIONARY)
+      PrintTextAbove(tillerman, &quot;The anchor is down, Captain!&quot;);
+    else
+      PrintTextAbove(tillerman, &quot;Aye Aye, Captain!&quot;);
+      TurnBoat(boat, 3);
+    endif
+  elseif(text[&quot;left&quot;])
+    if(state == STATE_STATIONARY)
+      PrintTextAbove(tillerman, &quot;The anchor is down, Captain!&quot;);
+    else
+      PrintTextAbove(tillerman, &quot;Aye Aye, Captain!&quot;);
+      state := STATE_MOVING;
+      relative_direction := 6;
+    endif
+  elseif(text[&quot;come about&quot;] || text[&quot;turn around&quot;])
+    if(state == STATE_STATIONARY)
+      PrintTextAbove(tillerman, &quot;The anchor is down, Captain!&quot;);
+    else
+      PrintTextAbove(tillerman, &quot;Aye Aye, Captain! Coming about!&quot;);
+      TurnBoat(boat, 2);
+      sleep(1);
+    endif
+/*NEW MAP COURSE COMMANDS*/
+    elseif(text[&quot;set course&quot;])
+      	PrintTextAbove(tillerman, &quot;Select a map for me to follow.&quot;);   	
+      	var map := Target(event.source);
+      	if(!map.isa(POLCLASS_MAP))
+      		PrintTextAbove(tillerman, &quot;Are ye dense? I need a map!&quot;); 
+      	else
+      		SetObjProperty(tillerman, &quot;course&quot;, map.GetPins());
+      		SetObjProperty(tillerman, &quot;nextwaypoint&quot;, 1);
+      		PrintTextAbove(tillerman, &quot;Arr, course plotted.&quot;); 
+      	endif
+    elseif(text[&quot;clear course&quot;])
+    	PrintTextAbove(tillerman, &quot;Arr, course cleared Cap'n.&quot;);
+    	EraseObjProperty(tillerman, &quot;course&quot;);
+    	EraseObjProperty(tillerman, &quot;nextwaypoint&quot;);
+    elseif(text[&quot;nav&quot;])
+    	if(state != STATE_FOLLOWING_COURSE)
+    		PrintTextAbove(tillerman, &quot;We are not currently following a course.&quot;);
+    	else
+    		PrintTextAbove(tillerman, &quot;We are following our course.&quot;);
+    		PrintTextAbove(tillerman, &quot;The next waypoint is #&quot; + GetObjProperty(tillerman,&quot;nextwaypoint&quot;));
+    	endif
+    elseif(text[&quot;start&quot;])
+    	if( (GetObjProperty(tillerman,&quot;course&quot;)==error) || (GetObjProperty(tillerman,&quot;nextwaypoint&quot;)==error))
+    		PrintTextAbove(tillerman,&quot;Arr, set course first Cap'n.&quot;);
+    	else    		
+     		state := STATE_FOLLOWING_COURSE;
+     		SetObjProperty(tillerman, &quot;nextwaypoint&quot;, 1);
+    		PrintTextAbove(tillerman,&quot;Aye, sailing to first waypoint.&quot;);
+    	endif
+    elseif(text[&quot;continue&quot;])
+    	if( (GetObjProperty(tillerman,&quot;course&quot;)==error) || (GetObjProperty(tillerman,&quot;nextwaypoint&quot;)==error))
+    		PrintTextAbove(tillerman,&quot;Arr, set course first Cap'n.&quot;);
+    	else
+    	    state := STATE_FOLLOWING_COURSE;
+    		PrintTextAbove(tillerman,&quot;Aye, moving on.&quot;);
+    	endif
+  	endif
+/*END NEW MAP COURSE COMMANDS*/
+  if(text[&quot;full&quot;])
+    if(state != STATE_STATIONARY)
+      PrintTextAbove(tillerman, &quot;Aye Aye, Captain! Full speed ahead!&quot;);
+      ms_delay_between_moves := 100;
+    endif
+  elseif(text[&quot;slow&quot;])
+    if(state != STATE_STATIONARY)
+      PrintTextAbove(tillerman, &quot;Aye Aye, Captain! &quot;);
+      ms_delay_between_moves := 1000;
+    endif
+  endif
+  sleep(1);
+  if(text[&quot;one&quot;])
+    if(state != STATE_STATIONARY)
+      MoveBoatRelative(boat, relative_direction);
+      state := STATE_STATIONARY;
+    endif
+  endif
+endfunction
+
+function process_event(event)
+  if(event.type == SYSEVENT_SPEECH)
+    if(CanCommandMe(event.source))
+      var text := lower(event.text);
+      if(text[&quot;drydock&quot;])
+        PrintTextAbove(tillerman, &quot;Aye Aye, Captain! Docking.&quot;);
+        drydock(event);
+        sleep(1);
+      elseif(text[&quot;status&quot;])
+        decay := GetObjProperty(boat.tillerman, &quot;decay&quot;);
+        if((decay - ReadGameClock() ) &gt; 861000 )
+          PrintTextAbove( tillerman, &quot;Arrh, the ship's in excellent shape! She's a fine vessel indeed, Captain!&quot; );
+        elseif((decay - ReadGameClock() ) &gt; 604800 )
+          PrintTextAbove( tillerman, &quot;She's slightly worn, Captain.&quot;);
+        elseif((decay - ReadGameClock() ) &gt; 259200 )
+          PrintTextAbove(tillerman, &quot;She's fairly worn, Captain.&quot;);
+        elseif((decay - ReadGameClock() ) &gt; 86400 )
+          PrintTextAbove(tillerman, &quot;Arrr, she's greatly worn and in dire need of repair, Captain!&quot;);
+        else 
+          PrintTextAbove(tillerman, &quot;Arrr, she's going to sink within the day if she don't get repairs soon, Captain!&quot;);
+        endif
+      else
+        foreach person in (boat.mobiles)
+          if (event.source == person)
+             handle_speech(event);
+          endif  
+        endforeach
+      endif
+    endif
+  endif
+  
+endfunction
+
+function CanCommandMe(who)
+  owner := GetObjProperty(boat.tillerman, &quot;owner&quot;);
+  if(who.serial == owner)
+    return 1;
+  else
+    var packkey;
+    var lokid := GetObjProperty(boat.tillerman, &quot;lockid&quot;);
+    foreach thing in EnumerateItemsInContainer(who.backpack)
+      if(GetObjProperty(thing, &quot;lockid&quot;) == lokid)
+        packkey := 1;
+        break;
+      endif
+    endforeach
+    if(packkey == 1)
+      return 1;
+    else
+      return 0;
+    endif
+  endif
+endfunction
+
+function DoEncounter()
+  foreach who in  ListMobilesNearLocationEx(boat.x, boat.y, GetMapInfo(boat.x, boat.y, boat.realm).z, 4, LISTEX_FLAG_GHOST, boat.realm)
+    if(YesNo(who,&quot;Resurrect?&quot;))
+      if (who in boat.mobiles)
+        PlaySoundEffect(who, SFX_SPELL_RESSURECTION);
+        PlaySoundEffect(who, SFX_SPELL_RESSURECTION);
+        Resurrect(who);
+      endif
+    endif
+  endforeach
+  var who :=(boat.mobiles);
+  who := who[1];
+  if(!who)
+    return;
+  endif
+  var x;
+  var y;
+  var z;
+  x := RandomInt(15)-5;
+  y := RandomInt(15)-5;
+  x := x + boat.x;
+  y := y + boat.y;
+  if(x &gt; boat.x)
+    x := x + 5;
+  else
+    x := x - 5;
+  endif
+  if(y &gt; boat.y)
+    y := y + 5;
+  else
+    y := y - 5;
+  endif
+  z := GetMapInfo(x, y, boat.realm).z;
+  if(z &gt;= who.z)
+    return;
+  endif
+  var it := CreateNpcFromTemplate(getcritter(), x, y, z, 0, boat.realm);
+  if(it)
+    SetObjProperty(it,&quot;killme&quot;,1);
+  endif
+  var ev := {};
+  ev.+type := EVID_ENTEREDAREA;
+  ev.+source := who;
+  SendEvent(it, ev);
+endfunction
+
+function checkres()
+  foreach who in  ListMobilesNearLocationEx(boat.x, boat.y, GetMapInfo(boat.x, boat.y, boat.realm).z, 4, LISTEX_FLAG_GHOST, boat.realm)
+    if(who in boat.mobiles)
+      if(YesNo(who,&quot;Resurrect?&quot;))
+        PlaySoundEffect(who, SFX_SPELL_RESSURECTION);
+        PlaySoundEffect(who, SFX_SPELL_RESSURECTION);
+        Resurrect(who);
+      endif
+    endif
+  endforeach
+endfunction
+
+function getcritter()
+  case(RandomInt(9))
+    0: return &quot;walrus&quot;;
+    1: return &quot;walrus&quot;;
+    2: return &quot;walrus&quot;;
+    3: return &quot;walrus&quot;;
+    4: return &quot;alligator&quot;;
+    5: return &quot;alligator&quot;;
+    6: return &quot;waterelemental&quot;;
+    7: return &quot;seaserpent&quot;;
+    8: return &quot;airelemental&quot;;
+  endcase
+endfunction
+
+function drydock(event)
+  if(GetObjProperty(event.source, &quot;#DryDocking&quot;))
+    SendSysMessage(event.source, &quot;You are already doing something else.&quot;);
+    return;
+  endif
+  SetObjProperty(event.source, &quot;#DryDocking&quot;, 1);
+  EraseObjProperty(event.source, &quot;#DryDocking&quot;);
+  var text := lower(event.text);
+  if(!text[&quot;drydock&quot;])
+    EraseObjProperty(event.source, &quot;#DryDocking&quot;);
+    return;
+  endif
+  var me := event.source;
+  var items := boat.items;
+  var mobsondeck := boat.mobiles;
+
+  if(len(items) &gt; 0)
+    PrintTextAbovePrivate(boat.tillerman, &quot;Arrh, Captain!  You can't drydock the boat while items are on deck!&quot;, me);
+    EraseObjProperty(me, &quot;#DryDocking&quot;);
+    return;
+  endif
+  items := EnumerateItemsInContainer(boat.hold);
+  if(len(items) &gt; 0)
+    PrintTextAbovePrivate(boat.tillerman, &quot;Arrh, we'd best clear out the items in the hold first, Captain!&quot;, me);
+    EraseObjProperty(me, &quot;#DryDocking&quot;);
+    return;
+  endif
+  if(len(mobsondeck) &gt; 0)
+    PrintTextAbovePrivate(boat.tillerman, &quot;Arrh, Captain!  You can't drydock the boat while people are on the deck!&quot;, me);
+    EraseObjProperty(me, &quot;#DryDocking&quot;);
+    return;
+  endif  
+  if(CanDockMe(boat, me))
+    if(!YesNo(me,&quot;Drydock the ship?&quot;))
+      EraseObjProperty(me, &quot;#DryDocking&quot;);
+      return;
+    endif
+    var shiptype;
+    case(boat.objtype)
+      0x6040: shiptype := 0x6027;
+      0x6041: shiptype := 0x6028;
+      0x6042: shiptype := 0x6029;
+      0x6043: shiptype := 0x602a;
+      0x6044: shiptype := 0x602b;
+      0x6045: shiptype := 0x602c;
+    endcase
+    if(!shiptype)
+      SendSysMessage(me, &quot;Your boat seems to be malfunctioning. Please page a GM.&quot;);
+      return;
+    endif
+    var newboat := CreateItemInContainer(me.backpack, shiptype, 1);
+    var key := FindKey(me, boat.tillerman);
+    if(!newboat)
+      SendSysMessage(me,&quot;Could not create boat deed in your backpack!&quot;);
+      EraseObjProperty(me, &quot;#DryDocking&quot;);
+      return;
+    endif
+    if(ReserveItem(newboat))
+      newboat.graphic := 0x14f3;
+      if(!boat.tillerman.name)
+        newboat.name := &quot;a toy boat&quot;;
+      else
+        newboat.name := boat.tillerman.name;
+      endif
+      if(!DestroyBoat(boat))
+        DestroyItem(newboat);
+        EraseObjProperty(me, &quot;#DryDocking&quot;);
+        return;
+      endif
+    else
+      DestroyItem(newboat);
+      EraseObjProperty(me, &quot;#DryDocking&quot;);
+      return;
+    endif
+    if(key)
+      DestroyItem(key);
+    endif
+  endif
+  EraseObjProperty(me, &quot;#DryDocking&quot;);
+endfunction
+
+function DestroyBoat(who)
+  var res := DestroyMulti(boat);
+  if(!res)
+    return 0;
+  endif
+  return 1;
+endfunction
+
+function SmackEveryone()
+  foreach mob in(boat.mobiles)
+    ApplyDamage(mob,RandomInt(10));
+    PerformAction(mob,0x14);
+    PlaySoundEffect(mob,0x110);
+  endforeach
+endfunction
+
+function PlayBoatSounds()
+  var who := RandomInt(len(boat.mobiles)+1);
+  var mobs :=(boat.mobiles);
+  if(RandomInt(2) == 1)
+    PlaySoundEffect(mobs[who],0x13);
+  else
+    PlaySoundEffect(mobs[who],0x14);
+  endif
+endfunction
+
+function WorldWrap()
+  var newx := boat.x;
+  var newy := boat.y;
+  if(boat.y &lt;= 6)
+    newy := 4088;
+  elseif(boat.y &gt;= 4089)
+    newy := 6;
+  endif
+  if(boat.x &lt;= 6)
+    newx := 5096;
+  elseif(boat.x &gt;= 5097)
+    newx := 6;
+  endif
+  var lockid := GetObjProperty(boat.hold, &quot;lockid&quot;);
+  var owner := GetObjProperty(boat.hold, &quot;owner&quot;);
+  var shiptype := boat.objtype;
+  var shipfacing, created;
+  case(tillerman.graphic)
+    0x3e4e: shipfacing := CRMULTI_FACING_NORTH;
+    0x3e55: shipfacing := CRMULTI_FACING_EAST;
+    0x3e4b: shipfacing := CRMULTI_FACING_SOUTH;
+    0x3e50: shipfacing := CRMULTI_FACING_WEST;
+    default: shipfacing := &quot;Error!&quot;;
+  endcase
+  if(shipfacing == &quot;Error!&quot;)
+    syslog( &quot;[ERROR] [boat.src] Couldn't tell which way the ship was facing for the worldwrap!&quot;);
+  endif    
+  created := CreateMultiAtLocation( newx, newy, -5, shiptype, shipfacing, boat.realm);
+  if(!created)
+    syslog( &quot;[ERROR] [boat.src] New ship couldn't be created for worldwrap!&quot;);
+    return;
+  endif
+  var oldshiphold := boat.hold;
+  var newshiphold := created.hold;
+  foreach item in EnumerateItemsInContainer( oldshiphold )
+    if(item.container == oldshiphold)
+      MoveItemToContainer(item, newshiphold);
+    endif
+  endforeach
+  foreach item in EnumerateItemsInContainer( oldshiphold )
+    MoveItemToContainer(item, newshiphold);
+  endforeach
+  foreach mob in(boat.mobiles)
+    MoveCharacterToLocation(mob,(mob.x-boat.x)+created.x,(mob.y-boat.y)+created.y, -2,  MOVECHAR_FORCELOCATION );
+  endforeach
+  if(boat.has_offline_mobiles)
+    foreach mob in(boat.offline_mobiles)
+      MoveCharacterToLocation(mob,(mob.x-boat.x)+created.x,(mob.y-boat.y)+created.y, -2,  MOVECHAR_FORCELOCATION );
+    endforeach
+  endif
+  foreach mob in(boat.items)
+    MoveitemToLocation(mob,(mob.x-boat.x)+created.x,(mob.y-boat.y)+created.y, -2,0  );
+  endforeach
+  var newtillerman := created.tillerman;
+  newtillerman.name := tillerman.name;
+  SetObjProperty( created.starboardplank, &quot;lockid&quot;, lockid);
+  SetObjProperty( created.portplank, &quot;lockid&quot;, lockid);
+  SetObjProperty( created.ship.starboardplank, &quot;owner&quot;, owner );
+  SetObjProperty( created.ship.portplank, &quot;owner&quot;, owner );
+  SetObjProperty( created.ship.starboardplank, &quot;tillermanid&quot;, newtillerman.serial );
+  SetObjProperty( created.ship.portplank, &quot;tillermanid&quot;, newtillerman.serial );
+  SetObjProperty( created.hold, &quot;lockid&quot;, lockid);
+  SetObjProperty( created.hold, &quot;owner&quot;, owner);
+  SetObjProperty( created.tillerman, &quot;owner&quot;, owner);
+  SetObjProperty( created.tillerman, &quot;shipserial&quot;, created.serial);
+  SetObjProperty( created.tillerman, &quot;lockid&quot;, lockid);
+  SetObjProperty( created.tillerman, &quot;decay&quot;, decay);
+  if(boat.starboardplank.locked == 1)
+    created.starboardplank.locked := 1;
+  endif
+  if(boat.portplank.locked == 1)  
+    created.portplank.locked := 1;
+  endif
+  if(boat.hold.locked == 1)
+    created.hold.locked := 1;
+  endif
+  SetObjProperty( created.hold, &quot;#relativedir&quot;, relative_direction);
+  SetObjProperty( created.hold, &quot;#speed&quot;, ms_delay_between_moves);
+  created.tillerman.usescript := &quot;:boat:tillerman&quot;;
+  if(!DestroyMulti(boat))
+    DestroyItem(boat.tillerman);
+    syslog( &quot;[ERROR] [boat.src] Old ship at &quot; +(boat.x-1) +&quot;,&quot;+ boat.y +&quot;,&quot;+ boat.z + &quot; couldn't be destroyed during worldwrap!&quot;);
+  endif
+endfunction
+
+function CanDockMe(boat, who)
+  if(GetObjProperty(boat.hold,&quot;owner&quot;) == who.serial)
+    return 1;
+  else
+    var packkey;
+    var lokid := GetObjProperty(boat.tillerman, &quot;lockid&quot;);
+    foreach thing in EnumerateItemsInContainer(who.backpack)
+      if(GetObjProperty(thing, &quot;lockid&quot;) == lokid)
+        packkey := 1;
+        break;
+      endif
+    endforeach
+    if(packkey == 1)
+      return 1;
+    else
+      return 0;
+    endif
+  endif
+endfunction
+
+/*NEW MAP COURSE FUNCTIONS*/
+//follows the current course
+function BoatFollowCourse(boat)
+	var startx, starty, destx, desty;
+	var course, nextwaypoint;
+	var newpoint, newfacing, prevfacing;
+	
+	course := GetObjProperty(boat.tillerman,&quot;course&quot;);
+	nextwaypoint := GetObjProperty(boat.tillerman,&quot;nextwaypoint&quot;);
+	startx := boat.x;
+	starty := boat.y;
+	prevfacing := boat.facing;
+	
+	if( (course==error) || (nextwaypoint==error))
+		return;
+	endif
+	
+	destx := course[nextwaypoint].x;
+	desty := course[nextwaypoint].y;
+	
+	newpoint := lineBresenham(startx,starty,destx,desty);
+	newfacing := GetNewFacing(startx,starty,newpoint[1],newpoint[2]);
+
+	if(newfacing == error) //reached waypoint/end
+		nextwaypoint := nextwaypoint + 1;
+		first_move_toward_waypoint := 1; //so we turn toward next waypoint (includes next course follow if we're done with this one)
+		if(nextwaypoint &gt; course.size()) //done
+			state := STATE_DRIFTING;
+			PrintTextAbove(boat.tillerman,&quot;Arr, we've reached our destination.&quot;);
+			return;
+		else
+			SetObjProperty(boat.tillerman,&quot;nextwaypoint&quot;,nextwaypoint);
+		endif
+		
+	else
+
+		if(first_move_toward_waypoint == 1)
+			if( prevfacing != newfacing )
+				TurnBoat(boat,Cint(DetermineTurnCode(boat,newfacing)) );
+			endif
+			first_move_toward_waypoint := 0;
+		endif
+		MoveBoat(boat,newfacing);
+		
+		if((startx == boat.x) &amp;&amp;(starty == boat.y)) //we didn't move. must be blocked
+    		state := STATE_DRIFTING;
+    		PrintTextAbove(tillerman, &quot;Aaargh!  We've stopped!&quot;);
+  		endif
+  	endif
+	
+endfunction
+
+//convert facing 0-7 to turn code 0-3
+function DetermineTurnCode( boat, desired )
+
+    var current := CInt(boat.facing / 2);
+    desired := CInt(desired / 2);
+
+	
+    if ( desired &lt; current ) 
+    	desired := desired + 4; 
+    endif
+    return (desired - current);
+endfunction
+	
+//returns the direction (x1,y1) lies from (x0,y0) in the range 0-7.
+// returns error if the 2 points are equal.
+function GetNewFacing(x0,y0,x1,y1)
+	var dx, dy;
+	var facing;
+	dx := x1 - x0;
+	dy := y1 - y0;
+	
+	case(dx)
+		NEGONE: 
+			case(dy)
+				 NEGONE: facing := 7;
+				 ZERO: facing := 6;
+				 POSONE: facing := 5;
+				 default: facing := error;
+			endcase
+		 ZERO:
+		 	case(dy)
+		 		 NEGONE: facing := 0;
+		 		 ZERO: facing := error;
+		 		 POSONE: facing := 4;
+		 		 default: facing := error;
+		    endcase
+		 POSONE:
+		 	case(dy)
+		 		 NEGONE: facing := 1;
+		 		 ZERO: facing := 2;
+		 		 POSONE: facing := 3;
+		 		 default: facing := error;
+		 	endcase
+		 default: facing := error;
+	endcase
+	
+	return facing;
+endfunction
+
+//Bresenham's line drawing algorithm. determines a line between two waypoints.
+function lineBresenham(x0, y0, x1, y1)
+    var dy;
+    dy := y1 - y0;
+    var dx;
+    dx := x1 - x0;
+    var stepx, stepy;
+
+    if (dy &lt; 0)
+      	dy := -dy;  
+       	stepy := -1;
+    else
+      	stepy := 1;
+    endif
+        
+    if (dx &lt; 0) 
+       	dx := -dx;
+       	stepx := -1;
+    else 
+      	stepx := 1;
+    endif
+        
+    dy := 2*dy;   
+    dx := 2*dx;    
+
+    if (dx &gt; dy)
+        var fraction;
+        fraction := 2*dy - dx;
+        while (x0 != x1)
+        	if (fraction &gt;= 0)
+            	y0 := y0 + stepy;
+                fraction := fraction - dx;
+           	endif
+            x0 := x0 + stepx;
+            fraction := fraction + dy;
+            return {x0, y0};
+        endwhile
+    else
+        var fraction;
+        fraction := 2*dx - dy;
+        while (y0 != y1)
+            if (fraction &gt;= 0)
+                x0 := x0 + stepx;
+                fraction := fraction - dy;
+            endif
+            y0 := y0 + stepy;
+            fraction := fraction + dx;
+            return {x0, y0};
+        endwhile
+    endif
+endfunction
+/*END NEW MAP COURSE FUNCTIONS*/

Added: trunk/096/pkg/multis/boat/itemdesc.cfg
===================================================================
--- trunk/096/pkg/multis/boat/itemdesc.cfg	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/boat/itemdesc.cfg	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,168 @@
+Item 0x6027
+{
+    Name                smallboatdeed
+    Desc                deed to a small boat
+    Graphic             0x14F2
+    Script              shipDeed
+    ShipObjType         smallboat
+    VendorSellsFor      12500
+    VendorBuysFor       12500
+	newbie              1
+}
+Item 0x6028
+{
+    Name                smalldragonboatdeed
+    Desc                deed to a small dragon boat
+    Graphic             0x14F2
+    Script              shipDeed
+    ShipObjType         smalldragonboat
+    VendorSellsFor      12500
+    VendorBuysFor       12500
+	newbie              1
+}
+
+
+Item 0x6029
+{
+    Name                mediumboatdeed
+    Desc                deed to a medium boat
+    Graphic             0x14F2
+    Script              shipDeed
+    ShipObjType         mediumboat
+    VendorSellsFor      14200
+    VendorBuysFor       14200
+	newbie              1
+}
+Item 0x602A
+{
+    Name                mediumdragonboatdeed
+    Desc                deed to a medium dragon boat
+    Graphic             0x14F2
+    Script              shipDeed
+    ShipObjType         mediumdragonboat
+    VendorSellsFor      14200
+    VendorBuysFor       14200
+	newbie              1
+}
+
+
+Item 0x602B
+{
+    Name                largeboatdeed
+    Desc                deed to a large boat
+    Graphic             0x14F2
+    Script              shipDeed
+    ShipObjType         largeboat
+    VendorSellsFor      15900
+    VendorBuysFor       15900
+	newbie              1
+}
+
+Item 0x602C
+{
+    Name                largedragonboatdeed
+	Desc                deed to a large dragon boat
+    Graphic             0x14F2
+    Script              shipDeed
+    ShipObjType         largedragonboat
+    VendorSellsFor      15900
+    VendorBuysFor       15900
+	newbie              1
+}
+
+Boat 0x6040
+{
+    Name                smallboat
+    Graphic             0x4000
+    MultiID             0x0000
+    OldObjtype          0x4000
+    OldObjtype          0x4001
+    OldObjtype          0x4002
+    OldObjtype          0x4003
+}
+
+Boat 0x6041
+{
+    Name                smalldragonboat
+    Graphic             0x4004
+    MultiID             0x0004
+    OldObjtype          0x4004
+    OldObjtype          0x4005
+    OldObjtype          0x4006
+    OldObjtype          0x4007
+}
+
+Boat 0x6042
+{
+    Name                mediumboat
+    Graphic             0x4008
+    MultiID             0x0008
+    OldObjtype          0x4008
+    OldObjtype          0x4009
+    OldObjtype          0x400A
+    OldObjtype          0x400B
+}
+
+Boat 0x6043
+{
+    Name                mediumdragonboat
+    Graphic             0x400C
+    MultiID             0x000C
+    OldObjtype          0x400C
+    OldObjtype          0x400D
+    OldObjtype          0x400E
+    OldObjtype          0x400F
+}
+
+Boat 0x6044
+{
+    Name                largeboat
+    Graphic             0x4010
+    MultiID             0x0010
+    OldObjtype          0x4010
+    OldObjtype          0x4011
+    OldObjtype          0x4012
+    OldObjtype          0x4013
+}
+
+Boat 0x6045
+{
+    Name                largedragonboat
+    Graphic             0x4014
+    MultiID             0x0014
+    OldObjtype          0x4014
+    OldObjtype          0x4015
+    OldObjtype          0x4016
+    OldObjtype          0x4017
+}
+
+Item 0xF010
+{
+    Name                Tillerman
+    graphic             1
+	script              tillerman
+}
+
+Item 0xF011
+{
+    Name                gangplank
+    Graphic             1
+    Lockable            1
+    RequiresAttention   0
+    DoubleclickRange    20
+    Script              plank
+    WalkOnScript        plankWalk
+    ControlScript       plankControl
+}
+
+Item 0xF012
+{
+    Name                gangplank2
+    Graphic             1
+    Lockable            1
+    RequiresAttention   0
+    DoubleclickRange    20
+    Script              plank
+    WalkOnScript        plankWalk
+    ControlScript       plankControl
+}

Added: trunk/096/pkg/multis/boat/pkg.cfg
===================================================================
--- trunk/096/pkg/multis/boat/pkg.cfg	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/boat/pkg.cfg	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,9 @@
+# $Id: pkg.cfg 684 2005-10-27 18:48:28Z muaddiblsd $
+#
+#
+Enabled		1
+Name		boat
+Maintainer	Distro Team
+Email		<A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">distro at polserver.com</A>
+Version		1.0
+

Added: trunk/096/pkg/multis/boat/plank.src
===================================================================
--- trunk/096/pkg/multis/boat/plank.src	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/boat/plank.src	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,92 @@
+use os;
+use uo;
+
+include &quot;util/key&quot;;
+include &quot;:itemutils:objtype&quot;;
+include &quot;plankUtil&quot;;
+
+program useplank(mob, plank)
+  set_critical(1);
+
+// Refresh the boat if he's the owner.
+var owner := GetObjProperty(plank, &quot;owner&quot;);
+if (mob.serial == owner)
+  var tillermanid := GetObjProperty(plank, &quot;tillermanid&quot;);
+  var tillerman := SystemFindObjectBySerial( tillermanid );
+  if (tillerman)
+    var decay := GetObjProperty(tillerman, &quot;decay&quot;);
+    // Only give him the refresh message if the ship was less than 'in excellent shape'
+    // so he doesn't get the message every time he gets on and off the ship.
+    if ( (decay - ReadGameClock() ) &lt; 860000 )
+          SendSysMessage(mob, &quot;Your ship has been refreshed.&quot;);
+    endif
+    SetObjProperty( tillerman, 	  &quot;decay&quot;,      (ReadGameClock()+ 864000));
+  endif
+endif
+  if(mob.multi.serial == plank.multi.serial)
+	TimedOpenClose(plank);
+  elseif((FK(mob, plank) == 1) ||(!plank.locked))
+	if(!IsExtended(plank))
+	  TimedOpenClose(plank);
+	else
+	  YankOntoBoat(mob,plank);
+	endif
+  else
+	PrintTextAbovePrivate(plank, &quot;That is locked.&quot;, mob);
+  endif
+endprogram
+
+function TimedOpenClose(plank)
+  if(IsExtended(plank))
+    if(!IsPlankOccupied(plank))
+      Retract(plank);
+      EraseObjProperty(plank, &quot;#WhenOpened&quot;);
+    endif
+  else
+    var whenopened := ReadGameClock();
+    SetObjProperty(plank, &quot;#WhenOpened&quot;, whenopened);
+    Extend(plank);
+    repeat
+    sleep(6);
+    until(!(plank &amp;&amp; IsPlankOccupied(plank)));
+    if(GetObjProperty(plank, &quot;#WhenOpened&quot;) == whenopened)
+      Retract(plank);
+      EraseObjProperty(plank, &quot;#WhenOpened&quot;);
+    endif
+  endif
+endfunction
+
+function YankOntoBoat(mob, plank)
+  var sh := GetStandingHeight(plank.x, plank.y, plank.z, plank.realm);
+  if(sh)
+    var nx :=(plank.x + plank.multi.x) / 2;
+    var ny :=(plank.y + plank.multi.y) / 2;
+    MoveCharacterToLocation(mob, nx, ny, plank.z);
+    return;
+  endif
+endfunction
+
+function CanWalkOntoPlank(plank)
+  var dx;
+  var dy;
+  case(plank.graphic)
+    GID_PLANK_EXTENDED_FACING_WEST:
+    GID_PLANK_RETRACTED_FACING_WEST:    dx := -1;
+                                        dy := 0;
+    GID_PLANK_EXTENDED_FACING_EAST:
+    GID_PLANK_RETRACTED_FACING_EAST:    dx := 1;
+                                        dy := 0;
+
+    GID_PLANK_EXTENDED_FACING_NORTH:
+    GID_PLANK_RETRACTED_FACING_NORTH:   dx := 0;
+                                        dy := -1;
+    GID_PLANK_EXTENDED_FACING_SOUTH:
+    GID_PLANK_RETRACTED_FACING_SOUTH:   dx := 0;
+                                        dy := 1;
+  endcase
+  if(GetStandingHeight(plank.x + dx, plank.y + dy, plank.z, plank.realm))
+    return 1;
+  else
+     return 0;
+  endif
+endfunction

Added: trunk/096/pkg/multis/boat/plankControl.src
===================================================================
--- trunk/096/pkg/multis/boat/plankControl.src	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/boat/plankControl.src	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,20 @@
+/*
+ * plankcontrol - plank control script
+ *
+ * sole job is to close an open locked plank on startup.
+ *
+ */
+
+use os;
+use uo;
+
+include &quot;:itemutils:objtype&quot;;
+include &quot;plankUtil&quot;;
+
+set_debug(1);
+
+program plankcontrol( plank )
+    if (plank.locked &amp;&amp; IsExtended(plank))
+        Retract( plank );
+    endif
+endprogram

Added: trunk/096/pkg/multis/boat/plankUtil.inc
===================================================================
--- trunk/096/pkg/multis/boat/plankUtil.inc	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/boat/plankUtil.inc	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,89 @@
+include &quot;:itemutils:objtype&quot;;
+
+const KEYSTART := 0x100e;
+const KEYEND := 0x1013;
+const KEYRING := 0x1011;
+
+function IsExtended( plank )
+  return plank.graphic in { GID_PLANK_EXTENDED_FACING_EAST, GID_PLANK_EXTENDED_FACING_WEST, GID_PLANK_EXTENDED_FACING_NORTH, GID_PLANK_EXTENDED_FACING_SOUTH };
+endfunction
+
+function IsPlankOccupied( plank )
+  return ListMobilesNearLocation( plank.x, plank.y, plank.z, 0, plank.realm ).size();
+endfunction
+
+function Extend( plank )
+  if (!IsExtended(plank))
+    TogglePlank(plank);
+  endif
+endfunction
+
+function Retract( plank )
+  if (IsExtended(plank))
+    TogglePlank(plank);
+  endif
+endfunction
+
+function TogglePlank( plank )
+  var partnertype := PlankPartner( plank.graphic );
+  if (partnertype)
+    plank.graphic := partnertype;
+  endif
+endfunction
+
+function PlankPartner( planktype )
+  case (planktype)
+    GID_PLANK_EXTENDED_FACING_EAST:  return GID_PLANK_RETRACTED_FACING_EAST;   // 0x3ed5: return 0x3eb1;
+    GID_PLANK_RETRACTED_FACING_EAST: return GID_PLANK_EXTENDED_FACING_EAST;    // 0x3eb1: return 0x3ed5;
+    GID_PLANK_EXTENDED_FACING_WEST:  return GID_PLANK_RETRACTED_FACING_WEST;   // 0x3ed4: return 0x3eb2;
+    GID_PLANK_RETRACTED_FACING_WEST: return GID_PLANK_EXTENDED_FACING_WEST;    // 0x3eb2: return 0x3ed4;
+    GID_PLANK_EXTENDED_FACING_NORTH:  return GID_PLANK_RETRACTED_FACING_NORTH; // 0x3e84: return 0x3e85;
+    GID_PLANK_RETRACTED_FACING_NORTH: return GID_PLANK_EXTENDED_FACING_NORTH;  // 0x3e85: return 0x3e84;
+    GID_PLANK_EXTENDED_FACING_SOUTH:  return GID_PLANK_RETRACTED_FACING_SOUTH; // 0x3e89: return 0x3e8a;
+    GID_PLANK_RETRACTED_FACING_SOUTH: return GID_PLANK_EXTENDED_FACING_SOUTH;  // 0x3e8a: return 0x3e89;
+    default: syslog( &quot;Unknown plank type 0x&quot; + Hex( planktype ) );
+             return error;
+  endcase
+endfunction
+
+function fk(me, plank)
+  var doorlockid := GetObjProperty( plank, &quot;lockid&quot; );
+  var keylockid;
+  var insidering;
+  var mykeys := EnumerateItemsInContainer(me.backpack);
+  foreach key in mykeys
+	if ( (key.objtype &gt;= KEYSTART ) &amp;&amp; (key.objtype &lt;= KEYEND) &amp;&amp; (key.objtype != KEYRING ) )
+	  keylockid := GetObjProperty( key, &quot;lockid&quot; );
+	  if ( (keylockid) &amp;&amp; (keylockid == doorlockid) )
+		return 1;
+	  endif
+	elseif (key.objtype == KEYRING)
+	  insidering := FindMyPack(key.serial);
+	  foreach otherkey in EnumerateItemsInContainer(insidering)
+		keylockid := GetObjProperty( otherkey, &quot;lockid&quot; );
+		if (keylockid == doorlockid)
+		  return 1;
+		endif
+	  endforeach
+	endif
+  endforeach
+  return 0;
+endfunction
+
+function OpenTamedStorageAreas()
+  var bank := FindStorageArea( &quot;Tamed Storage&quot; );
+  if (!bank)
+    bank := CreateStorageArea( &quot;Tamed Storage&quot; );
+  endif
+  return bank;
+endfunction
+
+function FindMyPack(myserial)
+  var mybank := OpenTamedStorageAreas();
+  var bank_obj_name := &quot;Bankbox  &quot; + Hex(myserial);
+  var bankbox := FindRootItemInStorageArea( mybank, bank_obj_name );
+  if (!bankbox)
+    bankbox := CreateRootItemInStorageArea(mybank, bank_obj_name, UOBJ_BANKBOX  );
+  endif
+  return bankbox;
+endfunction
\ No newline at end of file

Added: trunk/096/pkg/multis/boat/plankWalk.src
===================================================================
--- trunk/096/pkg/multis/boat/plankWalk.src	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/boat/plankWalk.src	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,158 @@
+use os;
+use uo;
+
+include &quot;include/client&quot;;
+include &quot;:itemutils:objtype&quot;;
+include &quot;util/key&quot;;
+include &quot;plankUtil&quot;;
+
+/*
+ * the searchoffset matrix is for an east-facing plank.
+ * these will have to be rotated for the other positions
+ *   P is the plank, N is where you can't step (otherwise
+ *    this teleportation stuff wouldn't be necessary)
+ *
+ *        13 12 11
+ *        14  5  4
+ *        15  6  2
+ *        16  7  1 N P
+ *        17  8  3
+ *        18  9 10
+ *        19 20 21
+ *
+ */
+
+var searchoffset := {
+   { -2,  0 },          //  1
+   { -2, -1 },
+   { -2, +1 },
+   { -2, -2 },
+   { -3, -2 },          //  5
+   { -3, -1 },
+   { -3,  0 },
+   { -3, +1 },
+   { -3, +2 },
+   { -2, +2 },          // 10
+   { -2, -3 },
+   { -3, -3 },
+   { -4, -3 },
+   { -4, -2 },
+   { -4, -1 },          // 15
+   { -4,  0 },
+   { -4, +1 },
+   { -4, +2 },
+   { -4, +3 },
+   { -3, +3 },          // 20
+   { -2, +3 },
+   { -5,  0 },
+   { -5, +2 },
+   { -5, +3 },
+   { -5, +4 },
+   { -4, +4 },          // 20
+   { -3, +4 },
+   { -6,  0 },
+   { -6, +3 },
+   { -6, +4 },
+   { -6, +5 },
+   { -5, +5 },          // 20
+   { -4, +5 }
+};
+
+program plankwalk( who, plank, lastx, lasty, lastz )
+    if (!FindKey( who, plank ))
+        if (plank.locked)
+            var sh := GetStandingHeight( lastx, lasty, lastz, who.realm );
+            if (!sh || !sh.multi || sh.multi.serial != plank.multi.serial)
+                MoveCharacterToLocation( who, lastx, lasty, lastz, MOVECHAR_FORCELOCATION );
+                return;
+            endif
+        endif
+    endif
+
+    if (ListMobilesNearLocation( plank.x, plank.y, plank.z, 0, plank.realm ).size() &gt; 1)
+        MoveCharacterToLocation( who, lastx, lasty, lastz, MOVECHAR_FORCELOCATION );
+        return;
+    endif
+
+    var xidx, yidx, xmul, ymul;
+
+    case (plank.graphic)
+        GID_PLANK_EXTENDED_FACING_WEST:
+            if (! (who.facing in { DIR_W, DIR_NW, DIR_SW }))
+                return;
+            endif
+            xidx := 1;
+            yidx := 2;
+            xmul := 1;
+            ymul := 1;
+
+        GID_PLANK_EXTENDED_FACING_EAST:
+            if (! (who.facing in { DIR_E, DIR_NE, DIR_SE }))
+                return;
+            endif
+            xidx := 1;
+            yidx := 2;
+            xmul := -1; // flip across x-axis
+            ymul := 1;
+
+        GID_PLANK_EXTENDED_FACING_NORTH:
+            if (! (who.facing in { DIR_N, DIR_NE, DIR_NW }))
+                return;
+            endif
+            xidx := 2;
+            yidx := 1;
+            xmul := 1;
+            ymul := +1;
+
+        GID_PLANK_EXTENDED_FACING_SOUTH:
+            if (! (who.facing in { DIR_S, DIR_SE, DIR_SW }))
+                return;
+            endif
+            xidx := 2;
+            yidx := 1;
+            xmul := 1;
+            ymul := -1; // flip across y-axis
+
+        default:
+            return;
+    endcase
+    if (CanMove( who,
+                 searchoffset[1][xidx] * xmul / 2,
+                 searchoffset[1][yidx] * ymul / 2 ))
+        return;                     // doesn't need our help!
+    endif
+
+
+    foreach offset in searchoffset
+        if (TryMove( who, offset[xidx] * xmul, offset[yidx] * ymul ))
+            return;
+        endif
+    endforeach
+endprogram
+
+function TryMove( who, dx, dy )
+    var res := 0;
+    set_critical( 1 );
+
+    var tryx := who.x + dx;
+    var tryy := who.y + dy;
+    var h := GetStandingHeight( tryx, tryy, who.z, who.realm );
+    if (h &amp;&amp; (not h.multi)) // CHECKME should check line of sight?
+        MoveCharacterToLocation( who, tryx, tryy, h.z );
+        res := 1;
+    endif
+
+    set_critical(0);
+    return res;
+endfunction
+
+function CanMove( who, dx, dy )
+    var tryx := who.x + dx;
+    var tryy := who.y + dy;
+    var h := GetStandingHeight( tryx, tryy, who.z, who.realm );
+    if (h)
+        return 1;
+    else
+        return 0;
+    endif
+endfunction
\ No newline at end of file

Added: trunk/096/pkg/multis/boat/shipDeed.src
===================================================================
--- trunk/096/pkg/multis/boat/shipDeed.src	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/boat/shipDeed.src	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,128 @@
+// $Id: shipDeed.src 905 2005-11-05 08:20:50Z muaddiblsd $
+
+use cfgfile;
+use uo;
+use os;
+
+include &quot;util/key&quot;;
+include &quot;:itemutils:objtype&quot;;
+include &quot;:itemutils:canAccess&quot;;
+
+program useshipdeed(who, deed)
+  if(DeedAlreadyBuiltFrom(deed))
+    PrintTextAbovePrivate(deed, &quot;That ship has already been built.&quot;, who);
+  elseif(can_access(who, deed))
+    BuildShip(who, deed);
+  endif
+endprogram
+
+function BuildShip(who, deed)
+  var shiptype := GetShipObjtype(deed.objtype);
+  if(!shiptype)
+    PrintTextAbovePrivate(deed, &quot;That ship deed appears to be broken.&quot;, who);
+    return;
+  endif
+  var flags := ShipFacingFlags(who.facing);
+  var where := TargetMultiPlacement(who, shiptype, flags);
+  if(!where)
+    if(deed.graphic == 5363)
+      deed.graphic := 5364;
+    elseif(deed.graphic == 5364)
+      deed.graphic := 5363;
+    endif
+    return;
+  elseif((where.x == deed.x) &amp;&amp; (where.y == deed.y))
+    if(deed.graphic == 5363)
+      deed.graphic := 5364;
+    elseif(deed.graphic == 5364)
+      deed.graphic := 5363;
+    endif
+    return;
+  endif
+  set_critical(1);
+  if((where.x &lt; who.x - 10) || (where.y &lt; who.y - 10) || (where.x &gt; who.x + 10) || (where.y &gt; who.y + 10))
+    SendSysMessage(who, &quot;You cannot place a boat that far away.&quot;);
+    return;
+  endif
+  var created := CreateShipKeysAndBuiltDeed(who, shiptype, where.x, where.y, where.z, flags);
+  if(created)
+    var ship := created.ship;
+    var deedtype := deed.objtype;
+    if((deed.name != &quot;a toy boat&quot;) &amp;&amp; (!deed.name[&quot;deed&quot;]))
+      ship.tillerman.name := deed.name;
+    endif
+    if(DestroyItem(deed))
+      ship.starboardplank.locked    := 1;
+      ship.portplank.locked         := 1;
+      ship.hold.locked              := 1;
+      var lockid := AllocLockId();
+      SetObjProperty(ship.starboardplank, &quot;lockid&quot;,      lockid);
+      SetObjProperty(ship.starboardplank, &quot;owner&quot;,       who.serial);
+      SetObjProperty(ship.starboardplank, &quot;tillermanid&quot;, ship.tillerman.serial);
+      SetObjProperty(ship.portplank,      &quot;lockid&quot;,      lockid);
+      SetObjProperty(ship.portplank,      &quot;owner&quot;,       who.serial);
+      SetObjProperty(ship.portplank,      &quot;tillermanid&quot;, ship.tillerman.serial);
+      SetObjProperty(ship.hold,           &quot;lockid&quot;,      lockid);
+      SetObjProperty(ship.tillerman,      &quot;owner&quot;,       who.serial);
+      SetObjProperty(ship.tillerman,      &quot;shipserial&quot;,  ship.serial);
+      SetObjProperty(ship.tillerman,      &quot;lockid&quot;,      lockid);
+      SetObjProperty(ship.tillerman,      &quot;shiptype&quot;,    deedtype);
+      SetObjProperty(created.packkey,     &quot;lockid&quot;,      lockid);
+      SetObjProperty(created.packkey,     &quot;shipserial&quot;,  ship.serial);
+      SetObjProperty(ship.tillerman,      &quot;decay&quot;,       (ReadGameClock()+ 864000));
+      ship.tillerman.usescript := &quot;:boat:tillerman&quot;;
+    else
+      DestroyItem(created.packkey);
+      DestroyMulti(ship);
+      SendSysMessage(who, &quot;There was an error creating the boat.&quot;);
+    endif
+  endif
+endfunction
+
+function ShipFacingFlags(facing)
+  var flags := 0;
+  case (facing)
+    DIR_N:  flags := CRMULTI_FACING_NORTH;
+    DIR_NE: flags := CRMULTI_FACING_NORTH;
+    DIR_E:  flags := CRMULTI_FACING_EAST;
+    DIR_SE: flags := CRMULTI_FACING_SOUTH;
+    DIR_S:  flags := CRMULTI_FACING_SOUTH;
+    DIR_SW: flags := CRMULTI_FACING_SOUTH;
+    DIR_W:  flags := CRMULTI_FACING_WEST;
+    DIR_NW: flags := CRMULTI_FACING_NORTH;
+  endcase
+  return flags;
+endfunction
+
+function CreateShipKeysAndBuiltDeed(who, shiptype, x, y, z, flags)
+  var packkey := CreateItemInBackpack(who, UOBJ_COPPER_KEY);
+  if(!packkey)
+    PrintTextAbovePrivate(who, &quot;My backpack is too full!&quot;, who);
+    return 0;
+  endif
+  var ship := CreateMultiAtLocation(x, y, z, shiptype, flags, who.realm);
+  if(!ship)
+    PrintTextAbovePrivate(who, &quot;I can't place the ship there.&quot;, who);
+    DestroyItem(packkey);
+    return 0;
+  else
+    var result := struct;
+    result.+packkey := packkey;
+    result.+ship    := ship;
+    return result;
+  endif
+endfunction
+
+function DeedAlreadyBuiltFrom(deed)
+  if(GetObjProperty(deed, &quot;builtserial&quot;))
+    return 1;
+  else
+    return 0;
+  endif
+endfunction
+
+function GetShipObjtype(objtype)
+    var cfg := ReadConfigFile(&quot;:boat:itemdesc&quot;);
+    var ot := GetObjtypeByName(cfg[objtype].ShipObjType);
+    return Cint(ot);
+endfunction
\ No newline at end of file

Added: trunk/096/pkg/multis/boat/tillerman.src
===================================================================
--- trunk/096/pkg/multis/boat/tillerman.src	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/boat/tillerman.src	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,22 @@
+use os;
+use uo;
+
+include &quot;util/key&quot;;
+include &quot;:itemutils:objtype&quot;;
+include &quot;plankUtil&quot;;
+
+program renameboat(you, tillerman)
+  if((GetObjProperty(tillerman,&quot;owner&quot;) != you.serial) &amp;&amp;(you.cmdlevel &lt; 2))
+	PrintTextAbove(tillerman,&quot;Stop that, or I'll throw ye overboard!&quot;);
+	return;
+  endif
+    var boatname := RequestInput(you, tillerman, &quot;Enter a new name for this boat.(max 40 characters)&quot;);
+  if(boatname)
+	if(len(boatname) &lt;= 40)
+	  tillerman.name := boatname;
+	  SendSysMessage(you, &quot;Boat is renamed.&quot;);
+	else
+	  SendSysMessage(you, &quot;Too many characters in name.&quot;);
+	endif
+  endif
+endprogram
\ No newline at end of file

Added: trunk/096/pkg/multis/housing/changeOwner.src
===================================================================
--- trunk/096/pkg/multis/housing/changeOwner.src	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/housing/changeOwner.src	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,371 @@
+// $Id: changeOwner.src 905 2005-11-05 08:20:50Z muaddiblsd $
+
+use uo;
+use os;
+use cfgfile;
+
+include &quot;:containers:storageAreas&quot;;
+include &quot;util/key&quot;;
+include &quot;:itemutils:canAccess&quot;;
+
+const UOBJECT_DOORS_START := 0x0675;
+const UOBJECT_DOORS_END   := 0x06f4;
+const UOBJECT_BRASS_SIGN := 0x0bd2;
+const UOBJECT_WOOD_SIGN := 0x0bd0;
+
+program ChangeHouseOwner(who, title)
+  if(!ReserveItem(title))
+    return;
+  endif
+  if(!can_access(who, title))
+    return;
+  endif
+  var houseserial := GetObjProperty(title, &quot;builtserial&quot;);
+  if(houseserial == error)
+    SendSysMessage(who, &quot;That deed is invalid.&quot;);
+    return;
+  endif
+  var house :=  SystemFindObjectBySerial(houseserial);
+  if(house == error)
+    SendSysMessage(who, &quot;Error finding the built house!&quot;);
+    syslog(house.errortext);
+    return;
+  endif
+  var oldownerserial := GetObjProperty(house, &quot;ownerserial&quot;);
+  if((oldownerserial == who.serial) &amp;&amp; (GetObjProperty(house, &quot;footage&quot;)))
+    SendSysMessage(who, &quot;You are already the owner of that house.&quot;);
+    return;
+  else
+    SetObjProperty(house, &quot;ownerserial&quot;, who.serial);
+    SetObjProperty(house, &quot;owneracct&quot;,   who.acctname);
+    if((oldownerserial != who.serial))
+      EraseObjProperty(house, &quot;friendlist&quot;);
+      EraseObjProperty(house, &quot;coownlist&quot;);
+      EraseObjProperty(house, &quot;banlist&quot;);
+    endif
+    var bankbox := CP_GetStorageContainerForMobile(who, CP_DEFAULT_AREA, 1);
+    var packkey := CreateItemInBackpack( who, UOBJ_GOLD_KEY );
+    if(!packkey)
+      SendSysMessage( who, &quot;My backpack is too full!&quot;);
+      return;
+    endif
+    var bankkey := CreateItemInContainer( bankbox, UOBJ_GOLD_KEY );
+    if(!bankkey)
+      SendSysMessage( who, &quot;My bankbox is too full!&quot;);
+      DestroyItem( packkey );
+      return;
+    endif
+    var housetype := house.objtype;
+    var footage := FindBoxArray(housetype, house);
+    SetObjProperty(house, &quot;footage&quot;, footage);
+    var lockid := AllocLockId();
+    SetObjProperty( packkey, &quot;lockid&quot;, lockid );
+    SetObjProperty( bankkey, &quot;lockid&quot;, lockid );
+    var lists := GetObjProperty(house, &quot;footage&quot;);
+    var itemlist := {};
+    var holder;
+    foreach thing in lists
+      holder := ListObjectsInBox(thing[1], thing[2], thing[3], thing[4], thing[5],thing[6],who.realm);
+      foreach thing in holder
+        itemlist.append(thing);
+      endforeach
+    endforeach
+    foreach itemt in itemlist
+      if((itemt.objtype == UOBJECT_BRASS_SIGN) || (itemt.objtype == UOBJECT_WOOD_SIGN))
+        SetObjProperty(itemt, &quot;lockid&quot;,       lockid);
+        SetObjProperty(itemt, &quot;ownerserial&quot;,  who.serial);
+        SetObjProperty(itemt, &quot;owneracct&quot;,    who.acctname);
+      elseif(((itemt.objtype &gt;= UOBJECT_DOORS_START) &amp;&amp; (itemt.objtype &lt;= UOBJECT_DOORS_END)))
+        itemt.locked := 1;
+        SetObjProperty(itemt, &quot;lockid&quot;, lockid);
+      else
+        EraseObjProperty(itemt, &quot;houseserial&quot;);
+        if((GetObjProperty(itemt, &quot;secure&quot;) == 1) &amp;&amp; (itemt.movable == 0))
+          EraseObjProperty(itemt, &quot;secure&quot;);
+          EraseObjProperty(itemt, &quot;houseserial&quot;);
+          var oldscript := GetObjProperty(itemt, &quot;oldscript&quot;);
+          if (oldscript == error)
+            oldscript := &quot;&quot;;
+          endif
+          itemt.usescript := oldscript;
+          itemt.movable := 1;
+          EraseObjProperty(itemt, &quot;houseserial&quot; );
+          EraseObjProperty(itemt, &quot;oldscript&quot; );
+        elseif((GetObjProperty(itemt, &quot;lockeddown&quot; ) == 1) &amp;&amp; (itemt.movable == 0))
+          itemt.movable := 1;
+          EraseObjProperty(itemt, &quot;lockeddown&quot;);
+        endif
+      endif
+    endforeach
+    SetObjProperty(house, &quot;numlockdowns&quot;, GetObjProperty(title, &quot;numlockdowns&quot;));
+    SetObjProperty(house, &quot;numsecure&quot;,    GetObjProperty(title, &quot;numsecure&quot;));
+    MoveItemToContainer(title, bankbox, x := -1, y := -1 );
+    SendSysMessage(who, &quot;You have taken ownership of the house.&quot; );
+  endif
+endprogram
+
+function FindBoxArray(housetype, house)
+  var footage;
+  case(housetype)
+    0x6060: footage := smallhousearray(house, house.x, house.y, house.z); //smallstoneandplasterhouse
+    0x6061: footage := smallhousearray(house, house.x, house.y, house.z); //smallstonehouse
+    0x6062: footage := smallhousearray(house, house.x, house.y, house.z); //smallstonehousetwo
+    0x6063: footage := smallhousearray(house, house.x, house.y, house.z); //smallwoodenhouse
+    0x6064: footage := smallhousearray(house, house.x, house.y, house.z); //smallplasterhouse
+    0x6073: footage := smallhousearray(house, house.x, house.y, house.z); //smallwoodandstrawhouse
+    0x6065: footage := largehousearray(house, house.x, house.y, house.z); //largebrickhouse
+    0x6072: footage := largehousearray(house, house.x, house.y, house.z); //largepatiohouse
+    0x6066: footage := twostoryarray(house, house.x, house.y, house.z); //twostorywoodandplasterhouse
+    0x6068: footage := twostoryarray(house, house.x, house.y, house.z); //twostorystoneandplasterhouse
+    0x6069: footage := bigtowerarray(house, house.x, house.y, house.z); //tower
+    0x6070: footage := keeparray(house, house.x, house.y, house.z); //keep
+    0x6071: footage := castlearray(house, house.x, house.y, house.z); //castle
+  endcase
+  return footage;
+endfunction
+
+function smallhousearray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 2);
+  box1.append(y - 2);
+  box1.append(z + 7);
+  box1.append(x + 2);
+  box1.append(y + 2);
+  box1.append(z + 27);
+  boxarray[1] := box1;
+  var banarray := {};
+  var bantile;
+  bantile := CreateItemAtLocation(x-1, y+4, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-0, y+4, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1, y+4, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+function largehousearray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 6);
+  box1.append(y - 6);
+  box1.append(z + 7);
+  box1.append(x + 6);
+  box1.append(y + 5);
+  box1.append(z + 27);
+  boxarray[1] := box1;
+  var banarray := {};
+  var bantile;
+  if(house.objtype == 0x608c)
+    bantile := CreateItemAtLocation(x-5, y+7, Z+4, 0x9999, 1, house.realm);
+    banarray.append(bantile.serial);
+    SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+    bantile := CreateItemAtLocation(x-4, y+7, Z+4, 0x9999, 1, house.realm);
+    banarray.append(bantile.serial);
+    SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+    bantile := CreateItemAtLocation(x-3, y+7, Z+4, 0x9999, 1, house.realm);
+    banarray.append(bantile.serial);
+    SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+    bantile := CreateItemAtLocation(x-2, y+7, Z+4, 0x9999, 1, house.realm);
+    banarray.append(bantile.serial);
+    SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  else
+    bantile := CreateItemAtLocation(x-2, y+7, Z+4, 0x9999, 1, house.realm);
+    banarray.append(bantile.serial);
+    SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+    bantile := CreateItemAtLocation(x-1, y+7, Z+4, 0x9999, 1, house.realm);
+    banarray.append(bantile.serial);
+    SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+    bantile := CreateItemAtLocation(x, y+7, Z+4, 0x9999, 1, house.realm);
+    banarray.append(bantile.serial);
+    SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+    bantile := CreateItemAtLocation(x+1, y+7, Z+4, 0x9999, 1, house.realm);
+    banarray.append(bantile.serial);
+    SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  endif
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+function twostoryarray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 6);
+  box1.append(y - 6);
+  box1.append(z + 7);
+  box1.append(x    );
+  box1.append(y + 5);
+  box1.append(z + 47);
+  boxarray[1] := box1;
+  box1 := {};
+  box1.append(x    );
+  box1.append(y    );
+  box1.append(z + 7);
+  box1.append(x + 5);
+  box1.append(y + 5);
+  box1.append(z + 47);
+  boxarray[2] := box1;
+  var banarray := {};
+  var bantile;
+  bantile := CreateItemAtLocation(x-4, y+7, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-3, y+7, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-2, y+7, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-1, y+7, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+function bigtowerarray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 6);
+  box1.append(y - 6);
+  box1.append(z + 6);
+  box1.append(x + 7);
+  box1.append(y + 5);
+  box1.append(z + 65);
+  boxarray[1] := box1;
+  box1 := {};
+  box1.append(x - 10);
+  box1.append(y - 6);
+  box1.append(z + 66);
+  box1.append(x + 11);
+  box1.append(y + 5);
+  box1.append(z + 86);
+  boxarray[2] := box1;
+  var banarray := {};
+  var bantile;
+  bantile := CreateItemAtLocation(x-1, y+8, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x, y+8, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1, y+8, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+2, y+8, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-1, y+7, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x, y+7, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1, y+7, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+2, y+7, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+function castlearray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 14);
+  box1.append(y - 14);
+  box1.append(z     );
+  box1.append(x + 14);
+  box1.append(y + 14);
+  box1.append(z + 47);
+  boxarray[1] := box1;
+  var banarray := {};
+  var bantile;
+  bantile := CreateItemAtLocation(x-1, y+16, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x, y+16, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1, y+16, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+2, y+16, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-1, y+10, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x, y+10, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1, y+10, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+2, y+10, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-1,  y+6, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x,  y+6, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1,  y+6, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+2,  y+6, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-2, y-10, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-1, y-10, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x, y-10, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1, y-10, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+function keeparray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 10);
+  box1.append(y - 10);
+  box1.append(z     );
+  box1.append(x + 11);
+  box1.append(y + 11);
+  box1.append(z + 47);
+  boxarray[1] := box1;
+  var banarray := {};
+  var bantile;
+  bantile := CreateItemAtLocation(x-1, y+11, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x, y+11, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1, y+11, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+2, y+11, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+

Added: trunk/096/pkg/multis/housing/commands/gm/destroyMulti.src
===================================================================
--- trunk/096/pkg/multis/housing/commands/gm/destroyMulti.src	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/housing/commands/gm/destroyMulti.src	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,34 @@
+/*
+ * $Id: destroyMulti.src 664 2005-10-27 03:36:13Z muaddiblsd $
+ *
+ */
+
+use uo;
+
+
+program textcmd_DestroyMulti(who, serial)
+	serial := CInt(serial);
+	var multi;
+	
+	if ( !serial )
+		SendSysMessage(who, &quot;Target an item in the multi.&quot;);
+		var targ := target(who);
+	
+		if ( targ.multi )
+			multi := targ.multi;
+		else
+			PrintTextAbovePrivate(targ, &quot;I dont have a multi property.&quot;, who);
+			return 0;
+		endif
+	else
+		multi := SystemFindObjectBySerial(serial);
+	endif
+	
+	var destroyed := DestroyMulti(multi);
+	
+	if ( destroyed.errortext )
+		SendSysMessage(who, &quot;Error: &quot;+destroyed.errortext);
+	endif
+	
+	return destroyed;
+endprogram

Added: trunk/096/pkg/multis/housing/commands/gm/makeMulti.src
===================================================================
--- trunk/096/pkg/multis/housing/commands/gm/makeMulti.src	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/housing/commands/gm/makeMulti.src	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,27 @@
+/*
+ * $Id: makeMulti.src 664 2005-10-27 03:36:13Z muaddiblsd $
+ *
+ */
+
+use uo;
+
+
+program textcmd_MakeMulti(who, text)
+	if ( !CInt(text) )
+		text := GetObjTypeByName(text);
+	endif
+	
+	var targ := TargetMultiPlacement(who, text);
+	
+	if ( targ == error )
+		SendSysMessage(who, &quot;[&quot;+text+&quot;] -&gt;&quot;+targ.errortext);
+		return 0;
+	endif
+	
+	var multi := CreateMultiAtLocation(targ.x, targ.y, targ.z, text, CRMULTI_IGNORE_ALL, who.realm);
+	if ( multi.errortext )
+		SendSysMessage(who, &quot;Error:&quot;+multi.errortext);
+	endif
+	
+	return multi;
+endprogram

Added: trunk/096/pkg/multis/housing/houseBanning.src
===================================================================
--- trunk/096/pkg/multis/housing/houseBanning.src	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/housing/houseBanning.src	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,26 @@
+use os;
+use uo;
+
+program walk_on_moongate(who, tile)
+  var hserial := GetObjProperty(tile, &quot;house_serial&quot;);
+  var house := SystemFindObjectBySerial( CInt(hserial) );
+  var sign := SystemFindObjectBySerial(GetObjProperty(house,&quot;signserial&quot;));
+  if(!sign)
+    var signarray := {0x0bd1, 0x0bd2, 0x0bcf, 0x0bd0};
+    foreach thing in (house.components)
+      if(thing.objtype in signarray)
+        sign := thing;
+        SetObjProperty(house, &quot;signserial&quot;, sign.serial);
+        break;
+      endif
+    endforeach
+  endif
+  var banlist := GetObjProperty(house, &quot;banlist&quot;);
+  if(!banlist)
+    return;
+  endif
+  if(who.serial in banlist)
+    MoveCharacterToLocation( who, sign.x, sign.y, sign.z, MOVECHAR_FORCELOCATION );
+    SendSysMessage(who, &quot;You are banned from that house and cannot enter it!&quot;);
+  endif
+endprogram

Added: trunk/096/pkg/multis/housing/houseDeed.src
===================================================================
--- trunk/096/pkg/multis/housing/houseDeed.src	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/housing/houseDeed.src	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,724 @@
+use cfgfile;
+use uo;
+use os;
+
+include &quot;util/key&quot;;
+include &quot;:containers:storageAreas&quot;;
+include &quot;:itemutils:objtype&quot;;
+include &quot;:coords:findCity&quot;;
+include &quot;:itemutils:canAccess&quot;;
+include &quot;:coords:isValidLoc&quot;;
+
+const UOBJECT_DOORS_START:=0x675;
+const UOBJECT_DOORS_END:=0x6f4;
+const UOBJECT_BRASS_SIGN:=0xbd2;
+const UOBJECT_WOOD_SIGN:=0xbd0;
+const UOBJECT_WOOD_SIGNTWO:=0xbd1;
+const UOBJECT_TENT_CHEST:=0xe43;
+
+program usehousedeed(character, deed)
+  if(!ReserveItem(deed))
+    return;
+  endif
+  if(!can_access(character, deed))
+    return;
+  endif
+  EraseObjProperty(character, &quot;IsMeditating&quot;);
+  if(deed.movable == 0)
+    SendSysMessage(character, &quot;You cannot use that.&quot;);
+    return;
+  endif
+  if(DeedAlreadyBuiltFrom(deed))
+    PrintTextAbovePrivate(deed, &quot;That house has already been built.&quot;, character);
+    DestroyItem(deed);
+  else
+    Buildhouse(character, deed);
+  endif
+endprogram
+
+function Buildhouse(character, deed)
+  if(!IsInContainer(character.backpack, deed))
+    SendSysMessage(character, &quot;The deed has to be in your backpack.&quot;);
+    return;
+  endif
+  if(!ReserveItem(deed))
+    return;
+  endif
+  var housetype := GetHouseObjtype(deed);
+  if(housetype == error)
+    PrintTextAbovePrivate(deed, &quot;That house deed appears to be broken.&quot;, character);
+    syslog(&quot;Deed &quot; + deed.serial + &quot; had no housetype property!&quot;);
+    return;
+  endif
+  var where := TargetMultiPlacement(character, housetype);
+  if(!where)
+    return;
+  endif
+  if((FindCity(character) != &quot;no city&quot;) || (FindCity(where) != &quot;no city&quot;))
+    PrintTextAbovePrivate(deed, &quot;You can't build in cities.&quot;, character);
+    return;
+  endif
+  if (Distance(character,where) &gt; 50)
+    PrintTextAbovePrivate(deed, &quot;You are too far from where you are trying to build.&quot;, character);
+    return;
+  endif
+  if(!isValidLoc(where.x, where.y) &amp;&amp; (character.cmdlevel &lt; 2))
+    PrintTextAbovePrivate(deed, &quot;You may not build in Green Acres.&quot;, character);
+    return;
+  endif
+  set_critical(1);
+  var created:=CreatehouseKeysAndBuiltDeed(character, housetype, where, deed);
+  if(!created)
+    return;
+  endif
+  var lock := GetObjProperty(deed, &quot;numlockdowns&quot;);
+  var sec  := GetObjProperty(deed, &quot;numsecure&quot;);
+  if(DestroyItem(deed))
+    var lockid := AllocLockId();
+    SetObjProperty(created.builtdeed, &quot;builtserial&quot;,  created.house.serial);
+    SetObjProperty(created.builtdeed, &quot;new&quot;,          1);
+    SetObjProperty(created.builtdeed, &quot;numlockdowns&quot;, lock);
+    SetObjProperty(created.builtdeed, &quot;numsecure&quot;,    sec);
+    SetObjProperty(created.packkey,   &quot;lockid&quot;,       lockid);
+    SetObjProperty(created.bankkey,   &quot;lockid&quot;,       lockid);
+    SetObjProperty(created.house,     &quot;numlockdowns&quot;, lock);
+    SetObjProperty(created.house,     &quot;numsecure&quot;,    sec);
+    SetObjProperty(created.house,     &quot;footage&quot;,      created.footage);
+    foreach item in (created.house.components)
+      if(((item.objtype &gt;= UOBJECT_DOORS_START) &amp;&amp;(item.objtype &lt;= UOBJECT_DOORS_END)) || item.objtype == UOBJECT_TENT_CHEST || item.objtype == 0x6ad)
+        item.locked := 1;
+        SetObjProperty(item, &quot;lockid&quot;, lockid);
+        SetObjProperty(item, &quot;houseserial&quot;, created.house.serial);
+      elseif((item.objtype == UOBJECT_BRASS_SIGN) || (item.objtype == UOBJECT_WOOD_SIGN) || (item.objtype == UOBJECT_WOOD_SIGNTWO))
+        SetObjProperty(item,&quot;lockid&quot;,lockid);
+        SetObjProperty(item, &quot;house_serial&quot;, created.house.serial);
+        SetObjProperty(created.house, &quot;signserial&quot;, item.serial);
+      endif
+    endforeach
+  else
+    DestroyItem(created.builtdeed);
+    DestroyItem(created.packkey);
+    DestroyItem(created.bankkey);
+    foreach item in (created.house.components)
+      DestroyItem(item);
+    endforeach
+    DestroyMulti(created.house);
+  endif
+endfunction
+
+function CreatehouseKeysAndBuiltDeed(character, housetype, where, deed)
+  var bankbox := CP_GetStorageContainerForMobile(character, CP_DEFAULT_AREA, 1);
+  var x := where.x, y := where.y, z := where.z;
+  var packkey := CreateItemInBackpack(character, UOBJ_GOLD_KEY);
+  if(!packkey)
+    PrintTextAbovePrivate(character, &quot;My backpack is too full!&quot;, character);
+    return 0;
+  endif
+  var bankkey := CreateItemInContainer(bankbox, UOBJ_GOLD_KEY);
+  if(!bankkey)
+    PrintTextAbovePrivate(character, &quot;My bankbox is too full!&quot;, character);
+    DestroyItem(packkey);
+    return 0;
+  endif
+  var builtdeed := CreateItemInContainer(bankbox, 0x14ef);
+
+
+  SetName(builtdeed, deed.desc + &quot; at &quot; + x + &quot;, &quot; + y + &quot;, &quot; + z + &quot;(built)&quot;);
+  if(!builtdeed)
+    PrintTextAbovePrivate(character, &quot;My bankbox is too full!&quot;, character);
+    DestroyItem(packkey);
+    DestroyItem(bankkey);
+    return 0;
+  endif
+  var house := CreateMultiAtLocation(x, y, z, housetype, 0, character.realm);
+    if(!house)
+    PrintTextAbovePrivate(character, &quot;I can't place the house there.&quot;, character);
+    print(house.errortext);
+    DestroyItem(packkey);
+    DestroyItem(bankkey);
+    DestroyItem(builtdeed);
+    return;
+  endif
+
+  var footage := FindBoxArray(housetype, house);
+
+  var test := CStr(footage);
+  SendSysMessage(character, test);
+
+  SetObjProperty(house,&quot;numlockdowns&quot;,GetObjProperty(deed,&quot;numlockdowns&quot;));
+  SetObjProperty(house,&quot;numsecure&quot;,GetObjProperty(deed,&quot;numsecure&quot;));
+  SetObjProperty(house,&quot;ownerserial&quot;,character.serial);
+  SetObjProperty(house,&quot;owneracct&quot;,character.acctname);
+  SetObjProperty(house,&quot;builtdeed&quot;,builtdeed.serial);
+  SetObjProperty(house,&quot;decay&quot;, (ReadGameClock()+ 2592000));
+  if(housetype==0x6bb8 || housetype==0x6070 || housetype==0x6072)
+  house.movable:=0;
+  house.visible:=1;
+  endif
+
+
+
+  var result := struct;
+  result.+packkey := packkey;
+  result.+bankkey := bankkey;
+  result.+builtdeed := builtdeed;
+  result.+house := house;
+  result.+footage := footage;
+  return result;
+endfunction
+
+function DeedAlreadyBuiltFrom(deed)
+  if(GetObjProperty(deed, &quot;builtserial&quot;))
+    return 1;
+  else
+    return 0;
+  endif
+endfunction
+
+function GetHouseObjtype(deed)
+  var id := ReadConfigFile(&quot;itemdesc&quot;);
+  var elem := id[ deed.objtype ];
+  var ot := GetObjtypeByName(elem.HouseObjType);
+  return ot;
+endfunction
+
+function IsInContainer(container, item)
+  foreach thing in EnumerateItemsInContainer(container)
+    if(thing.serial == item.serial)
+      return 1;
+    endif
+  endforeach
+  return 0;
+endfunction
+
+function FindBoxArray(housetype, house)
+  var footage;
+  case(housetype)
+    0x6060: footage := smallhousearray(house, house.x, house.y, house.z); //smallstoneandplasterhouse
+    0x6061: footage := smallhousearray(house, house.x, house.y, house.z); //smallstonehouse
+    0x6062: footage := smallhousearray(house, house.x, house.y, house.z); //smallstonehousetwo
+    0x6063: footage := smallhousearray(house, house.x, house.y, house.z); //smallwoodenhouse
+    0x6064: footage := smallhousearray(house, house.x, house.y, house.z); //smallplasterhouse
+    0x6073: footage := smallhousearray(house, house.x, house.y, house.z); //smallwoodandstrawhouse
+    0x6065: footage := largehousearray(house, house.x, house.y, house.z); //largebrickhouse
+    0x6072: footage := largehousearray(house, house.x, house.y, house.z); //largepatiohouse
+    0x6066: footage := twostoryarray(house, house.x, house.y, house.z); //twostorywoodandplasterhouse
+    0x6068: footage := twostoryarray(house, house.x, house.y, house.z); //twostorystoneandplasterhouse
+    0x6069: footage := bigtowerarray(house, house.x, house.y, house.z); //tower
+    0x6070: footage := keeparray(house, house.x, house.y, house.z); //keep
+    0x6071: footage := castlearray(house, house.x, house.y, house.z); //castle
+    0x6074: footage := smalltowerarray(house, house.x, house.y, house.z); //smalltower
+    0x6075: footage := smallmarbleshoparray(house, house.x, house.y, house.z); //smallmarbleshop
+    0x6076: footage := smallstoneshoparray(house, house.x, house.y, house.z); //smallstoneshop
+    0x6077: footage := largemarblehousearray(house, house.x, house.y, house.z); //largemarblehouse
+    0x6078: footage := logcabinarray(house, house.x, house.y, house.z); //logcabin
+    0x6079: footage := sandstonepatiohousearray(house, house.x, house.y, house.z); //sandstonepatiohouse
+    0x607A: footage := twostoryvillaarray(house, house.x, house.y, house.z); //twostoryvilla
+  endcase
+  return footage;
+endfunction
+
+// Added rope ladders to fix an issue with core and ladder climbing on multi's.
+// Also done was adjustment to house floor for items that for some reason end
+// up below the actual z of the floor (up to -3 z from floor)
+function logcabinarray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 2);
+  box1.append(y - 5);
+  box1.append(z + 5);
+  box1.append(x + 3);
+  box1.append(y + 5);
+  box1.append(z + 65);
+  boxarray[1] := box1;
+  var banarray := {};
+  var bantile;
+  bantile := CreateItemAtLocation(x+1, y+5, Z+5, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1, y+6, Z+2, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  // Added for Rope Ladders
+  bantile := CreateItemAtLocation(x+3, y-4, Z+7, 0x8A5, 1, house.realm);
+  bantile.movable := 0;
+  bantile.invisible := 1;
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+3, y-5, Z+11, 0x8A5, 1, house.realm);
+  bantile.movable := 0;
+  bantile.invisible := 1;
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+// Ladders added here for same reason. Z Adjusted for box also on here, and
+// on all remaining houses.
+function sandstonepatiohousearray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 4);
+  box1.append(y - 3);
+  box1.append(z + 0);
+  box1.append(x + 5);
+  box1.append(y + 2);
+  box1.append(z + 46);
+  boxarray[1] := box1;
+  var banarray := {};
+  var bantile;
+  bantile := CreateItemAtLocation(x, y+4, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-1, y+4, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-2, y+4, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  // Ladders
+  bantile := CreateItemAtLocation(x-4, y-2, Z+7, 0x8a3, 1, house.realm);
+  bantile.movable := 0;
+  bantile.invisible := 1;
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-4, y-3, Z+15, 0x8a3, 1, house.realm);
+  bantile.movable := 0;
+  bantile.invisible := 1;
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+function twostoryvillaarray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 4);
+  box1.append(y - 4);
+  box1.append(z + 0);
+  box1.append(x + 4);
+  box1.append(y + 4);
+  box1.append(z + 47);
+  boxarray[1] := box1;
+  var banarray := {};
+  var bantile;
+  bantile := CreateItemAtLocation(x+2, y+6, Z+2, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+3, y+6, Z+2, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+4, y+6, Z+2, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+5, y+6, Z+2, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+
+function largemarblehousearray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 6);
+  box1.append(y - 6);
+  box1.append(z + 0);
+  box1.append(x + 6);
+  box1.append(y + 5);
+  box1.append(z + 65);
+  boxarray[1] := box1;
+  var banarray := {};
+  var bantile;
+  bantile := CreateItemAtLocation(x-6, y+7, Z+1, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-5, y+7, Z+1, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-4, y+7, Z+1, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-3, y+7, Z+1, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-2, y+7, Z+1, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-1, y+7, Z+1, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  // Added for ladder to rooftop
+  bantile := CreateItemAtLocation(x-5, y+4, Z+35, 0x8a3, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile.movable := 0;
+  bantile.invisible := 1;
+  bantile := CreateItemAtLocation(x-5, y+5, Z+24, 0x8a4, 1, house.realm);
+  bantile.movable := 0;
+  bantile.invisible := 1;
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+function smalltowerarray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 2);
+  box1.append(y - 2);
+  box1.append(z + 0);
+  box1.append(x + 3);
+  box1.append(y + 2);
+  box1.append(z + 65);
+  boxarray[1] := box1;
+  var banarray := {};
+  var bantile;
+  bantile := CreateItemAtLocation(x+1, y+4, Z+2, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+2, y+4, Z+2, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+3, y+4, Z+2, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+4, y+4, Z+2, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  // Threw in for adding Ladders. Easiest here so no additions needed for decays
+  bantile := CreateItemAtLocation(x+3, y-2, z+17, 0x8a3, 1, house.realm);
+  bantile.movable := 0;
+  bantile.invisible := 1;
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-2, y-2, z+37, 0x8a0, 1, house.realm);
+  bantile.movable := 0;
+  bantile.invisible := 1;
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+function smallmarbleshoparray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 2);
+  box1.append(y - 2);
+  box1.append(z + 0);
+  box1.append(x + 2);
+  box1.append(y + 2);
+  box1.append(z + 65);
+  boxarray[1] := box1;
+  var banarray := {};
+  var bantile;
+  bantile := CreateItemAtLocation(x-1, y+4, Z+2, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x, y+4, Z+2, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1, y+4, Z+2, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  bantile := CreateItemAtLocation(x+2, y+4, Z+2, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  // Ladders
+  bantile := CreateItemAtLocation(x-2, y, Z+18, 0x8a3, 1, house.realm);
+  bantile.movable := 0;
+  bantile.invisible := 1;
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-2, y+1, Z+7, 0x8a4, 1, house.realm);
+  bantile.movable := 0;
+  bantile.invisible := 1;
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+function smallstoneshoparray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 2);
+  box1.append(y - 2);
+  box1.append(z + 0);
+  box1.append(x + 2);
+  box1.append(y + 2);
+  box1.append(z + 65);
+  boxarray[1] := box1;
+  var banarray := {};
+  var bantile;
+  bantile := CreateItemAtLocation(x-2, y+4, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-1, y+4, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x, y+4, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  // Ladders
+  bantile := CreateItemAtLocation(x-2, y, Z+18, 0x8a3, 1, house.realm);
+  bantile.movable := 0;
+  bantile.invisible := 1;
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-2, y+1, Z+7, 0x8a4, 1, house.realm);
+  bantile.movable := 0;
+  bantile.invisible := 1;
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+function smallhousearray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 2);
+  box1.append(y - 2);
+  box1.append(z + 0);
+  box1.append(x + 2);
+  box1.append(y + 2);
+  box1.append(z + 27);
+  boxarray[1] := box1;
+  var banarray := {};
+  var bantile;
+  bantile := CreateItemAtLocation(x-1, y+4, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-0, y+4, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1, y+4, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+function largehousearray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 6);
+  box1.append(y - 6);
+  box1.append(z + 0);
+  box1.append(x + 6);
+  box1.append(y + 5);
+  box1.append(z + 27);
+  boxarray[1] := box1;
+  var banarray := {};
+  var bantile;
+  if(house.objtype == 0x6072)
+    bantile := CreateItemAtLocation(x-5, y+7, Z+4, 0x9999, 1, house.realm);
+    banarray.append(bantile.serial);
+    SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+    bantile := CreateItemAtLocation(x-4, y+7, Z+4, 0x9999, 1, house.realm);
+    banarray.append(bantile.serial);
+    SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+    bantile := CreateItemAtLocation(x-3, y+7, Z+4, 0x9999, 1, house.realm);
+    banarray.append(bantile.serial);
+    SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+    bantile := CreateItemAtLocation(x-2, y+7, Z+4, 0x9999, 1, house.realm);
+    banarray.append(bantile.serial);
+    SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  else
+    bantile := CreateItemAtLocation(x-2, y+7, Z+4, 0x9999, 1, house.realm);
+    banarray.append(bantile.serial);
+    SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+    bantile := CreateItemAtLocation(x-1, y+7, Z+4, 0x9999, 1, house.realm);
+    banarray.append(bantile.serial);
+    SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+    bantile := CreateItemAtLocation(x, y+7, Z+4, 0x9999, 1, house.realm);
+    banarray.append(bantile.serial);
+    SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+    bantile := CreateItemAtLocation(x+1, y+7, Z+4, 0x9999, 1, house.realm);
+    banarray.append(bantile.serial);
+    SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  endif
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+function twostoryarray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 6);
+  box1.append(y - 6);
+  box1.append(z + 0);
+  box1.append(x    );
+  box1.append(y + 5);
+  box1.append(z + 47);
+  boxarray[1] := box1;
+  box1 := {};
+  box1.append(x    );
+  box1.append(y    );
+  box1.append(z + 7);
+  box1.append(x + 5);
+  box1.append(y + 5);
+  box1.append(z + 47);
+  boxarray[2] := box1;
+  var banarray := {};
+  var bantile;
+  bantile := CreateItemAtLocation(x-4, y+7, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-3, y+7, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-2, y+7, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-1, y+7, Z+4, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+function bigtowerarray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 6);
+  box1.append(y - 6);
+  box1.append(z + 0);
+  box1.append(x + 7);
+  box1.append(y + 5);
+  box1.append(z + 65);
+  boxarray[1] := box1;
+  box1 := {};
+  box1.append(x - 10);
+  box1.append(y - 6);
+  box1.append(z + 66);
+  box1.append(x + 11);
+  box1.append(y + 5);
+  box1.append(z + 86);
+  boxarray[2] := box1;
+  var banarray := {};
+  var bantile;
+  bantile := CreateItemAtLocation(x-1, y+8, Z+2, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x, y+8, Z+2, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1, y+8, Z+2, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+2, y+8, Z+2, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-1, y+7, Z+5, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x, y+7, Z+5, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1, y+7, Z+5, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+2, y+7, Z+5, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+function castlearray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 14);
+  box1.append(y - 14);
+  box1.append(z + 0);
+  box1.append(x + 14);
+  box1.append(y + 14);
+  box1.append(z + 47);
+  boxarray[1] := box1;
+  var banarray := {};
+  var bantile;
+  bantile := CreateItemAtLocation(x-1, y+16, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x, y+16, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1, y+16, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+2, y+16, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-1, y+10, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x, y+10, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1, y+10, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+2, y+10, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-1,  y+6, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x,  y+6, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1,  y+6, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+2,  y+6, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-2, y-10, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x-1, y-10, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x, y-10, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1, y-10, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
+
+function keeparray(house, x, y, z)
+  var boxarray := {};
+  var box1 := {};
+  box1.append(x - 10);
+  box1.append(y - 10);
+  box1.append(z + 0);
+  box1.append(x + 11);
+  box1.append(y + 11);
+  box1.append(z + 47);
+  boxarray[1] := box1;
+  var banarray := {};
+  var bantile;
+  bantile := CreateItemAtLocation(x-1, y+11, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x, y+11, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+1, y+11, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  bantile := CreateItemAtLocation(x+2, y+11, Z+3, 0x9999, 1, house.realm);
+  banarray.append(bantile.serial);
+  SetObjProperty(bantile, &quot;house_serial&quot;, house.serial);
+  SetObjProperty(house, &quot;bantiles&quot;, banarray);
+  return boxarray;
+endfunction
\ No newline at end of file

Added: trunk/096/pkg/multis/housing/itemdesc.cfg
===================================================================
--- trunk/096/pkg/multis/housing/itemdesc.cfg	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/housing/itemdesc.cfg	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,491 @@
+# $Id: itemdesc.cfg 684 2005-10-27 18:48:28Z muaddiblsd $
+#
+#
+Item 0xbd1
+{
+    Name             brasssign1
+    Script           sign
+    ControlScript    signControl
+    Doubleclickrange 6
+    movable          0
+    UseRequiresLOS   0
+}
+
+Item 0xbd2
+{
+    Name             brasssign
+    Script           sign
+    ControlScript    signControl
+    Doubleclickrange 6
+    movable          0
+    UseRequiresLOS   0
+}
+
+Item 0xbcf
+{
+    Name             woodensign1
+    Script           sign
+    ControlScript    signControl
+    Doubleclickrange 6
+    movable          0
+    UseRequiresLOS   0
+}
+
+Item 0xbd0
+{
+    Name             woodensign
+    Script           sign
+    ControlScript    signControl
+    Doubleclickrange 6
+    movable 0
+    UseRequiresLOS   0
+}
+
+Item 0x6019
+{
+    Name             smallstoneandplasterhousedeed
+    Desc             deed to a small stone and plaster house
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   44000
+    VendorBuysFor    22000
+    HouseObjType     smallstoneandplasterhouse
+    cprop numlockdowns i25
+    cprop numsecure  i1
+}
+
+Item 0x601A
+{
+    Name             smallstonehousedeed
+    Desc             deed to a small stone house
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   44000
+    VendorBuysFor    22000
+    HouseObjType     smallstonehouse
+    cprop numlockdowns i25
+    cprop numsecure  i1
+}
+Item 0x601B
+{
+    Name             smallwoodenhousedeed
+    Desc             deed to a small wooden house
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   44000
+    VendorBuysFor    22000
+    HouseObjType     smallwoodenhouse
+    cprop numlockdowns i25
+    cprop numsecure  i1
+}
+Item 0x601C
+{
+    Name             smallplasterhousedeed
+    Desc             deed to a small plaster house
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   44000
+    VendorBuysFor    22000
+    HouseObjType     smallplasterhouse
+    cprop numlockdowns i25
+    cprop numsecure  i1
+}
+Item 0x601D
+{
+    Name             smallwoodandstrawhousedeed
+    Desc             deed to a small wood and straw house
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   44000
+    VendorBuysFor    22000
+    HouseObjType     smallwoodandstrawhouse
+    cprop numlockdowns i25
+    cprop numsecure  i1
+}
+Item 0x601e
+{
+    Name              smallbrickhousedeed
+    Desc              deed to a small wood and straw house
+    Graphic           0x14F0
+    Script            houseDeed
+    newbie            1
+    HouseObjType      smallbrickhouse
+    VendorSellsFor    43800
+    VendorBuysFor     21900
+    cprop numlockdowns i25
+    cprop numsecure  i1
+}
+Item 0x6020
+{
+    Name             largebrickhousedeed
+    Desc             deed to a large brick house
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   145000
+    VendorBuysFor    72500
+    HouseObjType     largebrickhouse
+    cprop numlockdowns i86
+    cprop numsecure  i3
+}
+Item 0x6021
+{
+    Name             twostorywoodandplasterhousedeed
+    Desc             deed to a two story wood and plaster house
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   192000
+    VendorBuysFor    96000
+    HouseObjType     twostorywoodandplasterhouse
+    cprop numlockdowns i108
+    cprop numsecure  i5
+}
+Item 0x6022
+{
+    Name             twostorystoneandplasterhousedeed
+    Desc             deed to a two story stone and plaster house
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   192000
+    VendorBuysFor    96000
+    HouseObjType     twostorystoneandplasterhouse
+    cprop numlockdowns i108
+    cprop numsecure  i5
+}
+Item 0x6023
+{
+    Name             towerdeed
+    Desc             deed to a tower
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   430000
+    VendorBuysFor    215000
+    HouseObjType     tower
+    cprop numlockdowns i244
+    cprop numsecure  i12
+}
+Item 0x6024
+{
+    Name             keepdeed
+    Desc             deed to a keep
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   665000
+    VendorBuysFor    332500
+    HouseObjType     keep
+    cprop numlockdowns i375
+    cprop numsecure  i19
+}
+Item 0x6025
+{
+    Name             castledeed
+    Desc             deed to a grand castle
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   1023000
+    VendorBuysFor    511500
+    HouseObjType     castle
+    cprop numlockdowns i577
+    cprop numsecure  i29
+}
+Item 0x6026
+{
+    Name             largepatiohousedeed
+    Desc             deed to a large patio house
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   153000
+    VendorBuysFor    76500
+    HouseObjType     largepatiohouse
+    cprop numlockdowns i86
+    cprop numsecure  i4
+}
+Item 0x602D
+{
+    Name             smalltowerdeed
+    Desc             deed to a small tower
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   80000
+    VendorBuysFor    35000
+    HouseObjType     smalltowerhouse
+    cprop numlockdowns i35
+    cprop numsecure  i2
+}
+Item 0x602E
+{
+    Name             smallmarbleshopdeed
+    Desc             deed to a small marble shop
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   80000
+    VendorBuysFor    35000
+    HouseObjType     smallmarbleshophouse
+    cprop numlockdowns i25
+    cprop numsecure  i1
+}
+Item 0x602F
+{
+    Name             smallstoneshopdeed
+    Desc             deed to a small stone shop
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   80000
+    VendorBuysFor    35000
+    HouseObjType     smallstoneshophouse
+    cprop numlockdowns i25
+    cprop numsecure  i1
+}
+Item 0x6030
+{
+    Name             largemarblehousedeed
+    Desc             deed to a large marble house
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   153000
+    VendorBuysFor    76500
+    HouseObjType     largemarblehouse
+    cprop numlockdowns i86
+    cprop numsecure  i4
+}
+Item 0x6031
+{
+    Name             logcabindeed
+    Desc             deed to a log cabin
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   145000
+    VendorBuysFor    72000
+    HouseObjType     logcabin
+    cprop numlockdowns i86
+    cprop numsecure  i3
+}
+Item 0x6032
+{
+    Name             sandstonepatiohousedeed
+    Desc             deed to a sandstone patio house
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   125000
+    VendorBuysFor    52000
+    HouseObjType     sandstonepatiohouse
+    cprop numlockdowns i66
+    cprop numsecure  i2
+}
+Item 0x6033
+{
+    Name             twostoryvilladeed
+    Desc             deed to a two story villa
+    Graphic          0x14F0
+    Script           houseDeed
+    newbie           1
+    VendorSellsFor   145000
+    VendorBuysFor    72000
+    HouseObjType     twostoryvilla
+    cprop numlockdowns i86
+    cprop numsecure  i3
+}
+
+Item 0x14ef
+{
+    Name             builtdeed
+    Script           changeOwner
+    Newbie           1
+}
+House 0x6060
+{
+    Name             smallstoneandplasterhouse
+    Graphic          0x4064
+    MultiID          0x64
+    OldObjtype       0x4064
+}
+House 0x6061
+{
+    Name             smallstonehouse
+    WalkOnScript     houseBanning
+    Graphic          0x4066
+    MultiID          0x66
+    OldObjtype       0x4066
+}
+
+House 0x6062
+{
+    Name             smallwoodenhouse
+    WalkOnScript     houseBanning
+    Graphic          0x406a
+    MultiID          0x6a
+    OldObjtype       0x406a
+}
+
+House 0x6063
+{
+    Name             smallplasterhouse
+    WalkOnScript     houseBanning
+    Graphic          0x406c
+    MultiID          0x6c
+    OldObjtype       0x406c
+}
+
+House 0x6064
+{
+    Name             smallwoodandstrawhouse
+    WalkOnScript     houseBanning
+    Graphic          0x406e
+    MultiID          0x6e
+    OldObjtype       0x406e
+}
+
+House 0x6065
+{
+    Name             largebrickhouse
+    WalkOnScript     houseBanning
+    Graphic          0x4074
+    MultiID          0x74
+    OldObjtype       0x4074
+}
+
+House 0x6066
+{
+    Name             twostorywoodandplasterhouse
+    WalkOnScript     houseBanning
+    Graphic          0x4076
+    MultiID          0x76
+    OldObjtype       0x4076
+}
+
+House 0x6068
+{
+    Name             twostorystoneandplasterhouse
+    WalkOnScript     houseBanning
+    Graphic          0x4078
+    MultiID          0x78
+    OldObjtype       0x4078
+}
+
+House 0x6069
+{
+    Name             tower
+    WalkOnScript     houseBanning
+    Graphic          0x407a
+    MultiID          0x7a
+    OldObjtype       0x407a
+}
+
+House 0x6070
+{
+    Name             keep
+    WalkOnScript     houseBanning
+    Graphic          0x407c
+    MultiID          0x7c
+    OldObjtype       0x407c
+}
+
+House 0x6071
+{
+    Name             castle
+    WalkOnScript     houseBanning
+    Graphic          0x407e
+    MultiID          0x7e
+    OldObjtype       0x407e
+}
+
+House 0x6072
+{
+    Name             largepatiohouse
+    WalkOnScript     houseBanning
+    Graphic          0x408c
+    MultiID          0x8c
+    OldObjtype       0x408c
+}
+
+House 0x6073
+{
+    Name             smallbrickhouse
+    WalkOnScript     houseBanning
+    Graphic          0x4068
+    MultiID          0x68
+    OldObjtype       0x4068
+}
+
+House 0x6074
+{
+    Name             smalltowerhouse
+    WalkOnScript     houseBanning
+    Graphic          0x4098
+    MultiID          0x98
+    OldObjtype       0x4098
+}
+House 0x6075
+{
+    Name             smallmarbleshophouse
+    WalkOnScript     houseBanning
+    Graphic          0x40A2
+    MultiID          0xA2
+    OldObjtype       0x40A2
+}
+House 0x6076
+{
+    Name             smallstoneshophouse
+    WalkOnScript     houseBanning
+    Graphic          0x40A0
+    MultiID          0xA0
+    OldObjtype       0x40A0
+}
+House 0x6077
+{
+    Name             largemarblehouse
+    WalkOnScript     houseBanning
+    Graphic          0x4096
+    MultiID          0x96
+    OldObjtype       0x4096
+}
+House 0x6078
+{
+    Name             logcabin
+    WalkOnScript     houseBanning
+    Graphic          0x409A
+    MultiID          0x9A
+    OldObjtype       0x409A
+}
+House 0x6079
+{
+    Name             sandstonepatiohouse
+    WalkOnScript     houseBanning
+    Graphic          0x409C
+    MultiID          0x9C
+    OldObjtype       0x409C
+}
+House 0x607A
+{
+    Name             twostoryvilla
+    WalkOnScript     houseBanning
+    Graphic          0x409E
+    MultiID          0x9E
+    OldObjtype       0x409E
+}
+
+Item 0x9999
+{
+    Name             bantile
+    Graphic          0x1
+    Invisible        1
+    WalkOnScript     houseBanning
+    movable          0
+}

Added: trunk/096/pkg/multis/housing/pkg.cfg
===================================================================
--- trunk/096/pkg/multis/housing/pkg.cfg	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/housing/pkg.cfg	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,9 @@
+# $Id: pkg.cfg 684 2005-10-27 18:48:28Z muaddiblsd $
+#
+#
+Enabled		1
+Name		housing
+CoreRequired	92
+Maintainer	Distro Team
+Email		<A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">distro at polserver.com</A>
+Version		1.1

Added: trunk/096/pkg/multis/housing/secureCont.src
===================================================================
--- trunk/096/pkg/multis/housing/secureCont.src	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/housing/secureCont.src	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,30 @@
+use os;
+use uo;
+
+program use_securecont(who, item)
+  var house := SystemFindObjectBySerial( GetObjProperty( item, &quot;houseserial&quot; ));
+  var secure := 0;
+  if ((GetObjProperty( house, &quot;ownerserial&quot; ) == who.serial) || (GetObjProperty( house, &quot;owneracct&quot; ) == who.acctname))
+     secure := 1;
+  else
+    var coownerinfo := GetObjProperty(house,&quot;coownlist&quot;);
+    if(who.serial in coownerinfo)
+      secure := 1;
+    else
+      var friendinfo := GetObjProperty(house,&quot;friendlist&quot;);
+      if(who.serial in friendinfo)
+        secure := 1;
+      endif
+    endif
+  endif
+  if(who.cmdlevel &gt;= 3)
+    secure := 1;
+  endif
+  if(!secure)
+    SendSysMessage( who, &quot;You can't use this.&quot; );
+    return;
+  else
+    SendViewContainer( who, item );
+    SendSysMessage( who, &quot;You open the secure container.&quot; );
+  endif
+endprogram
\ No newline at end of file

Added: trunk/096/pkg/multis/housing/sign.src
===================================================================
--- trunk/096/pkg/multis/housing/sign.src	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/housing/sign.src	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,1483 @@
+use uo;
+use os;
+
+include &quot;util/key&quot;;
+include &quot;:gumps:yesno&quot;;
+include &quot;:containers:storageAreas&quot;;
+
+Const UOBJECT_DOORS_START := 0x0675;
+Const UOBJECT_DOORS_END   := 0x06f4;
+Const KEYSTART := 0x100e;
+Const KEYEND := 0x1013;
+Const KEYRING := 0x1011;
+
+var nonlayout := {
+ &quot;page 0&quot;,
+ &quot;gumppic 240 0 100&quot;,
+ &quot;text 270 200 48 0&quot;,
+ &quot;text 270 50 48 31&quot;
+ };
+
+var nondata := {
+&quot;&quot;
+};
+
+var layout := array(
+&quot;page 0&quot;,
+&quot;resizepic 100 45 2600 412 300&quot;,
+&quot;gumppic 240 0 100&quot;,
+&quot;text 290 30 48 0&quot;,
+&quot;text 290 50 48 31&quot;,
+&quot;resizepic 115 100 5100 382 25&quot;,
+&quot;text 125 102 0 1&quot;,
+&quot;button 178 104 5209 5003 0 1 0&quot;,
+&quot;text 245 102 0 2&quot;,
+&quot;button 330 104 5209 5003 0 2 0&quot;,
+&quot;text 375 102 0 3&quot;,
+&quot;button 460 104 5209 5003 0 3 0&quot;,
+&quot;button 150 308 247 248 1 0 0&quot;,
+&quot;page 1&quot;,
+&quot;text 140 140 2302 4&quot;,
+&quot;text 220 140 0 5&quot;,
+&quot;text 135 180 2302 6&quot;,
+&quot;text 350 180 0 7&quot;,
+&quot;text 135 200 2302 8&quot;,
+&quot;text 350 200 0 9&quot;,
+&quot;text 250 308 2302 14&quot;,
+&quot;button 430 308 2714 2715 1 0 1&quot;,
+&quot;page 2&quot;,
+&quot;text 155 130 2302 15&quot;,
+&quot;button 125 130 2714 2715 1 0 2&quot;,
+&quot;text 155 152 2302 16&quot;,
+&quot;button 125 152 2714 2715 1 0 3&quot;,
+&quot;text 155 174 2302 17&quot;,
+&quot;button 125 174 2714 2715 1 0 4&quot;,
+&quot;text 350 130 2302 18&quot;,
+&quot;button 125 194 2714 2715 1 0 17&quot;,
+&quot;text 155 194 2302 19&quot;,
+&quot;button 320 130 2714 2715 1 0 5&quot;,
+&quot;text 350 152 2302 20&quot;,
+&quot;button 320 152 2714 2715 1 0 6&quot;,
+&quot;text 350 174 2302 21&quot;,
+&quot;button 320 174 2714 2715 1 0 7&quot;,
+&quot;text 350 196 2302 22&quot;,
+&quot;button 320 196 2714 2715 1 0 8&quot;,
+&quot;text 245 218 2302 23&quot;,
+&quot;button 215 218 2714 2715 1 0 11&quot;,
+&quot;text 245 240 2302 24&quot;,
+&quot;button 215 240 2714 2715 1 0 9&quot;,
+&quot;text 245 262 2302 25&quot;,
+&quot;button 215 262 2714 2715 1 0 12&quot;,
+&quot;text 245 284 2302 26&quot;,
+&quot;button 215 284 2714 2715 1 0 10&quot;,
+&quot;page 3&quot;,
+&quot;text 190 130 2302 27&quot;,
+&quot;button 160 130 2714 2715 1 0 13&quot;,//transfer ownership
+&quot;text 190 160 2302 28&quot;,
+&quot;button 160 160 2714 2715 1 0 14&quot;,//demolish
+&quot;text 190 190 2302 29&quot;,
+//&quot;button 60 190 2714 2715 1 0 16&quot;,//change - key/sign
+&quot;text 190 220 2302 30&quot;,
+&quot;button 160 220 2714 2715 1 0 19&quot;,//declare priv/pub
+
+&quot;page 4&quot;,                                 // Page 4
+&quot;button 140 153 210 211 1 4 2980&quot;,          // Sign Button
+&quot;tilepic 149 145 2980&quot;,                   // Sign Picture
+&quot;button 140 188 210 211 1 4 2982&quot;,          // Sign Button
+&quot;tilepic 149 180 2982&quot;,                   // Sign Picture
+&quot;button 140 223 210 211 1 4 2984&quot;,          // Sign Button
+&quot;tilepic 149 215 2984&quot;,                   // Sign Picture
+&quot;button 140 258 210 211 1 4 2986&quot;,          // Sign Button
+&quot;tilepic 149 250 2986&quot;,                   // Sign Picture
+&quot;button 195 153 210 211 1 4 2988&quot;,          // Sign Button
+&quot;tilepic 204 145 2988&quot;,                   // Sign Picture
+&quot;button 195 188 210 211 1 4 2990&quot;,          // Sign Button
+&quot;tilepic 204 180 2990&quot;,                   // Sign Picture
+&quot;button 195 223 210 211 1 4 2992&quot;,          // Sign Button
+&quot;tilepic 204 215 2992&quot;,                   // Sign Picture
+&quot;button 195 258 210 211 1 4 2994&quot;,          // Sign Button
+&quot;tilepic 204 250 2994&quot;,                   // Sign Picture
+&quot;button 250 153 210 211 1 4 2996&quot;,          // Sign Button
+&quot;tilepic 259 145 2996&quot;,                   // Sign Picture
+&quot;button 250 188 210 211 1 4 2998&quot;,          // Sign Button
+&quot;tilepic 259 180 2998&quot;,                   // Sign Picture
+&quot;button 250 223 210 211 1 4 3000&quot;,          // Sign Button
+&quot;tilepic 259 215 3000&quot;,                   // Sign Picture
+&quot;button 250 258 210 211 1 4 3002&quot;,          // Sign Button
+&quot;tilepic 259 250 3002&quot;,                   // Sign Picture
+&quot;button 305 153 210 211 1 4 3004&quot;,          // Sign Button
+&quot;tilepic 314 145 3004&quot;,                   // Sign Picture
+&quot;button 305 188 210 211 1 4 3006&quot;,          // Sign Button
+&quot;tilepic 314 180 3006&quot;,                   // Sign Picture
+&quot;button 305 223 210 211 1 4 3008&quot;,          // Sign Button
+&quot;tilepic 314 215 3008&quot;,                   // Sign Picture
+&quot;button 305 258 210 211 1 4 3010&quot;,          // Sign Button
+&quot;tilepic 314 250 3010&quot;,                   // Sign Picture
+&quot;button 360 153 210 211 1 4 3012&quot;,          // Sign Button
+&quot;tilepic 369 145 3012&quot;,                   // Sign Picture
+&quot;button 360 188 210 211 1 4 3014&quot;,          // Sign Button
+&quot;tilepic 369 180 3014&quot;,                   // Sign Picture
+&quot;button 360 223 210 211 1 4 3016&quot;,          // Sign Button
+&quot;tilepic 369 215 3016&quot;,                   // Sign Picture
+&quot;button 360 258 210 211 1 4 3018&quot;,          // Sign Button
+&quot;tilepic 369 250 3018&quot;,                   // Sign Picture
+&quot;button 415 153 210 211 1 4 3020&quot;,          // Sign Button
+&quot;tilepic 424 145 3020&quot;,                   // Sign Picture
+&quot;button 415 188 210 211 1 4 3022&quot;,          // Sign Button
+&quot;tilepic 424 180 3022&quot;,                   // Sign Picture
+&quot;button 415 223 210 211 1 4 3024&quot;,          // Sign Button
+&quot;tilepic 424 215 3024&quot;,                   // Sign Picture
+&quot;button 415 258 210 211 1 4 3026&quot;,          // Sign Button
+&quot;tilepic 424 250 3026&quot;,                   // Sign Picture
+&quot;text 275 303 995 32&quot;,                    // Guild Text
+&quot;button 425 290 252 253 0 5 45&quot;,          // Guild Section
+&quot;page 5&quot;,                                 // Page 5
+&quot;button 140 153 210 211 1 5 3028&quot;,          // Sign Button
+&quot;tilepic 149 145 3028&quot;,                   // Sign Picture
+&quot;button 140 188 210 211 1 5 3030&quot;,          // Sign Button
+&quot;tilepic 149 180 3030&quot;,                   // Sign Picture
+&quot;button 140 223 210 211 1 5 3032&quot;,          // Sign Button
+&quot;tilepic 149 215 3032&quot;,                   // Sign Picture
+&quot;button 140 258 210 211 1 5 3034&quot;,          // Sign Button
+&quot;tilepic 149 250 3034&quot;,                   // Sign Picture
+&quot;button 140 283 210 211 1 5 3036&quot;,          // Sign Button
+&quot;tilepic 149 285 3036&quot;,                   // Sign Picture
+&quot;button 195 153 210 211 1 5 3038&quot;,          // Sign Button
+&quot;tilepic 204 145 3038&quot;,                   // Sign Picture
+&quot;button 195 283 210 211 1 5 3040&quot;,          // Sign Button
+&quot;tilepic 204 285 3040&quot;,                   // Sign Picture
+&quot;button 195 223 210 211 1 5 3042&quot;,          // Sign Button
+&quot;tilepic 204 215 3042&quot;,                   // Sign Picture
+&quot;button 195 258 210 211 1 5 3044&quot;,          // Sign Button
+&quot;tilepic 204 250 3044&quot;,                   // Sign Picture
+&quot;button 195 183 210 211 1 5 3046&quot;,          // Sign Button
+&quot;tilepic 204 185 3046&quot;,                   // Sign Picture
+&quot;button 250 153 210 211 1 5 3048&quot;,          // Sign Button
+&quot;tilepic 259 145 3048&quot;,                   // Sign Picture
+&quot;button 250 283 210 211 1 5 3050&quot;,          // Sign Button
+&quot;tilepic 259 285 3050&quot;,                   // Sign Picture
+&quot;button 250 223 210 211 1 5 3052&quot;,          // Sign Button
+&quot;tilepic 259 215 3052&quot;,                   // Sign Picture
+&quot;button 250 258 210 211 1 5 3054&quot;,          // Sign Button
+&quot;tilepic 259 250 3054&quot;,                   // Sign Picture
+&quot;button 250 183 210 211 1 5 3056&quot;,          // Sign Button
+&quot;tilepic 259 185 3056&quot;,                   // Sign Picture
+&quot;button 305 153 210 211 1 5 3058&quot;,          // Sign Button
+&quot;tilepic 314 145 3058&quot;,                   // Sign Picture
+&quot;button 305 188 210 211 1 5 3060&quot;,          // Sign Button
+&quot;tilepic 314 180 3060&quot;,                   // Sign Picture
+&quot;button 305 223 210 211 1 5 3062&quot;,          // Sign Button
+&quot;tilepic 314 215 3062&quot;,                   // Sign Picture
+&quot;button 305 258 210 211 1 5 3064&quot;,          // Sign Button
+&quot;tilepic 314 250 3064&quot;,                   // Sign Picture
+&quot;button 305 283 210 211 1 5 3066&quot;,          // Sign Button
+&quot;tilepic 314 285 3066&quot;,                   // Sign Picture
+&quot;button 360 153 210 211 1 5 3068&quot;,          // Sign Button
+&quot;tilepic 369 145 3068&quot;,                   // Sign Picture
+&quot;button 360 188 210 211 1 5 3070&quot;,          // Sign Button
+&quot;tilepic 369 180 3070&quot;,                   // Sign Picture
+&quot;button 360 223 210 211 1 5 3072&quot;,          // Sign Button
+&quot;tilepic 369 215 3072&quot;,                   // Sign Picture
+&quot;button 360 258 210 211 1 5 3074&quot;,          // Sign Button
+&quot;tilepic 369 250 3074&quot;,                   // Sign Picture
+&quot;button 360 283 210 211 1 5 3076&quot;,          // Sign Button
+&quot;tilepic 369 285 3076&quot;,                   // Sign Picture
+&quot;button 415 153 210 211 1 5 3078&quot;,          // Sign Button
+&quot;tilepic 424 145 3078&quot;,                   // Sign Picture
+&quot;button 415 188 210 211 1 5 3080&quot;,          // Sign Button
+&quot;tilepic 424 180 3080&quot;,                   // Sign Picture
+&quot;button 415 223 210 211 1 5 3082&quot;,          // Sign Button
+&quot;tilepic 424 215 3082&quot;,                   // Sign Picture
+&quot;button 415 258 210 211 1 5 3084&quot;,          // Sign Button
+&quot;tilepic 424 250 3084&quot;,                   // Sign Picture
+&quot;text 275 313 995 33&quot;,                    // Shop Test
+&quot;button 425 310 250 251 0 4&quot;,             // Shop Section
+
+
+&quot;nodispose&quot;
+);
+
+var data := array(
+&quot;&quot;,
+&quot;INFO&quot;,
+&quot;FRIENDS&quot;,
+&quot;OPTIONS&quot;,
+&quot;Owned by:&quot;,
+&quot;&lt;NAME&gt;&quot;,
+&quot;Number of locked down items:&quot;,
+&quot;&quot;,
+&quot;Number of secure containers:&quot;,
+&quot;&quot;,
+&quot;Number of visits this building has had:&quot;,
+&quot;This house is improperly placed.&quot;,
+&quot;&quot;,
+&quot;This house is of #### design.&quot;,
+&quot;Change the house name!&quot;,
+&quot;List of co-owners&quot;,
+&quot;Add a co-owner&quot;,
+&quot;Remove a co-owner&quot;,
+&quot;List of friends&quot;,
+&quot;Clear Co-owner List&quot;,
+&quot;Add a friend&quot;,
+&quot;Remove a friend&quot;,
+&quot;Clear friend list&quot;,
+&quot;List of banned people&quot;,
+&quot;Ban someone from the house&quot;,
+&quot;Remove a ban&quot;,
+&quot;Eject someone from the house&quot;,
+&quot;Transfer ownership of the house&quot;,
+&quot;Demolish the house &amp; get a deed back&quot;,
+&quot;Change the master key&quot;,
+&quot;Change the sign type&quot;,
+&quot;&quot;,
+&quot;Shop Sign Choices&quot;,
+&quot;Guild Sign Choices&quot;,
+&quot;&quot;
+);
+
+
+
+var layoutbanlift := {
+&quot;page 0&quot;,                                // Page 0
+&quot;resizepic 100 100 2600 400 300&quot;,        // Grey background
+&quot;resizepic 147 359 5100 310 25&quot;,         // Square Grey box
+&quot;text 185 118 995 0&quot;,                    // Title
+&quot;button 270 360 247 248 1 0 1&quot;,          // Okay, button 1
+&quot;button 150 340 2714 2714 1 0 2&quot;,        // Remove Button
+&quot;text 170 340 995 24&quot;,                    // Remove Text
+&quot;page 1&quot;,                                // Page 1
+&quot;button 425 363 5224 5224 0 2 16&quot;,       // Next Page
+&quot;text 180 140 0 1&quot;,                      // Banned Name
+&quot;button 150 140 210 211 1 0 3&quot;,          // Banned Button
+&quot;text 180 160 0 2&quot;,                      // Banned Name
+&quot;button 150 160 210 211 1 0 4&quot;,          // Banned Button
+&quot;text 180 180 0 3&quot;,                      // Banned Name
+&quot;button 150 180 210 211 1 0 5&quot;,          // Banned Button
+&quot;text 180 200 0 4&quot;,                      // Banned Name
+&quot;button 150 200 210 211 1 0 6&quot;,          // Banned Button
+&quot;text 180 220 0 5&quot;,                      // Banned Name
+&quot;button 150 220 210 211 1 0 7&quot;,          // Banned Button
+&quot;text 180 240 0 6&quot;,                      // Banned Name
+&quot;button 150 240 210 211 1 0 8&quot;,          // Banned Button
+&quot;text 180 260 0 7&quot;,                      // Banned Name
+&quot;button 150 260 210 211 1 0 9&quot;,          // Banned Button
+&quot;text 180 280 0 8&quot;,                      // Banned Name
+&quot;button 150 280 210 211 1 0 10&quot;,         // Banned Button
+&quot;text 180 300 0 9&quot;,                      // Banned Name
+&quot;button 150 300 210 211 1 0 11&quot;,         // Banned Button
+&quot;text 180 320 0 10&quot;,                     // Banned Name
+&quot;button 150 320 210 211 1 0 12&quot;,         // Banned Button
+&quot;page 2&quot;,                     // Page 2
+&quot;text 180 140 0 11&quot;,                     // Banned Name
+&quot;button 150 140 210 211 1 0 13&quot;,         // Banned Button
+&quot;text 180 160 0 12&quot;,                     // Banned Name
+&quot;button 150 160 210 211 1 0 14&quot;,         // Banned Button
+&quot;text 180 180 0 13&quot;,                     // Banned Name
+&quot;button 150 180 210 211 1 0 15&quot;,         // Banned Button
+&quot;text 180 200 0 14&quot;,                     // Banned Name
+&quot;button 150 200 210 211 1 0 16&quot;,         // Banned Button
+&quot;text 180 220 0 15&quot;,                     // Banned Name
+&quot;button 150 220 210 211 1 0 17&quot;,         // Banned Button
+&quot;text 180 240 0 16&quot;,                     // Banned Name
+&quot;button 150 240 210 211 1 0 18&quot;,         // Banned Button
+&quot;text 180 260 0 17&quot;,                     // Banned Name
+&quot;button 150 260 210 211 1 0 19&quot;,         // Banned Button
+&quot;text 180 280 0 18&quot;,                     // Banned Name
+&quot;button 150 280 210 211 1 0 20&quot;,         // Banned Button
+&quot;text 180 300 0 19&quot;,                     // Banned Name
+&quot;button 150 300 210 211 1 0 21&quot;,         // Banned Button
+&quot;text 180 320 0 20&quot;,                     // Banned Name
+&quot;button 150 320 210 211 1 0 22&quot;,         // Banned Button
+&quot;button 160 363 5223 5223 0 1 30&quot;        // Previous Page
+
+
+};
+
+var databanlift := {
+&quot;Lift a Ban&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;Remove Now!&quot;,
+&quot;&quot;
+};
+
+
+
+
+var layoutfriendremove := {
+&quot;page 0&quot;,                                // Page 0
+&quot;resizepic 100 100 2600 400 300&quot;,        // Grey background
+&quot;resizepic 147 359 5100 310 25&quot;,         // Square Grey box
+&quot;text 185 118 995 0&quot;,                    // Title
+&quot;button 270 360 247 248 1 0 1&quot;,          // Okay, button 1
+&quot;button 145 335 2714 2714 1 0 2&quot;,        // Remove Button
+&quot;text 165 335 995 24&quot;,                    // Remove Text
+&quot;page 1&quot;,                                // Page 1
+&quot;button 425 363 5224 5224 0 2 16&quot;,       // Next Page
+&quot;text 180 140 0 1&quot;,                      // Banned Name
+&quot;button 150 140 210 211 1 0 3&quot;,          // Banned Button
+&quot;text 180 160 0 2&quot;,                      // Banned Name
+&quot;button 150 160 210 211 1 0 4&quot;,          // Banned Button
+&quot;text 180 180 0 3&quot;,                      // Banned Name
+&quot;button 150 180 210 211 1 0 5&quot;,          // Banned Button
+&quot;text 180 200 0 4&quot;,                      // Banned Name
+&quot;button 150 200 210 211 1 0 6&quot;,          // Banned Button
+&quot;text 180 220 0 5&quot;,                      // Banned Name
+&quot;button 150 220 210 211 1 0 7&quot;,          // Banned Button
+&quot;text 180 240 0 6&quot;,                      // Banned Name
+&quot;button 150 240 210 211 1 0 8&quot;,          // Banned Button
+&quot;text 180 260 0 7&quot;,                      // Banned Name
+&quot;button 150 260 210 211 1 0 9&quot;,          // Banned Button
+&quot;text 180 280 0 8&quot;,                      // Banned Name
+&quot;button 150 280 210 211 1 0 10&quot;,         // Banned Button
+&quot;text 180 300 0 9&quot;,                      // Banned Name
+&quot;button 150 300 210 211 1 0 11&quot;,         // Banned Button
+&quot;text 180 320 0 10&quot;,                     // Banned Name
+&quot;button 150 320 210 211 1 0 12&quot;,         // Banned Button
+&quot;page 2&quot;,                     // Page 2
+&quot;text 180 140 0 11&quot;,                     // Banned Name
+&quot;button 150 140 210 211 1 0 13&quot;,         // Banned Button
+&quot;text 180 160 0 12&quot;,                     // Banned Name
+&quot;button 150 160 210 211 1 0 14&quot;,         // Banned Button
+&quot;text 180 180 0 13&quot;,                     // Banned Name
+&quot;button 150 180 210 211 1 0 15&quot;,         // Banned Button
+&quot;text 180 200 0 14&quot;,                     // Banned Name
+&quot;button 150 200 210 211 1 0 16&quot;,         // Banned Button
+&quot;text 180 220 0 15&quot;,                     // Banned Name
+&quot;button 150 220 210 211 1 0 17&quot;,         // Banned Button
+&quot;text 180 240 0 16&quot;,                     // Banned Name
+&quot;button 150 240 210 211 1 0 18&quot;,         // Banned Button
+&quot;text 180 260 0 17&quot;,                     // Banned Name
+&quot;button 150 260 210 211 1 0 19&quot;,         // Banned Button
+&quot;text 180 280 0 18&quot;,                     // Banned Name
+&quot;button 150 280 210 211 1 0 20&quot;,         // Banned Button
+&quot;text 180 300 0 19&quot;,                     // Banned Name
+&quot;button 150 300 210 211 1 0 21&quot;,         // Banned Button
+&quot;text 180 320 0 20&quot;,                     // Banned Name
+&quot;button 150 320 210 211 1 0 22&quot;,         // Banned Button
+&quot;button 160 363 5223 5223 0 1 30&quot;        // Previous Page
+
+
+};
+
+var datafriendremove := {
+&quot;Remove a friend&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;Remove Now!&quot;,
+&quot;&quot;
+};
+
+
+var layoutfriendlist := {
+&quot;page 0&quot;,                                // Page 0
+&quot;resizepic 100 100 2600 400 300&quot;,        // Grey background
+&quot;resizepic 147 359 5100 310 25&quot;,         // Square Grey box
+&quot;text 185 118 995 0&quot;,                    // Title
+&quot;button 270 360 247 248 1 0 1&quot;,          // Okay, button 1
+//&quot;button 145 335 2714 2714 1 0 2&quot;,        // Remove Button
+&quot;text 165 335 995 24&quot;,                    // Remove Text
+&quot;page 1&quot;,                                // Page 1
+&quot;button 425 363 5224 5224 0 2 16&quot;,       // Next Page
+&quot;text 180 140 0 1&quot;,                      // Banned Name
+&quot;text 180 160 0 2&quot;,                      // Banned Name
+&quot;text 180 180 0 3&quot;,                      // Banned Name
+&quot;text 180 200 0 4&quot;,                      // Banned Name
+&quot;text 180 220 0 5&quot;,                      // Banned Name
+&quot;text 180 240 0 6&quot;,                      // Banned Name
+&quot;text 180 260 0 7&quot;,                      // Banned Name
+&quot;text 180 280 0 8&quot;,                      // Banned Name
+&quot;text 180 300 0 9&quot;,                      // Banned Name
+&quot;text 180 320 0 10&quot;,                     // Banned Name
+&quot;page 2&quot;,                     // Page 2
+&quot;text 180 140 0 11&quot;,                     // Banned Name
+&quot;text 180 160 0 12&quot;,                     // Banned Name
+&quot;text 180 180 0 13&quot;,                     // Banned Name
+&quot;text 180 200 0 14&quot;,                     // Banned Name
+&quot;text 180 220 0 15&quot;,                     // Banned Name
+&quot;text 180 240 0 16&quot;,                     // Banned Name
+&quot;text 180 260 0 17&quot;,                     // Banned Name
+&quot;text 180 280 0 18&quot;,                     // Banned Name
+&quot;text 180 300 0 19&quot;,                     // Banned Name
+&quot;text 180 320 0 20&quot;,                     // Banned Name
+&quot;button 160 363 5223 5223 0 1 30&quot;        // Previous Page
+
+
+};
+
+var datafriendlist := {
+&quot;Friends of the house&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;
+};
+
+
+var layoutbanlist := {
+&quot;page 0&quot;,                                // Page 0
+&quot;resizepic 100 100 2600 400 300&quot;,        // Grey background
+&quot;resizepic 147 359 5100 310 25&quot;,         // Square Grey box
+&quot;text 185 118 995 0&quot;,                    // Title
+&quot;button 270 360 247 248 1 0 1&quot;,          // Okay, button 1
+//&quot;button 145 335 2714 2714 1 0 2&quot;,        // Remove Button
+&quot;text 165 335 995 24&quot;,                    // Remove Text
+&quot;page 1&quot;,                                // Page 1
+&quot;button 425 363 5224 5224 0 2 16&quot;,       // Next Page
+&quot;text 180 140 0 1&quot;,                      // Banned Name
+&quot;text 180 160 0 2&quot;,                      // Banned Name
+&quot;text 180 180 0 3&quot;,                      // Banned Name
+&quot;text 180 200 0 4&quot;,                      // Banned Name
+&quot;text 180 220 0 5&quot;,                      // Banned Name
+&quot;text 180 240 0 6&quot;,                      // Banned Name
+&quot;text 180 260 0 7&quot;,                      // Banned Name
+&quot;text 180 280 0 8&quot;,                      // Banned Name
+&quot;text 180 300 0 9&quot;,                      // Banned Name
+&quot;text 180 320 0 10&quot;,                     // Banned Name
+&quot;page 2&quot;,                     // Page 2
+&quot;text 180 140 0 11&quot;,                     // Banned Name
+&quot;text 180 160 0 12&quot;,                     // Banned Name
+&quot;text 180 180 0 13&quot;,                     // Banned Name
+&quot;text 180 200 0 14&quot;,                     // Banned Name
+&quot;text 180 220 0 15&quot;,                     // Banned Name
+&quot;text 180 240 0 16&quot;,                     // Banned Name
+&quot;text 180 260 0 17&quot;,                     // Banned Name
+&quot;text 180 280 0 18&quot;,                     // Banned Name
+&quot;text 180 300 0 19&quot;,                     // Banned Name
+&quot;text 180 320 0 20&quot;,                     // Banned Name
+&quot;button 160 363 5223 5223 0 1 30&quot;        // Previous Page
+
+
+};
+
+var databanlist := {
+&quot;Enemies of the house&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;
+};
+
+
+
+
+var layoutcownremove := {
+&quot;page 0&quot;,                                // Page 0
+&quot;resizepic 100 100 2600 400 300&quot;,        // Grey background
+&quot;resizepic 147 359 5100 310 25&quot;,         // Square Grey box
+&quot;text 185 118 995 0&quot;,                    // Title
+&quot;button 270 360 247 248 1 0 1&quot;,          // Okay, button 1
+&quot;button 145 335 2714 2714 1 0 2&quot;,        // Remove Button
+&quot;text 165 335 995 24&quot;,                    // Remove Text
+&quot;page 1&quot;,                                // Page 1
+&quot;button 425 363 5224 5224 0 2 16&quot;,       // Next Page
+&quot;text 180 140 0 1&quot;,                      // Banned Name
+&quot;button 150 140 210 211 1 0 3&quot;,          // Banned Button
+&quot;text 180 160 0 2&quot;,                      // Banned Name
+&quot;button 150 160 210 211 1 0 4&quot;,          // Banned Button
+&quot;text 180 180 0 3&quot;,                      // Banned Name
+&quot;button 150 180 210 211 1 0 5&quot;,          // Banned Button
+&quot;text 180 200 0 4&quot;,                      // Banned Name
+&quot;button 150 200 210 211 1 0 6&quot;,          // Banned Button
+&quot;text 180 220 0 5&quot;,                      // Banned Name
+&quot;button 150 220 210 211 1 0 7&quot;,          // Banned Button
+&quot;text 180 240 0 6&quot;,                      // Banned Name
+&quot;button 150 240 210 211 1 0 8&quot;,          // Banned Button
+&quot;text 180 260 0 7&quot;,                      // Banned Name
+&quot;button 150 260 210 211 1 0 9&quot;,          // Banned Button
+&quot;text 180 280 0 8&quot;,                      // Banned Name
+&quot;button 150 280 210 211 1 0 10&quot;,         // Banned Button
+&quot;text 180 300 0 9&quot;,                      // Banned Name
+&quot;button 150 300 210 211 1 0 11&quot;,         // Banned Button
+&quot;text 180 320 0 10&quot;,                     // Banned Name
+&quot;button 150 320 210 211 1 0 12&quot;,         // Banned Button
+&quot;page 2&quot;,                     // Page 2
+&quot;text 180 140 0 11&quot;,                     // Banned Name
+&quot;button 150 140 210 211 1 0 13&quot;,         // Banned Button
+&quot;text 180 160 0 12&quot;,                     // Banned Name
+&quot;button 150 160 210 211 1 0 14&quot;,         // Banned Button
+&quot;text 180 180 0 13&quot;,                     // Banned Name
+&quot;button 150 180 210 211 1 0 15&quot;,         // Banned Button
+&quot;text 180 200 0 14&quot;,                     // Banned Name
+&quot;button 150 200 210 211 1 0 16&quot;,         // Banned Button
+&quot;text 180 220 0 15&quot;,                     // Banned Name
+&quot;button 150 220 210 211 1 0 17&quot;,         // Banned Button
+&quot;text 180 240 0 16&quot;,                     // Banned Name
+&quot;button 150 240 210 211 1 0 18&quot;,         // Banned Button
+&quot;text 180 260 0 17&quot;,                     // Banned Name
+&quot;button 150 260 210 211 1 0 19&quot;,         // Banned Button
+&quot;text 180 280 0 18&quot;,                     // Banned Name
+&quot;button 150 280 210 211 1 0 20&quot;,         // Banned Button
+&quot;text 180 300 0 19&quot;,                     // Banned Name
+&quot;button 150 300 210 211 1 0 21&quot;,         // Banned Button
+&quot;text 180 320 0 20&quot;,                     // Banned Name
+&quot;button 150 320 210 211 1 0 22&quot;,         // Banned Button
+&quot;button 160 363 5223 5223 0 1 30&quot;        // Previous Page
+};
+
+var datacownremove := {
+&quot;Remove a Co-owner&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;Remove Now!&quot;,
+&quot;&quot;
+};
+
+
+var layoutcownlist := {
+&quot;page 0&quot;,                                // Page 0
+&quot;resizepic 100 100 2600 400 300&quot;,        // Grey background
+&quot;resizepic 147 359 5100 310 25&quot;,         // Square Grey box
+&quot;text 185 118 995 0&quot;,                    // Title
+&quot;button 270 360 247 248 1 0 1&quot;,          // Okay, button 1
+//&quot;button 145 335 2714 2714 1 0 2&quot;,        // Remove Button
+&quot;text 165 335 995 24&quot;,                    // Remove Text
+&quot;page 1&quot;,                                // Page 1
+&quot;button 425 363 5224 5224 0 2 16&quot;,       // Next Page
+&quot;text 180 140 0 1&quot;,                      // Banned Name
+&quot;text 180 160 0 2&quot;,                      // Banned Name
+&quot;text 180 180 0 3&quot;,                      // Banned Name
+&quot;text 180 200 0 4&quot;,                      // Banned Name
+&quot;text 180 220 0 5&quot;,                      // Banned Name
+&quot;text 180 240 0 6&quot;,                      // Banned Name
+&quot;text 180 260 0 7&quot;,                      // Banned Name
+&quot;text 180 280 0 8&quot;,                      // Banned Name
+&quot;text 180 300 0 9&quot;,                      // Banned Name
+&quot;text 180 320 0 10&quot;,                     // Banned Name
+&quot;page 2&quot;,                     // Page 2
+&quot;text 180 140 0 11&quot;,                     // Banned Name
+&quot;text 180 160 0 12&quot;,                     // Banned Name
+&quot;text 180 180 0 13&quot;,                     // Banned Name
+&quot;text 180 200 0 14&quot;,                     // Banned Name
+&quot;text 180 220 0 15&quot;,                     // Banned Name
+&quot;text 180 240 0 16&quot;,                     // Banned Name
+&quot;text 180 260 0 17&quot;,                     // Banned Name
+&quot;text 180 280 0 18&quot;,                     // Banned Name
+&quot;text 180 300 0 19&quot;,                     // Banned Name
+&quot;text 180 320 0 20&quot;,                     // Banned Name
+&quot;button 160 363 5223 5223 0 1 30&quot;        // Previous Page
+
+
+
+};
+
+var datacownlist := {
+&quot;Co-owners of the house&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;&quot;
+};
+
+var checklayout := array(
+
+&quot;page 0&quot;,
+&quot;gumppic   0  50 0206            &quot;,
+&quot;gumppic  40  50 0201            &quot;,
+&quot;gumppic 460  50 0207            &quot;,
+&quot;gumppic   0  94 0202            &quot;,
+&quot;gumppic  40  94 2604            &quot;,
+&quot;gumppic 460  94 2605            &quot;,
+&quot;gumppic   0 410 2606            &quot;,
+&quot;gumppic  40 410 2607            &quot;,
+&quot;gumppic 460 410 2608            &quot;,
+&quot;gumppic  16 100 5100            &quot;,
+&quot;gumppic  28 100 5101            &quot;,
+&quot;gumppic 118 100 5101            &quot;,
+&quot;gumppic 208 100 5101            &quot;,
+&quot;gumppic 298 100 5101            &quot;,
+&quot;gumppic 388 100 5101            &quot;,
+&quot;gumppic 478 100 5102            &quot;,
+&quot;gumppic  16 108 5103            &quot;,
+&quot;gumppic  28 108 5104            &quot;,
+&quot;gumppic 118 108 5104            &quot;,
+&quot;gumppic 208 108 5104            &quot;,
+&quot;gumppic 298 108 5104            &quot;,
+&quot;gumppic 388 108 5104            &quot;,
+&quot;gumppic 478 108 5105            &quot;,
+&quot;gumppic  16 116 5058            &quot;,
+&quot;gumppic 118 116 5058            &quot;,
+&quot;gumppic 232 116 5058            &quot;,
+&quot;gumppic 360 116 5058            &quot;,
+&quot;gumppic  16 116 5106            &quot;,
+&quot;gumppic  28 116 5107            &quot;,
+&quot;gumppic 118 116 5107            &quot;,
+&quot;gumppic 208 116 5107            &quot;,
+&quot;gumppic 298 116 5107            &quot;,
+&quot;gumppic 388 116 5107            &quot;,
+&quot;gumppic 478 116 5108            &quot;,
+&quot;text     55 183  910   0        &quot;,
+&quot;text     55 203  910   1        &quot;,
+&quot;text     55 223  910   2        &quot;,
+&quot;button  125 250  249  248 1 0  1&quot;,
+&quot;button  205 250  243  241 1 0  0&quot;
+);
+
+var checkdata := array(
+&quot;Declaring this house public will unlock&quot;,
+&quot;the front doors and make them not lockable.&quot;,
+&quot;Are you sure you want to do this?&quot;
+);
+
+program textcmd_sign(who, sign)
+  var hserial := GetObjProperty(sign, &quot;house_serial&quot;);
+  if(!hserial)
+    return;
+  endif
+  var house := SystemFindObjectBySerial(CInt(hserial));
+  var oserial := GetObjProperty(house, &quot;ownerserial&quot;);
+  SetPlaqueName(sign, house);
+  if(GetObjProperty(house, &quot;Public&quot;))
+    data[31] := &quot;Declare this house Private&quot;;
+    data[30] := &quot;Change the sign type&quot;;
+    layout.append(&quot;page 3&quot;);
+    layout.append(&quot;button 160 190 2714 2715 0 4 26&quot;);
+  else
+    data[31] := &quot;Declare this house Public&quot;;
+    data[30] := &quot;Change the master key&quot;;
+    layout.append(&quot;page 3&quot;);
+    layout.append(&quot;button 160 190 2714 2715 1 4 16&quot;);
+  endif
+  if(who.serial == oserial)
+    data[6] := who.name;
+    SetObjProperty(sign, &quot;lastownername&quot;, who.name);
+  else
+    data[6] := GetObjProperty(sign, &quot;lastownername&quot;);
+  endif
+  data[8]  := GetObjProperty(house, &quot;numlockdowns&quot;);
+  data[10] := GetObjProperty(house, &quot;numsecure&quot;);
+  var friend_ := 0, cown := 0;
+  var friendlist := GetObjProperty(house, &quot;friendlist&quot;);
+  var coown := GetObjProperty(house, &quot;coownlist&quot;);
+  if(who.serial in friendlist)
+    friend_ := 1;
+  elseif(who.serial in coown)
+    cown := 1;
+  endif
+  var result;
+  var acct := GetObjProperty(house, &quot;owneracct&quot;);
+  if((cown == 1) || (friend_ == 1) || (who.acctname == acct) || (who.cmdlevel &gt; 2))
+    result := SendDialogGump(who, layout, data);
+  else
+    SendDialogGump(who, nonlayout, data);
+  endif
+  if((oserial == who.serial) ||(cown))
+    SetObjProperty(house,&quot;decay&quot;,(ReadGameClock()+ 2592000));
+  endif
+  if((acct == who.acctname) || (cown) || (who.cmdlevel &gt; 2))
+    if(result[0] &gt; 2979 &amp;&amp; result[0] &lt; 3085)
+      ChangeSign(who, house, sign, result[0]);
+    endif
+    case(result[0])
+      1: var newname := RequestInput(who, sign, &quot;Enter a name for this house.(esc to exit)&quot;);
+         if(!newname)
+           SendSysMessage(who, &quot;Canceled!&quot;);
+         elseif((len(newname) &gt; 20))
+           SendSysMessage(who, &quot;House sign names may not be longer than 20 characters.&quot;);
+         elseif(len(SplitWords(newname)) &gt; 5)
+           SendSysMessage(who, &quot;House sign names are limited to 5 words or less.&quot;);
+         else
+           SetName(sign, newname);
+           SetObjProperty(house, &quot;signname&quot;, newname);
+         endif
+      2: ListCoowner(house, who);                                   //list co-owners
+      3: AddCoowner(house, who);                                    //add co-owner
+      4: DeleteCoowner(house, who);                                 //delete co-owner
+      5: ListFriend(house, who);                                    //list friends
+      6: AddFriend(house, who);                                     //add friend
+      7: DeleteFriend(house, who);                                  //delete friend
+      8: if(YesNo(who,&quot;Clear List?&quot;))                               //clear friend list
+           EraseObjProperty(house, &quot;friendlist&quot;);
+           SendSysMessage(who,&quot;Friend list has been cleared.&quot;);
+         else
+           SendSysMessage(who,&quot;Canceled!&quot;);
+         endif
+      9: AddBan(house, who,sign);                                   //add a ban
+     10: Eject(house,who,sign);                                     //eject someone
+     11: ListBan(house, who);                                       //list bans
+     12: DeleteBan(house, who);                                     //remove a ban
+     13: if((oserial == who.serial) or (who.cmdlevel &gt; 2))          //transfer ownership
+           var targetow := Target(who);
+           SendSysMessage(who, &quot;Transfer the house to who?&quot;);
+           if(ChangeHouseOwner(who, targetow,house) == 1)
+             SendSysMessage(who, &quot;House transfer was successful.&quot;);
+           else
+             SendSysMessage(who, &quot;House transfer was NOT successful.&quot;);
+           endif
+         endif
+     14: if(oserial == who.serial)                                   //demolish house
+           if(YesNo(who, &quot;are you sure?&quot;))
+             demolish(house, sign, who);
+           else
+             SendSysMessage(who, &quot;Cancelled&quot;);
+           endif
+           return;
+         endif
+     16: if(oserial == who.serial)                                   //change locks
+           ChangeLocks(who, house);
+         endif
+     17: if(YesNo(who,&quot;Clear List?&quot;))                               //clear co-owner list
+           EraseObjProperty(house, &quot;coownlist&quot;);
+           SendSysMessage(who,&quot;Co-owner list has been cleared.&quot;);
+         else
+           SendSysMessage(who,&quot;Canceled!&quot;);
+         endif
+     19: if(oserial == who.serial)                                   //make private
+           DeclarePrivPub(who, house, sign);
+         endif
+    endcase
+  endif
+endprogram
+
+//////////////////////////////////
+//       friending
+//////////////////////////////////
+
+function AddFriend(house, who)
+  var banlist := GetObjProperty(house, &quot;friendlist&quot;);
+  if(!banlist)
+    banlist := {};
+  endif
+  if(len(banlist) &gt;= 20)
+    SendSysMessage(who, &quot;The friend list is full.&quot;);
+    return;
+  endif
+  SendSysMessage(who,&quot;Select character.&quot;);
+  var targetchr := Target(who);
+  if(!targetchr)
+    SendSysMessage(who,&quot;Cancelled.&quot;);
+    return;
+  endif
+  if(!targetchr.isA(POLCLASS_MOBILE))
+    SendSysMessage(who,&quot;That cannot be added to the list.&quot;);
+    return;
+  endif
+  if(targetchr.serial in banlist)
+    SendSysMessage(who, &quot;That person is already a friend.&quot;);
+    return;
+  endif
+  if(targetchr.acctname == GetObjProperty(house,&quot;owneracct&quot;))
+    SendSysMessage(who, &quot;Canceled.&quot;);
+    return;
+  endif
+  checklists(house, targetchr, &quot;banlist&quot;, &quot;coownlist&quot;);
+  banlist.append(targetchr.serial);
+  SetObjProperty(house, &quot;friendlist&quot;, banlist);
+  SendSysMessage(who, targetchr.name + &quot; was friended to your house.&quot;);
+endfunction
+
+function DeleteFriend(house,who)
+  var z := 0;
+  var fillname;
+  var retval1 := 0;
+  var banlist := GetObjProperty(house, &quot;friendlist&quot;);
+  if(!banlist)
+    banlist := {};
+  endif
+  var newlist := {};
+  foreach thing in banlist
+    fillname := SystemFindObjectBySerial(thing);
+    if(!fillname)
+      fillname := SystemFindObjectBySerial(thing, SYSFIND_SEARCH_OFFLINE_MOBILES);
+    endif
+    if(fillname)
+      newlist.append(thing);
+      datafriendremove[z+2] := fillname.name;
+      z := z + 1;
+    endif
+  endforeach
+  SetObjProperty(house, &quot;friendlist&quot;, newlist);
+  retval1 := SendDialogGump(who, layoutfriendremove, datafriendremove);
+  var bancheck, returncheck;
+  if(retval1[0] &gt; 2 &amp;&amp; retval1[0] &lt;= 22)
+    returncheck := retval1[0] - 2;
+    bancheck := banlist[returncheck];
+    if(!bancheck)
+      SendSysMessage(who, &quot;There is no friend in that slot.&quot;);
+      return;
+    else
+      var newlist := {};
+      foreach thing in banlist
+        if(thing != bancheck)
+          newlist.append(thing);
+        endif
+      endforeach
+      SetObjProperty(house, &quot;friendlist&quot;, newlist);
+    endif
+  endif
+endfunction
+
+function ListFriend(house, who)
+  var z := 0;
+  var fillname;
+  var banlist := GetObjProperty(house, &quot;friendlist&quot;);
+  if(!banlist)
+    banlist := {};
+  endif
+  var newlist := {};
+  foreach thing in banlist
+    fillname := SystemFindObjectBySerial(thing);
+    if(!fillname)
+      fillname := SystemFindObjectBySerial(thing, SYSFIND_SEARCH_OFFLINE_MOBILES);
+    endif
+    if(fillname)
+      newlist.append(thing);
+      datafriendlist[z+2] := fillname.name;
+      z := z + 1;
+    endif
+  endforeach
+  SetObjProperty(house, &quot;friendlist&quot;, newlist);
+  SendDialogGump(who, layoutfriendlist, datafriendlist);
+endfunction
+
+////////////////////////////
+//   banning
+////////////////////////////
+
+function AddBan(house, who, sign)
+  var banlist := GetObjProperty(house, &quot;banlist&quot;);
+  if(!banlist)
+    banlist := {};
+  endif
+  if(len(banlist) &gt;= 20)
+    SendSysMessage(who, &quot;The ban list is full.&quot;);
+    return;
+  endif
+  SendSysMessage(who,&quot;Select character.&quot;);
+  var targetchr := Target(who);
+  if(!targetchr)
+    SendSysMessage(who,&quot;Cancelled.&quot;);
+    return;
+  endif
+  if(!targetchr.isA(POLCLASS_MOBILE))
+    SendSysMessage(who,&quot;That cannot be added to the list.&quot;);
+    return;
+  endif
+  if(targetchr.serial in banlist)
+    SendSysMessage(who, &quot;That person is already banned.&quot;);
+    return;
+  endif
+  if(targetchr.multi.serial == house.serial)
+    if(targetchr.acctname == GetObjProperty(house,&quot;owneracct&quot;))
+      SendSysMessage(who, &quot;You cannot ban yourself.&quot;);
+      return;
+    endif
+    checklists(house, targetchr, &quot;friendlist&quot;, &quot;coownlist&quot;);
+    MoveCharacterToLocation(targetchr, sign.x, sign.y, sign.z);
+    banlist.append(targetchr.serial);
+    SetObjProperty(house, &quot;banlist&quot;, banlist);
+    SendSysMessage(who, targetchr.name + &quot; was banned from your house.&quot;);
+  else
+    SendSysMessage(who, &quot;That cannot be added to the list.&quot;);
+    return;
+  endif
+endfunction
+
+function DeleteBan(house,who)
+  var z := 0;
+  var fillname;
+  var retval1 := 0;
+  var banlist := GetObjProperty(house, &quot;banlist&quot;);
+  if(!banlist)
+    banlist := {};
+  endif
+  var newlist := {};
+  foreach thing in banlist
+    fillname := SystemFindObjectBySerial(thing);
+    if(!fillname)
+      fillname := SystemFindObjectBySerial(thing, SYSFIND_SEARCH_OFFLINE_MOBILES);
+    endif
+    if(fillname)
+      newlist.append(thing);
+      databanlift[z+2] := fillname.name;
+      z := z + 1;
+    endif
+  endforeach
+  SetObjProperty(house, &quot;banlist&quot;, newlist);
+  retval1 := SendDialogGump(who, layoutbanlift, databanlift);
+  var bancheck, returncheck;
+  if(retval1[0] &gt; 2 &amp;&amp; retval1[0] &lt;= 22)
+    returncheck := retval1[0] - 2;
+    bancheck := banlist[returncheck];
+    if(!bancheck)
+      SendSysMessage(who, &quot;There is no ban in that slot.&quot;);
+      return;
+    else
+      var newlist := {};
+      foreach thing in banlist
+        if(thing != bancheck)
+          newlist.append(thing);
+        endif
+      endforeach
+      SetObjProperty(house, &quot;banlist&quot;, newlist);
+    endif
+  endif
+endfunction
+
+function ListBan(house, who)
+  var z := 0;
+  var fillname;
+  var banlist := GetObjProperty(house, &quot;banlist&quot;);
+  if(!banlist)
+    banlist := {};
+  endif
+  var newlist := {};
+  foreach thing in banlist
+    fillname := SystemFindObjectBySerial(thing);
+    if(!fillname)
+      fillname := SystemFindObjectBySerial(thing, SYSFIND_SEARCH_OFFLINE_MOBILES);
+    endif
+    if(fillname)
+      newlist.append(thing);
+      databanlist[z+2] := fillname.name;
+      z := z + 1;
+    endif
+  endforeach
+  SetObjProperty(house, &quot;banlist&quot;, newlist);
+  SendDialogGump(who, layoutbanlist, databanlist);
+endfunction
+
+function AddCoowner(house, who)
+  var banlist := GetObjProperty(house, &quot;coownlist&quot;);
+  if(!banlist)
+    banlist := {};
+  endif
+  if(len(banlist) &gt;= 20)
+    SendSysMessage(who, &quot;The co-owner list is full.&quot;);
+    return;
+  endif
+  SendSysMessage(who,&quot;Select character.&quot;);
+  var targetchr := Target(who);
+  if(!targetchr)
+    SendSysMessage(who,&quot;Cancelled.&quot;);
+    return;
+  endif
+  if(!targetchr.isA(POLCLASS_MOBILE))
+    SendSysMessage(who,&quot;That cannot be added to the list.&quot;);
+    return;
+  endif
+  if(targetchr.serial in banlist)
+    SendSysMessage(who, &quot;That person is already a co-owner.&quot;);
+    return;
+  endif
+  if(targetchr.acctname == GetObjProperty(house,&quot;owneracct&quot;))
+    SendSysMessage(who, &quot;Canceled.&quot;);
+    return;
+  endif
+  checklists(house, targetchr, &quot;friendlist&quot;, &quot;banlist&quot;);
+  banlist.append(targetchr.serial);
+  SetObjProperty(house, &quot;coownlist&quot;, banlist);
+  SendSysMessage(who, targetchr.name + &quot; was co-owned to your house.&quot;);
+endfunction
+
+function DeleteCoowner(house,who)
+  var z := 0;
+  var fillname;
+  var retval1 := 0;
+  var banlist := GetObjProperty(house, &quot;coownlist&quot;);
+  if(!banlist)
+    banlist := {};
+  endif
+  var newlist := {};
+  foreach thing in banlist
+    fillname := SystemFindObjectBySerial(thing);
+    if(!fillname)
+      fillname := SystemFindObjectBySerial(thing, SYSFIND_SEARCH_OFFLINE_MOBILES);
+    endif
+    if(fillname)
+      newlist.append(thing);
+      datacownremove[z+2] := fillname.name;
+      z := z + 1;
+    endif
+  endforeach
+  SetObjProperty(house, &quot;coownlist&quot;, newlist);
+  retval1 := SendDialogGump(who, layoutcownremove, datacownremove);
+  var bancheck, returncheck;
+  if(retval1[0] &gt; 2 &amp;&amp; retval1[0] &lt;= 22)
+    returncheck := retval1[0] - 2;
+    bancheck := banlist[returncheck];
+    if(!bancheck)
+      SendSysMessage(who, &quot;There is no co-owner in that slot.&quot;);
+      return;
+    else
+      var newlist := {};
+      foreach thing in banlist
+        if(thing != bancheck)
+          newlist.append(thing);
+        endif
+      endforeach
+      SetObjProperty(house, &quot;coownlist&quot;, newlist);
+    endif
+  endif
+endfunction
+
+function ListCoowner(house, who)
+  var z := 0;
+  var fillname;
+  var banlist := GetObjProperty(house, &quot;coownlist&quot;);
+  if(!banlist)
+    banlist := {};
+  endif
+  var newlist := {};
+  foreach thing in banlist
+    fillname := SystemFindObjectBySerial(thing);
+    if(!fillname)
+      fillname := SystemFindObjectBySerial(thing, SYSFIND_SEARCH_OFFLINE_MOBILES);
+    endif
+    if(fillname)
+      newlist.append(thing);
+      datacownlist[z+2] := fillname.name;
+      z := z + 1;
+    endif
+  endforeach
+  SetObjProperty(house, &quot;coownlist&quot;, newlist);
+  SendDialogGump(who, layoutcownlist, datacownlist);
+endfunction
+
+function ChangeHouseOwner(oldowner, who, house)
+  var oldownerserial:=GetObjProperty(house, &quot;ownerserial&quot;);
+  if(oldownerserial == who.serial)
+    return 0;
+  elseif(who.acctname)
+    var chk;
+    var builtdeed := GetObjProperty(house, &quot;builtdeed&quot;);
+    if(builtdeed)
+      chk := SystemFindObjectBySerial(builtdeed);
+      if(!chk)
+        chk := SystemFindObjectBySerial(builtdeed, 1);
+      endif
+      if(!chk)
+        chk := SystemFindObjectBySerial(builtdeed, 2);
+      endif
+      if(!chk)
+        SendSysMessage(who, &quot;Error: Could not find built deed. Page a GM.&quot;, 3, 40);
+        return 0;
+      endif
+    else
+      SendSysMessage(who, &quot;Error: Could not find built deed. Page a GM.&quot;, 3, 40);
+      return 0;
+    endif
+    var hisbank := CP_GetStorageContainerForMobile(who, CP_DEFAULT_AREA, 1);
+    if(!hisbank)
+      SendSysMessage(who,      &quot;House transfer was NOT successful.&quot;);
+      SendSysMessage(oldowner, &quot;House transfer was NOT successful.&quot;);
+      return 0;
+    endif
+    if(!MoveItemToContainer(builtdeed, hisbank))
+      SendSysMessage(who,      &quot;House transfer was NOT successful.&quot;);
+      SendSysMessage(oldowner, &quot;House transfer was NOT successful.&quot;);
+      return 0;
+    endif
+    SetObjProperty(house,    &quot;ownerserial&quot;, who.serial);
+    SetObjProperty(house,    &quot;owneracct&quot;,   who.acctname);
+    SendSysMessage(who,      &quot;House transfer was successful.&quot;);
+    SendSysMessage(who,      &quot;It would be wise to change the locks soon.&quot;);
+    SendSysMessage(oldowner, &quot;House transfer was successful.&quot;);
+    return 1;
+  endif
+  SendSysMessage(who,      &quot;House transfer was NOT successful.&quot;);
+  SendSysMessage(oldowner, &quot;House transfer was NOT successful.&quot;);
+  return 0;
+endfunction
+
+function DeclarePrivPub(who, house, sign)
+  var public := GetObjProperty(house, &quot;Public&quot;);
+  if(public == 1)
+    var check := 0;
+    foreach mob in (house.mobiles)
+      if(mob.npctemplate == &quot;playervendor&quot;)
+        check := 1;
+        break;
+      endif
+    endforeach
+    if(check == 1)
+      SendSysMessage(who, &quot;You cannot declare this house private while there are vendors inside.&quot;);
+      return;
+    endif
+    foreach thing in (house.components)
+      if(((thing.y == (sign.y - 1)) or (thing.y == (sign.y))) and (thing.isa(POLCLASS_DOOR)))
+        thing.locked := 1;
+        EraseObjProperty(thing, &quot;Public&quot;);
+      endif
+    endforeach
+    var signgraph := GetObjProperty(house, &quot;oldsignprop&quot;);
+    if(signgraph)
+      sign.graphic := signgraph;
+    endif
+    EraseObjProperty(house, &quot;Public&quot;);
+    SetObjProperty(house, &quot;Private&quot;, 1);
+    EraseObjProperty(sign, &quot;Public&quot;);
+    SetObjProperty(sign, &quot;Private&quot;, 1);
+    SendSysMessage(who, &quot;This house is now private. The front doors have been locked, and friends may no longer place vendors here.&quot;);
+  else
+    var result := SendDialogGump(who, checklayout, checkdata);
+    if(result[0] == 1)
+      EraseObjProperty(house, &quot;Private&quot;);
+      SetObjProperty(house, &quot;Public&quot;, 1);
+      EraseObjProperty(sign, &quot;Private&quot;);
+      SetObjProperty(sign, &quot;Public&quot;, 1);
+      foreach thing in (house.components)
+        if(((thing.y == (sign.y - 1)) or (thing.y == (sign.y))) and (thing.isa(POLCLASS_DOOR)))
+          thing.locked := 0;
+          SetObjProperty(thing, &quot;Public&quot;, 1);
+        endif
+      endforeach
+      SendSysMessage(who, &quot;This house is now public. Friends of the house may now place vendors.&quot;);
+    else
+      SendSysMessage(who, &quot;Cancelled.&quot;);
+    endif
+  endif
+endfunction
+
+function ChangeSign(who, house, sign, result)
+  who := who;
+  var signgraph := result[0];
+  if(sign.graphic == 3024 || sign.graphic == 3026)
+    SetObjProperty(house, &quot;oldsignprop&quot;, sign.graphic);
+    sign.graphic := signgraph;
+  else
+    sign.graphic := signgraph;
+  endif
+endfunction
+
+function Eject(house,who,sign)
+  house := house;
+  var targetchr:=Target(who);
+  if((!targetchr.multi) &amp;&amp;(Distance(who,sign)&gt;15))
+    return;
+  endif
+  if(!targetchr)
+    SendSysMessage(who,&quot;Cancelled.&quot;);
+    return;
+  endif
+  MoveCharacterToLocation(targetchr,sign.x,sign.y,0,MOVECHAR_FORCELOCATION);
+  SendSysMessage(who,targetchr.name+&quot; was ejected!&quot;);
+endfunction
+
+function checklists(house, who, list1, list2)
+  var lista := GetObjProperty(house, list1);
+  var listb := GetObjProperty(house, list2);
+  var newarray := {};
+  if(who.serial in lista)
+    foreach thing in lista
+      if(thing != who.serial)
+        newarray.append(thing);
+      endif
+    endforeach
+    SetObjProperty(house, list1, newarray);
+  endif
+  newarray := {};
+  if(who.serial in listb)
+    foreach thing in listb
+      if(thing != who.serial)
+        newarray.append(thing);
+      endif
+    endforeach
+    SetObjProperty(house, list2, newarray);
+  endif
+endfunction
+
+function demolish(house, sign, who)
+  sign := sign;
+  var lists := GetObjProperty(house, &quot;footage&quot;);
+  var itemlist := {};
+  var holder, chk := 0;
+  foreach thing in lists
+    holder := ListObjectsInBox(thing[1], thing[2], thing[3], thing[4], thing[5],thing[6], house.realm);
+    foreach thing in holder
+      itemlist.append(thing);
+    endforeach
+  endforeach
+  foreach thing in itemlist
+    if(thing.objtype == 0xa390)
+      chk := 1;
+      break;
+    endif
+  endforeach
+  foreach npc in (house.mobiles)
+    if(npc.npctemplate == &quot;playervendor&quot;)
+      chk := 1;
+      break;
+    endif
+  endforeach
+  if(chk == 1)
+    SendSysMessage(who, &quot;You cannot redeed a house with vendors in it.&quot;);
+    return;
+  endif
+  if(chk == 0)
+    var builtdeed := GetObjProperty(house, &quot;builtdeed&quot;);
+    if(builtdeed)
+      if(!DestroyItem(SystemFindObjectBySerial(builtdeed)))
+         chk := 2;
+      endif
+    endif
+  endif
+  if(chk == 0)
+    var lockids := {}, id;
+    foreach thing in (house.components)
+      id := GetObjProperty(thing, &quot;lockid&quot;);
+      if(id)
+        lockids.append(id);
+      endif
+    endforeach
+    foreach thing in EnumerateItemsInContainer(who.backpack)
+      id := GetObjProperty(thing, &quot;lockid&quot;);
+      if(id)
+        if(id in lockids)
+          DestroyItem(thing);
+        endif
+      endif
+    endforeach
+    var bankbox := CP_GetStorageContainerForMobile(who, CP_DEFAULT_AREA, 1);
+    if(bankbox)
+      foreach thing in EnumerateItemsInContainer(bankbox)
+        id := GetObjProperty(thing, &quot;lockid&quot;);
+        if(id)
+          if(id in lockids)
+            DestroyItem(thing);
+          endif
+        endif
+      endforeach
+    endif
+    var retdeed := 0;
+    case(house.objtype)
+      0x6060: retdeed := CreateItemInBackpack(who,0x6019,1); //smallstoneandplasterhouse
+      0x6061: retdeed := CreateItemInBackpack(who,0x601a,1); //smallstonehouse
+      0x6062: retdeed := CreateItemInBackpack(who,0x601b,1); //smallwoodenhouse
+      0x6063: retdeed := CreateItemInBackpack(who,0x601c,1); //smallplasterhouse
+      0x6064: retdeed := CreateItemInBackpack(who,0x601d,1); //smallwoodandstrawhouse
+      0x6073: retdeed := CreateItemInBackpack(who,0x601e,1); //smallbrickhouse
+      0x6065: retdeed := CreateItemInBackpack(who,0x6020,1); //largebrickhouse
+      0x6072: retdeed := CreateItemInBackpack(who,0x6026,1); //largepatiohouse
+      0x6066: retdeed := CreateItemInBackpack(who,0x6021,1); //twostorywoodandplasterhouse
+      0x6068: retdeed := CreateItemInBackpack(who,0x6022,1); //twostorystoneandplasterhouse
+      0x6069: retdeed := CreateItemInBackpack(who,0x6023,1); //tower
+      0x6070: retdeed := CreateItemInBackpack(who,0x6024,1); //keep
+      0x6071: retdeed := CreateItemInBackpack(who,0x6025,1); //castle
+      0x6074: retdeed := CreateItemInBackpack(who,0x602D,1); //smalltower
+      0x6075: retdeed := CreateItemInBackpack(who,0x602E,1); //smallmarbleshop
+      0x6076: retdeed := CreateItemInBackpack(who,0x602F,1); //smallstoneshop
+      0x6077: retdeed := CreateItemInBackpack(who,0x6030,1); //largemarblehouse
+      0x6078: retdeed := CreateItemInBackpack(who,0x6031,1); //logcabin
+      0x6079: retdeed := CreateItemInBackpack(who,0x6032,1); //sandstonepatiohouse
+      0x607A: retdeed := CreateItemInBackpack(who,0x6033,1); //twostoryvilla
+    endcase
+    if(retdeed)
+      var tilelist := GetObjProperty(house, &quot;bantiles&quot;);
+      foreach thing in tilelist
+        DestroyItem(SystemFindObjectBySerial(thing));
+      endforeach
+      foreach thing in itemlist
+        if((GetObjProperty(thing,&quot;secure&quot;) == 1) &amp;&amp; (thing.movable == 0))
+          EraseObjProperty(thing,&quot;secure&quot;);
+          if(GetObjProperty(thing, &quot;houseserial&quot; ) == house.serial)
+            var oldscript := GetObjProperty(thing, &quot;oldscript&quot;);
+            if (oldscript == error)
+              oldscript := &quot;&quot;;
+            endif
+            thing.usescript := oldscript;
+            thing.movable := 1;
+            EraseObjProperty(thing, &quot;houseserial&quot; );
+            EraseObjProperty(thing, &quot;oldscript&quot; );
+          endif
+        elseif ((GetObjProperty(thing, &quot;lockeddown&quot; ) == 1) &amp;&amp; (thing.movable == 0))
+          thing.movable := 1;
+          EraseObjProperty(thing, &quot;houseserial&quot; );
+          EraseObjProperty(thing, &quot;lockeddown&quot;);
+        elseif (thing.movable == 0)
+          if(thing.objtype == 0xa390)
+             MoveItemToLocation(thing, thing.x, thing.y, house.z, MOVEITEM_FORCELOCATION);
+          else
+            DestroyItem(thing);
+          endif
+        endif
+      endforeach
+      DestroyMulti(house);
+    else
+      SendSysMessage(who, &quot;Could not create deed. Your pack may be too full.&quot;);
+      return;
+    endif
+  elseif(chk == 2)
+    SendSysMessage(who, &quot;Could not find the built deed, please page a GM.&quot;);
+    return;
+  else
+    SendSysMessage(who, &quot;You cannot redeed a house while it has a guildstone.&quot;);
+    return;
+  endif
+endfunction
+
+function SetPlaqueName(sign, house)
+  sign := sign;
+  var signname := GetObjProperty(house, &quot;signname&quot;);
+  if(!signname)
+    signname := &quot; &quot;;
+  endif
+  var split := SplitWords(signname);
+  var j;
+  for(j := 1; j &lt;= 5; j := j + 1)
+    if(!split[j])
+      split[j] := &quot;&quot;;
+    endif
+  endfor
+  if(len(signname) &lt;= 12)
+    data[1] := signname;
+  elseif((len(split[1]) + len(split[2]) + len(split[3]) + 2) &lt;= 12)
+    data[1] := split[1] + &quot; &quot; + split[2] + &quot; &quot; + split[3];
+    data[32] := split[4] + &quot; &quot; + split[5];
+  elseif(len(split[1]) + len(split[2]) + 1 &lt;= 12)
+    data[1] := split[1] + &quot; &quot; + split[2];
+    data[32] := split[3] + &quot; &quot; + split[4] + &quot; &quot; + split[5];
+  elseif(len(split[1]) &lt;= 12)
+    data[1] := split[1];
+    data[32] := split[2] + &quot; &quot; + split[3] + &quot; &quot; + split[4] + &quot; &quot; + split[5];
+  endif
+endfunction
+
+function ChangeLocks(who,house)
+  SendSysMessage(who,&quot;Target the new master key.&quot;);
+  var addonitem,newkey:=Target(who);
+  if((newkey.objtype&gt;=KEYSTART) &amp;&amp;(newkey.objtype&lt;=KEYEND) &amp;&amp;(newkey.objtype!=KEYRING))
+    var lockid:=AllocLockId();
+    SetObjProperty(newkey,&quot;lockid&quot;,lockid);
+    foreach item in(house.components)
+      if(((item.objtype&gt;=UOBJECT_DOORS_START) &amp;&amp;(item.objtype&lt;=UOBJECT_DOORS_END)))
+        item.locked := 1;
+        SetObjProperty(item,&quot;lockid&quot;,lockid);
+      endif
+    endforeach
+    addonitem:=CInt(GetObjProperty(house,&quot;component2&quot;));
+    if(addonitem)
+      addonitem.locked:=1;
+      SetObjProperty(addonitem,&quot;lockid&quot;,lockid);
+    endif
+    SendSysMessage(who,&quot;Locks have been changed.&quot;);
+  else
+    SendSysMessage(who,&quot;That is not a key!&quot;);
+  endif
+endfunction

Added: trunk/096/pkg/multis/housing/signControl.src
===================================================================
--- trunk/096/pkg/multis/housing/signControl.src	2005-11-19 12:53:54 UTC (rev 1016)
+++ trunk/096/pkg/multis/housing/signControl.src	2005-11-19 12:58:15 UTC (rev 1017)
@@ -0,0 +1,483 @@
+use uo;
+use os;
+use basic;
+
+include &quot;include/OLD/eventID&quot;;
+include &quot;:attributes:attributes&quot;;
+include &quot;include/sysEvent&quot;;
+include &quot;:itemutils:objtype&quot;;
+
+program SignListener(sign)
+  var house := GetObjProperty(sign, &quot;house_serial&quot;);
+  if (house)
+    house := SystemFindObjectBySerial(house);
+  endif
+  if(!house)
+    return;
+  endif
+  RegisterForSpeechEvents(sign, 30);
+  var owneracct, who, ev, decaytime;
+  while(sign)
+    owneracct := GetObjProperty(house,&quot;owneracct&quot;);
+    ev := wait_for_event(120);
+    if(ev)
+      who := ev.source;
+      if((who.multi).serial == house.serial)
+        if(who.acctname == owneracct)
+          handle_speech(ev, house, sign, 3);
+        else
+          if(statuscheck(house, who, 1) == 1)
+            handle_speech(ev, house, sign, 2);
+          elseif(statuscheck(house, who, 2) == 1)
+            handle_speech(ev, house, sign, 1);
+          endif
+        endif
+      endif
+    endif
+    decaytime := GetObjProperty(sign,&quot;decay&quot;);
+    if(!decaytime)
+      decaytime := (ReadGameClock() + 864000);
+      SetObjProperty(sign, &quot;decay&quot;, decaytime);
+    endif
+    if(!GetObjProperty(sign,&quot;nodecay&quot;))
+      var tname;
+      var newname := GetObjProperty(sign,&quot;signname&quot;);
+      if(!newname)
+        newname := &quot;a house&quot;;
+        SetObjProperty(sign, &quot;signname&quot;, newname);
+      endif
+      if (ReadGameClock() &gt; decaytime)
+        demolish(house);
+      elseif((decaytime - ReadGameClock() ) &gt; 861000 )
+        tname := newname + &quot;, [this house is like new]&quot;;
+        SetName(sign, tname);
+      elseif((decaytime - ReadGameClock() ) &gt; 604800 )
+        tname := newname + &quot;, [this house is slightly worn]&quot;;
+        SetName(sign, tname);
+      elseif((decaytime - ReadGameClock() ) &gt; 259200 )
+        tname := newname + &quot;, [this house is fairly worn]&quot;;
+        SetName(sign, tname);
+      elseif((decaytime - ReadGameClock() ) &gt; 86400 )
+        tname := newname + &quot;, [this house is greatly worn]&quot;;
+        SetName(sign, tname);
+      else
+        tname := newname + &quot;, [this house is in danger of collapsing]&quot;;
+        SetName(sign, tname);
+      endif
+    endif
+    cleareventque();
+  endwhile
+endprogram
+
+function cleareventque()
+  var ev;
+  repeat
+  until(!(ev := os::wait_for_event(0)));
+endfunction
+
+function handle_speech(event, house, sign, sec)
+  var text := lower(event.text );
+  if((text[&quot;i wish to lock this down&quot;]) &amp;&amp; (sec &gt;= 2))
+    HouseFunction(house, event, 1 );
+  elseif((text[&quot;i wish to release this&quot;]) &amp;&amp; (sec &gt;= 2))
+    HouseFunction(house, event, 2 );
+  elseif((text[&quot;i wish to secure this&quot;]) &amp;&amp; (sec &gt;= 2))
+    secure(house, event );
+  elseif((text[&quot;i wish to unsecure this&quot;]) &amp;&amp; (sec &gt;= 2))
+    unsecure(house, event);
+  elseif((text[&quot;remove thyself&quot;]) &amp;&amp; (sec &gt;= 1))
+    remove(house, sign, event);
+  elseif((text[&quot;i ban thee&quot;]) &amp;&amp; (sec &gt;= 1))
+    housebanning(house, event, sign);
+  elseif((text[&quot;i wish to place a trash barrel&quot;]) &amp;&amp; (sec &gt;= 2))
+    trashbarrel(house, event);
+  elseif(text[&quot;reveal thyself&quot;])
+    reveal(house, event);
+  endif
+endfunction
+
+function remove(house, sign, event)
+  var who := event.source;
+  if (who.multi.serial == house.serial)
+    SendSysMessage(who, &quot;Target the person you wish to remove.&quot;);
+    var idiot := Target(who, TGTOPT_NOCHECK_LOS);
+    if (!idiot)
+      SendSysMessage(who, &quot;Cancelled.&quot;);
+      return;
+    elseif (AP_GetVital(idiot, MANA) == error)
+      SendSysMessage(who,&quot;You cannot eject items.&quot;);
+      return;
+    endif
+    if(InHouse(idiot, house))
+      var friend := statuscheck(house, idiot, 2);
+      var coown  := statuscheck(house, idiot, 1);
+      var staff  := who.cmdlevel;
+      if ((coown == 0) &amp;&amp; (friend == 0) &amp;&amp; (idiot.serial != who.serial) &amp;&amp; (staff &lt; 2))
+        MoveCharacterToLocation(idiot, sign.x, sign.y, sign.z, MOVECHAR_FORCELOCATION);
+        SendSysMessage(idiot,&quot;You have been ejected from the house!&quot;);
+        return;
+      elseif((friend == 1) || (coown == 1) || (idiot.acctname == GetObjProperty(house,&quot;owneracct&quot;)))
+        SendSysMessage(who,&quot;You cannot eject friends.&quot;);
+        return;
+      elseif (idiot.serial == who.serial)
+        SendSysMessage(who,&quot;You cannot eject yourself.&quot;);
+        return;
+      else
+        SendSysMessage(who,&quot;You cannot do that!&quot;);
+      endif
+    else
+      SendSysMessage(who,&quot;That person isn't inside the house.&quot;);
+      return;
+    endif
+  else
+    SendSysMessage(who,&quot;You must be in a house to do this.&quot;);
+    return;
+  endif
+endfunction
+
+function trashbarrel(house, event)
+  var who := event.source;
+  var barrelcheck := GetObjProperty(house, &quot;barrelserial&quot;);
+  if(barrelcheck)
+    var exists := 0;
+    foreach thing in (house.items)
+      if(thing.serial == barrelcheck)
+        exists := 1;
+        break;
+      endif
+    endforeach
+    if(exists == 1)
+      SendSysMessage(who, &quot;This house already has a trash barrel.&quot;);
+      return;
+    endif
+  endif
+  var items := ListItemsNearLocation(who.x, who.y, who.z, 1, who.realm);
+  var check := 0;
+  foreach thing in items
+    if(thing.objtype == 0x8889)
+      check := 1;
+    endif
+  endforeach
+  if(check == 0)
+    var barrel := CreateItemAtLocation(who.x, who.y, who.z, 0x7007, 1, who.realm);
+    if(barrel)
+      SetObjProperty(house, &quot;barrelserial&quot;, barrel.serial);
+      SetObjProperty(barrel, &quot;houseserial&quot;, house.serial);
+    endif
+  else
+    SendSysMessage(who, &quot;You cannot place that here.&quot;);
+  endif
+endfunction
+
+function HouseFunction(house, event, num)
+  var itemt := Target(event.source, TGTOPT_NOCHECK_LOS);
+  if(!itemt)
+    SendSysMessage(event.source, &quot;Cancelled.&quot;);
+    return;
+  endif
+  var lists := GetObjProperty(house, &quot;footage&quot;);
+  var itemlist := {};
+  var holder;
+  foreach thing in lists
+    holder := ListObjectsInBox(thing[1], thing[2], thing[3], thing[4], thing[5],thing[6], house.realm);
+    foreach thing in holder
+      itemlist.append(thing);
+    endforeach
+  endforeach
+  if(itemt in itemlist)
+    case(num)
+      1: if(GetObjProperty(house, &quot;numlockdowns&quot;) &gt; 0)
+           if(itemt.movable == 1)
+               itemt.movable := 0;
+               SetObjProperty(itemt, &quot;lockeddown&quot;, 1);
+               SetObjProperty(itemt, &quot;houseserial&quot;, house.serial);
+               SetObjProperty(house, &quot;numlockdowns&quot;, GetObjProperty(house, &quot;numlockdowns&quot;) - 1);
+               SendSysMessage(event.source, &quot;Locked Down.&quot;);
+           elseif((itemt.movable == 0) &amp;&amp; (GetObjProperty(itemt,&quot;lockeddown&quot;) ==1))
+             SendSysMessage(event.source, &quot;That item is already locked down!&quot;);
+             return;
+           elseif((itemt.movable == 0) &amp;&amp; (GetObjProperty(itemt,&quot;secure&quot;) ==1))
+             SendSysMessage(event.source, &quot;That item is secure!&quot;);
+             return;
+           else
+             SendSysMessage(event.source, &quot;You cannot lock that down!&quot;);
+             return;
+           endif
+         else
+           SendSysMessage(event.source, &quot;The house has no more lockdowns remaining.&quot;);
+         endif
+      2: if(GetObjProperty(itemt, &quot;lockeddown&quot;) &amp;&amp; (itemt.movable == 0))
+           if(GetObjProperty(itemt,&quot;secure&quot;) ==1)
+             EraseObjProperty(itemt,&quot;secure&quot;);
+             var oldscript := GetObjProperty(itemt,&quot;oldscript&quot;);
+             if(oldscript == error)
+               oldscript := &quot;&quot;;
+             endif
+             itemt.usescript := oldscript;
+             SetObjProperty(house, &quot;numsecure&quot;, GetObjProperty(house, &quot;numsecure&quot;) + 1);
+             EraseObjProperty(itemt, &quot;oldscript&quot;);
+             EraseObjProperty(itemt, &quot;boxserial&quot;);
+           endif
+           EraseObjProperty(itemt, &quot;houseserial&quot;);
+           itemt.movable := 1;
+           EraseObjProperty(itemt, &quot;lockeddown&quot;);
+           SetObjProperty(house, &quot;numlockdowns&quot;, GetObjProperty(house, &quot;numlockdowns&quot;) + 1);
+           SendSysMessage(event.source, &quot;Released.&quot;);
+           return;
+         elseif ((itemt.movable == 0) &amp;&amp;(GetObjProperty(itemt,&quot;secure&quot;) ==1))
+           EraseObjProperty(itemt,&quot;secure&quot;);
+           var oldscript := GetObjProperty(itemt,&quot;oldscript&quot;);
+           if (oldscript == error)
+             oldscript := &quot;&quot;;
+           endif
+           itemt.usescript := oldscript;
+           SetObjProperty(house, &quot;numsecure&quot;, GetObjProperty(house, &quot;numsecure&quot;) + 1);
+           EraseObjProperty(itemt, &quot;houseserial&quot;);
+           EraseObjProperty(itemt, &quot;oldscript&quot;);
+           itemt.movable := 1;
+           SendSysMessage(event.source, &quot;Released.&quot;);
+           return;
+         elseif (itemt.movable == 1)
+           SendSysMessage(event.source, &quot;That is not locked down.&quot;);
+           return;
+         else
+           SendSysMessage(event.source, &quot;You cannot release that.&quot;);
+           return;
+         endif
+    endcase
+  else
+    SendSysMessage(event.source, &quot;That is not inside your house.&quot;);
+  endif
+endfunction
+
+function secure(house, event)
+  var itemt := Target(event.source);
+  if(!itemt)
+    SendSysMessage(event.source, &quot;Cancelled.&quot;);
+    return;
+  endif
+  if(GetObjProperty(house, &quot;numsecure&quot;))
+    var lists := GetObjProperty(house, &quot;footage&quot;);
+    var itemlist := {};
+    var holder;
+    foreach thing in lists
+      holder := ListObjectsInBox(thing[1], thing[2], thing[3], thing[4], thing[5],thing[6], house.realm);
+      foreach thing in holder
+        itemlist.append(thing);
+      endforeach
+    endforeach
+    if(itemt in itemlist)
+      if(itemt.movable == 0)
+        if(GetObjProperty(itemt,&quot;lockeddown&quot;) ==1)
+          SendSysMessage(event.source, &quot;Securing this container. Your house will be credited with one lockdown.&quot;);
+          SetObjProperty(house, &quot;numlockdowns&quot;, GetObjProperty(house, &quot;numlockdowns&quot;) + 1);
+          EraseObjProperty(itemt,&quot;lockeddown&quot;);
+        else
+          SendSysMessage(event.source, &quot;You cannot secure that.&quot;);
+          return;
+        endif
+      endif
+      itemt.movable := 0;
+      SetObjProperty(itemt, &quot;boxserial&quot;, itemt.serial);
+      SetObjProperty(itemt, &quot;houseserial&quot;, house.serial);
+      SetObjProperty(itemt, &quot;secure&quot;, 1);
+      SetObjProperty(itemt,&quot;oldscript&quot;, itemt.script);
+      itemt.usescript := &quot;:housing:secureCont&quot;;
+      SetObjProperty(house, &quot;numsecure&quot;, GetObjProperty(house, &quot;numsecure&quot;) - 1);
+      SendSysMessage(event.source, &quot;Container is secure.&quot;);
+    else
+      SendSysMessage(event.source, &quot;That item is not inside your house.&quot;);
+    endif
+  else
+    SendSysMessage(event.source, &quot;The house has no more secure containers remaining.&quot;);
+  endif
+endfunction
+
+function unsecure(house, event)
+  var itemt := Target(event.source);
+  if(!itemt)
+    SendSysMessage(event.source, &quot;Canceled.&quot;);
+    return;
+  endif
+  if (!GetObjProperty(itemt,&quot;secure&quot;) ==1)
+    SendSysMessage(event.source,&quot;You cannot unsecure that.&quot;);
+    return;
+  endif
+  EraseObjProperty(itemt,&quot;secure&quot;);
+  if(GetObjProperty(itemt, &quot;houseserial&quot;) == house.serial)
+    var lockdowns := GetObjProperty(house, &quot;numlockdowns&quot;);
+    var oldscript := GetObjProperty(itemt,&quot;oldscript&quot;);
+    if(oldscript == error)
+      oldscript := &quot;&quot;;
+    endif
+    itemt.usescript := oldscript;
+    SetObjProperty(house, &quot;numsecure&quot;, GetObjProperty(house, &quot;numsecure&quot;) + 1);
+    EraseObjProperty(itemt, &quot;houseserial&quot;);
+    EraseObjProperty(itemt, &quot;oldscript&quot;);
+    EraseObjProperty(itemt, &quot;boxserial&quot;);
+    if(lockdowns &gt; 0)
+      SetObjProperty(itemt, &quot;lockeddown&quot;, 1);
+      SetObjProperty(house, &quot;numlockdowns&quot;, lockdowns - 1);
+      SendSysMessage(event.source, &quot;The container is locked down and your house has been credited one secure container.&quot;);
+    else
+      itemt.movable := 1;
+      SendSysMessage(event.source, &quot;The container is no longer locked down and your house has been credited one secure container.&quot;);
+    endif
+  else
+    SendSysMessage(event.source, &quot;That is not in your house.&quot;);
+  endif
+endfunction
+
+function housebanning(house, event, sign)
+  var who := event.source;
+  var banlist := GetObjProperty(house, &quot;banlist&quot;);
+  if(!banlist)
+    banlist := {};
+  endif
+  if(len(banlist) &gt;= 20)
+    SendSysMessage(event.source, &quot;The ban list is full.&quot;);
+    return;
+  endif
+  SendSysMessage(event.source,&quot;Select character.&quot;);
+  var idiot := Target(event.source);
+  if(!idiot)
+    SendSysMessage(who, &quot;Cancelled.&quot;);
+    return;
+  endif
+  if(!(idiot.isA(POLCLASS_NPC) || idiot.acctname))
+    SendSysMessage(who, &quot;That cannot be added to the list.&quot;);
+    return;
+  endif
+  if((InHouse(idiot, house)) or (idiot.multi == house))
+    var friend := statuscheck(house, idiot, 2);
+    var coown  := statuscheck(house, idiot, 1);
+    var banned := statuscheck(house, idiot, 3);
+    var staff  := idiot.cmdlevel;
+    var act    := idiot.acctname;
+    var own    := GetObjProperty(house, &quot;owneracct&quot;);
+    if((coown == 0) &amp;&amp; (banned == 0) &amp;&amp; (friend == 0) &amp;&amp; ( act != own) &amp;&amp; (idiot.serial != who.serial) &amp;&amp; (staff &lt; 2))
+      SendSysMessage(idiot, &quot;You have been ejected from the house!&quot;);
+      MoveCharacterToLocation(idiot, sign.x, sign.y, sign.z);
+      banlist.append(idiot.serial);
+      SetObjProperty(house, &quot;banlist&quot;, banlist);
+      SendSysMessage(event.source, idiot.name + &quot; was banned from your house.&quot;);
+      return;
+    elseif((friend == 1) || (coown == 1) || (act == own))
+      SendSysMessage(who,&quot;You cannot ban friends.&quot;);
+      return;
+    elseif(banned == 1)
+      SendSysMessage(who,&quot;That person is already banned.&quot;);
+      MoveCharacterToLocation(idiot, sign.x, sign.y, sign.z, MOVECHAR_FORCELOCATION);
+      return;
+    else
+      SendSysMessage(who,&quot;You cannot do that!&quot;);
+      return;
+    endif
+  else
+    SendSysMessage(event.source, &quot;That cannot be added to the list.&quot;);
+    return;
+  endif
+endfunction
+
+function InHouse(who, house)
+  var lists := GetObjProperty(house, &quot;footage&quot;);
+  var holder := 0;
+  foreach thing in lists
+    foreach thing in ListObjectsInBox(thing[1], thing[2], thing[3], thing[4], thing[5],thing[6], house.realm)
+      if(thing == who)
+        holder := 1;
+        break;
+      endif
+    endforeach
+    if(holder == 1)
+      break;
+    endif
+  endforeach
+  return holder;
+endfunction
+
+function demolish(house)
+  // Find the bantiles and ladders to make sure they get destroyed
+  var bantiles := GetObjProperty(house, &quot;bantiles&quot;);
+  var thetile;
+  foreach entry in bantiles
+    thetile := SystemFindObjectBySerial(entry);
+    destroyitem(thetile);
+  endforeach
+  var lists := GetObjProperty(house, &quot;footage&quot;);
+  var itemlist := {};
+  foreach entry in lists
+    foreach thing in ListObjectsInBox(entry[1], entry[2], entry[3], entry[4], entry[5],entry[6], house.realm)
+      itemlist.append(thing);
+    endforeach
+  endforeach
+  var builtdeed := GetObjProperty(house, &quot;builtdeed&quot;);
+  if(builtdeed)
+    if(!DestroyItem(SystemFindObjectBySerial(builtdeed)))
+      DestroyItem(SystemFindObjectBySerial(builtdeed, 1));
+    endif
+  endif
+  foreach thing in itemlist
+    if(GetObjProperty(thing, &quot;houseserial&quot;) == house.serial)
+      if ((GetObjProperty(thing, &quot;secure&quot;) == 1) &amp;&amp; (thing.movable == 0))
+        EraseObjProperty(thing, &quot;secure&quot;);
+        if(GetObjProperty(thing, &quot;houseserial&quot; ) == house.serial)
+          var oldscript := GetObjProperty(thing, &quot;oldscript&quot;);
+          if (oldscript == error)
+            oldscript := &quot;&quot;;
+          endif
+          thing.usescript := oldscript;
+          thing.movable := 1;
+          EraseObjProperty(thing, &quot;houseserial&quot; );
+          EraseObjProperty(thing, &quot;oldscript&quot; );
+        endif
+      elseif ((GetObjProperty(thing, &quot;lockeddown&quot; ) == 1) &amp;&amp; (thing.movable == 0))
+        thing.movable := 1;
+        EraseObjProperty(thing, &quot;houseserial&quot;);
+        EraseObjProperty(thing, &quot;lockeddown&quot;);
+      elseif (thing.movable == 0)
+        if(thing.objtype == 0xa390)
+           MoveItemToLocation(thing, thing.x, thing.y, (thing.z - 7), MOVEITEM_FORCELOCATION);
+        else
+          DestroyItem(thing);
+        endif
+      endif
+    endif
+  endforeach
+  DestroyMulti(house );
+  return;
+endfunction
+
+function statuscheck(house, who, type)
+  var nfo := {};
+  case(type)
+    1: nfo := GetObjProperty(house, &quot;coownlist&quot;);
+    2: nfo := GetObjProperty(house, &quot;friendlist&quot;);
+    3: nfo := GetObjProperty(house, &quot;banlist&quot;);
+  endcase
+  if(who.serial in nfo)
+    return 1;
+  else
+    return 0;
+  endif
+endfunction
+
+function reveal(house, event)
+  var lists := GetObjProperty(house, &quot;footage&quot;);
+  var holder := 0;
+  foreach thing in lists
+    foreach thing in ListObjectsInBox(thing[1], thing[2], thing[3], thing[4], thing[5],thing[6], house.realm)
+      if((AP_GetStat(thing, STRENGTH)) and (thing.hidden))
+        thing.hidden := 0;
+        holder := holder + 1;
+      endif
+    endforeach
+  endforeach
+  if(!holder)
+    SendSysMessage(event.source, &quot;You didn't find anyone.&quot;);
+  elseif(holder == 1)
+    PrintTextAbovePrivate(event.source, &quot;You have found one person hiding!&quot;, event.source);
+  else
+    PrintTextAbovePrivate(event.source, &quot;You have found &quot; + holder + &quot; people hiding!&quot;, event.source);
+  endif
+endfunction
\ No newline at end of file


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000989.html">[Poldistro-svn] r1016 - trunk/096/pkg/items/hair/hairdye
</A></li>
	<LI>Next message: <A HREF="000991.html">[Poldistro-svn] r1018 - trunk/096/pkg/commands
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#990">[ date ]</a>
              <a href="thread.html#990">[ thread ]</a>
              <a href="subject.html#990">[ subject ]</a>
              <a href="author.html#990">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/poldistro-svn">More information about the Poldistro-svn
mailing list</a><br>
</body></html>
