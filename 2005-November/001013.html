<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Poldistro-svn] r1040 - in trunk/096/pkg/commands: config gm include props
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/poldistro-svn/2005-November/index.html" >
   <LINK REL="made" HREF="mailto:poldistro-svn%40lists.berlios.de?Subject=Re%3A%20%5BPoldistro-svn%5D%20r1040%20-%20in%20trunk/096/pkg/commands%3A%20config%20gm%20include%20props&In-Reply-To=%3C200511212100.jALL0SuR017661%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001012.html">
   <LINK REL="Next"  HREF="001014.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Poldistro-svn] r1040 - in trunk/096/pkg/commands: config gm include props</H1>
    <B>austin at BerliOS</B> 
    <A HREF="mailto:poldistro-svn%40lists.berlios.de?Subject=Re%3A%20%5BPoldistro-svn%5D%20r1040%20-%20in%20trunk/096/pkg/commands%3A%20config%20gm%20include%20props&In-Reply-To=%3C200511212100.jALL0SuR017661%40sheep.berlios.de%3E"
       TITLE="[Poldistro-svn] r1040 - in trunk/096/pkg/commands: config gm include props">austin at berlios.de
       </A><BR>
    <I>Mon Nov 21 22:00:28 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001012.html">[Poldistro-svn] r1039 - trunk/096/scripts/include
</A></li>
        <LI>Next message: <A HREF="001014.html">[Poldistro-svn] r1041 - in trunk/096/pkg: commands/gm systems/combat/include
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1013">[ date ]</a>
              <a href="thread.html#1013">[ thread ]</a>
              <a href="subject.html#1013">[ subject ]</a>
              <a href="author.html#1013">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: austin
Date: 2005-11-21 22:00:27 +0100 (Mon, 21 Nov 2005)
New Revision: 1040

Added:
   trunk/096/pkg/commands/config/cmdhelp.cfg
   trunk/096/pkg/commands/include/cmdhelp.inc
Removed:
   trunk/096/pkg/commands/gm/setprop.src
Modified:
   trunk/096/pkg/commands/config/flip.cfg
   trunk/096/pkg/commands/props/setprop.src
Log:
Removed duplicate .setprop command
Fixed elem errors in flip.cfg
Added an example cmdhelp.cfg for textcommand help.
Added cmdhelp.inc which will be used for getting help text for text commands. (No more .src, .ecl and .txt for every command)

Added: trunk/096/pkg/commands/config/cmdhelp.cfg
===================================================================
--- trunk/096/pkg/commands/config/cmdhelp.cfg	2005-11-21 00:19:37 UTC (rev 1039)
+++ trunk/096/pkg/commands/config/cmdhelp.cfg	2005-11-21 21:00:27 UTC (rev 1040)
@@ -0,0 +1,39 @@
+#
+# Help path
+# {
+# 	Text	Line Of Text to display
+#	Text	additional line of text to display
+# }
+#
+
+
+Help pkg/commands/props/setprop.ecl
+{
+	Text	.SetProp &lt;property name&gt; &lt;property value&gt;
+	Text	NULL for value will set it to &quot;&quot; or 0
+}
+
+Help pkg/commands/seer/go.ecl
+{
+	Text	&lt;b&gt;.go [text]&lt;/b&gt;
+
+	Text	&lt;u&gt;Flags&lt;/u&gt;
+	Text	text - Optional. Location name of a go location will take you directly to this location. If no location exists by this name, it brings up the gump of locations.
+
+	Text	&lt;u&gt;Reserved Location Names&lt;/u&gt;
+	Text	xyz	- Used in .go xyz &lt;x&gt; &lt;y&gt; &lt;z&gt; to go to specific coordinates given.
+	Text	refresh	- Used to refresh your gumps. Gumps are stored once generated. Usually only used when altering the script.
+	
+	Text	&lt;u&gt;Purpose&lt;/u&gt;
+	Text	The command .go is part of a staff travel system. It has a public menu, and a private menu. The private menu is only viewable by the person it belongs to. With the Menu, you can select to Goto the location, or Send someone, depending on which button you click on.
+
+	Text	You can Add, Copy, Edit, and Delete entries from the Public and Private Menus.
+
+	Text	To Add a new entry, go to the menu you wish to add it to (public or private) and click on the Add button.
+
+	Text	To Edit an existing entry, go to the menu that has the entry, and click Edit. This will let you edit the information for this entry (including name).
+
+	Text	To Delete an existing entry, select Delete from the Edit screen.
+
+	Text	To Copy an existing entry from one menu to another (from public to private, or vice versa), go to the appropriate menu that has the entry, and click Copy. Then select the entry you wish to Copy.
+}

Modified: trunk/096/pkg/commands/config/flip.cfg
===================================================================
--- trunk/096/pkg/commands/config/flip.cfg	2005-11-21 00:19:37 UTC (rev 1039)
+++ trunk/096/pkg/commands/config/flip.cfg	2005-11-21 21:00:27 UTC (rev 1040)
@@ -557,7 +557,7 @@
 FLIP 2890
 {
 	ChangeTo 2891
-{
+}
 
 FLIP 2891
 {
@@ -1016,7 +1016,7 @@
 FLIP 3057
 {
 	ChangeTo 3058
-{
+}
 
 FLIP 3058
 {
@@ -4239,7 +4239,7 @@
 FLIP 6787
 {
 	ChangeTo 6792
-{
+}
 
 FLIP 6792
 {

Deleted: trunk/096/pkg/commands/gm/setprop.src
===================================================================
--- trunk/096/pkg/commands/gm/setprop.src	2005-11-21 00:19:37 UTC (rev 1039)
+++ trunk/096/pkg/commands/gm/setprop.src	2005-11-21 21:00:27 UTC (rev 1040)
@@ -1,120 +0,0 @@
-/* $Id$
- *
- */
-use uo;
-
-
-program SetProperties(who, text)
-	var param := SplitWords(text);
-	if ( param.size() &lt; 2 )
-		SendSysMessage(who, &quot;SYNTAX: .setprop &lt;property name&gt; &lt;value&gt;&quot;);
-		return;
-	endif
-
-	var targ := target(who);
-	if ( !targ )
-		SendSysMessage(who, &quot;Cancelled&quot;);
-		return;
-	endif
-
-	var property := Lower(param[1]);
-	var pos := Find(text, param[2], Len(param[1])+1);
-	var value := text[pos, Len(text)];
-
-	// Useful for clearing something like 'mobile.guild_title'.
-	if ( value == &quot;NULL&quot; )
-		value := &quot;&quot;;
-	endif
-	var old_val := targ.get_member(property);
-	var old_type := Lower(TypeOf(old_val));
-	case ( old_type )
-		&quot;integer&quot;	: value := CInt(value); break;
-		&quot;string&quot;	: value := CStr(value); break;
-		&quot;double&quot;	: value := CDbl(value); break;
-		default:
-			SendSysMessage(who, &quot;Original data-type '&quot;+old_type+&quot;' not supported. No changes can be made.&quot;);
-			return 0;
-	endcase
-	SendSysMessage(who, &quot;Old Value-&gt;&quot;+old_val);
-
-	ProcessInput(who, targ,property, value);
-
-	SendSysMessage(who, &quot;New Value-&gt;&quot;+targ.get_member(property));
-endprogram
-
-
-function ProcessInput(who, targ, byref property, byref value)
-	//Works on items and mobiles, so do this first.
-	if ( property in array{&quot;x&quot;, &quot;y&quot;, &quot;z&quot;, &quot;realm&quot;} )
-		DoMovement(targ,property, value);
-		return 1;
-	elseif ( MobileProperties(who, targ,property, value) )
-		// Special mobile methods/functions were used.
-		return 1;
-	else
-		// Nothing special was needed to be done, just an ordinary member to change.
-		targ.set_member(property, value);
-		return 1;
-	endif
-endfunction
-
-
-function MobileProperties(who, targ, byref property, byref value)
-	if ( !targ.IsA(POLCLASS_MOBILE) )
-		return error;
-	endif
-	
-	case ( property )
-		&quot;concealed&quot;:
-			if ( value &gt; who.cmdlevel )
-				SendSysMessage(who, &quot;You can not conceal something higher than your cmdlevel.&quot;);
-				return 1;
-			else
-				targ.concealed := value; return 1;
-			endif
-		&quot;cmdlevel&quot;:
-			if ( value &gt; who.cmdlevel )
-				SendSysMessage(who, &quot;You can not set a command level higher than your own.&quot;);
-				return 1;
-			else
-				targ.cmdlevel := value; return 1;
-			endif
-		&quot;criminal&quot;:
-			targ.SetCriminal(value); return 1;
-		&quot;murderer&quot;:
-			targ.SetMurderer(value); return 1;
-		&quot;poisoned&quot;:
-			targ.SetPoisoned(value); return 1;
-		&quot;squelch&quot;:
-			targ.Squelch(value); return 1;
-		&quot;warmode&quot;:
-			targ.SetWarMode(value); return 1;
-	endcase
-	
-	// Nothing was done here.
-	return 0;
-endfunction
-
-
-function DoMovement(targ, byref property, byref value)
-	var x := targ.x;
-	var y := targ.y;
-	var z := targ.z;
-	var realm := targ.realm;
-
-	if ( property == realm )
-		MoveObjectToRealm(targ, property, x, y, z);
-	else
-		case ( property )
-			&quot;x&quot;: x := value;
-			&quot;y&quot;: y := value;
-			&quot;z&quot;: z := value;
-		endcase
-
-		if ( targ.IsA(POLCLASS_ITEM) )
-			MoveItemToLocation(targ, x, y, z, MOVEITEM_FORCELOCATION);
-		elseif ( targ.IsA(POLCLASS_MOBILE) )
-			MoveCharacterToLocation(targ, x, y, z, MOVECHAR_FORCELOCATION);
-		endif
-	endif
-endfunction

Added: trunk/096/pkg/commands/include/cmdhelp.inc
===================================================================
--- trunk/096/pkg/commands/include/cmdhelp.inc	2005-11-21 00:19:37 UTC (rev 1039)
+++ trunk/096/pkg/commands/include/cmdhelp.inc	2005-11-21 21:00:27 UTC (rev 1040)
@@ -0,0 +1,117 @@
+use uo;
+use os;
+use cfgfile;
+
+include &quot;:datafile:datafile&quot;;
+
+/*
+ * GetCmdHelpText(path)
+ *
+ * Purpose
+ * Retrieves the help text for a text command.
+ *
+ * Parameters
+ * path:	Path to the script. 
+ *		If not set, will find the path of the script that calls the function.
+ * 
+ * Return value
+ * Returns a string
+ *
+ */
+function GetCmdHelpText(path:=&quot;&quot;)
+	if ( !path )
+		path := GetProcess(GetPid()).name;
+	endif
+	
+	// Attempt to find the text from cache first
+	var help_text := GetCmdHelpTextFromCache(path);
+	if ( help_text )
+		return help_text;
+	endif
+	
+	// Get all config/cmdhelp.cfg files and search them.
+	var cfg := ReadConfigFile(&quot;:*:config/cmdhelp&quot;);
+	if ( !cfg )
+		return cfg;
+	endif
+	var cfg_elem := cfg[path];
+	if ( !cfg )
+		return cfg_elem;
+	endif
+	
+	// Get the &quot;Text&quot; lines from the elem.
+	help_text := &quot;&quot;;
+	foreach entry in ( GetConfigStringArray(cfg_elem, &quot;Text&quot;) )
+		help_text := help_text + entry;
+		sleepms(2);
+	endforeach
+	// Cache the text for faster retrieval next time.
+	SetCmdHelpTextCache(path, help_text);
+	
+	return help_text;
+endfunction
+
+/*
+ * GetCmdHelpTextFromCache(path)
+ *
+ * Purpose
+ * Retrieves the cached help text for a text command.
+ *
+ * Parameters
+ * path:	Path to the script. 
+ *		If not set, will find the path of the script that calls the function.
+ * 
+ * Return value
+ * Returns a string
+ *
+ */
+function GetCmdHelpTextFromCache(path:=&quot;&quot;)
+	if ( !path )
+		path := GetProcess(GetPid()).name;
+	endif
+	
+	var data_file := DFOpenDataFile(&quot;:commands:helptext&quot;, DF_CREATE);
+	var data_elem := DFFindElement(data_file, path, DF_NO_CREATE);
+	return data_elem.GetProp(&quot;HelpText&quot;);
+endfunction
+
+/*
+ * SetCmdHelpTextCache(path)
+ *
+ * Purpose
+ * Saves the help text for a text command.
+ *
+ * Parameters
+ * path:	Path to the script. 
+ * text:	Text to cache.
+ * 
+ * Return value
+ * 1 on success
+ * error on failure
+ *
+ */
+function SetCmdHelpTextCache(path, text)
+	var data_file := DFOpenDataFile(&quot;:commands:helptext&quot;, DF_CREATE);
+	var data_elem := DFFindElement(data_file, path, DF_NO_CREATE);
+	
+	return data_elem.SetProp(&quot;HelpText&quot;, text);
+endfunction
+
+/*
+ * RemoveCmdHelpTextCache(path)
+ *
+ * Purpose
+ * Removes the cached help text for a text command.
+ *
+ * Parameters
+ * path:	Path to the script. 
+ * 
+ * Return value
+ * Returns a string
+ *
+ */
+function RemoveCmdHelpTextCache(path)
+	var data_file := DFOpenDataFile(&quot;:commands:helptext&quot;, DF_CREATE);
+	return data_file.DeleteElement(path);
+endfunction
+	
\ No newline at end of file

Modified: trunk/096/pkg/commands/props/setprop.src
===================================================================
--- trunk/096/pkg/commands/props/setprop.src	2005-11-21 00:19:37 UTC (rev 1039)
+++ trunk/096/pkg/commands/props/setprop.src	2005-11-21 21:00:27 UTC (rev 1040)
@@ -1,10 +1,14 @@
-/* $Id: setprop.src 385 2005-10-02 18:31:15Z panosl $
+/* $Id$
  *
  */
 use uo;
+use os;
 
-
 program SetProperties(who, text)
+	
+	var ref := GetProcess(GetPid());
+	SendSysMessage(who, &quot;-&gt;&quot;+ref.name);
+	
 	var param := SplitWords(text);
 	if ( param.size() &lt; 2 )
 		SendSysMessage(who, &quot;SYNTAX: .setprop &lt;property name&gt; &lt;value&gt;&quot;);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001012.html">[Poldistro-svn] r1039 - trunk/096/scripts/include
</A></li>
	<LI>Next message: <A HREF="001014.html">[Poldistro-svn] r1041 - in trunk/096/pkg: commands/gm systems/combat/include
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1013">[ date ]</a>
              <a href="thread.html#1013">[ thread ]</a>
              <a href="subject.html#1013">[ subject ]</a>
              <a href="author.html#1013">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/poldistro-svn">More information about the Poldistro-svn
mailing list</a><br>
</body></html>
