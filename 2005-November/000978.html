<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Poldistro-svn] r1005 - in trunk/096/pkg: commands/coun items/bountyboard items/bountyboard/config items/containers items/guildstone/config items/hair items/hair/config items/hair/cuthair items/hair/hairdye items/keys items/keys/config items/keys/include items/keys/key items/keys/keyring items/moongates/config items/moongates/systemMoonGate items/mounts/config mobiles/brainAI/bundled/banker mobiles/newCharacter mobiles/newCharacter/config mobiles/newCharacter/include skills/lumberjacking skills/magery/config skills/magery/recallRune skills/magery/spellScripts/circle4 skills/magery/spellScripts/circle7 systems/combat/config utils/saver/config utils/scheduler utils/scheduler/config
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/poldistro-svn/2005-November/index.html" >
   <LINK REL="made" HREF="mailto:poldistro-svn%40lists.berlios.de?Subject=Re%3A%20%5BPoldistro-svn%5D%20r1005%20-%20in%20trunk/096/pkg%3A%20commands/coun%20items/bountyboard%20items/bountyboard/config%20items/containers%20items/guildstone/config%20items/hair%20items/hair/config%20items/hair/cuthair%20items/hair/hairdye%20items/keys%20items/keys/config%20items/keys/include%20items/keys/key%20items/keys/keyring%20items/moongates/config%20items/moongates/systemMoonGate%20items/mounts/config%20mobiles/brainAI/bundled/banker%20mobiles/newCharacter%20mobiles/newCharacter/config%20mobiles/newCharacter/include%20skills/lumberjacking%20skills/magery/config%20skills/magery/recallRune%20skills/magery/spellScripts/circle4%20skills/magery/spellScripts/circle7%20systems/combat/config%20utils/saver/config%20utils/scheduler%20utils/scheduler/config&In-Reply-To=%3C200511150920.jAF9KLIc009504%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000977.html">
   <LINK REL="Next"  HREF="000979.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Poldistro-svn] r1005 - in trunk/096/pkg: commands/coun items/bountyboard items/bountyboard/config items/containers items/guildstone/config items/hair items/hair/config items/hair/cuthair items/hair/hairdye items/keys items/keys/config items/keys/include items/keys/key items/keys/keyring items/moongates/config items/moongates/systemMoonGate items/mounts/config mobiles/brainAI/bundled/banker mobiles/newCharacter mobiles/newCharacter/config mobiles/newCharacter/include skills/lumberjacking skills/magery/config skills/magery/recallRune skills/magery/spellScripts/circle4 skills/magery/spellScripts/circle7 systems/combat/config utils/saver/config utils/scheduler utils/scheduler/config</H1>
    <B>Scott E. Royalty at BerliOS</B> 
    <A HREF="mailto:poldistro-svn%40lists.berlios.de?Subject=Re%3A%20%5BPoldistro-svn%5D%20r1005%20-%20in%20trunk/096/pkg%3A%20commands/coun%20items/bountyboard%20items/bountyboard/config%20items/containers%20items/guildstone/config%20items/hair%20items/hair/config%20items/hair/cuthair%20items/hair/hairdye%20items/keys%20items/keys/config%20items/keys/include%20items/keys/key%20items/keys/keyring%20items/moongates/config%20items/moongates/systemMoonGate%20items/mounts/config%20mobiles/brainAI/bundled/banker%20mobiles/newCharacter%20mobiles/newCharacter/config%20mobiles/newCharacter/include%20skills/lumberjacking%20skills/magery/config%20skills/magery/recallRune%20skills/magery/spellScripts/circle4%20skills/magery/spellScripts/circle7%20systems/combat/config%20utils/saver/config%20utils/scheduler%20utils/scheduler/config&In-Reply-To=%3C200511150920.jAF9KLIc009504%40sheep.berlios.de%3E"
       TITLE="[Poldistro-svn] r1005 - in trunk/096/pkg: commands/coun items/bountyboard items/bountyboard/config items/containers items/guildstone/config items/hair items/hair/config items/hair/cuthair items/hair/hairdye items/keys items/keys/config items/keys/include items/keys/key items/keys/keyring items/moongates/config items/moongates/systemMoonGate items/mounts/config mobiles/brainAI/bundled/banker mobiles/newCharacter mobiles/newCharacter/config mobiles/newCharacter/include skills/lumberjacking skills/magery/config skills/magery/recallRune skills/magery/spellScripts/circle4 skills/magery/spellScripts/circle7 systems/combat/config utils/saver/config utils/scheduler utils/scheduler/config">muaddiblsd at berlios.de
       </A><BR>
    <I>Tue Nov 15 10:20:21 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000977.html">[Poldistro-svn] r1004 - in trunk/096/pkg: items/moongates skills/magery
</A></li>
        <LI>Next message: <A HREF="000979.html">[Poldistro-svn] r1006 - in trunk/096/pkg: items/runebook skills/magery skills/magery/config skills/magery/include skills/magery/spellScripts/circle4 skills/magery/spellScripts/circle6 skills/magery/spellScripts/circle7
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#978">[ date ]</a>
              <a href="thread.html#978">[ thread ]</a>
              <a href="subject.html#978">[ subject ]</a>
              <a href="author.html#978">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: muaddiblsd
Date: 2005-11-15 10:20:06 +0100 (Tue, 15 Nov 2005)
New Revision: 1005

Added:
   trunk/096/pkg/skills/magery/spellScripts/circle4/recall.src
   trunk/096/pkg/skills/magery/spellScripts/circle7/gate.src
Modified:
   trunk/096/pkg/commands/coun/reveal.txt
   trunk/096/pkg/items/bountyboard/config/autoLoad.cfg
   trunk/096/pkg/items/bountyboard/itemdesc.cfg
   trunk/096/pkg/items/containers/onDelete.src
   trunk/096/pkg/items/guildstone/config/autoLoad.cfg
   trunk/096/pkg/items/hair/config/hairColors.cfg
   trunk/096/pkg/items/hair/config/icp.cfg
   trunk/096/pkg/items/hair/cuthair/control.src
   trunk/096/pkg/items/hair/hairdye/use.src
   trunk/096/pkg/items/hair/itemdesc.cfg
   trunk/096/pkg/items/hair/pkg.cfg
   trunk/096/pkg/items/keys/config/icp.cfg
   trunk/096/pkg/items/keys/include/key.inc
   trunk/096/pkg/items/keys/itemdesc.cfg
   trunk/096/pkg/items/keys/key/methods.src
   trunk/096/pkg/items/keys/key/use.src
   trunk/096/pkg/items/keys/keyring/canInsert.src
   trunk/096/pkg/items/keys/keyring/onRemove.src
   trunk/096/pkg/items/keys/keyring/use.src
   trunk/096/pkg/items/keys/pkg.cfg
   trunk/096/pkg/items/moongates/config/autoload.cfg
   trunk/096/pkg/items/moongates/systemMoonGate/moongateInit.src
   trunk/096/pkg/items/moongates/systemMoonGate/walkOn.src
   trunk/096/pkg/items/mounts/config/icp.cfg
   trunk/096/pkg/mobiles/brainAI/bundled/banker/combat.src
   trunk/096/pkg/mobiles/brainAI/bundled/banker/init.src
   trunk/096/pkg/mobiles/brainAI/bundled/banker/listen.src
   trunk/096/pkg/mobiles/newCharacter/config/icp.cfg
   trunk/096/pkg/mobiles/newCharacter/config/startEquip.cfg
   trunk/096/pkg/mobiles/newCharacter/include/newCharacter.inc
   trunk/096/pkg/mobiles/newCharacter/onCreate.src
   trunk/096/pkg/mobiles/newCharacter/onDelete.src
   trunk/096/pkg/mobiles/newCharacter/pkg.cfg
   trunk/096/pkg/skills/lumberjacking/itemdesc.cfg
   trunk/096/pkg/skills/magery/config/runeColor.cfg
   trunk/096/pkg/skills/magery/recallRune/methods.src
   trunk/096/pkg/skills/magery/recallRune/use.src
   trunk/096/pkg/systems/combat/config/icp.cfg
   trunk/096/pkg/utils/saver/config/autoLoad.cfg
   trunk/096/pkg/utils/saver/config/icp.cfg
   trunk/096/pkg/utils/scheduler/config/icp.cfg
   trunk/096/pkg/utils/scheduler/start.src
Log:



Property changes on: trunk/096/pkg/commands/coun/reveal.txt
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/bountyboard/config/autoLoad.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/bountyboard/itemdesc.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/containers/onDelete.src
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/guildstone/config/autoLoad.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/hair/config/hairColors.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/hair/config/icp.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/hair/cuthair/control.src
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/hair/hairdye/use.src
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/hair/itemdesc.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/hair/pkg.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/keys/config/icp.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/keys/include/key.inc
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/keys/itemdesc.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/keys/key/methods.src
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/keys/key/use.src
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/keys/keyring/canInsert.src
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/keys/keyring/onRemove.src
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/keys/keyring/use.src
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/keys/pkg.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/moongates/config/autoload.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/moongates/systemMoonGate/moongateInit.src
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/moongates/systemMoonGate/walkOn.src
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/items/mounts/config/icp.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/mobiles/brainAI/bundled/banker/combat.src
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/mobiles/brainAI/bundled/banker/init.src
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/mobiles/brainAI/bundled/banker/listen.src
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/mobiles/newCharacter/config/icp.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/mobiles/newCharacter/config/startEquip.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/mobiles/newCharacter/include/newCharacter.inc
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/mobiles/newCharacter/onCreate.src
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/mobiles/newCharacter/onDelete.src
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/mobiles/newCharacter/pkg.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/skills/lumberjacking/itemdesc.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/skills/magery/config/runeColor.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/skills/magery/recallRune/methods.src
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/skills/magery/recallRune/use.src
___________________________________________________________________
Name: svn:keywords
   + Id

Added: trunk/096/pkg/skills/magery/spellScripts/circle4/recall.src
===================================================================
--- trunk/096/pkg/skills/magery/spellScripts/circle4/recall.src	2005-11-15 09:06:39 UTC (rev 1004)
+++ trunk/096/pkg/skills/magery/spellScripts/circle4/recall.src	2005-11-15 09:20:06 UTC (rev 1005)
@@ -0,0 +1,220 @@
+/* $Id$
+ *
+ */
+use uo;
+use os;
+
+include &quot;:attributes:attributes&quot;;
+include &quot;:magery:spells&quot;;
+include &quot;:itemutils:objtype&quot;;
+include &quot;:coords:isValidLoc&quot;;
+include &quot;:runebook:runebookFunctions&quot;;
+
+program SpellScript(params)
+	var who := params[1];
+	var runebook_info := params[4];
+	//var info := params[2];
+	params := 0; // No longer needed
+
+	if( TypeOf(runebook_info) == &quot;Array&quot; )
+		RunebookRecall(who, runebook_info);
+		return 1;
+	endif
+
+	var prompt := &quot;Select an object to recall from.&quot;;
+	var recall_rune := MS_Target(who, 0, prompt, TGTOPT_CHECK_LOS+TGTOPT_NEUTRAL);
+	if( (recall_rune.objtype != UOBJ_RUNE) &amp;&amp; (recall_rune.objtype != 0x6100))
+		SendSysMessage(who, &quot;You can only cast that on a recall rune or runebook.&quot;);
+		return 0;
+	endif
+	if( !ReserveItem(recall_rune) )
+		return 0;
+	endif
+
+	if( GetObjProperty(recall_rune, &quot;Vendored&quot;) )
+		SendSysMessage(who, &quot;You cannot recall off of runes on a vendor.&quot;);
+		return 0;
+	endif
+	var tox := CInt(GetObjProperty( recall_rune, &quot;x&quot; ));
+	var toy := CInt(GetObjProperty( recall_rune, &quot;y&quot; ));
+	var toz := CInt(GetObjProperty( recall_rune, &quot;z&quot; ));
+	var torealm :=  GetObjProperty( recall_rune, &quot;realm&quot; );
+	if(!tox)
+		SendSysMessage(who, &quot;That item is not marked.&quot;);
+		return 0;
+	endif
+	if(!torealm)
+		torealm := &quot;britannia&quot;;
+	endif
+
+	if( !isValidLoc(tox,toy,torealm) )
+		SendSysMessage(who, &quot;Invalid recall location.&quot;);
+		if( recall_rune.objtype == 0x6100 )
+			RemoveRunebookDefault(recall_rune);
+			return 0;
+		else
+			DestroyItem(recall_rune);
+			return 0;
+		endif
+	endif
+
+	PlaySoundEffect(who, 0x210);
+
+	if( (who.x &gt;= 5120) &amp;&amp; (who.x &lt;= 5375) &amp;&amp; (who.y &gt;= 0) &amp;&amp; (who.y &lt;= 255) )
+		SendSysMessage(who, &quot;Your spell fails and consumes the rune!&quot;);
+		if(recall_rune.objtype == UOBJ_RUNE)
+			DestroyItem(recall_rune);
+		elseif(recall_rune.objtype == 0x6100)
+			RemoveRunebookDefault(recall_rune);
+		endif
+		return 0;
+	endif
+
+	var signs := ListItemsNearLocationOfType( tox, toy, toz, 30, 0x7060, torealm);
+	foreach sign in signs
+		var infoarr := GetObjProperty(sign, &quot;homeinfo&quot;);
+		if( infoarr )
+			if( (tox &gt;= infoarr[2]) &amp;&amp; (tox &lt;= infoarr[4]) &amp;&amp; (toy &gt;= infoarr[3]) &amp;&amp; (toy &lt;= infoarr[5]) )
+				SendSysMessage(who, &quot;Something is blocking the location.&quot;);
+				return 0;
+				break;
+			endif
+		endif
+	endforeach
+
+	var multicheck := CreateItemAtLocation(1, 1, 0, 0xeed, 1, torealm);
+	multicheck.invisible := 1;
+	if( !MoveItemToLocation(multicheck, tox, toy, toz, MOVEITEM_NORMAL) )
+		SendSysMessage(who, &quot;Something is blocking the location.&quot;);
+		if(recall_rune.objtype == UOBJ_RUNE)
+			DestroyItem(recall_rune);
+		elseif(recall_rune.objtype == 0x6100)
+			RemoveRunebookDefault(recall_rune);
+		endif
+		return 0;
+	endif
+	if(multicheck.multi)
+		SendSysMessage(who,&quot;Something is blocking the location.&quot;);
+		if(recall_rune.objtype == UOBJ_RUNE)
+			DestroyItem(recall_rune);
+		elseif(recall_rune.objtype == 0x6100)
+			RemoveRunebookDefault(recall_rune);
+		endif
+		return 0;
+	endif
+	DestroyItem(multicheck);
+	MoveObjectToLocation( who, tox, toy, toz, torealm );
+	PlaySoundEffect(who, 0x1fd);
+	return 1;
+endprogram
+
+function RemoveRunebookDefault(runebook)
+	var tox := CInt(GetObjProperty( runebook, &quot;x&quot; ));
+	var toy := CInt(GetObjProperty( runebook, &quot;y&quot; ));
+	var toz := CInt(GetObjProperty( runebook, &quot;z&quot; ));
+	var torealm := GetObjProperty( runebook, &quot;realm&quot; );
+	var rune_list := GetRuneList(runebook);
+
+	foreach rune_entry in rune_list
+		if( (Cint(rune_list.X) == tox) &amp;&amp; (Cint(rune_list.Y) == toy) &amp;&amp; (Cint(rune_list.Z) == toz) &amp;&amp; (Cint(rune_list.Realm) == torealm) )
+			rune_list.Erase(rune_entry);
+		endif
+	endforeach
+
+	SetObjProperty(runebook, &quot;%RuneList%&quot;, rune_list);
+	EraseObjProperty(runebook, &quot;x&quot;);
+	EraseObjProperty(runebook, &quot;y&quot;);
+	EraseObjProperty(runebook, &quot;z&quot;);
+	EraseObjProperty(runebook, &quot;realm&quot;);
+	return 1;
+endfunction
+
+
+function RemoveRunebookEntry(runebook, rune_info)
+	var tox := CInt(rune_info.X);
+	var toy := CInt(rune_info.Y);
+	var toz := CInt(rune_info.Z);
+	var torealm :=  rune_info.Realm;
+	var rune_list := GetRuneList(runebook);
+
+	foreach rune_entry in rune_list
+		if( (Cint(rune_list.X) == tox) &amp;&amp; (Cint(rune_list.Y) == toy) &amp;&amp; (Cint(rune_list.Z) == toz) &amp;&amp; (Cint(rune_list.Realm) == torealm) )
+			rune_list.Erase(rune_entry);
+		endif
+	endforeach
+
+	SetObjProperty(runebook, &quot;%RuneList%&quot;, rune_list);
+	EraseObjProperty(runebook, &quot;x&quot;);
+	EraseObjProperty(runebook, &quot;y&quot;);
+	EraseObjProperty(runebook, &quot;z&quot;);
+	EraseObjProperty(runebook, &quot;realm&quot;);
+	return 1;
+endfunction
+
+
+function RunebookRecall(who, runebook_info)
+	var runebook := runebook_info[1];
+	var rune_info := runebook_info[2];
+
+	if( !ReserveItem(runebook) )
+		return 0;
+	endif
+
+	if( GetObjProperty(runebook, &quot;Vendored&quot;) )
+		SendSysMessage(who, &quot;You cannot recall off of runebooks on a vendor.&quot;);
+		return 0;
+	endif
+	var tox := CInt(rune_info.X);
+	var toy := CInt(rune_info.Y);
+	var toz := CInt(rune_info.Z);
+	var torealm :=  rune_info.Realm;
+	if(!tox)
+		SendSysMessage(who, &quot;That is an invalid location.&quot;);
+		return 0;
+	endif
+	if(!torealm)
+		torealm := &quot;britannia&quot;;
+	endif
+
+	if( !isValidLoc(tox,toy,torealm) )
+		SendSysMessage(who, &quot;Invalid recall location.&quot;);
+		RemoveRunebookEntry(runebook, rune_info);
+		return 0;
+	endif
+
+	PlaySoundEffect(who, 0x210);
+
+	if( (who.x &gt;= 5120) &amp;&amp; (who.x &lt;= 5375) &amp;&amp; (who.y &gt;= 0) &amp;&amp; (who.y &lt;= 255) )
+		SendSysMessage(who, &quot;Your spell fails and consumes the rune!&quot;);
+		RemoveRunebookEntry(runebook, rune_info);
+		return 0;
+	endif
+
+	var signs := ListItemsNearLocationOfType( tox, toy, toz, 30, 0x7060, torealm);
+	foreach sign in signs
+		var infoarr := GetObjProperty(sign, &quot;homeinfo&quot;);
+		if( infoarr )
+			if( (tox &gt;= infoarr[2]) &amp;&amp; (tox &lt;= infoarr[4]) &amp;&amp; (toy &gt;= infoarr[3]) &amp;&amp; (toy &lt;= infoarr[5]) )
+				SendSysMessage(who, &quot;Something is blocking the location.&quot;);
+				return 0;
+				break;
+			endif
+		endif
+	endforeach
+
+	var multicheck := CreateItemAtLocation(1, 1, 0, 0xeed, 1, torealm);
+	multicheck.invisible := 1;
+	if( !MoveItemToLocation(multicheck, tox, toy, toz, MOVEITEM_NORMAL) )
+		SendSysMessage(who, &quot;Something is blocking the location.&quot;);
+		return 0;
+	endif
+	if(multicheck.multi)
+		SendSysMessage(who,&quot;A house is blocking the location.&quot;);
+		RemoveRunebookEntry(runebook, rune_info);
+		return 0;
+	endif
+	DestroyItem(multicheck);
+	MoveObjectToLocation( who, tox, toy, toz, torealm );
+	PlaySoundEffect(who, 0x1fd);
+	return 1;
+endfunction
\ No newline at end of file


Property changes on: trunk/096/pkg/skills/magery/spellScripts/circle4/recall.src
___________________________________________________________________
Name: svn:keywords
   + Id

Added: trunk/096/pkg/skills/magery/spellScripts/circle7/gate.src
===================================================================
--- trunk/096/pkg/skills/magery/spellScripts/circle7/gate.src	2005-11-15 09:06:39 UTC (rev 1004)
+++ trunk/096/pkg/skills/magery/spellScripts/circle7/gate.src	2005-11-15 09:20:06 UTC (rev 1005)
@@ -0,0 +1,282 @@
+/* $Id$
+ *
+ */
+use uo;
+use os;
+
+include &quot;:attributes:attributes&quot;;
+include &quot;:magery:spells&quot;;
+include &quot;:itemutils:objtype&quot;;
+include &quot;:coords:isValidLoc&quot;;
+include &quot;:runebook:runebookFunctions&quot;;
+
+program SpellScript(params)
+	var who := params[1];
+	var runebook_info := params[2].targ;
+	//var info := params[2];
+	params := 0; // No longer needed
+
+	if( TypeOf(runebook_info) == &quot;Array&quot; )
+		RunebookGate(who, runebook_info);
+		return 1;
+	endif
+
+	var prompt := &quot;Select an object to gate from.&quot;;
+	var recall_rune := MS_Target(who, 0, prompt, TGTOPT_CHECK_LOS+TGTOPT_NEUTRAL);
+	if( (recall_rune.objtype != UOBJ_RUNE) &amp;&amp; (recall_rune.objtype != 0x6100))
+		SendSysMessage(who, &quot;You can only cast that on a recall rune or runebook.&quot;);
+		return 0;
+	endif
+	if( !ReserveItem(recall_rune) )
+		return 0;
+	endif
+
+	if( GetObjProperty(recall_rune, &quot;Vendored&quot;) )
+		SendSysMessage(who, &quot;You cannot recall off of runes on a vendor.&quot;);
+		return 0;
+	endif
+	var tox := CInt(GetObjProperty( recall_rune, &quot;x&quot; ));
+	var toy := CInt(GetObjProperty( recall_rune, &quot;y&quot; ));
+	var toz := CInt(GetObjProperty( recall_rune, &quot;z&quot; ));
+	var torealm :=  GetObjProperty( recall_rune, &quot;realm&quot; );
+	if(!tox)
+		SendSysMessage(who, &quot;That item is not marked.&quot;);
+		return 0;
+	endif
+	if(!torealm)
+		torealm := &quot;britannia&quot;;
+	endif
+
+	if( !isValidLoc(tox,toy,torealm) )
+		SendSysMessage(who, &quot;Invalid recall location.&quot;);
+		if( recall_rune.objtype == 0x6100 )
+			RemoveRunebookDefault(recall_rune);
+			return 0;
+		else
+			DestroyItem(recall_rune);
+			return 0;
+		endif
+	endif
+
+	PlaySoundEffect(who, 0x210);
+
+	if( (who.x &gt;= 5120) &amp;&amp; (who.x &lt;= 5375) &amp;&amp; (who.y &gt;= 0) &amp;&amp; (who.y &lt;= 255) )
+		SendSysMessage(who, &quot;Your spell fails and consumes the rune!&quot;);
+		if(recall_rune.objtype == UOBJ_RUNE)
+			DestroyItem(recall_rune);
+		elseif(recall_rune.objtype == 0x6100)
+			RemoveRunebookDefault(recall_rune);
+		endif
+		return 0;
+	endif
+
+	var signs := ListItemsNearLocationOfType( tox, toy, toz, 30, 0x7060, torealm);
+	foreach sign in signs
+		var infoarr := GetObjProperty(sign, &quot;homeinfo&quot;);
+		if( infoarr )
+			if( (tox &gt;= infoarr[2]) &amp;&amp; (tox &lt;= infoarr[4]) &amp;&amp; (toy &gt;= infoarr[3]) &amp;&amp; (toy &lt;= infoarr[5]) )
+				SendSysMessage(who, &quot;Something is blocking the location.&quot;);
+				return 0;
+				break;
+			endif
+		endif
+	endforeach
+
+	var multicheck := CreateItemAtLocation(1, 1, 0, 0xeed, 1, torealm);
+	multicheck.invisible := 1;
+	if( !MoveItemToLocation(multicheck, tox, toy, toz, MOVEITEM_NORMAL) )
+		SendSysMessage(who, &quot;Something is blocking the location.&quot;);
+		if(recall_rune.objtype == UOBJ_RUNE)
+			DestroyItem(recall_rune);
+		elseif(recall_rune.objtype == 0x6100)
+			RemoveRunebookDefault(recall_rune);
+		endif
+		return 0;
+	endif
+	if(multicheck.multi)
+		SendSysMessage(who,&quot;Something is blocking the location.&quot;);
+		if(recall_rune.objtype == UOBJ_RUNE)
+			DestroyItem(recall_rune);
+		elseif(recall_rune.objtype == 0x6100)
+			RemoveRunebookDefault(recall_rune);
+		endif
+		return 0;
+	endif
+	DestroyItem(multicheck);
+
+	var wx := who.x;
+	var wy := who.y;
+	var wz := who.z;
+	PlayStationaryEffect( wx, wy, wz, 6899, 1, 30, 0, who.realm );
+	PlayStationaryEffect( tox, toy, toz, 6899, 1, 30, 0, torealm );
+	sleepms(2800);
+	set_critical( 1 );
+	var gate1 := CreateItemAtLocation( wx, wy, wz, UOBJ_BLUE_MOONGATE, 1, who.realm );
+	gate1.movable := 0;
+	var gate2 := CreateItemAtLocation( tox, toy, toz, UOBJ_BLUE_MOONGATE, 1, torealm );
+	gate2.movable := 0;
+	if( !gate1 )
+		DestroyItem(gate2);
+		SendSysMessage(who, &quot;Something is interfering with the spell.&quot;);
+		return 0;
+	endif
+	if( !gate2 )
+		DestroyItem(gate1);
+		SendSysMessage(who, &quot;Something is interfering with the spell.&quot;);
+		return 0;
+	endif
+	set_critical(0);
+	var dest := dictionary{ &quot;x&quot; -&gt; gate2.x, &quot;y&quot; -&gt; gate2.y, &quot;z&quot; -&gt; gate2.z, &quot;realm&quot; -&gt; gate2.realm};
+	SetObjProperty( gate1, &quot;Destination&quot;, dest );
+	dest := dictionary{ &quot;x&quot; -&gt; gate1.x, &quot;y&quot; -&gt; gate1.y, &quot;z&quot; -&gt; gate1.z, &quot;realm&quot; -&gt; gate1.realm};
+	SetObjProperty( gate2, &quot;Destination&quot;, dest );
+	Detach();
+	sleep(30);
+	set_critical(1);
+	DestroyItem( gate1 );
+	DestroyItem( gate2 );
+	set_critical(0);
+	return 1;
+endprogram
+
+function RemoveRunebookDefault(runebook)
+	var tox := CInt(GetObjProperty( runebook, &quot;x&quot; ));
+	var toy := CInt(GetObjProperty( runebook, &quot;y&quot; ));
+	var toz := CInt(GetObjProperty( runebook, &quot;z&quot; ));
+	var torealm := GetObjProperty( runebook, &quot;realm&quot; );
+	var rune_list := GetRuneList(runebook);
+
+	foreach rune_entry in rune_list
+		if( (Cint(rune_list.X) == tox) &amp;&amp; (Cint(rune_list.Y) == toy) &amp;&amp; (Cint(rune_list.Z) == toz) &amp;&amp; (Cint(rune_list.Realm) == torealm) )
+			rune_list.Erase(rune_entry);
+		endif
+	endforeach
+
+	SetObjProperty(runebook, &quot;%RuneList%&quot;, rune_list);
+	EraseObjProperty(runebook, &quot;x&quot;);
+	EraseObjProperty(runebook, &quot;y&quot;);
+	EraseObjProperty(runebook, &quot;z&quot;);
+	EraseObjProperty(runebook, &quot;realm&quot;);
+	return 1;
+endfunction
+
+
+function RemoveRunebookEntry(runebook, rune_info)
+	var tox := CInt(rune_info.X);
+	var toy := CInt(rune_info.Y);
+	var toz := CInt(rune_info.Z);
+	var torealm :=  rune_info.Realm;
+	var rune_list := GetRuneList(runebook);
+
+	foreach rune_entry in rune_list
+		if( (Cint(rune_list.X) == tox) &amp;&amp; (Cint(rune_list.Y) == toy) &amp;&amp; (Cint(rune_list.Z) == toz) &amp;&amp; (Cint(rune_list.Realm) == torealm) )
+			rune_list.Erase(rune_entry);
+		endif
+	endforeach
+
+	SetObjProperty(runebook, &quot;%RuneList%&quot;, rune_list);
+	EraseObjProperty(runebook, &quot;x&quot;);
+	EraseObjProperty(runebook, &quot;y&quot;);
+	EraseObjProperty(runebook, &quot;z&quot;);
+	EraseObjProperty(runebook, &quot;realm&quot;);
+	return 1;
+endfunction
+
+
+function RunebookGate(who, runebook_info)
+	var runebook := runebook_info[1];
+	var rune_info := runebook_info[2];
+
+	if( !ReserveItem(runebook) )
+		return 0;
+	endif
+
+	if( GetObjProperty(runebook, &quot;Vendored&quot;) )
+		SendSysMessage(who, &quot;You cannot recall off of runebooks on a vendor.&quot;);
+		return 0;
+	endif
+	var tox := CInt(rune_info.X);
+	var toy := CInt(rune_info.Y);
+	var toz := CInt(rune_info.Z);
+	var torealm :=  rune_info.Realm;
+	if(!tox)
+		SendSysMessage(who, &quot;That is an invalid location.&quot;);
+		return 0;
+	endif
+	if(!torealm)
+		torealm := &quot;britannia&quot;;
+	endif
+
+	if( !isValidLoc(tox,toy,torealm) )
+		SendSysMessage(who, &quot;Invalid recall location.&quot;);
+		RemoveRunebookEntry(runebook, rune_info);
+		return 0;
+	endif
+
+	PlaySoundEffect(who, 0x210);
+
+	if( (who.x &gt;= 5120) &amp;&amp; (who.x &lt;= 5375) &amp;&amp; (who.y &gt;= 0) &amp;&amp; (who.y &lt;= 255) )
+		SendSysMessage(who, &quot;Your spell fails and consumes the rune!&quot;);
+		RemoveRunebookEntry(runebook, rune_info);
+		return 0;
+	endif
+
+	var signs := ListItemsNearLocationOfType( tox, toy, toz, 30, 0x7060, torealm);
+	foreach sign in signs
+		var infoarr := GetObjProperty(sign, &quot;homeinfo&quot;);
+		if( infoarr )
+			if( (tox &gt;= infoarr[2]) &amp;&amp; (tox &lt;= infoarr[4]) &amp;&amp; (toy &gt;= infoarr[3]) &amp;&amp; (toy &lt;= infoarr[5]) )
+				SendSysMessage(who, &quot;Something is blocking the location.&quot;);
+				return 0;
+				break;
+			endif
+		endif
+	endforeach
+
+	var multicheck := CreateItemAtLocation(1, 1, 0, 0xeed, 1, torealm);
+	multicheck.invisible := 1;
+	if( !MoveItemToLocation(multicheck, tox, toy, toz, MOVEITEM_NORMAL) )
+		SendSysMessage(who, &quot;Something is blocking the location.&quot;);
+		return 0;
+	endif
+	if(multicheck.multi)
+		SendSysMessage(who,&quot;A house is blocking the location.&quot;);
+		RemoveRunebookEntry(runebook, rune_info);
+		return 0;
+	endif
+	DestroyItem(multicheck);
+
+	var wx := who.x;
+	var wy := who.y;
+	var wz := who.z;
+	PlayStationaryEffect( wx, wy, wz, 6899, 1, 30, 0, who.realm );
+	PlayStationaryEffect( tox, toy, toz, 6899, 1, 30, 0, torealm );
+	sleepms(2800);
+	set_critical( 1 );
+	var gate1 := CreateItemAtLocation( wx, wy, wz, UOBJ_BLUE_MOONGATE, 1, who.realm );
+	gate1.movable := 0;
+	var gate2 := CreateItemAtLocation( tox, toy, toz, UOBJ_BLUE_MOONGATE, 1, torealm );
+	gate2.movable := 0;
+	if( !gate1 )
+		DestroyItem(gate2);
+		SendSysMessage(who, &quot;Something is interfering with the spell.&quot;);
+		return 0;
+	endif
+	if( !gate2 )
+		DestroyItem(gate1);
+		SendSysMessage(who, &quot;Something is interfering with the spell.&quot;);
+		return 0;
+	endif
+	set_critical(0);
+	var dest := dictionary{ &quot;x&quot; -&gt; gate2.x, &quot;y&quot; -&gt; gate2.y, &quot;z&quot; -&gt; gate2.z, &quot;realm&quot; -&gt; gate2.realm};
+	SetObjProperty( gate1, &quot;Destination&quot;, dest );
+	dest := dictionary{ &quot;x&quot; -&gt; gate1.x, &quot;y&quot; -&gt; gate1.y, &quot;z&quot; -&gt; gate1.z, &quot;realm&quot; -&gt; gate1.realm};
+	SetObjProperty( gate2, &quot;Destination&quot;, dest );
+	Detach();
+	sleep(30);
+	set_critical(1);
+	DestroyItem( gate1 );
+	DestroyItem( gate2 );
+	set_critical(0);
+	return 1;
+endfunction
\ No newline at end of file


Property changes on: trunk/096/pkg/skills/magery/spellScripts/circle7/gate.src
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/systems/combat/config/icp.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/utils/saver/config/autoLoad.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/utils/saver/config/icp.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/utils/scheduler/config/icp.cfg
___________________________________________________________________
Name: svn:keywords
   + Id


Property changes on: trunk/096/pkg/utils/scheduler/start.src
___________________________________________________________________
Name: svn:keywords
   + Id


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000977.html">[Poldistro-svn] r1004 - in trunk/096/pkg: items/moongates skills/magery
</A></li>
	<LI>Next message: <A HREF="000979.html">[Poldistro-svn] r1006 - in trunk/096/pkg: items/runebook skills/magery skills/magery/config skills/magery/include skills/magery/spellScripts/circle4 skills/magery/spellScripts/circle6 skills/magery/spellScripts/circle7
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#978">[ date ]</a>
              <a href="thread.html#978">[ thread ]</a>
              <a href="subject.html#978">[ subject ]</a>
              <a href="author.html#978">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/poldistro-svn">More information about the Poldistro-svn
mailing list</a><br>
</body></html>
