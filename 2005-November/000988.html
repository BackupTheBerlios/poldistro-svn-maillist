<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Poldistro-svn] r1015 - in trunk/096/pkg/items/hair: . config hairdye
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/poldistro-svn/2005-November/index.html" >
   <LINK REL="made" HREF="mailto:poldistro-svn%40lists.berlios.de?Subject=Re%3A%20%5BPoldistro-svn%5D%20r1015%20-%20in%20trunk/096/pkg/items/hair%3A%20.%20config%20hairdye&In-Reply-To=%3C200511191251.jAJCpHXr021318%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000987.html">
   <LINK REL="Next"  HREF="000989.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Poldistro-svn] r1015 - in trunk/096/pkg/items/hair: . config hairdye</H1>
    <B>austin at BerliOS</B> 
    <A HREF="mailto:poldistro-svn%40lists.berlios.de?Subject=Re%3A%20%5BPoldistro-svn%5D%20r1015%20-%20in%20trunk/096/pkg/items/hair%3A%20.%20config%20hairdye&In-Reply-To=%3C200511191251.jAJCpHXr021318%40sheep.berlios.de%3E"
       TITLE="[Poldistro-svn] r1015 - in trunk/096/pkg/items/hair: . config hairdye">austin at berlios.de
       </A><BR>
    <I>Sat Nov 19 13:51:17 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000987.html">[Poldistro-svn] r1014 - trunk/096/pkg/mobiles/brainAI/bundled/banker
</A></li>
        <LI>Next message: <A HREF="000989.html">[Poldistro-svn] r1016 - trunk/096/pkg/items/hair/hairdye
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#988">[ date ]</a>
              <a href="thread.html#988">[ thread ]</a>
              <a href="subject.html#988">[ subject ]</a>
              <a href="author.html#988">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: austin
Date: 2005-11-19 13:51:14 +0100 (Sat, 19 Nov 2005)
New Revision: 1015

Modified:
   trunk/096/pkg/items/hair/config/hairColors.cfg
   trunk/096/pkg/items/hair/hairdye/use.src
   trunk/096/pkg/items/hair/itemdesc.cfg
Log:
Hair dye works... hooray? 

Modified: trunk/096/pkg/items/hair/config/hairColors.cfg
===================================================================
--- trunk/096/pkg/items/hair/config/hairColors.cfg	2005-11-19 11:41:33 UTC (rev 1014)
+++ trunk/096/pkg/items/hair/config/hairColors.cfg	2005-11-19 12:51:14 UTC (rev 1015)
@@ -16,7 +16,7 @@
 ####################
 
 Elem	Index
-{
+{	// Controls order categories appear in.
 	Category	Auburn
 	Category	Blonde
 	Category	Blue
@@ -29,59 +29,58 @@
 	Category	Purple
 	Category	Red
 }
-	
 
+
 HairColor Grey
 {
-	// 22 shades of grey
 	TitleColor	2305
-	Color	2301
-	Color	2102
-	Color	2302
-	Color	2403
-	Color	2409
-	Color	2103
-	Color	2404
-	Color	2410
+	Color	992
+	Color	2412
 	Color	2411
-	Color	2105
+	Color	2410
+	Color	2409
 	Color	2406
+	Color	2404
+	Color	2403
 	Color	2306
+	Color	2302
+	Color	2301
 	Color	2106
-	Color	2412
-	Color	1107
+	Color	2105
+	Color	2103
+	Color	2102
+	Color	1908
 	Color	1907
-	Color	992
 	Color	1899
-	Color	1908
-	Color	1108
 	Color	1109
+	Color	1108
+	Color	1107
 }
+
 HairColor Chestnut
 {
-	// 16 shades of chestnut
 	TitleColor	1753
-	Color	1743
+	Color	1754
+	Color	1753
 	Color	1752
+	Color	1745
+	Color	1743
+	Color	1736
+	Color	1727
+	Color	1717
+	Color	1708
 	Color	1707
-	Color	1516
-	Color	1130
 	Color	1517
-	Color	1708
-	Color	1717
-	Color	1131
-	Color	1753
+	Color	1516
 	Color	1509
-	Color	1727
-	Color	1736
-	Color	1745
-	Color	1754
-	Color	1125
 	Color	1132
+	Color	1131
+	Color	1130
+	Color	1125
 }
+
 HairColor Golden
 {
-	// 24 shades
 	TitleColor	1514
 	Color	2009
 	Color	2215
@@ -110,7 +109,6 @@
 }
 HairColor Blonde
 {
-	// 17 shades of Blonde
 	TitleColor	1727
 	Color	2007
 	Color	2313
@@ -134,7 +132,6 @@
 }
 HairColor Auburn
 {
-	// 21 Shades of Auburn
 	TitleColor	1860
 	Color	1860
 	Color	1869
@@ -160,7 +157,6 @@
 }
 HairColor LtBrown
 {
-	// 26 shades of light brown
 	TitleColor	1113
 	Color	2107
 	Color	1819
@@ -190,7 +186,6 @@
 }
 HairColor DkBrown
 {
-	// 26 shades of dark brown
 	TitleColor	2111
 	Color	1056
 	Color	1114
@@ -221,7 +216,6 @@
 }
 HairColor Blue
 {
-	// 25 shades of blue
 	TitleColor	1315
 	Color	1319
 	Color	1401
@@ -250,7 +244,6 @@
 }
 HairColor Red
 {
-	// 32 shades of red
 	TitleColor	1207
 	Color	1219
 	Color	1619
@@ -288,7 +281,6 @@
 }
 HairColor Green
 {
-	// 32 shades of green
 	TitleColor	2129
 	Color	2001
 	Color	2002
@@ -325,7 +317,6 @@
 }
 HairColor Purple
 {
-	// 28 shades of purple
 	TitleColor	1243
 	Color	1230
 	Color	1239

Modified: trunk/096/pkg/items/hair/hairdye/use.src
===================================================================
--- trunk/096/pkg/items/hair/hairdye/use.src	2005-11-19 11:41:33 UTC (rev 1014)
+++ trunk/096/pkg/items/hair/hairdye/use.src	2005-11-19 12:51:14 UTC (rev 1015)
@@ -7,45 +7,128 @@
 use os;
 use cfgfile;
 
+include &quot;include/client&quot;;
 include &quot;:gumps:gumps&quot;;
 include &quot;:gumps:gumps_ex&quot;;
-include &quot;include/arrays&quot;;
 
+unload_scripts(&quot;hairdye&quot;);
+
+CONST CANCEL_BTN	:= 0xA00001;
+CONST OKAY_BTN		:= 0xA00002;
+
 program UseDyes(who, dyes)
-	var gump := BuildHairDyeGump();
-	GFSendGump(who, gump);
-	
+	if ( !ReserveItem(dyes) )
+		SendSysMessage(who, &quot;Someone else is already using that.&quot;);
+		return 0;
+	elseif ( !(dyes in EnumerateItemsInContainer(who.backpack)) )
+		SendSysMessage(who, &quot;That must be in your backpack to be used.&quot;);
+		return 0;
+	endif
+
+	var hair := GetEquipmentByLayer(who, LAYER_HAIR);
+	var beard := GetEquipmentByLayer(who, LAYER_BEARD);
+	var color := CInt(hair.color);
+	if ( !color )
+		color := CInt(beard.color);
+	endif
+
+	var gump := BuildHairDyeGump(color);
+	var input := GFSendGump(who, gump);
+
+	if ( input[0] == 0 || input[CANCEL_BTN] )
+		SendSysMessage(who, &quot;Cancelled.&quot;);
+		return 0;
+	endif
+
+	foreach key in ( input.keys )
+		if ( key &gt; 2 )
+			color := key;
+			break;
+		endif
+		sleepms(2);
+	endforeach
+
+	if ( !IsValidHairColor(color) )
+		// Occurs when custom values are inserted into the gump with client cheats.
+		// Remember Raph Koster's rule - &quot;The client is in the hands of the enemy. Never trust it.&quot;
+		SendSysMessage(who, &quot;Error - Color found [&quot;+color+&quot;] is invalid.&quot;);
+		return 0;
+	endif
+
+	hair.color := color;
+	beard.color := color;
+	SubtractAmount(dyes, 1);
+
 	return 1;
 endprogram
 
-//GFResizePic(gump, 0, 0, GFCfgConst(&quot;Defaults&quot;, &quot;BackGround&quot;), 310, 420);
-//GFResizePic(gump, 10, 10, GFCfgConst(&quot;Defaults&quot;, &quot;ForeGround&quot;), 290, 400);
+function BuildHairDyeGump(cur_color := 0)
+	var gump := GFCreateGump();
 
-function BuildHairDyeGump()
-	var gump := GFCreateGump();
-	
-	GFPage(0);
-	GFClosable(gump, 0);
+	GFPage(gump, 0);
+	//GFClosable(gump, 0);
 	GFResizePic(gump, 0, 0, GFCfgConst(&quot;Defaults&quot;, &quot;BackGround&quot;), 400, 450);
 	GFResizePic(gump, 15, 15, GFCfgConst(&quot;Defaults&quot;, &quot;ForeGround&quot;), 120, 420);
 	GFResizePic(gump, 140, 15, GFCfgConst(&quot;Defaults&quot;, &quot;ForeGround&quot;), 245, 380);
-	
+
+	GFAddButton(gump, 190, 405, 2128, 2129, GF_CLOSE_BTN, 1);
+	GFAddButton(gump, 265, 405, 2119, 2120, GF_CLOSE_BTN, 2);
+
 	var color_cfg := ReadConfigFile(&quot;:hair:config/hairColors&quot;);
-	var index_elem := color_cfg[&quot;Index&quot;];
-	var color_list := array{};
-	var color_info := struct;
-	color_info.+
-	
-	
-	GetConfigStringArray(index_elem, &quot;Category&quot;);
-	
+	var index_elem := color_cfg[&quot;Index&quot;]; // Controls order colors appear.
+	var categories := GetConfigStringArray(index_elem, &quot;Category&quot;);
+
+	// Build category buttons on the left first
 	var index_y := 25;
-	foreach category in ( color_list )
-		GFAddButton(gump, 20, index_y+3, 5224, 5224, GF_PAGE_BTN, _color_info_iter);
-		GFTextLine(gump, 50, index_y, color_info.cat_color, color_info.name);
+	foreach category in ( categories )
+		GFAddButton(gump, 20, index_y+3, 5224, 5224, GF_PAGE_BTN, _category_iter);
+		var color_elem := color_cfg[category];
+		GFTextLine(gump, 50, index_y, color_elem.TitleColor, category);
+
 		index_y := index_y + 20;
 		sleepms(2);
 	endforeach
-	
+
+	// Build colors inside each category
+	foreach category in ( categories )
+		GFPage(gump, _category_iter);
+		var color_elem := color_cfg[category];
+
+		var color_x := 150;
+		var color_y := 20;
+		var side := 1;
+		foreach color in ( GetConfigStringArray(color_elem, &quot;Color&quot;) )
+			color := CInt(color);
+			GFRadioButton(gump, color_x, color_y, 210, 211, (color == cur_color), color);
+			GFTextLine(gump, color_x+20, color_y, color-1, category);
+			if ( side == 1 )
+				color_x := 290;
+				side := 0;
+			else
+				color_x := 150;
+				color_y := color_y+20;
+				side := 1;
+			endif
+
+			sleepms(2);
+		endforeach
+		sleepms(2);
+	endforeach
+
 	return gump;
 endfunction
+
+function IsValidHairColor(color_num)
+	var color_cfg := ReadConfigFile(&quot;:hair:config/hairColors&quot;);
+	color_num := CStr(color_num);
+
+	foreach elem_name in ( GetConfigStringKeys(color_cfg) )
+		var cfg_elem := color_cfg[elem_name];
+		if ( color_num in GetConfigStringArray(cfg_elem, &quot;Color&quot;) )
+			return 1;
+		endif
+		sleepms(2);
+	endforeach
+
+	return 0;
+endfunction

Modified: trunk/096/pkg/items/hair/itemdesc.cfg
===================================================================
--- trunk/096/pkg/items/hair/itemdesc.cfg	2005-11-19 11:41:33 UTC (rev 1014)
+++ trunk/096/pkg/items/hair/itemdesc.cfg	2005-11-19 12:51:14 UTC (rev 1015)
@@ -4,7 +4,7 @@
 	Desc		cut hair
 
 	Movable		0
-	
+
 	ControlScript	cuthair/control
 }
 
@@ -12,8 +12,8 @@
 {
 	Name		HairDye
 	Desc		hair dye
-	Graphic		6215	
-	
+	Graphic		3623
+
 	Script		hairdye/use
 }
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000987.html">[Poldistro-svn] r1014 - trunk/096/pkg/mobiles/brainAI/bundled/banker
</A></li>
	<LI>Next message: <A HREF="000989.html">[Poldistro-svn] r1016 - trunk/096/pkg/items/hair/hairdye
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#988">[ date ]</a>
              <a href="thread.html#988">[ thread ]</a>
              <a href="subject.html#988">[ subject ]</a>
              <a href="author.html#988">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/poldistro-svn">More information about the Poldistro-svn
mailing list</a><br>
</body></html>
