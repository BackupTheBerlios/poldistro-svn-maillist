<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Poldistro-svn] r883 - in trunk/096/pkg/skills/magery: . spellScroll
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/poldistro-svn/2005-November/index.html" >
   <LINK REL="made" HREF="mailto:poldistro-svn%40lists.berlios.de?Subject=Re%3A%20%5BPoldistro-svn%5D%20r883%20-%20in%20trunk/096/pkg/skills/magery%3A%20.%20spellScroll&In-Reply-To=%3C200511031530.jA3FUbCO004899%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000856.html">
   <LINK REL="Next"  HREF="000858.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Poldistro-svn] r883 - in trunk/096/pkg/skills/magery: . spellScroll</H1>
    <B>Austin Heilman at BerliOS</B> 
    <A HREF="mailto:poldistro-svn%40lists.berlios.de?Subject=Re%3A%20%5BPoldistro-svn%5D%20r883%20-%20in%20trunk/096/pkg/skills/magery%3A%20.%20spellScroll&In-Reply-To=%3C200511031530.jA3FUbCO004899%40sheep.berlios.de%3E"
       TITLE="[Poldistro-svn] r883 - in trunk/096/pkg/skills/magery: . spellScroll">austin at berlios.de
       </A><BR>
    <I>Thu Nov  3 16:30:37 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000856.html">[Poldistro-svn] r882 - trunk/096/pkg/items/magic
</A></li>
        <LI>Next message: <A HREF="000858.html">[Poldistro-svn] r884 - trunk/096/pkg/mobiles/brainAI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#857">[ date ]</a>
              <a href="thread.html#857">[ thread ]</a>
              <a href="subject.html#857">[ subject ]</a>
              <a href="author.html#857">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: austin
Date: 2005-11-03 16:30:37 +0100 (Thu, 03 Nov 2005)
New Revision: 883

Added:
   trunk/096/pkg/skills/magery/spellScroll/
   trunk/096/pkg/skills/magery/spellScroll/use.src
Modified:
   trunk/096/pkg/skills/magery/itemdesc.cfg
   trunk/096/pkg/skills/magery/spellStarter.src
Log:
Spell scrolls will work with the spell starter.
Itll consume the scroll rather than reagents.

Modified: trunk/096/pkg/skills/magery/itemdesc.cfg
===================================================================
--- trunk/096/pkg/skills/magery/itemdesc.cfg	2005-11-03 15:29:00 UTC (rev 882)
+++ trunk/096/pkg/skills/magery/itemdesc.cfg	2005-11-03 15:30:37 UTC (rev 883)
@@ -1,3 +1,9 @@
+#
+# $Id$
+#
+#
+
+//--=[ SPELL BOOKS ]=-------------------------
 Spellbook 0xEFA
 {
 	Name			Spellbook
@@ -23,3 +29,835 @@
 	CanRemoveScript		:containers:container/noRemove
 }
 
+//--=[ MAGERY SCROLLS ]=-------------------------
+Item 0x1f2d
+{
+	Name			reactivearmorscroll
+	Desc			Reactive Armor scroll
+	
+	SpellId			7
+	
+	VendorBuysFor		6
+	VendorSellsFor		12
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f2e
+{
+	Name			clumsyscroll
+	Desc			Clumsy scroll
+	
+	SpellId			1
+	
+	VendorBuysFor		6
+	VendorSellsFor		12
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f2f
+{
+	Name			createfoodscroll
+	Desc			Create Food scroll
+	
+	SpellId			2
+	
+	VendorBuysFor		6
+	VendorSellsFor		12
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f30
+{
+	Name			feeblemindscroll
+	Desc			Feeblemind scroll
+	
+	SpellId			3
+	
+	VendorBuysFor		6
+	VendorSellsFor		12
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f31
+{
+	Name			healscroll
+	Desc			Heal scroll
+	
+	SpellId			4
+	
+	VendorBuysFor		6
+	VendorSellsFor		12
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f32
+{
+	Name			magicarrowscroll
+	Desc			Magic Arrow scroll
+	
+	SpellId			5
+	
+	VendorBuysFor		6
+	VendorSellsFor		12
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f33
+{
+	Name			nightsightscroll
+	Desc			Nightsight scroll
+	
+	SpellId			6
+	
+	VendorBuysFor		6
+	VendorSellsFor		12
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f34
+{
+	Name			weakenscroll
+	Desc			Weaken scroll
+	
+	SpellId			8
+	
+	VendorBuysFor		6
+	VendorSellsFor		12
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f35
+{
+	Name			agilityscroll
+	Desc			Agility scroll
+	
+	SpellId			9
+	
+	VendorBuysFor		11
+	VendorSellsFor		22
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f36
+{
+	Name			cunningscroll
+	Desc			Cunning scroll
+	
+	SpellId			10
+	
+	VendorBuysFor		11
+	VendorSellsFor		22
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f37
+{
+	Name			curescroll
+	Desc			Cure scroll
+	
+	SpellId			11
+	
+	VendorBuysFor		11
+	VendorSellsFor		22
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f38
+{
+	Name			harmscroll
+	Desc			Harm scroll
+	
+	SpellId			12
+	
+	VendorBuysFor		11
+	VendorSellsFor		22
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f39
+{
+	Name			magictrapscroll
+	Desc			Magic Trap scroll
+	
+	SpellId			13
+	
+	VendorBuysFor		11
+	VendorSellsFor		22
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f3a
+{
+	Name			magicuntrapscroll
+	Desc			Magic Untrap scroll
+	
+	SpellId			14
+	
+	VendorBuysFor		11
+	VendorSellsFor		22
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f3b
+{
+	Name			protectionscroll
+	Desc			Protection scroll
+	
+	SpellId			15
+	
+	VendorBuysFor		11
+	VendorSellsFor		22
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f3c
+{
+	Name			strengthscroll
+	Desc			Strength scroll
+	
+	SpellId			16
+	
+	VendorBuysFor		11
+	VendorSellsFor		22
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f3d
+{
+	Name			blessscroll
+	Desc			Bless scroll
+	
+	SpellId			17
+	
+	VendorBuysFor		16
+	VendorSellsFor		32
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f3e
+{
+	Name			fireballscroll
+	Desc			Fireball scroll
+	
+	SpellId			18
+	
+	VendorBuysFor		16
+	VendorSellsFor		32
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f3f
+{
+	Name			magiclockscroll
+	Desc			Magic Lock scroll
+	
+	SpellId			19
+	
+	VendorBuysFor		16
+	VendorSellsFor		32
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f40
+{
+	Name			poisonscroll
+	Desc			Poison scroll
+	
+	SpellId			20
+	
+	VendorBuysFor		16
+	VendorSellsFor		32
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f41
+{
+	Name			telekinesisscroll
+	Desc			Telekinesis scroll
+	
+	SpellId			21
+	
+	VendorBuysFor		16
+	VendorSellsFor		32
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f42
+{
+	Name			teleportscroll
+	Desc			Teleport scroll
+	
+	SpellId			22
+	
+	VendorBuysFor		16
+	VendorSellsFor		32
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f43
+{
+	Name			magicunlockscroll
+	Desc			Magic Unlock scroll
+	
+	SpellId			23
+	
+	VendorBuysFor		16
+	VendorSellsFor		32
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f44
+{
+	Name			wallofstonescroll
+	Desc			Wall of Stone scroll
+	
+	SpellId			24
+	
+	VendorBuysFor		16
+	VendorSellsFor		32
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f45
+{
+	Name			archcurescroll
+	Desc			Archcure scroll
+	
+	SpellId			25
+	
+	VendorBuysFor		21
+	VendorSellsFor		42
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f46
+{
+	Name			archprotectionscroll
+	Desc			Archprotection scroll
+	
+	SpellId			26
+	
+	VendorBuysFor		21
+	VendorSellsFor		42
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f47
+{
+	Name			cursecroll
+	Desc			Curse scroll
+	
+	SpellId			27
+	
+	VendorBuysFor		21
+	VendorSellsFor		42
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f48
+{
+	Name			firefieldscroll
+	Desc			Firefield scroll
+	
+	SpellId			28
+	
+	VendorBuysFor		21
+	VendorSellsFor		42
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f49
+{
+	Name			greaterhealscroll
+	Desc			Greater Heal scroll
+	
+	SpellId			29
+	
+	VendorBuysFor		21
+	VendorSellsFor		42
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f4a
+{
+	Name			lightningscroll
+	Desc			Lightning scroll
+	
+	SpellId			30
+	
+	VendorBuysFor		21
+	VendorSellsFor		42
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f4b
+{
+	Name			manadrainscroll
+	Desc			Manadrain scroll
+	
+	SpellId			31
+	
+	VendorBuysFor		21
+	VendorSellsFor		42
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f4c
+{
+	Name			recallscroll
+	Desc			Recall scroll
+	
+	SpellId			32
+	
+	VendorBuysFor		21
+	VendorSellsFor		42
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f4d
+{
+	Name			bladespiritscroll
+	Desc			Blade Spirit scroll
+	
+	SpellId			33
+	
+	VendorBuysFor		26
+	VendorSellsFor		52
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f4e
+{
+	Name			dispelfieldscroll
+	Desc			Dispel Field scroll
+	
+	SpellId			34
+	
+	VendorBuysFor		26
+	VendorSellsFor		52
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f4f
+{
+	Name			incognitoscroll
+	Desc			Incognito scroll
+	
+	SpellId			35
+	
+	VendorBuysFor		26
+	VendorSellsFor		52
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f50
+{
+	Name			magicrelfectscroll
+	Desc			Magic Reflect scroll
+	
+	SpellId			36
+	
+	VendorBuysFor		26
+	VendorSellsFor		52
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f51
+{
+	Name			mindblastscroll
+	Desc			Mind Blast scroll
+	
+	SpellId			37
+	
+	VendorBuysFor		26
+	VendorSellsFor		52
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f52
+{
+	Name			paralyzescroll
+	Desc			Paralyze scroll
+	
+	SpellId			38
+	
+	VendorBuysFor		26
+	VendorSellsFor		52
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f53
+{
+	Name			poisonfieldscroll
+	Desc			Poison Field scroll
+	
+	SpellId			39
+	
+	VendorBuysFor		26
+	VendorSellsFor		52
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f54
+{
+	Name			summoncreaturescroll
+	Desc			Summon Creature scroll
+	
+	SpellId			40
+	
+	VendorBuysFor		26
+	VendorSellsFor		52
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f55
+{
+	Name			dispelscroll
+	Desc			Dispel scroll
+	
+	SpellId			41
+	
+	VendorBuysFor		31
+	VendorSellsFor		62
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f56
+{
+	Name			energyboltscroll
+	Desc			Energy Bolt scroll
+	
+	SpellId			42
+	
+	VendorBuysFor		31
+	VendorSellsFor		62
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f57
+{
+	Name			explosionscroll
+	Desc			Explosion scroll
+	
+	SpellId			43
+	
+	VendorBuysFor		31
+	VendorSellsFor		62
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f58
+{
+	Name			invisibilityscroll
+	Desc			Invisibility scroll
+	
+	SpellId			44
+	
+	VendorBuysFor		31
+	VendorSellsFor		62
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f59
+{
+	Name			markscroll
+	Desc			Mark scroll
+	
+	SpellId			45
+	
+	VendorBuysFor		31
+	VendorSellsFor		62
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f5a
+{
+	Name			masscursescroll
+	Desc			Mass Curse scroll
+	
+	SpellId			46
+	
+	VendorBuysFor		31
+	VendorSellsFor		62
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f5b
+{
+	Name			paralyzefieldscroll
+	Desc			Paralyze Field scroll
+	
+	SpellId			47
+	
+	VendorBuysFor		31
+	VendorSellsFor		62
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f5c
+{
+	Name			revealscroll
+	Desc			Reveal scroll
+	
+	SpellId			48
+	
+	VendorBuysFor		31
+	VendorSellsFor		62
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f5d
+{
+	Name			chainlightningscroll
+	Desc			Chain Lightning scroll
+	
+	SpellId			49
+	
+	VendorBuysFor		36
+	VendorSellsFor		72
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f5e
+{
+	Name			energyfieldscroll
+	Desc			Energy Field scroll
+	
+	SpellId			50
+	
+	VendorBuysFor		36
+	VendorSellsFor		72
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f5f
+{
+	Name			flamestrikescroll
+	Desc			Flamestrike scroll
+	
+	SpellId			51
+	
+	VendorBuysFor		36
+	VendorSellsFor		72
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f60
+{
+	Name			gatetravelscroll
+	Desc			Gate Travel scroll
+	
+	SpellId			52
+	
+	VendorBuysFor		36
+	VendorSellsFor		72
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f61
+{
+	Name			manavampirescroll
+	Desc			Mana Vampire scroll
+	
+	SpellId			53
+	
+	VendorBuysFor		36
+	VendorSellsFor		72
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f62
+{
+	Name			massdispelscroll
+	Desc			Mass Dispel scroll
+	
+	SpellId			54
+	
+	VendorBuysFor		36
+	VendorSellsFor		72
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f63
+{
+	Name			meteorswarmscroll
+	Desc			Meteor Swarm scroll
+	
+	SpellId			55
+	
+	VendorBuysFor		36
+	VendorSellsFor		72
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f64
+{
+	Name			polymorphscroll
+	Desc			Polymorph scroll
+	
+	SpellId			56
+	
+	VendorBuysFor		36
+	VendorSellsFor		72
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f65
+{
+	Name			earthquakescroll
+	Desc			Earthquake scroll
+	
+	SpellId			57
+	
+	VendorBuysFor		41
+	VendorSellsFor		82
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f66
+{
+	Name			energyvortexscroll
+	Desc			Energy Vortex scroll
+	
+	SpellId			58
+	
+	VendorBuysFor		41
+	VendorSellsFor		82
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f67
+{
+	Name			resurrectionscroll
+	Desc			Resurrection scroll
+	
+	SpellId			59
+	
+	VendorBuysFor		41
+	VendorSellsFor		82
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f68
+{
+	Name			summonairelemscroll
+	Desc			Summon Air Elemental scroll
+	
+	SpellId			60
+	
+	VendorBuysFor		41
+	VendorSellsFor		82
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f69
+{
+	Name			summondaemonscroll
+	Desc			Summon Daemon scroll
+	
+	SpellId			61
+	
+	VendorBuysFor		41
+	VendorSellsFor		82
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f6a
+{
+	Name			summonearthelemscroll
+	Desc			Summon Earth Elemental scroll
+	
+	SpellId			62
+	
+	VendorBuysFor		41
+	VendorSellsFor		82
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f6b
+{
+	Name			summonfireelemscroll
+	Desc			Summon Fire Elemental scroll
+	
+	SpellId			63
+	
+	VendorBuysFor		41
+	VendorSellsFor		82
+	
+	Script			spellScroll/use
+}
+
+Item 0x1f6c
+{
+	Name			summonwaterelemscroll
+	Desc			Summon Water Elemental scroll
+	
+	SpellId			64
+	
+	VendorBuysFor		41
+	VendorSellsFor		82
+	
+	Script			spellScroll/use
+}
\ No newline at end of file

Added: trunk/096/pkg/skills/magery/spellScroll/use.src
===================================================================
--- trunk/096/pkg/skills/magery/spellScroll/use.src	2005-11-03 15:29:00 UTC (rev 882)
+++ trunk/096/pkg/skills/magery/spellScroll/use.src	2005-11-03 15:30:37 UTC (rev 883)
@@ -0,0 +1,23 @@
+/*
+ * $Id$
+ *
+ */
+
+use uo;
+use os;
+use cfgfile;
+
+program useScroll(who, scroll)
+	var item_cfg := ReadConfigFile(&quot;:*:itemdesc&quot;);
+	item_cfg := item_cfg[scroll.objtype];
+	
+	var spell_id := item_cfg.SpellId;
+	
+	var script := Start_Script(&quot;spellStarter&quot;, {who, spell_id, scroll});
+	if ( script.errortext )
+		SendSysMessage(who, &quot;Error - Could not start spell starter -&gt;&quot;+script.errortext);
+		return 0;
+	endif
+	
+	return 1;
+endprogram

Modified: trunk/096/pkg/skills/magery/spellStarter.src
===================================================================
--- trunk/096/pkg/skills/magery/spellStarter.src	2005-11-03 15:29:00 UTC (rev 882)
+++ trunk/096/pkg/skills/magery/spellStarter.src	2005-11-03 15:30:37 UTC (rev 883)
@@ -16,59 +16,51 @@
 set_script_option(SCRIPTOPT_CAN_ACCESS_OFFLINE_MOBILES, 1);
 
 program SpellStarter(params)
-	var who := params[1];
-	var words_of_power := params[2];
-	var parent_pid := params[3];
+	var who		:= params[1]; // Caster.
+	var spell_id	:= params[2]; // Id # of the spell.
+	var scroll	:= params[3]; // Scroll object being used.
+	var targ	:= params[4]; // NPC target
+	params := 0; // No longer needed
 	
 	Attach(who);
 	
-	//Remove trailing space
-	words_of_power := RemoveSpaces(words_of_power, CLR_LEADING_SPACES+CLR_DOUBLE_SPACES+CLR_TRAILING_SPACES);
-	
-	var spell_info := ReadConfigFile(&quot;configs/spell_info&quot;);
-	spell_info := spell_info[words_of_power];
+	var spell_elem := MS_GetSpellsCfgElem(spell_id);
 
 	// If spell is set to 'TestOnly 1', then it requires GM-cmdlevel or #TestSpell CProp
 	// before it can be used.
 	var can_cast := 1;
-	if ( spell_info.TestOnly &amp;&amp; (!who.cmdlevel) )
+	if ( spell_elem.TestOnly &amp;&amp; (!who.cmdlevel) )
 		// They need #TestSpell to cast it
 		if ( GetObjProperty(who, &quot;#TestSpell&quot;) == error )
 			can_cast := 0;
 		endif
-	elseif ( spell_info.NPCOnly &amp;&amp; !who.npctemplate )
+	elseif ( spell_elem.NPCOnly &amp;&amp; !who.npctemplate )
 		PrintTextAbove(who, &quot;Unable to cast - NPC only spell.&quot;);
 		return 0;
 	endif
 
-	var attribute		:= spell_info.Attribute;
-	var delay		:= spell_info.BaseDelay;
-	var difficulty		:= spell_info.Difficulty;
-	var mana_cost		:= spell_info.ManaCost;
+	var attribute		:= spell_elem.Attribute;
+	var delay		:= spell_elem.BaseDelay;
+	var difficulty		:= spell_elem.Difficulty;
+	var mana_cost		:= spell_elem.ManaCost;
 	if ( !attribute )
 		attribute := &quot;Magery&quot;;
 	endif
 
 	if ( GetObjProperty(who, &quot;#medding&quot;) )
 		SendSysMessage(who, &quot;You can not cast right now.&quot;);
-		return;
+		return 0;
 	else
 		SetObjProperty(who, &quot;#medding&quot;, 1);
 	endif
 
-	if ( !spell_info || !can_cast )
-		SendSysMessage(who, &quot;Your words seem to have no meaning.&quot;);
-		if ( who.npctemplate )
-			PrintTextAbove(who, &quot;Your words seem to have no meaning.&quot;);
-		endif
-		FailSpell(who);
-	elseif ( who.squelched &amp;&amp; !who.npctemplate )
+	if ( who.squelched &amp;&amp; !who.npctemplate )
 		SendSysMessage(who, &quot;Something prevents you from casting.&quot;);
 		FailSpell(who);
 	elseif ( !ConsumeVital(who, MANA, mana_cost) )
 		SendSysMessage(who, &quot;You are too tired to cast.&quot;);
 		FailSpell(who);
-	elseif ( !CheckRegs(who, spell_info) )
+	elseif ( !CheckRegs(who, spell_elem, scroll) )
 		FailSpell(who);
 	elseif ( !EquipmentCheck(who) )
 		FailSpell(who);
@@ -79,16 +71,16 @@
 		var skill_check := SkillCheck(who, attribute, difficulty);
 		if ( skill_check &gt; 0 )
 			var info := struct;
-			info.+script := spell_info.script;
-			info.+attribute := attribute;
-			info.+skill_check := skill_check;
-			info.+spell_words := words_of_power;
-			info.+target := params[4];
-			info.+pid := GetPid();
+			info.+script		:= spell_elem.script;
+			info.+attribute		:= attribute;
+			info.+skill_check	:= skill_check;
+			info.+targ		:= targ;
+			info.+pid		:= GetPid();
+			info.+spellId		:= spell_id;
 
-			var script := start_script(spell_info.script, {who, info});
+			var script := start_script(spell_elem.Script, {who, info});
 			if ( script.errortext )
-				PrintTextAbove(who, &quot;Unable to start [&quot;+spell_info.script+&quot;] -&gt; &quot;+script.errortext);
+				PrintTextAbove(who, &quot;Unable to start [&quot;+spell_elem.script+&quot;] -&gt; &quot;+script.errortext);
 				SendSysMessage(who, script.errortext);
 			endif
 
@@ -102,7 +94,6 @@
 	endif
 
 	EraseObjProperty(who, &quot;#medding&quot;);
-	ReleaseScript(parent_pid);
 endprogram
 
 function CheckDelay(who, attribute, difficulty, base_delay)
@@ -175,15 +166,17 @@
 	return 1;
 endfunction
 
-function CheckRegs(who, byref spell_info)
+function CheckRegs(who, byref spell_elem, scroll)
 	if ( who.npctemplate )
 		// NPCs don't need reagents to cast.
 		return 1;
+	elseif ( scroll )
+		return SubtractAmount(scroll, 1);
 	endif
 	
 	var reg_list := dictionary;
 
-	foreach line in GetConfigStringArray(spell_info, &quot;Reagent&quot;)
+	foreach line in GetConfigStringArray(spell_elem, &quot;Reagent&quot;)
 		line := SplitWords(line);
 		var objtype := GetObjTypeByName(line[1]);
 		var amount := CInt(line[2]);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000856.html">[Poldistro-svn] r882 - trunk/096/pkg/items/magic
</A></li>
	<LI>Next message: <A HREF="000858.html">[Poldistro-svn] r884 - trunk/096/pkg/mobiles/brainAI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#857">[ date ]</a>
              <a href="thread.html#857">[ thread ]</a>
              <a href="subject.html#857">[ subject ]</a>
              <a href="author.html#857">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/poldistro-svn">More information about the Poldistro-svn
mailing list</a><br>
</body></html>
