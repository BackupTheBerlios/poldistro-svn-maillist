<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Poldistro-svn] r1335 - in trunk/096/pkg/OLD/items: . bulletinboard bulletinboard/config decorations decorations/config guildstone guildstone/command guildstone/command/player guildstone/config lighting wands
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/poldistro-svn/2006-May/index.html" >
   <LINK REL="made" HREF="mailto:poldistro-svn%40lists.berlios.de?Subject=Re%3A%20%5BPoldistro-svn%5D%20r1335%20-%20in%20trunk/096/pkg/OLD/items%3A%20.%20bulletinboard%20bulletinboard/config%20decorations%20decorations/config%20guildstone%20guildstone/command%20guildstone/command/player%20guildstone/config%20lighting%20wands&In-Reply-To=%3C200605120614.k4C6EiND004515%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001291.html">
   <LINK REL="Next"  HREF="001302.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Poldistro-svn] r1335 - in trunk/096/pkg/OLD/items: . bulletinboard bulletinboard/config decorations decorations/config guildstone guildstone/command guildstone/command/player guildstone/config lighting wands</H1>
    <B>austin at BerliOS</B> 
    <A HREF="mailto:poldistro-svn%40lists.berlios.de?Subject=Re%3A%20%5BPoldistro-svn%5D%20r1335%20-%20in%20trunk/096/pkg/OLD/items%3A%20.%20bulletinboard%20bulletinboard/config%20decorations%20decorations/config%20guildstone%20guildstone/command%20guildstone/command/player%20guildstone/config%20lighting%20wands&In-Reply-To=%3C200605120614.k4C6EiND004515%40sheep.berlios.de%3E"
       TITLE="[Poldistro-svn] r1335 - in trunk/096/pkg/OLD/items: . bulletinboard bulletinboard/config decorations decorations/config guildstone guildstone/command guildstone/command/player guildstone/config lighting wands">austin at berlios.de
       </A><BR>
    <I>Fri May 12 08:14:44 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="001291.html">[Poldistro-svn] r1334 - trunk/096/pkg/items
</A></li>
        <LI>Next message: <A HREF="001302.html">[Poldistro-svn] r1336 - in trunk/096/pkg/systems/combat: . config weaponHitScripts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1308">[ date ]</a>
              <a href="thread.html#1308">[ thread ]</a>
              <a href="subject.html#1308">[ subject ]</a>
              <a href="author.html#1308">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: austin
Date: 2006-05-12 08:14:35 +0200 (Fri, 12 May 2006)
New Revision: 1335

Added:
   trunk/096/pkg/OLD/items/bulletinboard/
   trunk/096/pkg/OLD/items/bulletinboard/bulletinboard.src
   trunk/096/pkg/OLD/items/bulletinboard/config/
   trunk/096/pkg/OLD/items/bulletinboard/config/icp.cfg
   trunk/096/pkg/OLD/items/bulletinboard/config/itemdesc.cfg
   trunk/096/pkg/OLD/items/bulletinboard/destroyboard.src
   trunk/096/pkg/OLD/items/bulletinboard/itemdesc.cfg
   trunk/096/pkg/OLD/items/bulletinboard/pkg.cfg
   trunk/096/pkg/OLD/items/decorations/
   trunk/096/pkg/OLD/items/decorations/config/
   trunk/096/pkg/OLD/items/decorations/config/icp.cfg
   trunk/096/pkg/OLD/items/decorations/itemdesc.cfg
   trunk/096/pkg/OLD/items/decorations/pkg.cfg
   trunk/096/pkg/OLD/items/guildstone/
   trunk/096/pkg/OLD/items/guildstone/command/
   trunk/096/pkg/OLD/items/guildstone/command/player/
   trunk/096/pkg/OLD/items/guildstone/command/player/c.src
   trunk/096/pkg/OLD/items/guildstone/command/player/gc.src
   trunk/096/pkg/OLD/items/guildstone/config/
   trunk/096/pkg/OLD/items/guildstone/config/autoLoad.cfg
   trunk/096/pkg/OLD/items/guildstone/guildControl.src
   trunk/096/pkg/OLD/items/guildstone/guildData.inc
   trunk/096/pkg/OLD/items/guildstone/guildDeed.src
   trunk/096/pkg/OLD/items/guildstone/guildDestroy.src
   trunk/096/pkg/OLD/items/guildstone/guildManager.src
   trunk/096/pkg/OLD/items/guildstone/guildMethods.src
   trunk/096/pkg/OLD/items/guildstone/guildMove.src
   trunk/096/pkg/OLD/items/guildstone/guildStone.src
   trunk/096/pkg/OLD/items/guildstone/itemdesc.cfg
   trunk/096/pkg/OLD/items/guildstone/pkg.cfg
   trunk/096/pkg/OLD/items/lighting/
   trunk/096/pkg/OLD/items/lighting/change.src
   trunk/096/pkg/OLD/items/lighting/itemdesc.cfg
   trunk/096/pkg/OLD/items/lighting/pkg.cfg
   trunk/096/pkg/OLD/items/wands/
   trunk/096/pkg/OLD/items/wands/getSpellID.inc
   trunk/096/pkg/OLD/items/wands/magicWands.src
   trunk/096/pkg/OLD/items/wands/pkg.cfg
Log:


Added: trunk/096/pkg/OLD/items/bulletinboard/bulletinboard.src
===================================================================
--- trunk/096/pkg/OLD/items/bulletinboard/bulletinboard.src	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/bulletinboard/bulletinboard.src	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,181 @@
+// //$Id: bulletinboard.src 664 2005-10-27 03:36:13Z muaddiblsd $
+
+/////////////////////////////////////////
+// 2.0
+//
+// bulletinboard.src
+// by Austin Heilman
+// <A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">Austin at tsse.net</A>
+//
+// Bulletin board script that stores posts in a
+// datafile.
+//
+// Created: 9/04/2001 11:32PM
+// Updated: 2/13/2003 12:16PM
+//
+// History
+// Feb. 13, 2003 - Austin
+// A lot of code cleanup.
+// Reading posts now uses the new gumps.inc function OldGFHTMLArea()
+//
+// Sep. 04, 2001 - Austin
+// Package is created.
+/////////////////////////////////////////
+
+use uo;
+use os;
+
+include &quot;:datafile:datafile&quot;;
+include &quot;:gumps:include/old/old-gumps&quot;;
+
+const ADD_POST_BTN := 0xE000;
+const DELETE_BTN := 0xE001;
+
+var board_data_file;
+var board_elem;
+
+program BulletinBoard(who, board)
+	var input := 0;
+	repeat
+		board_data_file := DFOpenDataFile(&quot;MessageBoards&quot;, DF_CREATE);
+		board_elem := DFFindElement(board_data_file, hex(board.serial), DF_CREATE);
+
+		OldGFInitGump();
+
+		OldGFButtonPage(40, 195, 0x1B6B, 0x1B6B, 500);
+		OldGFGumpPic(20, 20, 0x87A);
+		OldGFTextMid(260, 57, 0, GF_STDCOLOR, &quot;Message Board&quot;);
+
+		BoardIndex(board);
+
+		var subject := &quot;&quot;, msg_lines := array;
+		NewPost(who, subject, msg_lines);
+
+		input := OldGFSendGump(who);
+		if ( !GetObjProperty(who, &quot;#Online&quot;) )
+			//If the player goes offline, terminate the script.
+			exit;
+		endif
+
+		if ( input[ADD_POST_BTN] )
+			subject := OldGFExtractData(subject.keyid, input);
+
+			//Take the 'lines' from the post and put them into 1 string.
+			var msg_string := &quot;&quot;;
+			foreach line in msg_lines
+				line := OldGFExtractData(line.keyid, input);
+				if ( line )
+					msg_string := msg_string+&quot; &quot;+line;
+				endif
+				sleepms(5);
+			endforeach
+
+			var post_num := CInt(board_elem.GetProp(&quot;NextPost&quot;));
+			var new_num := CInt(board_elem.GetProp(&quot;NextPost&quot;))+1;
+			if (new_num &gt; 50)
+				//Were on post 50, reset the counter.
+				new_num := 1;
+			endif
+			board_elem.SetProp(&quot;NextPost&quot;, new_num);
+						var post_info := struct;
+			post_info.+Name := who.name;
+			post_info.+Subject := Subject;
+			post_info.+Message := msg_string;
+
+			board_elem.SetProp(hex(post_num), post_info);
+		elseif ( input[0] &gt;= DELETE_BTN )
+			var temp := CInt(input[0]-DELETE_BTN);
+			board_elem.EraseProp(hex(temp));
+		endif
+	until (input[0] &lt;= 2);
+	//Right click closes the gump.
+
+endprogram
+
+function BoardIndex(board)
+	board := board;
+	var y_pos := 180;
+	var page_num := 1;
+	var post_page_num := 1000;
+	var counter := 1;
+	var total := 0;
+	var prop_list := board_elem.PropNames();
+	foreach postnum in prop_list
+		if ( postnum != &quot;NextPost&quot; )
+			var name := board_elem.GetProp(postnum).Name;
+			var subject := board_elem.GetProp(postnum).Subject;
+			var message := board_elem.GetProp(postnum).Message;
+
+			OldGFPage(page_num);
+			OldGFButtonPage(135, y_pos+3, 0xFC1, 0xFC1, post_page_num);
+			OldGFTextLine(155, y_pos, GF_STDCOLOR, subject);
+			y_pos := y_pos+20;
+
+			OldGFPage(post_page_num);
+
+			var msg := &quot;&lt;basefont color=#111111&gt;&quot;
+				+&quot;From: &quot;+name+&quot;&lt;br&gt;&quot;
+				+&quot;Subject: &quot;+subject+&quot;&lt;br&gt;&quot;
+				+&quot;Message:&lt;br&gt;&quot;;
+
+			if ( TypeOf(message) == &quot;Array&quot; )
+				foreach line in message
+					msg := msg+line+&quot; &quot;;
+					sleepms(2);
+				endforeach
+			else
+				msg := msg+&quot; &quot;+message;
+			endif
+			OldGFHTMLArea(130, 180, 263, 160, 0, 1, msg);
+
+			post_page_num := post_page_num+1;
+
+			OldGFButtonPage(135, 367, 0x15E3, 0x15E7, page_num);
+			OldGFTextLine(155, 365, GF_STDCOLOR, &quot;Index&quot;);
+
+			OldGFTextLine(350, 364, GF_STDCOLOR, &quot;Delete&quot;);
+			OldGFButtonID(395, 367, 2117, 2118, 1, (CInt(postnum)+DELETE_BTN));
+
+			counter := counter+1;
+			total := total+1;
+
+			if ( counter &gt; 8 &amp;&amp; total &lt; (prop_list.size()-1) )
+				OldGFPage(page_num);
+				//Down arrow
+				OldGFButtonPage(377, 336, 0xFC, 0xFD, page_num+1);
+				page_num := page_num+1;
+				OldGFPage(page_num);
+				//Up arrow
+				OldGFButtonPage(377, 160, 0xFA, 0xFB, page_num-1);
+				y_pos := 180;
+				counter := 1;
+			endif
+		endif
+		sleepms(2);
+	endforeach
+endfunction
+
+function NewPost(who, byref subject, byref msg_lines)
+	OldGFPage(500);
+
+	OldGFTextLine(130, 180, GF_STDCOLOR, &quot;From: &quot; + who.name);
+	OldGFTextLine(130, 200, GF_STDCOLOR, &quot;Subject: &quot;);
+	subject := OldGFTextEntry(193, 200, 105, 20, GF_STDCOLOR, &quot;New Message&quot;);
+
+	OldGFTextLine(130, 230, GF_STDCOLOR, &quot;Message:&quot;);
+
+	var i;
+	var y_pos := 250;
+	//Five message lines.
+	for (i:=0; i &lt; 5; i:=i+1)
+		msg_lines.append(OldGFTextEntry(130, y_pos, 255, 20, GF_STDCOLOR));
+		y_pos := y_pos+20;
+	endfor
+
+	OldGFButtonPage(135, 367, 0x15E3, 0x15E7, 1);
+	OldGFTextLine(155, 365, GF_STDCOLOR, &quot;Index&quot;);
+
+	OldGFTextLine(355, 364, GF_STDCOLOR, &quot;Post&quot;);
+	OldGFButtonID(395, 367, 2117, 2118, 1, ADD_POST_BTN);
+endfunction
+

Added: trunk/096/pkg/OLD/items/bulletinboard/config/icp.cfg
===================================================================
--- trunk/096/pkg/OLD/items/bulletinboard/config/icp.cfg	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/bulletinboard/config/icp.cfg	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,19 @@
+# $Id: icp.cfg 684 2005-10-27 18:48:28Z muaddiblsd $
+#
+#
+ICP Register
+{
+	Name		Bulletin Boards
+	Version		1.0
+	Description	Scripts and item definitions for bulletin boards
+
+	Creator		Austin
+	C_Email		<A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">AustinHeilman at gmail.com</A>
+
+	Maintainer
+	M_Email
+
+	#Script	cmdlevel path
+
+	#TextCmd	cmdlevel path
+}

Added: trunk/096/pkg/OLD/items/bulletinboard/config/itemdesc.cfg
===================================================================
--- trunk/096/pkg/OLD/items/bulletinboard/config/itemdesc.cfg	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/bulletinboard/config/itemdesc.cfg	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,17 @@
+# $Id: itemdesc.cfg 259 2005-09-26 08:25:45Z panosl $
+Item 0x1E5E
+{
+	Name		BulletinBoard
+	
+	Script		bulletinboard
+	DestroyScript	destroyboard
+}
+
+Item 0x1E5F
+{
+	Name		BulletinBoard2
+	
+	Script		bulletinboard
+	DestroyScript	destroyboard
+}
+	
\ No newline at end of file

Added: trunk/096/pkg/OLD/items/bulletinboard/destroyboard.src
===================================================================
--- trunk/096/pkg/OLD/items/bulletinboard/destroyboard.src	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/bulletinboard/destroyboard.src	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,14 @@
+/* $Id: destroyboard.src 259 2005-09-26 08:25:45Z panosl $
+ *
+ */
+use uo;
+
+include &quot;:datafile:datafile&quot;;
+
+
+program DestroyBoard(board)
+	var board_data_file := DFOpenDataFile(&quot;MessageBoards&quot;, DF_NO_CREATE);
+	board_data_file.DeleteElement(Hex(board.serial));
+	
+	return 1;
+endprogram

Added: trunk/096/pkg/OLD/items/bulletinboard/itemdesc.cfg
===================================================================
--- trunk/096/pkg/OLD/items/bulletinboard/itemdesc.cfg	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/bulletinboard/itemdesc.cfg	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,16 @@
+Item 0x1E5E
+{
+	Name		BulletinBoard
+	
+	Script		bulletinboard
+	DestroyScript	destroyboard
+}
+
+Item 0x1E5F
+{
+	Name		BulletinBoard2
+	
+	Script		bulletinboard
+	DestroyScript	destroyboard
+}
+	
\ No newline at end of file

Added: trunk/096/pkg/OLD/items/bulletinboard/pkg.cfg
===================================================================
--- trunk/096/pkg/OLD/items/bulletinboard/pkg.cfg	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/bulletinboard/pkg.cfg	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,14 @@
+# $Id: pkg.cfg 684 2005-10-27 18:48:28Z muaddiblsd $
+#
+#
+Enabled         0
+Name		bulletinboard
+Version         1.0
+
+CoreRequired    92
+
+Creator         Austin Heilman
+Email           <A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">AustinHeilman at gmail.com</A>
+
+Maintainer	Distro Team
+Email		<A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">distro at polserver.com</A>
\ No newline at end of file

Added: trunk/096/pkg/OLD/items/decorations/config/icp.cfg
===================================================================
--- trunk/096/pkg/OLD/items/decorations/config/icp.cfg	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/decorations/config/icp.cfg	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,12 @@
+ICP Register
+{
+        Name            Decorations
+        Version         1.0a
+        Description     Decorations package. Contains items solely for decoration and their scripts if any required.
+
+        Creator         Distro Team
+        C_Email         <A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">distro at polserver.com</A>
+
+        Maintainer      Distro Team
+        M_Email         <A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">distro at polserver.com</A>
+}

Added: trunk/096/pkg/OLD/items/decorations/itemdesc.cfg
===================================================================
--- trunk/096/pkg/OLD/items/decorations/itemdesc.cfg	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/decorations/itemdesc.cfg	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,37 @@
+# $Id: itemdesc.cfg 684 2005-10-27 18:48:28Z muaddiblsd $
+#
+#
+Item 0xE46 # empty jars
+{
+	Name		emptyjars1
+	VendorSellsFor  200
+	VendorBuysFor   75
+}
+
+Item 0xEE4 # W spiderweb
+{
+	Name 		spiderweb1
+	VendorSellsFor  200
+	VendorBuysFor   75
+}
+
+Item 0xEE3 # N spiderweb
+{
+	Name 		spiderweb2
+	VendorSellsFor  200
+	VendorBuysFor   75
+}
+
+Item 0x154D # water barrel
+{
+	Name 		waterbarrel
+	VendorSellsFor  280
+	VendorBuysFor   130
+}
+
+Item 0x1852 # scales2
+{
+	Name 		scales2
+	VendorSellsFor  200
+	VendorBuysFor   75
+}

Added: trunk/096/pkg/OLD/items/decorations/pkg.cfg
===================================================================
--- trunk/096/pkg/OLD/items/decorations/pkg.cfg	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/decorations/pkg.cfg	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,8 @@
+# $Id: pkg.cfg 684 2005-10-27 18:48:28Z muaddiblsd $
+#
+#
+Enabled         0
+Name		decorations
+Maintainer      Distro Team
+Email           <A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">distro at polserver.com</A>
+Version         1.0a

Added: trunk/096/pkg/OLD/items/guildstone/command/player/c.src
===================================================================
--- trunk/096/pkg/OLD/items/guildstone/command/player/c.src	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/guildstone/command/player/c.src	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,118 @@
+// updated November 4, 2000
+// zulu (<A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">zulu at zuluhotel.com</A>)
+
+use uo;
+use os;
+
+var chatlayout :=
+{
+&quot;nomove&quot;,
+&quot;nodispose&quot;,
+&quot;page 0&quot;,
+&quot;resizepic 160 35 5054 320 200&quot;,
+&quot;text 200 45 5 0&quot;,
+&quot;text 200 70 300 1&quot;,
+&quot;text 200 90 300 2&quot;,
+&quot;text 200 110 300 3&quot;,
+
+&quot;text 200 150 300 4&quot;,
+&quot;text 200 170 300 5&quot;,
+&quot;text 220 200 0 6&quot;,
+&quot;button 350 108 4023 4024 1 0 2000&quot;,
+&quot;button 350 168 4023 4024 1 0 3000&quot;,
+&quot;radio 170 70 210 211 0 1&quot;,
+&quot;radio 170 90 210 211 0 2&quot;,
+&quot;radio 170 110 210 211 0 3&quot;,
+&quot;radio 170 150 210 211 0 1&quot;,
+&quot;radio 170 170 210 211 0 2&quot;
+};
+var chatdata :={
+&quot;Select your option and click okay&quot;,
+&quot;Hear own guild&quot;,
+&quot;Hear all guilds&quot;,
+&quot;Hear no guilds&quot;,
+&quot;Talk to own guild&quot;,
+&quot;Talk to all guilds&quot;,
+&quot;use .c &lt;message&gt; to chat&quot;
+};
+
+
+program use_guild_chat(who,text)
+
+var hear,guild_pl:=GetObjProperty(who,&quot;guild_id&quot;);
+if (guild_pl.errortext) return; endif
+
+if (text==&quot;&quot;)
+var choose,box:=SendDialogGump(who,chatlayout,chatdata);
+
+if(box[0]==2000)
+  foreach k in (box.keys)
+    if(k&gt;0 &amp;&amp; k&lt;1000)
+      choose:=k;
+      break;
+    endif
+  endforeach
+SetObjProperty(who,&quot;hearchat&quot;,choose);
+elseif(box[0]==3000)
+  foreach k in (box.keys)
+    if(k&gt;0 &amp;&amp; k&lt;1000)
+      choose:=k;
+      break;
+    endif
+  endforeach
+SetObjProperty(who,&quot;talkchat&quot;,choose);
+else
+return;
+endif
+
+if(!choose) return; endif
+hear:=GetObjProperty(who,&quot;hearchat&quot;);
+SendSysMessage(who,chatdata[hear+1],3,70);
+hear:=GetObjProperty(who,&quot;talkchat&quot;);
+SendSysMessage(who,chatdata[hear+4],3,70);
+return;
+else
+var addon:=&quot;:&quot;,guild:=FindGuild(guild_pl);
+
+if(guild.getprop(&quot;guildabv&quot;)!=&quot;NONE&quot; &amp;&amp; GetObjProperty(who,&quot;abv&quot;)==&quot;0&quot;) addon:=&quot; [&quot;+guild.getprop(&quot;guildabv&quot;)+&quot;]:&quot;; endif
+
+if (GetObjProperty(who,&quot;talkchat&quot;)==1) // talk to own
+msgown(who.name+addon+&quot; &quot;+text,guild_pl);
+else // talk to all
+msgall(who.name+addon+&quot; &quot;+text,guild_pl);
+endif
+endif
+endprogram
+
+function msgown(msg,guild_pl)
+
+var chr,i,plychat:=GetGlobalProperty(&quot;plychat&quot;),csize:=plychat.size();
+
+for (i:=1;i&lt;=csize;i:=i+1)
+chr:=SystemFindObjectBySerial(plychat[i]);
+
+if ((GetObjProperty(chr,&quot;hearchat&quot;)!=3) &amp;&amp; (GetObjProperty(chr,&quot;guild_id&quot;)==guild_pl) &amp;&amp; chr)
+SendSysMessage(chr,msg,3,68);
+endif
+
+endfor
+
+endfunction
+
+function msgall(msg,guild_pl)
+
+var hear,chr,i,plychat:=GetGlobalProperty(&quot;plychat&quot;),csize:=plychat.size();
+
+for (i:=1;i&lt;=csize;i:=i+1)
+chr:=SystemFindObjectBySerial(plychat[i]);
+
+hear:=GetObjProperty(chr,&quot;hearchat&quot;);
+if (hear==1 &amp;&amp; GetObjProperty(chr,&quot;guild_id&quot;)==guild_pl &amp;&amp; chr)
+SendSysMessage(chr,msg,3,68);
+elseif (hear==2 &amp;&amp; chr)
+SendSysMessage(chr,msg,3,44);
+endif
+
+endfor
+
+endfunction
\ No newline at end of file

Added: trunk/096/pkg/OLD/items/guildstone/command/player/gc.src
===================================================================
--- trunk/096/pkg/OLD/items/guildstone/command/player/gc.src	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/guildstone/command/player/gc.src	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,29 @@
+use uo;
+use os;
+
+program gc(who, text)
+  var guildid := GetObjProperty(who, &quot;guild_id&quot;);
+  if(!guildid)
+    return;
+  endif
+	var guild_pid := GetGlobalProperty(CStr(&quot;#Guild&quot; + guildid));
+	if(!guild_pid)
+	  return;
+	endif
+	var guild_proc := GetProcess(guild_pid);
+	if(text == &quot;off&quot;)
+	  SetObjProperty(who,&quot;gc_off&quot;, 1);
+	  SendSysMessage(who, &quot;You will no longer receive messages from other guild members.&quot;, 3, 40);
+	elseif( text == &quot;on&quot; )
+	  EraseObjProperty(who, &quot;gc_off&quot;);
+	  SendSysMessage(who, &quot;You will now receive messages from other guild members.&quot;);
+	else
+	  var evnt      := struct;
+	  evnt.+who     := who;
+	  evnt.+message := text;
+	  evnt.+type    := &quot;gc&quot;;
+	  evnt.+status  := 0;
+	  guild_proc.sendevent(evnt);
+	Endif
+endprogram
+

Added: trunk/096/pkg/OLD/items/guildstone/config/autoLoad.cfg
===================================================================
--- trunk/096/pkg/OLD/items/guildstone/config/autoLoad.cfg	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/guildstone/config/autoLoad.cfg	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,9 @@
+# $Id: autoLoad.cfg 1005 2005-11-15 09:20:06Z muaddiblsd $
+
+Autoload guildManager
+{
+	Script      guildManager
+	Resistent   1
+	Name        guildManager
+	Priority    0
+}

Added: trunk/096/pkg/OLD/items/guildstone/guildControl.src
===================================================================
--- trunk/096/pkg/OLD/items/guildstone/guildControl.src	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/guildstone/guildControl.src	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,204 @@
+use uo;
+use os;
+
+var proc := 0;
+var stonemanager := 0;
+var guildstone;
+
+program guildNode(stone)
+  guildstone := stone;
+  while(!proc)
+    print(&quot;Waiting for Process&quot;);
+    sleep(5);
+    proc := GetProcess(GetGlobalProperty(&quot;#GuildManager&quot;));
+  endwhile
+  var guildid := GetObjProperty(stone, &quot;guild_id&quot;);
+  while(!guildid)
+    sleep(2);
+    guildid := GetObjProperty(stone, &quot;guild_id&quot;);
+  endwhile
+  var pid := GetPid();
+  stonemanager := GetProcess(pid);
+  SetGlobalProperty(CStr(&quot;#Guild&quot; + guildid), pid);
+  while(stone)
+    var ev := wait_for_event(360);
+    if(ev)
+      case(ev.type)
+        &quot;gc&quot;:           stone.GuildChat(ev, FindGuild(guildid));
+        &quot;resign&quot;:       Resign(ev);
+        &quot;declarewar&quot;:   DeclareWar(ev);
+        &quot;declareally&quot;:  DeclareAlly(ev);
+        &quot;removeally&quot;:   RemoveAlly(ev);
+        &quot;removeenemy&quot; : RemoveEnemy(ev);
+      endcase
+    endif
+  endwhile
+endprogram
+
+function RemoveEnemy(ev)
+  var who := ev.who;
+  var guild := ev.guild;
+  var enemy := ev.enemy;
+  SendSysMessage(who, &quot;Your have ended the war.&quot;);
+  guild.removeenemyguild(enemy);
+  enemy.removeenemyguild(guild);
+  guildstone.RemoveEnemyGuild(guild, enemy);
+  var evnt      := struct;
+  evnt.+status  := 1;
+  evnt.+message := &quot;We have ended our war with guild: &quot; + enemy.getprop(&quot;guildname&quot;) + &quot;.&quot;;
+  guildstone.guildchat(evnt, guild);
+  evnt.message := &quot;guild: &quot; + guild.getprop(&quot;guildname&quot;) + &quot; has ended their war with us.&quot;;
+  guildstone.guildchat(evnt, enemy);
+endfunction
+
+function RemoveAlly(ev)
+  var who := ev.who;
+  var guild := ev.guild;
+  var enemy := ev.enemy;
+  SendSysMessage(who, &quot;Your have ended the alliance.&quot;);
+  guild.removeallyguild(enemy);
+  enemy.removeallyguild(guild);
+  guildstone.RemoveAllyGuild(guild, enemy);
+  var evnt      := struct;
+  evnt.+status  := 1;
+  evnt.+message := &quot;We have ended our alliance with guild: &quot; + enemy.getprop(&quot;guildname&quot;) + &quot;.&quot;;
+  guildstone.guildchat(evnt, guild);
+  evnt.message := &quot;guild: &quot; + guild.getprop(&quot;guildname&quot;) + &quot; has ended their alliance with us.&quot;;
+  guildstone.guildchat(evnt, enemy);
+endfunction
+
+function DeclareAlly(ev)
+  var who := ev.who;
+  var guild := ev.guild;
+  var enemy := ev.enemy;
+  var chk := 0;
+  var dc := guild.getprop(&quot;GuildDeclareStatus&quot;);
+  if(!dc)
+    dc := {};
+  endif
+  foreach thing in dc
+    if(enemy.guildid == thing[2] &amp;&amp; (guild.guildid == thing[1]) &amp;&amp; (thing[3] == &quot;RA&quot;))
+      chk := 1;
+      break;
+    endif
+  endforeach
+  if(chk)
+    if(!guildstone.CanWar(guild.getprop(&quot;type&quot;),  enemy.getprop(&quot;type&quot;), who))
+      return;
+    endif
+    SendSysMessage(who, &quot;You have accepted their request for peace.&quot;);
+    guild.addallyguild(enemy);
+    enemy.addallguild(guild);
+    guildstone.RemoveDeclaration(guild, enemy);
+    guildstone.AddAllyGuild(guild, enemy);
+    var evnt      := struct;
+    evnt.+status  := 1;
+    evnt.+message := &quot;We have begun an alliance with guild: &quot; + enemy.getprop(&quot;guildname&quot;) + &quot;.&quot;;
+    guildstone.guildchat(evnt, guild);
+    evnt.message := &quot;guild: &quot; + guild.getprop(&quot;guildname&quot;) + &quot; has begun an alliance with us.&quot;;
+    guildstone.guildchat(evnt, enemy);
+  else
+    chk := 0;
+    foreach gstatus in dc
+      if((guild.guildid == gstatus[2]) &amp;&amp; (enemy.guildid == gstatus[1]) &amp;&amp; (gstatus[3] == &quot;RA&quot;))
+        chk := 1;
+        break;
+      endif
+    endforeach
+    if(chk)
+      SendSysMessage(who, &quot;Your request for peace has been cancelled.&quot;);
+      guildstone.RemoveDeclaration(guild, enemy);
+      var evnt      := struct;
+      evnt.+status  := 1;
+      evnt.+message := &quot;We have cancelled our request for an alliance with guild: &quot; + enemy.getprop(&quot;guildname&quot;) + &quot;.&quot;;
+      guildstone.guildchat(evnt, guild);
+      evnt.message := &quot;guild: &quot; + guild.getprop(&quot;guildname&quot;) + &quot; has cancelled their request for an alliance with us.&quot;;
+      guildstone.guildchat(evnt, enemy);
+    else
+      SendSysMessage(who, &quot;Your request for an alliance has been made.&quot;);
+      guildstone.AddDeclaration(guild, enemy, &quot;RA&quot;);
+      var evnt      := struct;
+      evnt.+status  := 1;
+      evnt.+message := &quot;We have requested to have an alliance with guild: &quot; + enemy.getprop(&quot;guildname&quot;) + &quot;.&quot;;
+      guildstone.guildchat(evnt, guild);
+      evnt.message := &quot;guild: &quot; + guild.getprop(&quot;guildname&quot;) + &quot; has requested to have an alliance with us.&quot;;
+      guildstone.guildchat(evnt, enemy);
+    endif
+  endif
+endfunction
+
+function DeclareWar(ev)
+  var who := ev.who;
+  var guild := ev.guild;
+  var enemy := ev.enemy;
+  var chk := 0;
+  var dc := guild.getprop(&quot;GuildDeclareStatus&quot;);
+  if(!dc)
+    dc := {};
+  endif
+  foreach thing in dc
+    if((enemy.guildid == thing[2]) &amp;&amp; (guild.guildid == thing[1]) &amp;&amp; (thing[3] == &quot;RE&quot;))
+      if(!guildstone.CanWar(guild.getprop(&quot;type&quot;),  enemy.getprop(&quot;type&quot;), who))
+        return;
+      endif
+      SendSysMessage(who, &quot;You have accepted their declaration of war.&quot;);
+      guild.addenemyguild(enemy);
+      enemy.addenemyguild(guild);
+      guildstone.RemoveDeclaration(guild, enemy);
+      guildstone.AddEnemyGuild(guild, enemy);
+      var evnt      := struct;
+      evnt.+status  := 1;
+      evnt.+message := &quot;We have begun a war with guild: &quot; + enemy.getprop(&quot;guildname&quot;) + &quot;.&quot;;
+      guildstone.guildchat(evnt, guild);
+      evnt.message := &quot;guild: &quot; + guild.getprop(&quot;guildname&quot;) + &quot; has begun a war with us.&quot;;
+      guildstone.guildchat(evnt, enemy);
+      chk := 1;
+      break;
+    elseif((enemy.guildid == thing[1]) &amp;&amp; (guild.guildid == thing[2]) &amp;&amp; (thing[3] == &quot;RE&quot;))
+      SendSysMessage(who, &quot;Your request for war has been retired.&quot;);
+      guildstone.RemoveDeclaration(guild, enemy);
+      var evnt      := struct;
+      evnt.+status  := 1;
+      evnt.+message := &quot;We have cancelled our request for war with guild: &quot; + enemy.getprop(&quot;guildname&quot;) + &quot;.&quot;;
+      guildstone.guildchat(evnt, guild);
+      evnt.message := &quot;guild: &quot; + guild.getprop(&quot;guildname&quot;) + &quot; has cancelled their request for war with us.&quot;;
+      guildstone.guildchat(evnt, enemy);
+      chk := 1;
+      break;
+    endif
+  endforeach
+  if(chk)
+    return;
+  else
+    SendSysMessage(who, &quot;Your request for war has been made.&quot;);
+    guildstone.AddDeclaration(guild, enemy, &quot;RE&quot;);
+    var evnt      := struct;
+    evnt.+status  := 1;
+    evnt.+message := &quot;We have requested to have a war with guild: &quot; + enemy.getprop(&quot;guildname&quot;) + &quot;.&quot;;
+    guildstone.guildchat(evnt, guild);
+    evnt.message := &quot;guild: &quot; + guild.getprop(&quot;guildname&quot;) + &quot; has requested to have a war with us.&quot;;
+    guildstone.guildchat(evnt, enemy);
+  endif
+endfunction
+
+function Resign(ev)
+  var who   := ev.source;
+  var gm    := ev.gm;
+  var guild := ev.guild;
+  //var stone := ev.guildstone;	// uncomment if/when required :)
+  if(who == gm)
+    guild.setprop(&quot;gm&quot;, 0);
+  endif
+  guild.removemember(who);
+  EraseObjProperty(who, &quot;guildtitle&quot;);
+  EraseObjProperty(who, &quot;guild_id&quot;);
+  EraseObjProperty(who, &quot;fealty&quot;);
+  who.title_guild := &quot;&quot;;
+  EraseObjProperty(who, &quot;abv&quot;);
+  SendSysMessage(who, &quot;You are no longer a member of &quot; + guild.getprop(&quot;guildname&quot;) + &quot;.&quot;, 3, 70);
+  var members := guild.members;
+  if(len(members) == 0)
+    ev.type := &quot;disband&quot;;
+    proc.sendevent(ev);
+  endif
+endfunction
\ No newline at end of file

Added: trunk/096/pkg/OLD/items/guildstone/guildData.inc
===================================================================
--- trunk/096/pkg/OLD/items/guildstone/guildData.inc	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/guildstone/guildData.inc	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,149 @@
+const MAX_GUILD_NAME_SIZE := 30;
+const MAX_GUILD_ABREV_SIZE := 4;
+const UOBJ_PACKED_GUIDSTONE_GRAPHIC := 0x1869;
+const MAX_GM_TITLE_SIZE := 30;
+const MAX_GUILD_TITLE_SIZE := 20;
+
+var filllayout := {};
+var filldata := {};
+
+var dyelayout := {
+&quot;page 0&quot;,
+&quot;resizepic 30 30 2620 280 200&quot;,
+&quot;button 50 70 2104 2103 1 0 1101&quot;,
+&quot;button 50 90 2104 2103 1 0 1201&quot;,
+&quot;button 50 110 2104 2103 1 0 1301&quot;,
+&quot;button 50 130 2104 2103 1 0 1401&quot;,
+&quot;button 50 150 2104 2103 1 0 1501&quot;,
+&quot;button 50 170 2104 2103 1 0 1601&quot;,
+&quot;button 130 70 2104 2103 1 0 1701&quot;,
+&quot;button 130 90 2104 2103 1 0 1801&quot;,
+&quot;button 130 110 2104 2103 1 0 1001&quot;,
+&quot;button 130 130 2104 2103 1 0 901&quot;,
+&quot;button 130 150 2104 2103 1 0 801&quot;,
+&quot;button 130 170 2104 2103 1 0 701&quot;,
+&quot;button 210 70 2104 2103 1 0 601&quot;,
+&quot;button 210 90 2104 2103 1 0 752&quot;,
+&quot;button 210 110 2104 2103 1 0 852&quot;,
+&quot;button 210 130 2104 2103 1 0 252&quot;,
+&quot;button 210 150 2104 2103 1 0 152&quot;,
+&quot;button 210 170 2104 2103 1 0 2000&quot;,
+&quot;button 130 194 2104 2103 1 0 1&quot;,
+&quot;text 50 42 1000 0&quot;,
+&quot;text 70 65 1121 1&quot;,
+&quot;text 70 85 1221 2&quot;,
+&quot;text 70 105 1321 3&quot;,
+&quot;text 70 125 1421 4&quot;,
+&quot;text 70 145 1521 5&quot;,
+&quot;text 70 165 1621 6&quot;,
+&quot;text 150 65 1721 7&quot;,
+&quot;text 150 85 1821 8&quot;,
+&quot;text 150 105 1021 9&quot;,
+&quot;text 150 125 921 10&quot;,
+&quot;text 150 145 821 11&quot;,
+&quot;text 150 165 721 12&quot;,
+&quot;text 230 65 621 13&quot;,
+&quot;text 230 85 752 14&quot;,
+&quot;text 230 105 852 15&quot;,
+&quot;text 230 125 272 16&quot;,
+&quot;text 230 145 152 17&quot;,
+&quot;text 230 165 2000 18&quot;,
+&quot;button 50 195 2122 2123 1 0 99&quot;,
+&quot;text 150 190 1000 19&quot;
+};
+
+var dyedata := {
+&quot;Select a color range:&quot;,
+&quot;One&quot;,
+&quot;Two&quot;,
+&quot;Three&quot;,
+&quot;Four&quot;,
+&quot;Five&quot;,
+&quot;Six&quot;,
+&quot;Seven&quot;,
+&quot;Eight&quot;,
+&quot;Nine&quot;,
+&quot;Ten&quot;,
+&quot;Eleven&quot;,
+&quot;Twelve&quot;,
+&quot;Thirteen&quot;,
+&quot;Fourteen&quot;,
+&quot;Fifteen&quot;,
+&quot;Sixteen&quot;,
+&quot;Seventeen&quot;,
+&quot;Eighteen&quot;,
+&quot;Remove Color&quot;
+};
+
+var dyelayout2 := {
+&quot;page 0&quot;,
+&quot;gumppic 0 50 2620&quot;,
+&quot;gumppic 20 50 2621&quot;,
+&quot;gumppic 290 50 2622&quot;,
+&quot;gumppic 0 68 2623&quot;,
+&quot;gumppic 22 68 2624&quot;,
+&quot;gumppic 288 68 2625&quot;,
+&quot;gumppic 0 272 2623&quot;,
+&quot;gumppic 22 272 2624&quot;,
+&quot;gumppic 288 272 2625&quot;,
+&quot;gumppic 0 476 2626&quot;,
+&quot;gumppic 20 476 2627&quot;,
+&quot;gumppic 290 476 2628&quot;,
+&quot;text 20 62 1102 0&quot;
+};
+
+var dyedata2 := {
+&quot;Select a color:&quot;,
+&quot;Color1&quot;,
+&quot;Color2&quot;,
+&quot;Color3&quot;,
+&quot;Color4&quot;,
+&quot;Color5&quot;,
+&quot;Color6&quot;,
+&quot;Color7&quot;,
+&quot;Color8&quot;,
+&quot;Color9&quot;,
+&quot;Color10&quot;,
+&quot;Color11&quot;,
+&quot;Color12&quot;,
+&quot;Color13&quot;,
+&quot;Color14&quot;,
+&quot;Color15&quot;,
+&quot;Color16&quot;,
+&quot;Color17&quot;,
+&quot;Color18&quot;,
+&quot;Color19&quot;,
+&quot;Color20&quot;,
+&quot;Color21&quot;,
+&quot;Color22&quot;,
+&quot;Color23&quot;,
+&quot;Color24&quot;,
+&quot;Color25&quot;,
+&quot;Color26&quot;,
+&quot;Color27&quot;,
+&quot;Color28&quot;,
+&quot;Color29&quot;,
+&quot;Color30&quot;,
+&quot;Color31&quot;,
+&quot;Color32&quot;,
+&quot;Color33&quot;,
+&quot;Color34&quot;,
+&quot;Color35&quot;,
+&quot;Color36&quot;,
+&quot;Color37&quot;,
+&quot;Color38&quot;,
+&quot;Color39&quot;,
+&quot;Color40&quot;,
+&quot;Color41&quot;,
+&quot;Color42&quot;,
+&quot;Color43&quot;,
+&quot;Color44&quot;,
+&quot;Color45&quot;,
+&quot;Color46&quot;,
+&quot;Color47&quot;,
+&quot;Color48&quot;,
+&quot;Color49&quot;,
+&quot;Color50&quot;,
+&quot;Color51&quot;,
+&quot;Color52&quot;
+};
\ No newline at end of file

Added: trunk/096/pkg/OLD/items/guildstone/guildDeed.src
===================================================================
--- trunk/096/pkg/OLD/items/guildstone/guildDeed.src	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/guildstone/guildDeed.src	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,123 @@
+use uo;
+use os;
+
+include &quot;:itemutils:canAccess&quot;;
+include &quot;guildData&quot;;
+
+program use_guild_deed(who, deed)
+  EraseObjProperty(who, &quot;IsMeditating&quot;);
+  EraseObjProperty(who, &quot;HealTimer&quot;);
+  if(!can_access(who, deed))
+    return;
+  elseif(!Accessible(who,deed))
+    SendSysMessage(who, &quot;You cannot access that item!&quot;);
+    return;
+  elseif(!ReserveItem(deed))
+    return;
+  elseif(GetObjProperty(who, &quot;guild_id&quot;))
+    SendSysMessage(who, &quot;You are already a member of a Guild.&quot;);
+    return;
+  endif
+  var house := who.multi;
+  var owner := GetObjProperty(house, &quot;owneracct&quot;);
+  var coowners := GetObjProperty(house, &quot;coownlist&quot;);
+  if((owner != who.acctname) and (!(who.serial in coowners)))
+    SendSysMessage(who, &quot;You must be the owner or a co-owner of the house to place a guildstone.&quot;);
+    return;
+  endif
+  var chk := 0;
+  foreach item in ListItemsNearLocation(who.x, who.y, who.z, 1, who.realm)
+    if((item.objtype &gt;= 0x0675) &amp;&amp; (item.objtype &lt;= 0x06f4))
+      if((((item.x == who.x+1) || (item.x == who.x-1)) &amp;&amp; (item.y == who.y)) || (((item.y == who.y+1) || (item.y == who.y-1)) &amp;&amp; (item.x == who.x)))
+        chk := 1;
+        break;
+      endif
+    endif
+  endforeach
+  if(chk == 1)
+    SendSysMessage(who, &quot;This is too close to the door.&quot;);
+    return;
+  endif
+  chk := 0;
+  foreach item in (house.items)
+    if(item.objtype == 0xa390)
+      chk := 1;
+      break;
+    endif
+  endforeach
+  if(chk == 1)
+    SendSysMessage(who, &quot;Only one guildstone can be placed in a house.&quot;);
+    return;
+  else
+    var pos  := GetStandingHeight(who.x, who.y, who.z, who.realm);
+    var item := CreateItemAtLocation(who.x, who.y, pos.z, 0xa390, 1, who.realm);
+    if(item)
+      if(setupguild(who, item) == 0)
+        DestroyItem(item);
+        return;
+      endif
+      DestroyItem(deed);
+      SetObjProperty(item, &quot;houseserial&quot;, house.serial);
+    endif
+  endif
+endprogram
+
+function setupguild(who, stone)
+  var gname := SendTextEntryGump(who, &quot;What is the guild name?&quot;, 0, 1, 30, &quot;Type the name.&quot;);
+  if(gname == error)
+    return 0;
+  endif
+  if(len(gname) &gt; 30)
+    SendSysMessage(who, &quot;Guild name can't have more than 30 characters.&quot;, 3, 34);
+    return 0;
+  endif
+  if(!stone.Character_Validation(gname))
+    SendSysMessage(who, &quot;You are using invalid characters.&quot;, 3, 34);
+    return 0;
+  endif
+  if(!stone.Name_Validation(gname))
+    PrintTextAbovePrivate(stone, &quot;That guild name is already taken.&quot;, who);
+    return 0;
+  endif
+  var aname := SendTextEntryGump(who, &quot;What's the new guild's abbreviation?&quot;, 0, 1, 4, &quot;Type the abrev&quot;);
+  if(!aname)
+    return 0;
+  elseif(len(aname) &gt; 4)
+    SendSysMessage(who, &quot;Abbreviation can't have more than 4 characters.&quot;, 3, 40);
+    return 0;
+  endif
+  if(!stone.Abreviation_Validation(aname))
+    PrintTextAbovePrivate(stone, &quot;That abbreviation is already taken.&quot;, who, 3, 40);
+    return 0;
+  elseif(!stone.Character_Validation(aname))
+    SendSysMessage(who, &quot;You are using invalid characters.&quot;, 3, 40);
+    return 0;
+  else
+    var dupe := {&quot;NONE&quot;};
+    var guild    := CreateGuild();
+    var guild_id := guild.guildid;
+    guild.setprop(&quot;guildname&quot;, gname);
+    guild.setprop(&quot;guildabv&quot;,  aname);
+    guild.setprop(&quot;gm&quot;, who.serial);
+    guild.setprop(&quot;gc&quot;, dupe);
+    guild.setprop(&quot;recruits&quot;, dupe);
+    guild.setprop(&quot;movetime&quot;, ReadGameClock()+ 10);
+    guild.setprop(&quot;nametime&quot;, ReadGameClock()+ 10);
+    guild.setprop(&quot;abrvtime&quot;, ReadGameClock() + 10);
+    stone.name := &quot;Guildstone for &quot; + gname;
+    SetObjProperty(stone, &quot;guild_id&quot;, guild_id);
+    guild.addmember(who);
+    SetObjProperty(who, &quot;guild_id&quot;, guild_id);
+    SetObjProperty(who, &quot;fealty&quot;, who.serial);
+    who.title_guild := &quot;Guild Master, [&quot; + aname + &quot;]&quot;;
+    SetObjProperty(who, &quot;abv&quot;, &quot;1&quot;);
+    SetObjProperty(who, &quot;guildtitle&quot;, &quot;Guild Master&quot;);
+    var ev := struct;
+    ev.+type := &quot;created&quot;;
+    ev.+name := gname;
+    ev.+abbv := aname;
+    var guildmanager := GetProcess(GetGlobalProperty(&quot;#GuildManager&quot;));
+    guildmanager.SendEvent(ev);
+    return 1;
+  endif
+endfunction
\ No newline at end of file

Added: trunk/096/pkg/OLD/items/guildstone/guildDestroy.src
===================================================================
--- trunk/096/pkg/OLD/items/guildstone/guildDestroy.src	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/guildstone/guildDestroy.src	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,7 @@
+use uo;
+use os;
+
+program guildDestroy(stone)
+  stone := stone; // stops ecompile &quot;not used&quot; warning
+  return 1;
+endprogram
\ No newline at end of file

Added: trunk/096/pkg/OLD/items/guildstone/guildManager.src
===================================================================
--- trunk/096/pkg/OLD/items/guildstone/guildManager.src	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/guildstone/guildManager.src	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,87 @@
+use uo;
+use os;
+
+include &quot;include/OLD/eventID&quot;;
+
+var proc := GetProcess(GetPid());
+var guilds;
+var stafflist := 0;
+while(stafflist == 0)
+  print(&quot;Guild Manager: Waiting for Stafflist to initialize&quot;);
+  sleep(2);
+  stafflist := GetProcess(GetGlobalProperty(&quot;#stafflist&quot;));
+endwhile
+print(&quot;GuildManager Loaded&quot;);
+
+program GuildManager()
+  SetGlobalProperty(&quot;#GuildManager&quot;, GetPid());
+  var ev;
+  guilds := ListGuilds();
+  if(!guilds)
+    guilds := {};
+  endif
+  sleep(5);
+  while(1)
+    ev := os::wait_for_event(3600);
+    if(ev)
+      case(ev.type)
+        &quot;orderchaos&quot;: OrderChaos(ev);
+        &quot;disband&quot;:    GuildDisband(ev);
+        &quot;created&quot;:    GuildCreated(ev);
+      endcase
+    endif
+  endwhile
+endprogram
+
+function OrderChaos(ev)
+  ev := ev; // stops ecompile &quot;not used&quot; warning
+  return;
+endfunction
+
+function GuildDisband(ev)
+  var guild  := ev.guild;
+  var gm     := ev.gm;
+  var stone  := ev.gs;
+  var name   := guild.GetProp(&quot;guildname&quot;);
+  var abbv   := guild.GetProp(&quot;guildabv&quot;);
+  var holder := guild.allyguilds;
+  foreach ally in holder
+    stone.RemoveAllyGuild(ally, guild);
+    guild.removeallyguild(ally);
+  endforeach
+  holder := guild.enemyguilds;
+  foreach enemy in holder
+    stone.RemoveAllyGuild(enemy, guild);
+    guild.removeenemyguild(enemy);
+  endforeach
+  stone.PurgeDeclarations(guild);
+  DestroyGuild(guild);
+  guilds := ListGuilds();
+  if(!guilds)
+    guilds := {};
+  endif
+  ev.type := &quot;gmbcast&quot;;
+  ev.+src := &quot;ScriptManager&quot;;
+  ev.+msg := &quot;Guild Manager: guild [&quot; + name + &quot;, [&quot; + abbv + &quot;]]  has been disbanded.&quot;;
+  stafflist.SendEvent(ev);
+  var chk := 0;
+  while(chk == 0)
+    if(DestroyItem(stone))
+      chk := 1;
+    else
+      sleep(10);
+    endif
+  endwhile
+  CreateItemInBackpack(gm, 0xa391, 1);
+endfunction
+
+function GuildCreated(ev)
+  guilds     := ListGuilds();
+  if(!guilds)
+    guilds := {};
+  endif
+  ev.type    := &quot;gmbcast&quot;;
+  ev.+src := &quot;GuildManager&quot;;
+  ev.+msg    := &quot;Guild Manager: guild [&quot; + ev.name + &quot;, [&quot; + ev.abbv + &quot;]]  has been created.&quot;;
+  stafflist.sendevent(ev);
+endfunction
\ No newline at end of file

Added: trunk/096/pkg/OLD/items/guildstone/guildMethods.src
===================================================================
--- trunk/096/pkg/OLD/items/guildstone/guildMethods.src	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/guildstone/guildMethods.src	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,479 @@
+use uo;
+use os;
+use cfgfile;
+use util;
+
+include &quot;:itemutils:canAccess&quot;;
+
+program Install()
+  return 1;
+endprogram
+
+exported function guild_destroy(stone)
+  var guild_id := GetObjProperty(stone,&quot;guild_id&quot;);
+  var guild := FindGuild(guild_id);
+  var gname := guild.getprop(&quot;guildname&quot;);
+  foreach thing in (guild.members)
+    guild.removemember(thing);
+    EraseObjProperty(thing, &quot;guild_id&quot;);
+    EraseObjProperty(thing, &quot;fealty&quot;);
+    EraseObjProperty(thing, &quot;abv&quot;);
+    thing.title_guild := &quot;&quot;;
+    SendSysMessage(thing, &quot;You are no longer a member of &quot; + gname + &quot;.&quot;, 3, 34);
+  endforeach
+  foreach thing in (guild.allyguilds)
+    guild.removeallyguild(thing);
+  endforeach
+  foreach thing in (guild.enemyguilds)
+    guild.removeenemyguild(thing);
+  endforeach
+  DestroyGuild(guild);
+endfunction
+
+exported function FindGM(stone, guild)
+  stone := stone; // stops ecompile &quot;not used&quot; warning
+  var returninfo := {&quot;In Vote&quot;, &quot;0&quot;};
+  var gm := guild.getprop(&quot;gm&quot;);
+  foreach thing in (guild.members)
+    if(thing.serial == gm)
+      returninfo[1] := thing.name;
+      returninfo[2] := thing.serial;
+      returninfo[3] := thing;
+      break;
+    endif
+  endforeach
+  return returninfo;
+endfunction
+
+exported function FindNewGM(stone, guild)
+  stone := stone; // stops ecompile &quot;not used&quot; warning
+  var vote, count, i;
+  var dict := dictionary;
+  foreach thing in (guild.members)
+    vote := GetObjProperty(thing, &quot;fealty&quot;);
+    if(dict.exists(vote))
+      count := dict[vote] + 1;
+      dict[vote] := count;
+    else
+      dict.insert(vote, 1);
+    endif
+  endforeach
+  var winner := 0, votes:=dict.keys(),tie:=0;
+  count :=0;
+  for(i:=1;i&lt;=dict.size();i:=i+1)
+    vote:=dict[votes[i]];
+    if(vote&gt;count)
+      count:=vote;
+      winner:=votes[i];
+      tie:=0;
+    elseif(vote==count)
+      tie:=1;
+    endif
+  endfor
+  if(!tie)
+    guild.setprop(&quot;gm&quot;, winner);
+  endif
+endfunction
+
+exported function Toggle_Showing(stone, who, guild)
+  stone := stone; // stops ecompile &quot;not used&quot; warning
+  var abv := guild.getprop(&quot;guildabv&quot;);
+  var type := guild.getprop(&quot;type&quot;);
+  var tname := &quot;[&quot; + abv + &quot;]&quot;;
+  if(type == &quot;Order&quot;)
+    tname := tname + &quot;(Order)&quot;;
+  elseif(type == &quot;Chaos&quot;)
+    tname := tname + &quot;(Chaos)&quot;;
+  endif
+  var gtitle := GetObjProperty(who, &quot;guildtitle&quot;);
+  if(!gtitle)
+    gtitle := &quot;&quot;;
+  endif
+  if(GetObjProperty(who, &quot;abv&quot;) == &quot;0&quot;)
+    if(gtitle == &quot;&quot;)
+      who.title_guild := tname;
+    else
+      who.title_guild := gtitle + &quot;, &quot; + tname;
+    endif
+    SetObjProperty(who, &quot;abv&quot;, 1);
+  else
+    SetObjProperty(who, &quot;abv&quot;, &quot;0&quot;);
+    if(type == &quot;Standard&quot;)
+      who.title_guild := &quot;&quot;;
+    else
+      who.title_guild := tname;
+    endif
+  endif
+endfunction
+
+exported function Abreviation_Validation(stone, thestring)
+  stone := stone; // stops ecompile &quot;not used&quot; warning
+  var chk := 1;
+  foreach guilds in ListGuilds()
+    if(lower(guilds.getprop(&quot;guildabv&quot;)) == lower(thestring))
+      chk := 0;
+      break;
+    endif
+  endforeach
+  return chk;
+endfunction
+
+exported function Name_Validation(stone, thestring)
+  stone := stone; // stops ecompile &quot;not used&quot; warning
+  var chk := 1;
+  foreach guilds in ListGuilds()
+    if(lower(guilds.getprop(&quot;guildname&quot;)) == lower(thestring))
+      chk := 0;
+      break;
+    endif
+  endforeach
+  return chk;
+endfunction
+
+exported function Character_Validation(stone, thestring)
+  stone := stone; // stops ecompile &quot;not used&quot; warning
+  var i, validstr:={&quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;, &quot;i&quot;, &quot;j&quot;, &quot;k&quot;, &quot;l&quot;, &quot;m&quot;, &quot;n&quot;, &quot;o&quot;, &quot;p&quot;, &quot;q&quot;, &quot;r&quot;, &quot;s&quot;, &quot;t&quot;, &quot;u&quot;, &quot;v&quot;, &quot;w&quot;, &quot;x&quot;, &quot;y&quot;, &quot;z&quot;, &quot;$&quot;, &quot;*&quot;, &quot;&amp;&quot;, &quot;#&quot;, &quot;@&quot;, &quot;!&quot;, &quot;?&quot;, &quot;+&quot;, &quot;-&quot;, &quot;^&quot;, &quot; &quot;};
+  thestring := lower(thestring);
+  var chk := 1;
+  for(i:=1; i&lt;=len(thestring);i:=i+1)
+    if(!(thestring[i] in validstr))
+      chk := 0;
+    endif
+  endfor
+  return chk;
+endfunction
+
+exported function GuildChat(stone, ev, guild)
+  stone := stone; // stops ecompile &quot;not used&quot; warning
+  var the_msg := ev.message;
+  //var status  := ev.status; // uncomment if needed
+  if(ev.status == 1)
+    foreach person in (guild.members)
+      SendSysMessage(person, &quot;Guild Status: &quot; + the_msg, 3, 70);
+    endforeach
+  else
+    var who     := ev.who;
+    var gm := {&quot;In Vote&quot;, &quot;0&quot;};
+    var chk := guild.getprop(&quot;gm&quot;);
+    foreach thing in (guild.members)
+      if(thing.serial == chk)
+        gm := thing;
+        break;
+      endif
+    endforeach
+    foreach person in (guild.members)
+      if((!GetObjProperty(person, &quot;gc_off&quot;)) or (person == who) or (gm == who))
+        SendSysMessage(person, who.name + &quot;: &quot; + the_msg, 3, 70);
+      endif
+    endforeach
+  endif
+endfunction
+
+exported function CanWar(stone, ourtype, theirtype, who)
+  stone := stone; // stops ecompile &quot;not used&quot; warning
+  if(ourtype != &quot;Standard&quot;)
+    if((ourtype == theirtype) or (theirtype == &quot;Chaos&quot;) or (theirtype == &quot;Order&quot;))
+      SendSysMessage(who, &quot;You cannot change your warfare status with a &quot; + theirtype + &quot; guild.&quot;);
+      return 0;
+    endif
+  endif
+  return 1;
+endfunction
+
+exported function PurgeDeclarations(stone, guild)
+  var dc := guild.getprop(&quot;GuildDeclareStatus&quot;);
+  if(!dc)
+    return;
+  endif
+  foreach gstatus in dc
+    var chk := gstatus[1];
+    if(chk == guild.guildid)
+      chk := FindGuild(gstatus[2]);
+    else
+      chk := FindGuild(chk);
+    endif
+    RemoveDeclaration(stone, guild, chk);
+  endforeach
+endfunction
+
+exported function RemoveDeclaration(stone, guild, enemy)
+  stone := stone; // stops ecompile &quot;not used&quot; warning
+  var holder := {};
+  var dc := guild.getprop(&quot;GuildDeclareStatus&quot;);
+  if(!dc)
+    dc := {};
+  endif
+  foreach gstatus in dc
+    if(((enemy.guildid != gstatus[2]) &amp;&amp; (guild.guildid != gstatus[1])) and ((enemy.guildid != gstatus[1]) &amp;&amp; (guild.guildid != gstatus[2])))
+      holder.append(gstatus);
+      break;
+    endif
+  endforeach
+  guild.setprop(&quot;GuildDeclareStatus&quot;, holder);
+  holder := {};
+  dc := enemy.getprop(&quot;GuildDeclareStatus&quot;);
+  if(!dc)
+    dc := {};
+  endif
+  foreach gstatus in dc
+    if(((enemy.guildid != gstatus[2]) &amp;&amp; (guild.guildid != gstatus[1])) and ((enemy.guildid != gstatus[1]) &amp;&amp; (guild.guildid != gstatus[2])))
+      holder.append(gstatus);
+      break;
+    endif
+  endforeach
+  enemy.setprop(&quot;GuildDeclareStatus&quot;, holder);
+endfunction
+
+exported function AddDeclaration(stone, guild, enemy, type)
+  stone := stone; // stops ecompile &quot;not used&quot; warning
+  var request:={};
+  request[1]:= enemy.guildid;
+  request[2]:= guild.guildid;
+  request[3]:= type;
+  var ga := guild.getprop(&quot;GuildDeclareStatus&quot;);
+  if(!ga)
+    ga := {};
+  endif
+  ga.append(request);
+  guild.setprop(&quot;GuildDeclareStatus&quot;, ga);
+  ga := enemy.getprop(&quot;GuildDeclareStatus&quot;);
+  if(!ga)
+    ga := {};
+  endif
+  ga.append(request);
+  request[1]:= guild.guildid;
+  request[2]:= enemy.guildid;
+  enemy.SetProp(&quot;GuildDeclareStatus&quot;, ga);
+endfunction
+
+exported function AddEnemyGuild(stone, guild, enemy)
+  stone := stone; // stops ecompile &quot;not used&quot; warning
+  var guildenemies := guild.getprop(&quot;guildenemies&quot;);
+  if(!guildenemies)
+    guildenemies := {};
+  endif
+  guildenemies.append(enemy.guildid);
+  guild.setprop(&quot;guildenemies&quot;, guildenemies);
+  guildenemies := enemy.getprop(&quot;guildenemies&quot;);
+  if(!guildenemies)
+    guildenemies := {};
+  endif
+  guildenemies.append(guild.guildid);
+  enemy.setprop(&quot;guildenemies&quot;, guildenemies);
+endfunction
+
+exported function AddAllyGuild(stone, guild, ally)
+  stone := stone; // stops ecompile &quot;not used&quot; warning
+  var guildallies := guild.getprop(&quot;guildallies&quot;);
+  if(!guildallies)
+    guildallies := {};
+  endif
+  guildallies.append(ally.guildid);
+  guild.setprop(&quot;guildallies&quot;, guildallies);
+  guildallies := ally.getprop(&quot;guildallies&quot;);
+  if(!guildallies)
+    guildallies := {};
+  endif
+  guildallies.append(guild.guildid);
+  ally.setprop(&quot;guildallies&quot;, guildallies);
+endfunction
+
+exported function RemoveAllyGuild(stone, guild, ally)
+  stone := stone; // stops ecompile &quot;not used&quot; warning
+  var guildallies := guild.getprop(&quot;guildallies&quot;);
+  if(!guildallies)
+    guildallies := {};
+  endif
+  var holder := {};
+  foreach thing in guildallies
+    if(thing != ally.guildid)
+      holder.append(thing);
+    endif
+  endforeach
+  guild.setprop(&quot;guildallies&quot;, guildallies);
+  guildallies := ally.getprop(&quot;guildallies&quot;);
+  if(!guildallies)
+    guildallies := {};
+  endif
+  foreach thing in guildallies
+    if(thing != guild.guildid)
+      holder.append(thing);
+    endif
+  endforeach
+  ally.setprop(&quot;guildallies&quot;, guildallies);
+endfunction
+
+exported function RemoveEnemyGuild(stone, guild, enemy)
+  stone := stone; // stops ecompile &quot;not used&quot; warning
+  var guildenemies := guild.getprop(&quot;guildenemies&quot;);
+  if(!guildenemies)
+    guildenemies := {};
+  endif
+  var holder := {};
+  foreach thing in guildenemies
+    if(thing != enemy.guildid)
+      holder.append(thing);
+    endif
+  endforeach
+  guild.setprop(&quot;guildenemies&quot;, guildenemies);
+  guildenemies := enemy.getprop(&quot;guildenemies&quot;);
+  if(!guildenemies)
+    guildenemies := {};
+  endif
+  foreach thing in guildenemies
+    if(thing != guild.guildid)
+      holder.append(thing);
+    endif
+  endforeach
+  enemy.setprop(&quot;guildenemies&quot;, guildenemies);
+endfunction
+
+exported function Pending(stone, guild, enemy, type)
+  stone := stone; // stops ecompile &quot;not used&quot; warning
+  var chk := 1;
+  foreach thing in (guild.getprop(&quot;GuildDeclareStatus&quot;))
+    if((Cint(thing[1]) == enemy.guildid) and (Cint(thing[2]) == guild.guildid) and (thing[3] == type))
+      chk := 0;
+      break;
+    endif
+  endforeach
+  return chk;
+endfunction
+
+exported function OrderChaos(stone, guild, type)
+  print(&quot;Changing Order Chaos&quot;);
+  var orderguilds := GetGlobalProperty(&quot;OrderGuilds&quot;);
+  var chaosguilds := GetGlobalProperty(&quot;ChaosGuilds&quot;);
+  if(!orderguilds)
+    orderguilds := {};
+  endif
+  if(!chaosguilds)
+    chaosguilds := {};
+  endif
+  //var allies := guild.allyguilds;		// uncomment if needed
+  //var enemies := guild.enemyguilds;	// uncomment if needed
+  if(type == &quot;Order&quot;)
+    foreach gld in orderguilds
+      var holder := FindGuild(gld);
+      if(holder)
+        if((Pending(stone, guild, holder, &quot;RE&quot;)) or (Pending(stone, guild, gld, &quot;RA&quot;)))
+          RemoveDeclaration(stone, guild, gld);
+        endif
+        guild.removeenemyguild(holder);
+        holder.removeenemyguild(guild);
+        guild.addallyguild(holder);
+        holder.addallyguild(guild);
+      endif
+    endforeach
+    foreach gld in chaosguilds
+      var holder := FindGuild(gld);
+      if(holder)
+        if((Pending(stone, guild, holder, &quot;RE&quot;)) or (Pending(stone, guild, gld, &quot;RA&quot;)))
+          RemoveDeclaration(stone, guild, gld);
+        endif
+        guild.removeallyguild(holder);
+        holder.removeallyguild(guild);
+        guild.addenemyguild(holder);
+        holder.addenemyguild(guild);
+      endif
+    endforeach
+    guild.setprop(&quot;type&quot;, &quot;Order&quot;);
+    orderguilds.append(guild.guildid);
+    SetGlobalProperty(&quot;OrderGuilds&quot;, orderguilds);
+    foreach member in (guild.members)
+      if(GetObjProperty(member, &quot;abv&quot; == &quot;0&quot;))
+        SetObjProperty(member, &quot;abv&quot;, 1);
+      else
+        SetObjProperty(member, &quot;abv&quot;, &quot;0&quot;);
+      endif
+      Toggle_Showing(stone, member, guild);
+    endforeach
+  elseif(type == &quot;Chaos&quot;)
+    foreach gld in orderguilds
+      var holder := FindGuild(gld);
+      if(holder)
+        if((Pending(stone, guild, holder, &quot;RE&quot;)) or (Pending(stone, guild, gld, &quot;RA&quot;)))
+          RemoveDeclaration(stone, guild, gld);
+        endif
+        guild.removeallyguild(holder);
+        holder.removeallyguild(guild);
+        guild.addenemyguild(holder);
+        holder.addenemyguild(guild);
+      endif
+    endforeach
+    foreach gld in chaosguilds
+      var holder := FindGuild(gld);
+      if(holder)
+        if((Pending(stone, guild, holder, &quot;RE&quot;)) or (Pending(stone, guild, gld, &quot;RA&quot;)))
+          RemoveDeclaration(stone, guild, gld);
+        endif
+        guild.removeenemyguild(holder);
+        holder.removeenemyguild(guild);
+        guild.addallyguild(holder);
+        holder.addallyguild(guild);
+      endif
+    endforeach
+    chaosguilds.append(guild.guildid);
+    SetGlobalProperty(&quot;ChaosGuilds&quot;, chaosguilds);
+    guild.setprop(&quot;type&quot;, &quot;Chaos&quot;);
+    foreach member in (guild.members)
+      if(GetObjProperty(member, &quot;abv&quot; == &quot;0&quot;))
+        SetObjProperty(member, &quot;abv&quot;, 1);
+      else
+        SetObjProperty(member, &quot;abv&quot;, &quot;0&quot;);
+      endif
+      Toggle_Showing(stone, member, guild);
+    endforeach
+  else
+    if(guild.getprop(&quot;type&quot;) == &quot;Order&quot;)
+      var holder := {};
+      foreach thing in orderguilds
+        if(thing != guild.guildid)
+          holder.append(thing);
+        endif
+      endforeach
+      orderguilds := holder;
+      SetGlobalProperty(&quot;OrderGuilds&quot;, orderguilds);
+    elseif(guild.getprop(&quot;type&quot;) == &quot;Chaos&quot;)
+      var holder := {};
+      foreach thing in chaosguilds
+        if(thing != guild.guildid)
+          holder.append(thing);
+        endif
+      endforeach
+      chaosguilds := holder;
+      SetGlobalProperty(&quot;ChaosGuilds&quot;, chaosguilds);
+    endif
+    foreach thing in (guild.enemyguilds)
+      if((thing.guildid in orderguilds) or (thing.guildid in chaosguilds))
+        guild.removeenemyguild(thing);
+        thing.removeenemyguild(guild);
+        guild.removeallyguild(thing);
+        thing.removeallyguild(guild);
+      endif
+    endforeach
+    foreach thing in (guild.allyguilds)
+      if((thing.guildid in orderguilds) or (thing.guildid in chaosguilds))
+        guild.removeenemyguild(thing);
+        thing.removeenemyguild(guild);
+        guild.removeallyguild(thing);
+        thing.removeallyguild(guild);
+      endif
+    endforeach
+    foreach thing in (guild.getprop(&quot;guildenemies&quot;))
+      guild.addenemyguild(FindGuild(thing));
+    endforeach
+    foreach thing in (guild.GetProp(&quot;guildallies&quot;))
+      guild.addallyguild(FindGuild(thing));
+    endforeach
+    guild.setprop(&quot;type&quot;, &quot;Standard&quot;);
+    foreach member in (guild.members)
+      if(GetObjProperty(member, &quot;abv&quot; == &quot;0&quot;))
+        SetObjProperty(member, &quot;abv&quot;, 1);
+      else
+        SetObjProperty(member, &quot;abv&quot;, &quot;0&quot;);
+      endif
+      Toggle_Showing(stone, member, guild);
+    endforeach
+  endif
+endfunction
\ No newline at end of file

Added: trunk/096/pkg/OLD/items/guildstone/guildMove.src
===================================================================
--- trunk/096/pkg/OLD/items/guildstone/guildMove.src	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/guildstone/guildMove.src	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,62 @@
+use uo;
+use os;
+
+include &quot;:itemutils:canAccess&quot;;
+
+program packed_stone(who,stone)
+  EraseObjProperty(who, &quot;IsMeditating&quot;);
+  EraseObjProperty(who, &quot;HealTimer&quot;);
+  if(!can_access(who, stone))
+    return;
+  elseif(!ReserveItem(stone))
+    return;
+  elseif(!Accessible(who,stone))
+    SendSysMessage(who,&quot;You cannot access that item!&quot;);
+    return;
+  endif
+  var guild_id := GetObjProperty(stone,&quot;guild_id&quot;);
+  var guild := FindGuild(guild_id);
+  var gm := stone.FindGM(guild);
+  if(gm[2] != who.serial)
+    SendSysMessage(who, &quot;Only the Guild Master can place the stone.&quot;);
+    return;
+  endif
+  var house := who.multi;
+  var owner := GetObjProperty(house, &quot;owneracct&quot;);
+  var coowners := GetObjProperty(house, &quot;coownlist&quot;);
+  if((owner != who.acctname) and (!(who.serial in coowners)))
+    SendSysMessage(who, &quot;You must be the owner or a co-owner of the house to place a guildstone.&quot;);
+    return;
+  endif
+  var chk := 0;
+  foreach item in ListItemsNearLocation(who.x, who.y, who.z, 1, who.realm)
+    if((item.objtype &gt;= 0x0675) &amp;&amp; (item.objtype &lt;= 0x06f4))
+      if((((item.x == who.x+1) || (item.x == who.x-1)) &amp;&amp; (item.y == who.y)) || (((item.y == who.y+1) || (item.y == who.y-1)) &amp;&amp; (item.x == who.x)))
+        chk := 1;
+        break;
+      endif
+    endif
+  endforeach
+  if(chk == 1)
+    SendSysMessage(who, &quot;This is too close to the door.&quot;);
+    return;
+  endif
+  chk := 0;
+  foreach item in (house.items)
+    if(item.objtype == 0xa390)
+      chk := 1;
+      break;
+    endif
+  endforeach
+  if(chk == 1)
+    SendSysMessage(who, &quot;Only one guildstone can be placed in a house.&quot;);
+    return;
+  else
+    stone.movable := 1;
+    MoveItemToLocation(stone, who.x, who.y, who.z, MOVEITEM_FORCELOCATION);
+    stone.movable := 0;
+    stone.graphic := 0x0ed4;
+    stone.usescript := &quot;&quot;;
+    SetObjProperty(stone, &quot;houseserial&quot;, house.serial);
+  endif
+endprogram
\ No newline at end of file

Added: trunk/096/pkg/OLD/items/guildstone/guildStone.src
===================================================================
--- trunk/096/pkg/OLD/items/guildstone/guildStone.src	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/guildstone/guildStone.src	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,1605 @@
+use uo;
+use os;
+
+include &quot;:gumps:yesno&quot;;
+include &quot;:itemutils:canAccess&quot;;
+include &quot;guildData&quot;;
+include &quot;:gumps:include/old/old-gumps&quot;;
+include &quot;include/OLD/webPage&quot;;
+
+var guildstone;
+var gm, guild, guild_id;
+var guildmanager := GetProcess(GetGlobalProperty(&quot;#GuildManager&quot;));
+var stonemanager;
+
+program use_guild_stone(who, stone)
+  guildstone := stone;
+  EraseObjProperty(who, &quot;IsMeditating&quot;);
+  EraseObjProperty(who, &quot;HealTimer&quot;);
+  if(!ReserveItem(guildstone))
+    SendSysMessage(who, &quot;Guild Stone in use.&quot;, 3, 40);
+    return;
+  endif
+  guild_id := GetObjProperty(guildstone, &quot;guild_id&quot;);
+  stonemanager := GetProcess(GetGlobalProperty(CStr(&quot;#Guild&quot; + guild_id)));
+  var guild_pl := GetObjProperty(who, &quot;guild_id&quot;);
+  if((guild_id == 0)&amp;&amp;(!guild_pl.errortext))
+    PrintTextAbovePrivate(guildstone, &quot;You are already member of &quot; + FindGuild(guild_pl).getprop(&quot;guildname&quot;) + &quot;.&quot;, who);
+    return;
+  endif
+  guild := FindGuild(guild_id);
+  gm := guildstone.FindGM(guild);
+  var title := GetObjProperty(gm[3], &quot;guildtitle&quot;);
+  if(!title)
+    title := &quot;Guild Master&quot;;
+  endif
+  var count := guild.members;
+  if(guild.errortext)
+    DestroyItem(guildstone);
+    return;
+  endif
+  if(((guild_pl != guild_id)||(!guild.ismember(who)))&amp;&amp;(who.cmdlevel &lt; 3))
+    OldGFInitGump();
+    OldGFPage(0);
+    OldGFResizePic(150,  25, 5120, 460, 140);
+    OldGFResizePic(160,  35, 5054, 440, 120);
+    OldGFButtonID (165,  40, 4017, 4018, 1, 2000);
+    OldGFTextLine (205,  40,    0, guild.getprop(&quot;guildname&quot;));
+    OldGFTextLine (205,  60,    0, title + &quot;   &quot; + gm[1]);
+    OldGFTextLine (170,  85,    0, &quot;Members:   &quot; + count.size());
+    var type := guild.getprop(&quot;type&quot;);
+    if(type == &quot;Order&quot;)
+      OldGFTextLine (170,  105,  0, &quot;Guild type: Order&quot;);
+    elseif(type == &quot;Chaos&quot;)
+      OldGFTextLine (170,  105,  0, &quot;Guild type: Chaos&quot;);
+    else
+      OldGFTextLine (170,  105,  0, &quot;Guild type: Standard&quot;);
+      guild.setprop(&quot;type&quot;, &quot;Standard&quot;);
+    endif
+    if(!guild_pl.errortext)
+      var guild2 := FindGuild(guild_pl);
+      if(guild2.isallyguild(guild))
+        OldGFTextLine (170,  125,  940, &quot;This guild is an ally of your guild.&quot;);
+      elseif(guild2.isenemyguild(guild))
+        OldGFTextLine (170,  125,  940, &quot;This guild is an enemy of your guild.&quot;);
+      else
+        OldGFTextLine (170,  125,  940, &quot;This guild is neutral towards your guild.&quot;);
+      endif
+    else
+      OldGFTextLine (170,  125,  940, &quot;This guild is neutral towards you.&quot;);
+    endif
+    OldGFSendGump(who);
+    return;
+  endif
+  count:=0;
+  if(gm[1] == &quot;In Vote&quot;)
+    if(SetFealty(who) == 0)
+      SendSysMessage(who, &quot;You have to set your fealty.&quot;, 3, 70);
+      return;
+    endif
+    guildstone.FindNewGM(guild);
+    gm := guildstone.FindGM(guild);
+  endif
+  buildgump(who);
+endprogram
+
+function buildgump(who)
+  var title := GetObjProperty(gm[3], &quot;guildtitle&quot;);
+  if(!title)
+    title := &quot;Guild Master&quot;;
+  endif
+  OldGFInitGump();
+  OldGFPage(0);
+  OldGFResizePic(110,  25, 5120,  470, 470);
+  OldGFResizePic(120,  35, 5054,  450, 450);
+  OldGFResizePic(133, 415, 5120,  420,  45);
+  OldGFResizePic(137, 420, 5100,  410,  35);
+  OldGFTextLine(140,  45, 5, guild.getprop(&quot;guildname&quot;) + &quot; (&quot; + title + &quot; &quot; + gm[1] + &quot;)&quot;);
+  OldGFButtonID(350, 426, 5042, 5043, 1);
+  OldGFButtonID(240, 426, 5200, 5201, 1);
+  OldGFTextLine(165,  95,  0, &quot;Recruit someone into the guild.&quot;);
+  OldGFTextLine(165, 115,  0, &quot;View the current roster.&quot;);
+  OldGFTextLine(165, 135,  0, &quot;View the guild's charter.&quot;);
+  OldGFTextLine(165, 155,  0, &quot;Declare your fealty. You are currently loyal to&quot;);
+  var flty := GetObjProperty(who, &quot;fealty&quot;);
+  if(flty == who.serial)
+    OldGFTextLine(165, 172, 0, &quot;yourself.&quot;);
+  else
+    foreach thing in (guild.members)
+      if(thing.serial == flty)
+        OldGFTextLine(165, 172, 0, thing.name + &quot;.&quot;);
+        break;
+      endif
+    endforeach
+  endif
+  OldGFTextLine (165, 195, 0, &quot;Toggle your the guild's abbreviation in&quot;);
+  if(guild.getprop(&quot;guildabv&quot;) == &quot;NONE&quot;)
+    OldGFTextLine (165, 212, 0, &quot;your name. Currently off.&quot;);
+  elseif(GetObjProperty(who, &quot;abv&quot;) == &quot;0&quot;)
+    OldGFTextLine (165, 212, 0, &quot;your name. Currently off.&quot;);
+  else
+    OldGFTextLine (165, 212, 0, &quot;your name. Currently on.&quot;);
+  endif
+  OldGFTextLine (165, 235, 0, &quot;Resign from the guild.&quot;);
+  OldGFTextLine (165, 255, 0, &quot;View list of cantidates who have been&quot;);
+  OldGFTextLine (165, 272, 0, &quot;sponsored to the guild.&quot;);
+  OldGFTextLine (165, 295, 0, &quot;Guild Master functions.&quot;);
+  OldGFTextLine (165, 315, 0, &quot;View list of your guild allies.&quot;);
+  OldGFTextLine (165, 335, 0, &quot;View list of your guild enemies.&quot;);
+  OldGFTextLine (165, 355, 0, &quot;View pending allies/enemies.&quot;);
+  OldGFSetRadioGroup(1);
+  OldGFRadioButton(140,  98, 210, 211, 0);
+  OldGFRadioButton(140, 118, 210, 211, 0);
+  OldGFRadioButton(140, 138, 210, 211, 0);
+  OldGFRadioButton(140, 158, 210, 211, 0);
+  OldGFRadioButton(140, 198, 210, 211, 0);
+  OldGFRadioButton(140, 238, 210, 211, 0);
+  OldGFRadioButton(140, 258, 210, 211, 0);
+  OldGFRadioButton(140, 298, 210, 211, 0);
+  OldGFRadioButton(140, 318, 210, 211, 0);
+  OldGFRadioButton(140, 338, 210, 211, 0);
+  OldGFRadioButton(140, 358, 210, 211, 0);
+  var box := OldGFSendGump(who);
+  if((box[0] == 0) or (box[0] == 1026))
+    SendSysMessage(who, &quot;Cancelled.&quot;, 3, 40);
+    return;
+  else
+    foreach thing in (box.keys)
+      if((thing != 1025) and (thing != 0))
+        case(thing)
+          2049: recruit(who);
+          2050: viewmembers(who);
+          2051: viewcharter(who);
+                buildgump(who);
+          2052: if(SetFealty(who) == 1);
+                  sleep(2);
+                  buildgump(who);
+                endif
+          2053: guildstone.Toggle_Showing(who, guild);
+                buildgump(who);
+          2054: resign(who);
+          2055: viewrecruits(who);
+                buildgump(who);
+          2056: gm_menu(who);
+          2057: yourallies(who);
+                buildgump(who);
+          2058: yourenemies(who);
+          2059: viewstatus(who);
+        endcase
+        break;
+      endif
+    endforeach
+  endif
+endfunction
+
+function gm_menu(who)
+  if((!(gm[2] == who.serial)) &amp;&amp; (who.cmdlevel &lt; 3))
+    SendSysMessage(who, &quot;Only the GuildMaster may access on this menu.&quot;);
+    return;
+  endif
+  var title := GetObjProperty(gm[3], &quot;guildtitle&quot;);
+  if(!title)
+    title := &quot;Guild Master&quot;;
+  endif
+  OldGFInitGump();
+  OldGFPage(0);
+  OldGFResizePic(110,  25, 5120,  470, 470);
+  OldGFResizePic(120,  35, 5054,  450, 450);
+  OldGFResizePic(133, 415, 5120,  420,  45);
+  OldGFResizePic(137, 420, 5100,  410,  35);
+  OldGFTextLine(140,  45, 5, guild.getprop(&quot;guildname&quot;) + &quot; (&quot; + title + &quot; &quot; + gm[1] + &quot;)&quot;);
+  var cancel := OldGFButtonID(240, 426, 5200, 5201, 1);
+  var ok     := OldGFButtonID(350, 426, 5042, 5043, 1);
+  OldGFTextLine(165,  95, 0, &quot;Set the guild name.&quot;);
+  OldGFTextLine(165, 115, 0, &quot;Set the guild's abbreviation.&quot;);
+  var type := guild.getprop(&quot;type&quot;);
+  if(type == &quot;Order&quot;)
+    OldGFTextLine(165, 135, 0, &quot;Change guild type. [currently an Order guild]&quot;);
+  elseif(type == &quot;Chaos&quot;)
+    OldGFTextLine(165, 135, 0, &quot;Change guild type. [currently a Chaos guild]&quot;);
+  else
+    OldGFTextLine(165, 135, 0, &quot;Change guild type. [currently a Standard guild]&quot;);
+    guild.setprop(&quot;type&quot;, &quot;Standard&quot;);
+  endif
+  OldGFTextLine(165, 155, 0, &quot;Change the color of the guild stone.&quot;);
+  OldGFTextLine(165, 175, 0, &quot;Set the guild charter.&quot;);
+  OldGFTextLine(165, 195, 0, &quot;Dismiss a member.&quot;);
+  OldGFTextLine(165, 215, 0, &quot;Declare war.&quot;);
+  OldGFTextLine(165, 235, 0, &quot;Declare peace.&quot;);
+  OldGFTextLine(165, 255, 0, &quot;Propose an alliance with another guild.&quot;);
+  OldGFTextLine(165, 275, 0, &quot;Break alliance with another guild.&quot;);
+  OldGFTextLine(165, 295, 0, &quot;Accept a cantidate seeking membership.&quot;);
+  OldGFTextLine(165, 315, 0, &quot;Refuse a cantidate seeking membership.&quot;);
+  OldGFTextLine(165, 335, 0, &quot;Set the guildmaster's title.&quot;);
+  OldGFTextLine(165, 355, 0, &quot;Grant a title to another member.&quot;);
+  OldGFTextLine(165, 375, 0, &quot;Transport this guildstone.&quot;);
+  OldGFTextLine(165, 395, 0, &quot;Return to the main menu.&quot;);
+  OldGFSetRadioGroup(1);
+  OldGFRadioButton(140,  95, 210, 211, 0);
+  OldGFRadioButton(140, 115, 210, 211, 0);
+  OldGFRadioButton(140, 135, 210, 211, 0);
+  OldGFRadioButton(140, 155, 210, 211, 0);
+  OldGFRadioButton(140, 175, 210, 211, 0);
+  OldGFRadioButton(140, 195, 210, 211, 0);
+  OldGFRadioButton(140, 215, 210, 211, 0);
+  OldGFRadioButton(140, 235, 210, 211, 0);
+  OldGFRadioButton(140, 255, 210, 211, 0);
+  OldGFRadioButton(140, 275, 210, 211, 0);
+  OldGFRadioButton(140, 295, 210, 211, 0);
+  OldGFRadioButton(140, 315, 210, 211, 0);
+  OldGFRadioButton(140, 335, 210, 211, 0);
+  OldGFRadioButton(140, 355, 210, 211, 0);
+  OldGFRadioButton(140, 375, 210, 211, 0);
+  OldGFRadioButton(140, 395, 210, 211, 0);
+  var box := OldGFSendGump(who);
+  var choose := 0;
+  if(box[cancel.keyid])
+    SendSysMessage(who, &quot;Cancelled.&quot;, 3, 40);
+    return;
+  elseif(box[ok.keyid])
+    foreach k in(box.keys)
+      if((k != 0) &amp;&amp; (k != ok.keyid))
+        choose := k;
+        break;
+      endif
+    endforeach
+  else
+    SendSysMessage(who, &quot;Cancelled.&quot;, 3, 40);
+    return;
+  endif
+  if(!choose)
+    gm_menu(who);
+    return;
+  endif
+  print(choose);
+  case(choose)
+    2049: SetGuildName(who);
+    2050: SetAbrevName(who);
+    2051: ToggleVirtue(who);
+    2052: setstonecolor(who);
+    2053: setcharter(who);
+    2054: Dismiss(who);
+    2055: setenemies(who);
+    2056: remenemies(who);
+    2057: setallies(who);
+    2058: remallies(who);
+    2059: AcceptCandidate(who);
+    2060: RefuseCandidate(who);
+    2061: SetGMTitle(who);
+    2062: GrantTitle(who);
+    2063: Teleport(who);
+          return;
+    2064: buildgump(who);
+  endcase
+endfunction
+
+function ToggleVirtue(who);
+  if(ReadGameClock() &lt; guild.getprop(&quot;virtuetime&quot;))
+    SendSysMessage(who, &quot;You can only change the guild virtue once a week.&quot;, 3, 40);
+    sleep(2);
+    return;
+  endif
+  OldGFInitGump();
+  OldGFPage(0);
+  OldGFResizePic(110,  25, 5120,  470, 470);
+  OldGFResizePic(120,  35, 5054,  450, 450);
+  OldGFResizePic(133, 415, 5120,  420,  45);
+  OldGFResizePic(137, 420, 5100,  410,  35);
+  OldGFResizePic(140, 110, 2620,  410, 280);
+  OldGFTextLine (240,  50,   0, &quot;Guild Virtue Menu&quot;);
+  OldGFTextLine (160,  70, 900, &quot;Guild Master: &quot; + gm[1]);
+  var cancel := OldGFButtonID(240, 426, 5200, 5201, 1);
+  /*var ok     :=*/ OldGFButtonID(350, 426, 5042, 5043, 1);
+  OldGFSetRadioGroup(1);
+  var type := guild.getprop(&quot;type&quot;);
+  var order, chaos, standard;
+  if(type == &quot;Standard&quot;)
+    standard := OldGFRadioButton(150, 122, 210, 211, 1, 1);
+    order    := OldGFRadioButton(150, 142, 210, 211, 0, 2);
+    chaos    := OldGFRadioButton(150, 162, 210, 211, 0, 3);
+  elseif(type == &quot;Order&quot;)
+    standard := OldGFRadioButton(150, 122, 210, 211, 0, 1);
+    order    := OldGFRadioButton(150, 142, 210, 211, 1, 2);
+    chaos    := OldGFRadioButton(150, 162, 210, 211, 0, 3);
+  else
+    standard := OldGFRadioButton(150, 122, 210, 211, 0, 1);
+    order    := OldGFRadioButton(150, 142, 210, 211, 0, 2);
+    chaos    := OldGFRadioButton(150, 162, 210, 211, 1, 3);
+  endif
+  OldGFTextLine(175, 120, 300, &quot;Standard&quot;);
+  OldGFTextLine(175, 140, 300, &quot;Order&quot;);
+  OldGFTextLine(175, 160, 300, &quot;Chaos&quot;);
+  var box := OldGFSendGump(who);
+  if(box[cancel.keyid])
+    return;
+  endif
+  var newtype;
+  if(box[standard.keyid])
+    newtype := &quot;Standard&quot;;
+  elseif(box[order.keyid])
+    newtype := &quot;Order&quot;;
+  else
+    newtype := &quot;Chaos&quot;;
+  endif
+  if(type == newtype)
+    return;
+  endif
+  if(guildstone.OrderChaos(guild, newtype))
+    guild.setprop(&quot;virtuetime&quot;, ReadGameClock()+(7*24*3600));
+    var ev      := struct;
+    ev.+type    := &quot;orderchaos&quot;;
+    ev.+message := &quot;Guild type changed to: &quot; + newtype + &quot;.&quot;;
+    guildmanager.SendEvent(ev);
+    guildstone.guildchat(ev, guild);
+    var evnt := struct;
+    evnt.type := &quot;gmbcast&quot;;
+    evnt.+src := &quot;GuildManager&quot;;
+    evnt.+msg := &quot;Guild Manager: guild [&quot; + guild.getprop(&quot;guildname&quot;) + &quot;, [&quot; + guild.getprop(&quot;guildabv&quot;) + &quot;]]  has switched to &quot; + newtype + &quot;.&quot;;
+    var stafflist := GetProcess(GetGlobalProperty(&quot;#stafflist&quot;));
+    stafflist.SendEvent(evnt);
+    sleep(2);
+  endif
+endfunction
+
+function recruit(who)
+  SendSysMessage(who, &quot;Select the player to recruit.&quot;);
+  var targ:=Target(who, TGTOPT_CHECK_LOS + TGTOPT_NEUTRAL);
+  if(!targ.acctname)
+    SendSysMessage(who, &quot;You can only target players.&quot;, 3, 40);
+    sleep(2);
+    return;
+  elseif(GetObjProperty(targ, &quot;guild_id&quot;))
+    SendSysMessage(who, &quot;They are already in a guild.&quot;, 3, 40);
+    sleep(2);
+    return;
+  endif
+  var guildname := guild.getprop(&quot;guildname&quot;);
+  SendSysMessage(targ, &quot;Would you like to join the guild: &quot; + guildname, 3, 70);
+  var answer := YesNo(targ, &quot;Join Guild?&quot;);
+  if(!answer)
+    SendSysMessage(targ, &quot;You have refused to join &quot; + guildname + &quot;.&quot;, 3, 40);
+    SendSysMessage(who, targ.name + &quot; has decided not to join.&quot;, 3, 40);
+    sleep(2);
+    return;
+  endif
+  var recruits := guild.getprop(&quot;recruits&quot;);
+  if((!recruits) or (recruits[1] == &quot;NONE&quot;))
+    recruits := {};
+  endif
+  if(targ.serial in recruits)
+    SendSysMessage(who, targ.name + &quot; has already been recruited.&quot;, 3, 40);
+    sleep(2);
+    return;
+  else
+    recruits.append(targ.serial);
+    guild.setprop(&quot;recruits&quot;, recruits);
+    SendSysMessage(who, targ.name + &quot; has been recruited to join the guild.&quot;);
+    SendSysMessage(targ, &quot;You have been recruited to join &quot; + guild.getprop(&quot;guildname&quot;) + &quot;.&quot;);
+    if(who != gm[3])
+      SendSysMessage(gm[3], targ.name + &quot; has been recruited to join the guild.&quot;, 3, 70);
+    endif
+    sleep(2);
+  endif
+endfunction
+
+function viewmembers(who)
+  var count := 0;
+  var rc := 120;
+  var pc := 0;
+  OldGFInitGump();
+  OldGFPage(pc);
+  pc := pc + 1;
+  OldGFResizePic(110,  25, 5120,  470, 470);
+  OldGFResizePic(120,  35, 5054,  450, 450);
+  OldGFResizePic(133, 415, 5120,  420,  45);
+  OldGFResizePic(137, 420, 5100,  410,  35);
+  OldGFResizePic(140, 110, 2620,  410, 280);
+  OldGFTextLine (240,  50,   0, &quot;Guild Roster&quot;);
+  OldGFTextLine (160,  70, 900, &quot;Guild Master: &quot; + gm[1]);
+  OldGFTextLine (140,  90,   0, &quot;Member Name&quot;);
+  var ok := OldGFButtonID (285, 425, 5042, 5043, 1);
+  OldGFPage(pc);
+  pc := pc + 1;
+  foreach member in (guild.members)
+    if(gm[2] != member.serial)
+      count := count + 1;
+      if(count &gt; 13)
+        count := 1;
+        rc := 120;
+        OldGFButtonPage(315, 393, 5540, 5541, pc);
+        if(pc &gt; 2)
+          OldGFButtonPage(275, 393, 5537, 5538,(pc - 2));
+        endif
+        OldGFPage(pc);
+        pc := pc + 1;
+      endif
+      var title := GetObjProperty(member, &quot;guildtitle&quot;);
+      if(!title)
+        title := &quot;&quot;;
+      endif
+      OldGFTextLine(150, rc, 300, member.name + &quot;:  &quot; + title);
+      rc := rc + 20;
+    endif
+  endforeach
+  if(count == 0)
+    OldGFTextLine(150, rc, 940, &quot;No Members&quot;);
+  endif
+  var box := OldGFSendGump(who);
+  if(box[ok.keyid])
+    buildgump(who);
+  endif
+endfunction
+
+function viewcharter(who)
+  OldGFInitGump();
+  OldGFPage(0);
+  OldGFResizePic( 40, 40, 5120, 560, 400);
+  OldGFResizePic( 50, 50, 5054, 540, 380);
+  OldGFResizePic( 60, 90, 2620, 520, 270);
+  OldGFTextLine(200, 70, 5, &quot;Charter for &quot;+guild.getprop(&quot;guildname&quot;));
+  var message := guild.getprop(&quot;gc&quot;);
+  if(message[1]==&quot;NONE&quot;)
+    message:={&quot;&quot;, &quot;No Charter has been set up yet.&quot;, &quot;&quot;};
+  endif
+  var i;
+  var line := 3;
+  for(i:=4; i&lt;=15; i:=i+1)
+    if(message[i-3]!=error)
+      OldGFTextLine(70, (82+((line-2)*20)), 300, message[i-3]);
+      line:=line+1;
+    endif
+  endfor
+  OldGFTextLine(200, 360, 70, &quot;Guild Master &quot; + gm[1]);
+  var wp := guild.getprop(&quot;webpage&quot;);
+  if(wp == error)
+    OldGFTextLine(170, 390, 0, &quot;Guild Web Page: Not Entered&quot;);
+  else
+    OldGFTextLine(170, 390, 0, &quot;Guild Web Page: &quot; + wp);
+  endif
+  OldGFTextLine( 60, 390, 0, &quot;go there?:&quot;);
+  var goweb := OldGFButtonID(130, 390, 4023, 4025, 1);
+  var res := OldGFSendGump(who);
+  if(res[goweb.keyid])
+    OpenWebSite(who, wp);
+  endif
+endfunction
+
+function SetFealty(who)
+  var guildmembers := guild.members;
+  var count := 0;
+  var rc := 120;
+  var pc := 0;
+  OldGFInitGump();
+  OldGFPage(pc);
+  pc := pc + 1;
+  OldGFResizePic(110,  25, 5120,  470, 470);
+  OldGFResizePic(120,  35, 5054,  450, 450);
+  OldGFResizePic(133, 415, 5120,  420,  45);
+  OldGFResizePic(137, 420, 5100,  410,  35);
+  OldGFResizePic(140, 110, 2620,  410, 280);
+  OldGFTextLine (240,  50,   0, &quot;Declare Fealty&quot;);
+  OldGFTextLine (160,  70, 900, &quot;Guild Master: &quot; + gm[1]);
+  OldGFTextLine (140,  90,   0, &quot;Member Name&quot;);
+  /*var cancel :=*/ OldGFButtonID(240, 426, 5200, 5201, 1);
+  var ok     := OldGFButtonID(350, 426, 5042, 5043, 1);
+  OldGFPage(pc);
+  pc := pc + 1;
+  var rg := 1;
+  OldGFSetRadioGroup(rg);
+  rg := rg + 1;
+  foreach member in guildmembers
+    count := count + 1;
+    if(count &gt; 13)
+      count := 1;
+      rc := 120;
+      OldGFButtonPage(315, 393, 5540, 5541, pc);
+      if(pc &gt; 2)
+        OldGFButtonPage(275, 393, 5537, 5538, (pc - 2));
+      endif
+      OldGFPage(pc);
+      pc := pc + 1;
+      rg := rg + 1;
+      OldGFSetRadioGroup(rg);
+    endif
+    OldGFRadioButton(150, rc + 2, 2103, 2104, 0, member.serial);
+    if(gm[2] == member.serial)
+      OldGFTextLine(185, rc, 940, &quot;GM: &quot; + member.name);
+    else
+      OldGFTextLine(185, rc, 940, member.name);
+    endif
+    rc := rc + 20;
+  endforeach
+  var choose;
+  var box := OldGFSendGump(who);
+  if(box[ok.keyid])
+    foreach k in(box.keys)
+      if((k != ok.keyid) and (k != 0))
+        choose := k;
+        break;
+      endif
+    endforeach
+    SetObjProperty(who, &quot;fealty&quot;, choose);
+    SendSysMessage(who, &quot;You declare your fealty.&quot;);
+    sleep(2);
+    return 1;
+  else
+    SendSysMessage(who, &quot;Cancelled&quot;, 3, 40);
+    sleep(2);
+    return 0;
+  endif
+endfunction
+
+function resign(who)
+  SendSysMessage(who, &quot;Are you sure you want to resign?&quot;, 3, 40);
+  var answer := YesNo(who, &quot;Quit Guild?&quot;);
+  if(!answer)
+    SendSysMessage(who, &quot;Canceled.&quot;, 3, 40);
+    return;
+  endif
+  var ev := struct;
+  ev.+source := who;
+  ev.+guild  := guild;
+  ev.+type   := &quot;resign&quot;;
+  ev.+gm     := gm[3];
+  ev.+gs     := guildstone;
+  stonemanager.SendEvent(ev);
+endfunction
+
+function viewrecruits(who)
+  var count := 0;
+  var rc := 120;
+  var pc := 0;
+  OldGFInitGump();
+  OldGFPage(pc);
+  pc := pc + 1;
+  OldGFResizePic(110,  25, 5120,  470, 470);
+  OldGFResizePic(120,  35, 5054,  450, 450);
+  OldGFResizePic(133, 415, 5120,  420,  45);
+  OldGFResizePic(137, 420, 5100,  410,  35);
+  OldGFResizePic(140, 110, 2620,  410, 280);
+  OldGFTextLine (240,  50,   0, &quot;Guild Recruitment Status Page&quot;);
+  OldGFTextLine (160,  70, 900, &quot;Guild Master: &quot; + gm[1]);
+  OldGFTextLine (140,  90,   0, &quot;Guild Listing&quot;);
+  var ok := OldGFButtonID (285, 425, 5042, 5043, 1);
+  var total := 0;
+  foreach gstatus in (guild.getprop(&quot;recruits&quot;))
+    var enemy := SystemFindObjectBySerial(gstatus, SYSFIND_SEARCH_OFFLINE_MOBILES);
+    if(enemy)
+      count := count + 1;
+      if(count &gt; 13)
+        count := 1;
+        rc := 120;
+        OldGFButtonPage(315, 396, 5540, 5541, pc);
+        if(pc &gt; 2)
+          OldGFButtonPage(275, 396, 5537, 5538, (pc - 2));
+        endif
+        OldGFPage(pc);
+        pc := pc + 1;
+      endif
+      OldGFTextLine(150, rc, 300, enemy.name);
+      rc := rc + 20;
+      total := total + 1;
+    endif
+  endforeach
+  if(total == 0)
+    OldGFTextLine(150, rc, 300, &quot;No Current Recruits&quot;);
+  endif
+  OldGFTextLine (340,  90,   0, &quot;total recruits: &quot; + total);
+  var res := OldGFSendGump(who);
+  if(res[ok.keyid]);
+    buildgump(who);
+  endif
+endfunction
+
+function Dismiss(who)
+  var count := 0;
+  var rc := 120;
+  var pc := 0;
+  OldGFInitGump();
+  OldGFPage(pc);
+  pc := pc + 1;
+  OldGFResizePic(110,  25, 5120,  470, 470);
+  OldGFResizePic(120,  35, 5054,  450, 450);
+  OldGFResizePic(133, 415, 5120,  420,  45);
+  OldGFResizePic(137, 420, 5100,  410,  35);
+  OldGFResizePic(140, 110, 2620,  410, 280);
+  OldGFTextLine (240,  50,   0, &quot;Guild Roster&quot;);
+  OldGFTextLine (160,  70, 900, &quot;Guild Master: &quot; + gm[1]);
+  OldGFTextLine (140,  90,   0, &quot;Member Name&quot;);
+  var ok := OldGFButtonID (285, 425, 5042, 5043, 1);
+  OldGFPage(pc);
+  pc := pc + 1;
+  var rg := 1;
+  OldGFSetRadioGroup(rg);
+  foreach member in (guild.members)
+    if(gm[2] != member.serial)
+      count := count + 1;
+      if(count &gt; 13)
+        count := 1;
+        rc := 120;
+        OldGFButtonPage(315, 393, 5540, 5541, pc);
+        if(pc &gt; 2)
+          OldGFButtonPage(275, 393, 5537, 5538,(pc - 2));
+        endif
+        OldGFPage(pc);
+        pc := pc + 1;
+        rg := rg + 1;
+        OldGFSetRadioGroup(rg);
+      endif
+      var title := GetObjProperty(member, &quot;guildtitle&quot;);
+      if(!title)
+        title := &quot;&quot;;
+      endif
+      OldGFTextLine(175, rc, 300, member.name + &quot;:  &quot; + title);
+      OldGFRadioButton(150, rc, 210, 211, 0, member.serial);
+      rc := rc + 20;
+    endif
+  endforeach
+  if(count == 0)
+    OldGFTextLine(150, rc, 940, &quot;No Members&quot;);
+  endif
+  var box := OldGFSendGump(who);
+  var choose := 0;
+  if(box[ok.keyid])
+    foreach k in(box.keys)
+      if((k &gt; 1) and (k != ok.keyid))
+        choose := k;
+        break;
+      endif
+    endforeach
+    foreach thing in (guild.members)
+      if(thing.serial == choose)
+        guild.removemember(thing);
+        EraseObjProperty(thing, &quot;guild_id&quot;);
+        EraseObjProperty(thing, &quot;fealty&quot;);
+        EraseObjProperty(thing, &quot;abv&quot;);
+        thing.title_guild := &quot;&quot;;
+        SendSysMessage(thing, &quot;You have been removed from your guild.&quot;, 3, 40);
+        SendSysMessage(who, &quot;Player has been dismissed.&quot;, 3,70);
+        var evnt      := struct;
+        evnt.+status  := 1;
+        evnt.+message := thing.name + &quot; has been removed from the guild.&quot;;
+        guildstone.guildchat(evnt, guild);
+        break;
+      endif
+    endforeach
+    sleep(2);
+  else
+    SendSysMessage(who, &quot;Cancelled.&quot;, 3, 40);
+    sleep(2);
+    gm_menu(who);
+    return;
+  endif
+endfunction
+
+function setallies(who)
+  var count := 0;
+  var rc := 120;
+  var pc := 0;
+  OldGFInitGump();
+  OldGFPage(pc);
+  pc := pc + 1;
+  OldGFResizePic(110,  25, 5120,  470, 470);
+  OldGFResizePic(120,  35, 5054,  450, 450);
+  OldGFResizePic(133, 415, 5120,  420,  45);
+  OldGFResizePic(137, 420, 5100,  410,  35);
+  OldGFResizePic(140, 110, 2620,  410, 280);
+  OldGFTextLine (240,  50,   0, &quot;Delcare Peace(allies)&quot;);
+  OldGFTextLine (160,  70, 900, &quot;Guild Master: &quot; + gm[1]);
+  OldGFTextLine (140,  90,   0, &quot;Guild Name&quot;);
+  /*var cancel :=*/ OldGFButtonID(240, 426, 5200, 5201, 1);
+  var ok     := OldGFButtonID(350, 426, 5042, 5043, 1);
+  OldGFPage(pc);
+  pc := pc + 1;
+  var rg := 1;
+  OldGFSetRadioGroup(rg);
+  //var orderguilds := GetGlobalProperty(&quot;OrderGuilds&quot;); // uncomment if needed
+  //var chaosguilds := GetGlobalProperty(&quot;ChaosGuilds&quot;); // uncomment if needed
+  foreach gstatus in ListGuilds()
+    if((VirtueChecking(guild, gstatus)) and (!guild.isallyguild(gstatus)) and (guild.guildid != gstatus.guildid) and (!guild.isenemyguild(gstatus)) and (guildstone.Pending(guild, gstatus, &quot;RE&quot;)))
+      count := count + 1;
+      if(count &gt; 13)
+        count := 1;
+        rc := 120;
+        OldGFButtonPage(315, 393, 5540, 5541, pc);
+        if(pc &gt; 2)
+          OldGFButtonPage(275, 393, 5537, 5538, (pc - 2));
+        endif
+        OldGFPage(pc);
+        rg := rg + 1;
+        OldGFSetRadioGroup(rg);
+        pc := pc + 1;
+      endif
+      OldGFTextLine(175, rc, 300, gstatus.getprop(&quot;guildname&quot;) + &quot; [&quot; + gstatus.getprop(&quot;guildabv&quot;) + &quot;]&quot;);
+      OldGFRadioButton(150, rc, 210, 211, 0, gstatus.guildid);
+      rc := rc + 20;
+    endif
+  endforeach
+  var choose:=0;
+  var box := OldGFSendGump(who);
+  if(box[ok.keyid])
+    foreach k in(box.keys)
+      if(k &gt; 1)
+        choose := k;
+        break;
+      endif
+    endforeach
+  else
+    SendSysMessage(who, &quot;Cancelled.&quot;, 3, 40);
+    sleep(2);
+    gm_menu(who);
+    return;
+  endif
+  if(!choose || choose==0)
+    SendSysMessage(who, &quot;Cancelled.&quot;, 3, 40);
+    sleep(2);
+    gm_menu(who);
+    return;
+  endif
+  box := FindGuild(choose);
+  var ev := struct;
+  ev.+type  := &quot;declareally&quot;;
+  ev.+who   := who;
+  ev.+guild := guild;
+  ev.+enemy := box;
+  stonemanager.SendEvent(ev);
+endfunction
+
+function remallies(who)
+  var count := 0;
+  var rc := 120;
+  var pc := 0;
+  OldGFInitGump();
+  OldGFPage(pc);
+  pc := pc + 1;
+  OldGFResizePic(110,  25, 5120,  470, 470);
+  OldGFResizePic(120,  35, 5054,  450, 450);
+  OldGFResizePic(133, 415, 5120,  420,  45);
+  OldGFResizePic(137, 420, 5100,  410,  35);
+  OldGFResizePic(140, 110, 2620,  410, 280);
+  OldGFTextLine (240,  50,   0, &quot;End Peace(allies)&quot;);
+  OldGFTextLine (160,  70, 900, &quot;Guild Master: &quot; + gm[1]);
+  OldGFTextLine (140,  90,   0, &quot;Guild Name&quot;);
+  /*var cancel :=*/ OldGFButtonID(240, 426, 5200, 5201, 1);
+  var ok     := OldGFButtonID(350, 426, 5042, 5043, 1);
+  OldGFPage(pc);
+  pc := pc + 1;
+  var rg := 1;
+  OldGFSetRadioGroup(rg);
+  //var orderguilds := GetGlobalProperty(&quot;OrderGuilds&quot;); // uncomment if needed
+  //var chaosguilds := GetGlobalProperty(&quot;ChaosGuilds&quot;); // uncomment if needed
+  foreach gstatus in ListGuilds()
+    if((VirtueChecking(guild, gstatus)) and (guild.isallyguild(gstatus)) and (guild.guildid != gstatus.guildid))
+      count := count + 1;
+      if(count &gt; 13)
+        count := 1;
+        rc := 120;
+        OldGFButtonPage(315, 393, 5540, 5541, pc);
+        if(pc &gt; 2)
+          OldGFButtonPage(275, 393, 5537, 5538, (pc - 2));
+        endif
+        OldGFPage(pc);
+        rg := rg + 1;
+        OldGFSetRadioGroup(rg);
+        pc := pc + 1;
+      endif
+      OldGFTextLine(175, rc, 300, gstatus.getprop(&quot;guildname&quot;) + &quot; [&quot; + gstatus.getprop(&quot;guildabv&quot;) + &quot;]&quot;);
+      OldGFRadioButton(150, rc, 210, 211, 0, gstatus.guildid);
+      rc := rc + 20;
+    endif
+  endforeach
+  var choose:=0;
+  var box := OldGFSendGump(who);
+  if(box[ok.keyid])
+    foreach k in(box.keys)
+      if(k &gt; 1)
+        choose := k;
+        break;
+      endif
+    endforeach
+  else
+    SendSysMessage(who, &quot;Cancelled.&quot;, 3, 40);
+    sleep(2);
+    gm_menu(who);
+    return;
+  endif
+  if((!choose) || (choose == 0))
+    SendSysMessage(who, &quot;Cancelled.&quot;, 3, 40);
+    sleep(2);
+    gm_menu(who);
+    return;
+  endif
+  box := FindGuild(choose);
+  var ev := struct;
+  ev.+type  := &quot;removeally&quot;;
+  ev.+who   := who;
+  ev.+guild := guild;
+  ev.+enemy := box;
+  stonemanager.SendEvent(ev);
+endfunction
+
+function setenemies(who)
+  var count := 0;
+  var rc := 120;
+  var pc := 0;
+  OldGFInitGump();
+  OldGFPage(pc);
+  pc := pc + 1;
+  OldGFResizePic(110,  25, 5120,  470, 470);
+  OldGFResizePic(120,  35, 5054,  450, 450);
+  OldGFResizePic(133, 415, 5120,  420,  45);
+  OldGFResizePic(137, 420, 5100,  410,  35);
+  OldGFResizePic(140, 110, 2620,  410, 280);
+  OldGFTextLine (240,  50,   0, &quot;Delcare War(Enemies)&quot;);
+  OldGFTextLine (160,  70, 900, &quot;Guild Master: &quot; + gm[1]);
+  OldGFTextLine (140,  90,   0, &quot;Guild Name&quot;);
+  /*var cancel :=*/ OldGFButtonID(240, 426, 5200, 5201, 1);
+  var ok     := OldGFButtonID(350, 426, 5042, 5043, 1);
+  OldGFPage(pc);
+  pc := pc + 1;
+  var rg := 1;
+  OldGFSetRadioGroup(rg);
+  //var orderguilds := GetGlobalProperty(&quot;OrderGuilds&quot;); // uncomment if needed
+  //var chaosguilds := GetGlobalProperty(&quot;ChaosGuilds&quot;); // uncomment if needed
+  foreach gstatus in ListGuilds()
+    if((VirtueChecking(guild, gstatus)) and (!guild.isallyguild(gstatus)) and (guild.guildid != gstatus.guildid) and (!guild.isenemyguild(gstatus)) and (guildstone.Pending(guild, gstatus, &quot;RA&quot;)))
+      count := count + 1;
+      if(count &gt; 13)
+        count := 1;
+        rc := 120;
+        OldGFButtonPage(315, 393, 5540, 5541, pc);
+        if(pc &gt; 2)
+          OldGFButtonPage(275, 393, 5537, 5538, (pc - 2));
+        endif
+        OldGFPage(pc);
+        OldGFSetRadioGroup(rg);
+        pc := pc + 1;
+        rg := rg + 1;
+        OldGFSetRadioGroup(rg);
+      endif
+      OldGFTextLine(175, rc, 300, gstatus.getprop(&quot;guildname&quot;) + &quot; [&quot; + gstatus.getprop(&quot;guildabv&quot;) + &quot;]&quot;);
+      OldGFRadioButton(150, rc, 210, 211, 0, gstatus.guildid);
+      rc := rc + 20;
+    endif
+  endforeach
+  var choose:=0;
+  var box := OldGFSendGump(who);
+  if(box[ok.keyid])
+    foreach k in(box.keys)
+      if(k &gt; 1)
+        choose := k;
+        break;
+      endif
+    endforeach
+  else
+    SendSysMessage(who, &quot;Cancelled.&quot;, 3, 40);
+    sleep(2);
+    gm_menu(who);
+    return;
+  endif
+  if(!choose || choose==0)
+    SendSysMessage(who, &quot;Cancelled.&quot;, 3, 40);
+    sleep(2);
+    gm_menu(who);
+    return;
+  endif
+  box := FindGuild(choose);
+  var ev := struct;
+  ev.+type  := &quot;declarewar&quot;;
+  ev.+who   := who;
+  ev.+guild := guild;
+  ev.+enemy := box;
+  stonemanager.SendEvent(ev);
+endfunction
+
+function remenemies(who)
+  var count := 0;
+  var rc := 120;
+  var pc := 0;
+  OldGFInitGump();
+  OldGFPage(pc);
+  pc := pc + 1;
+  OldGFResizePic(110,  25, 5120,  470, 470);
+  OldGFResizePic(120,  35, 5054,  450, 450);
+  OldGFResizePic(133, 415, 5120,  420,  45);
+  OldGFResizePic(137, 420, 5100,  410,  35);
+  OldGFResizePic(140, 110, 2620,  410, 280);
+  OldGFTextLine (240,  50,   0, &quot;End War: (remove enemies)&quot;);
+  OldGFTextLine (160,  70, 900, &quot;Guild Master: &quot; + gm[1]);
+  OldGFTextLine (140,  90,   0, &quot;Guild Name&quot;);
+  /*var cancel :=*/ OldGFButtonID(240, 426, 5200, 5201, 1);
+  var ok     := OldGFButtonID(350, 426, 5042, 5043, 1);
+  OldGFPage(pc);
+  pc := pc + 1;
+  var rg := 1;
+  OldGFSetRadioGroup(rg);
+  //var orderguilds := GetGlobalProperty(&quot;OrderGuilds&quot;); // uncomment if needed
+  //var chaosguilds := GetGlobalProperty(&quot;ChaosGuilds&quot;); // uncomment if needed
+  foreach gstatus in ListGuilds()
+    if((VirtueChecking(guild, gstatus)) and (guild.isenemyguild(gstatus)) and (guild.guildid != gstatus.guildid))
+      count := count + 1;
+      if(count &gt; 13)
+        count := 1;
+        rc := 120;
+        OldGFButtonPage(315, 393, 5540, 5541, pc);
+        if(pc &gt; 2)
+          OldGFButtonPage(275, 393, 5537, 5538, (pc - 2));
+        endif
+        OldGFPage(pc);
+        rg := rg + 1;
+        OldGFSetRadioGroup(rg);
+        pc := pc + 1;
+      endif
+      OldGFTextLine(175, rc, 300, gstatus.getprop(&quot;guildname&quot;) + &quot; [&quot; + gstatus.getprop(&quot;guildabv&quot;) + &quot;]&quot;);
+      OldGFRadioButton(150, rc, 210, 211, 0, gstatus.guildid);
+      rc := rc + 20;
+    endif
+  endforeach
+  var choose:=0;
+  var box := OldGFSendGump(who);
+  if(box[ok.keyid])
+    foreach k in(box.keys)
+      if(k &gt; 1)
+        choose := k;
+        break;
+      endif
+    endforeach
+  else
+    SendSysMessage(who, &quot;Cancelled.&quot;, 3, 40);
+    sleep(2);
+    gm_menu(who);
+    return;
+  endif
+  if((!choose) || (choose == 0))
+    SendSysMessage(who, &quot;Cancelled.&quot;, 3, 40);
+    sleep(2);
+    gm_menu(who);
+    return;
+  endif
+  box := FindGuild(choose);
+  var ev := struct;
+  ev.+type  := &quot;removeenemy&quot;;
+  ev.+who   := who;
+  ev.+guild := guild;
+  ev.+enemy := box;
+  stonemanager.SendEvent(ev);
+endfunction
+
+function yourallies(who)
+  var count := 0;
+  var rc := 120;
+  var pc := 0;
+  OldGFInitGump();
+  OldGFPage(pc);
+  pc := pc + 1;
+  OldGFResizePic(110,  25, 5120,  470, 470);
+  OldGFResizePic(120,  35, 5054,  450, 450);
+  OldGFResizePic(133, 415, 5120,  420,  45);
+  OldGFResizePic(137, 420, 5100,  410,  35);
+  OldGFResizePic(140, 110, 2620,  410, 280);
+  OldGFTextLine (240,  50,   0, &quot;Guild Ally Status Page&quot;);
+  OldGFTextLine (160,  70, 900, &quot;Guild Master: &quot; + gm[1]);
+  OldGFTextLine (140,  90,   0, &quot;Guild Listing&quot;);
+  var ok := OldGFButtonID (285, 425, 5042, 5043, 1);
+  var total := 0;
+  //var orderguilds := GetGlobalProperty(&quot;OrderGuilds&quot;); // uncomment if needed
+  //var chaosguilds := GetGlobalProperty(&quot;ChaosGuilds&quot;); // uncomment if needed
+  foreach gstatus in (guild.getprop(&quot;guildallies&quot;))
+    var enemy := FindGuild(gstatus);
+    if((enemy) and (VirtueChecking(guild, enemy)))
+      count := count + 1;
+      if(count &gt; 13)
+        count := 1;
+        rc := 120;
+        OldGFButtonPage(315, 396, 5540, 5541, pc);
+        if(pc &gt; 2)
+          OldGFButtonPage(275, 396, 5537, 5538, (pc - 2));
+        endif
+        OldGFPage(pc);
+        pc := pc + 1;
+      endif
+      OldGFTextLine(150, rc, 300, enemy.GetProp(&quot;guildname&quot;) + &quot;  &quot; + enemy.GetProp(&quot;guildabv&quot;));
+      rc := rc + 20;
+      total := total + 1;
+    endif
+  endforeach
+  if(total == 0)
+    OldGFTextLine(150, rc, 300, &quot;No Current Requests&quot;);
+  endif
+  OldGFTextLine (340,  90,   0, &quot;total requests: &quot; + total);
+  var res := OldGFSendGump(who);
+  if(res[ok.keyid]);
+    buildgump(who);
+  endif
+endfunction
+
+function yourenemies(who)
+  var count := 0;
+  var rc := 120;
+  var pc := 0;
+  OldGFInitGump();
+  OldGFPage(pc);
+  pc := pc + 1;
+  OldGFResizePic(110,  25, 5120,  470, 470);
+  OldGFResizePic(120,  35, 5054,  450, 450);
+  OldGFResizePic(133, 415, 5120,  420,  45);
+  OldGFResizePic(137, 420, 5100,  410,  35);
+  OldGFResizePic(140, 110, 2620,  410, 280);
+  OldGFTextLine (240,  50,   0, &quot;Guild Enemy Status Page&quot;);
+  OldGFTextLine (160,  70, 900, &quot;Guild Master: &quot; + gm[1]);
+  OldGFTextLine (140,  90,   0, &quot;Guild Listing&quot;);
+  var ok := OldGFButtonID (285, 425, 5042, 5043, 1);
+  var total := 0;
+  //var orderguilds := GetGlobalProperty(&quot;OrderGuilds&quot;); // uncomment if needed
+  //var chaosguilds := GetGlobalProperty(&quot;ChaosGuilds&quot;); // uncomment if needed
+  foreach gstatus in (guild.getprop(&quot;guildenemies&quot;))
+    var enemy := FindGuild(gstatus);
+    if((enemy) and (VirtueChecking(guild, enemy)))
+      count := count + 1;
+      if(count &gt; 13)
+        count := 1;
+        rc := 120;
+        OldGFButtonPage(315, 396, 5540, 5541, pc);
+        if(pc &gt; 2)
+          OldGFButtonPage(275, 396, 5537, 5538, (pc - 2));
+        endif
+        OldGFPage(pc);
+        pc := pc + 1;
+      endif
+      OldGFTextLine(150, rc, 300, enemy.GetProp(&quot;guildname&quot;) + &quot;  &quot; + enemy.GetProp(&quot;guildabv&quot;));
+      rc := rc + 20;
+      total := total + 1;
+    endif
+  endforeach
+  if(total == 0)
+    OldGFTextLine(150, rc, 300, &quot;No Current Requests&quot;);
+  endif
+  OldGFTextLine (340,  90,   0, &quot;total requests: &quot; + total);
+  var res := OldGFSendGump(who);
+  if(res[ok.keyid]);
+    buildgump(who);
+  endif
+endfunction
+
+function viewstatus(who)
+  var count := 0;
+  var rc := 120;
+  var pc := 0;
+  OldGFInitGump();
+  OldGFPage(pc);
+  pc := pc + 1;
+  OldGFResizePic(110,  25, 5120,  470, 470);
+  OldGFResizePic(120,  35, 5054,  450, 450);
+  OldGFResizePic(133, 415, 5120,  420,  45);
+  OldGFResizePic(137, 420, 5100,  410,  35);
+  OldGFResizePic(140, 110, 2620,  410, 280);
+  OldGFTextLine (240,  50,   0, &quot;Guild Relation Status Page&quot;);
+  OldGFTextLine (160,  70, 900, &quot;Guild Master: &quot; + gm[1]);
+  OldGFTextLine (140,  90,   0, &quot;Guild Listing&quot;);
+  var ok := OldGFButtonID (285, 425, 5042, 5043, 1);
+  var total := 0;
+  //var orderguilds := GetGlobalProperty(&quot;OrderGuilds&quot;); // uncomment if needed
+  //var chaosguilds := GetGlobalProperty(&quot;ChaosGuilds&quot;); // uncomment if needed
+  foreach gstatus in (guild.getprop(&quot;GuildDeclareStatus&quot;))
+    var chk := gstatus[1];
+    if(chk == guild.guildid)
+      chk := gstatus[2];
+    endif
+    chk := FindGuild(chk);
+    if(chk)
+      if(VirtueChecking(guild, chk))
+        count := count + 1;
+        if(count &gt; 13)
+          count := 1;
+          rc := 120;
+          OldGFButtonPage(315, 396, 5540, 5541, pc);
+          if(pc &gt; 2)
+            OldGFButtonPage(275, 396, 5537, 5538, (pc - 2));
+          endif
+          OldGFPage(pc);
+          pc := pc + 1;
+        endif
+        var gname := chk.GetProp(&quot;guildname&quot;);
+        if(gstatus[3] == &quot;RA&quot;)
+          OldGFTextLine(150, rc, 300, gname + &quot; (pending alliance)&quot;);
+        elseif(gstatus[3] == &quot;RE&quot;)
+          OldGFTextLine(150, rc, 300, gname + &quot; (pending war)&quot;);
+        endif
+        rc := rc + 20;
+        total := total + 1;
+      endif
+    endif
+  endforeach
+  if(total == 0)
+    OldGFTextLine(150, rc, 300, &quot;No Current Requests&quot;);
+  endif
+  OldGFTextLine (340,  90,   0, &quot;total requests: &quot; + total);
+  var res := OldGFSendGump(who);
+  if(res[ok.keyid]);
+    buildgump(who);
+  endif
+endfunction
+
+function VirtueChecking(guild, enemy)
+  var type := guild.getprop(&quot;type&quot;);
+  var ret := 1;
+  if(type != &quot;Standard&quot;)
+    var holder := enemy.getprop(&quot;type&quot;);
+    if(holder != &quot;Standard&quot;)
+      ret := 0;;
+    endif
+  endif
+  return ret;
+endfunction
+
+function SetGuildName(who)
+  if(ReadGameClock() &lt; guild.getprop(&quot;nametime&quot;))
+    SendSysMessage(who, &quot;You can only change the guild name once a week.&quot;, 3, 40);
+    sleep(2);
+    return;
+  endif
+  var tname := SendTextEntryGump(who, &quot;What is the guild name?&quot;,0,1,MAX_GUILD_NAME_SIZE, &quot;Type the new name.&quot;);
+  if(!tname)
+    return;
+  elseif(len(tname) &gt; MAX_GUILD_NAME_SIZE)
+    SendSysMessage(who, &quot;Guild name can not have more than &quot; + MAX_GUILD_NAME_SIZE + &quot; characters.&quot;, 3, 40);
+    sleep(2);
+    return;
+  endif
+  if(!guildstone.Name_Validation(tname))
+    PrintTextAbovePrivate(guildstone, &quot;That guild name is already taken.&quot;,who);
+    sleep(2);
+    return;
+  elseif(!guildstone.Character_Validation(tname))
+    SendSysMessage(who, &quot;You are using invalid characters.&quot;, 3, 40);
+    sleep(2);
+    return;
+  endif
+  guildstone.name := &quot;Guildstone for &quot;+tname;
+  guild.setprop(&quot;guildname&quot;, tname);
+  guild.setprop(&quot;nametime&quot;, ReadGameClock()+(7*24*3600));
+  var ev      := struct;
+  ev.+status  := 1;
+  ev.+message := &quot;Guild name changed to: &quot; + tname + &quot;.&quot;;
+  guildstone.guildchat(ev, guild);
+  sleep(2);
+endfunction
+
+function SetAbrevName(who)
+  if(ReadGameClock() &lt; guild.getprop(&quot;abrvtime&quot;))
+    SendSysMessage(who, &quot;You can only change the guild abbreviation once a week.&quot;, 3, 40);
+    sleep(2);
+    return;
+  endif
+  var tname:=SendTextEntryGump(who, &quot;What's the new guild's abbreviation?&quot;,0,1,MAX_GUILD_ABREV_SIZE, &quot;Type the abrev&quot;);
+  if(!tname)
+    return;
+  elseif(len(tname)&gt;MAX_GUILD_ABREV_SIZE)
+    SendSysMessage(who, &quot;Abbreviation can't have more than &quot;+MAX_GUILD_ABREV_SIZE+&quot; characters.&quot;, 3, 40);
+    sleep(2);
+    return;
+  endif
+  if(!guildstone.Abreviation_Validation(tname))
+    PrintTextAbovePrivate(guildstone, &quot;That abbreviation is already taken.&quot;,who);
+    sleep(2);
+    return;
+  elseif(!guildstone.Character_Validation(tname))
+    SendSysMessage(who, &quot;You are using invalid characters.&quot;, 3, 40);
+    sleep(2);
+    return;
+  endif
+  guild.setprop(&quot;guildabv&quot;, tname);
+  guild.setprop(&quot;abrvtime&quot;, ReadGameClock()+(7*24*3600));
+  foreach member in (guild.members)
+    var abv := GetObjProperty(member, &quot;abv&quot;);
+    if(!abv)
+      SetObjProperty(member, &quot;abv&quot;, 1);
+    else
+      SetObjProperty(member, &quot;abv&quot;, &quot;0&quot;);
+    endif
+    guildstone.Toggle_Showing(who, guild);
+  endforeach
+  var ev      := struct;
+  ev.+status  := 1;
+  ev.+message := &quot;Guild abbreviation changed to: [&quot; + tname + &quot;].&quot;;
+  guildstone.guildchat(ev, guild);
+  sleep(2);
+endfunction
+
+function setcharter(who)
+  SetNotes(guild);
+  var box := OldGFSendGump(who);
+  if(box[0]!=2)
+    SendSysMessage(who, &quot;Canceled.&quot;, 3, 40);
+    sleep(2);
+    return;
+  endif
+  var subnote, message:= {};
+  foreach thing in (box.keys)
+    if(thing == 525)
+      subnote := box[thing];
+      subnote[1, find(subnote, &quot;: &quot;, 1)+1] := &quot;&quot;;
+      if(subnote != &quot;&quot;)
+        guild.setprop(&quot;webpage&quot;, subnote);
+      endif
+    elseif((thing != 0) and (thing != 2))
+      subnote := box[thing];
+      subnote[1, find(subnote, &quot;: &quot;, 1)+1] := &quot;&quot;;
+      if(subnote != &quot;&quot;)
+        message.append(subnote + &quot; &quot;);
+      endif
+    endif
+  endforeach
+  guild.setprop(&quot;gc&quot;, message);
+  SendSysMessage(who, &quot;Charter saved.&quot;, 3,70);
+endfunction
+
+function SetNotes(guild)
+  OldGFInitGump();
+  OldGFPage(0);
+  OldGFResizePic( 20,   0, 5120, 560, 340);
+  OldGFResizePic( 30,  30, 2620, 540, 260);
+  OldGFResizePic( 30, 300, 5054, 540,  30);
+  OldGFTextLine ( 30,  5,  910, &quot;Input your Guild Charter:&quot;);
+  OldGFTextLine (400,  5,  910, &quot;Save Charter:&quot;);
+  OldGFButtonID(508, 5, 4011, 4013, 1, 2);
+  var i;
+  var message := guild.getprop(&quot;gc&quot;);
+  var y := 40;
+  if(message[1] == &quot;NONE&quot;)
+    for(i:=3; i&lt;=14; i:=i+1)
+      OldGFTextEntry(40, y, 500, 20, 910, &quot;&quot;);
+      y := y + 20;
+    endfor
+  else
+    for(i:=3; i&lt;=14; i:=i+1)
+      if(message[i-2] != error)
+        OldGFTextEntry(40, y, 500, 20, 910, message[i-2]);
+      else
+        OldGFTextEntry(40, y, 500, 20, 910, &quot;&quot;);
+      endif
+      y := y + 20;
+    endfor
+  endif
+  OldGFTextLine( 40, 305, 0, &quot;Guild Web Page:&quot;);
+  var wp := guild.getprop(&quot;webpage&quot;);
+  OldGFTextEntry(170, 305, 400, 30, 900, wp);
+endfunction
+
+function setstonecolor(who)
+  var i,textline,maxcolor:=52,firstrow:=20,secondrow:=40,newcolor:=0;
+  var res:=SendDialogGump(who,dyelayout,dyedata);
+  var basecolor:=res[0];
+  if(!basecolor)
+    SendSysMessage(who, &quot;Canceled.&quot;, 3, 40);
+    return;
+  elseif(basecolor==1101)
+    maxcolor:=47;
+  elseif(basecolor==2000)
+    maxcolor:=18;
+    firstrow:=18;
+    secondrow:=18;
+  endif
+  if(basecolor==1)
+    newcolor:=0;
+  else
+    for(i:=1;i&lt;=firstrow;i:=i+1)
+      textline:=&quot;button 20 &quot;+CStr(65+(20*i)) + &quot; 2104 2103 1 0 &quot;+CStr(basecolor+i);
+      dyelayout2[CInt(len(dyelayout2)+1)]:=textline;
+    endfor
+    for(i:=21;i&lt;=secondrow;i:=i+1)
+      textline:=&quot;button 100 &quot;+CStr(65+(20*(i-20))) + &quot; 2104 2103 1 0 &quot;+CStr(basecolor+i);
+      dyelayout2[CInt(len(dyelayout2)+1)]:=textline;
+    endfor
+    for(i:=41;i&lt;=maxcolor;i:=i+1)
+      textline:=&quot;button 180 &quot;+CStr(65+(20*(i-40))) + &quot; 2104 2103 1 0 &quot;+CStr(basecolor+i);
+      dyelayout2[CInt(len(dyelayout2)+1)]:=textline;
+    endfor
+    basecolor:=basecolor-1;
+    for(i:=1;i&lt;=firstrow;i:=i+1)
+      textline:=&quot;text 40 &quot;+CStr(60+(20*i)) + &quot; &quot;+CStr(basecolor+i) + &quot; &quot;+CStr(i);
+      dyelayout2[CInt(len(dyelayout2)+1)]:=textline;
+    endfor
+    for(i:=21;i&lt;= secondrow;i:=i+1)
+      textline:=&quot;text 120 &quot;+CStr(60+(20*(i-20))) + &quot; &quot;+CStr(basecolor+i) + &quot; &quot;+CStr(i);
+      dyelayout2[CInt(len(dyelayout2)+1)]:=textline;
+    endfor
+    for(i:=41;i&lt;= maxcolor;i:=i+1)
+      textline:=&quot;text 200 &quot;+CStr(60+(20*(i-40))) + &quot; &quot;+CStr(basecolor + i) + &quot; &quot;+CStr(i);
+      dyelayout2[CInt(len(dyelayout2)+1)]:=textline;
+    endfor
+    dyelayout2[len(dyelayout2)+1]:=&quot;button 220 440 2119 2120 1 0 0&quot;;
+    res:=SendDialogGump(who,dyelayout2,dyedata2);
+    newcolor:=res[0];
+    if(!newcolor)
+      SendSysMessage(who, &quot;Canceled.&quot;, 3, 40);
+      return;
+    endif
+  endif
+  guildstone.color:=newcolor;
+endfunction
+
+function Teleport(who)
+  if(ReadGameClock()&lt;guild.getprop(&quot;movetime&quot;))
+    SendSysMessage(who, &quot;The guild stone can only be moved once a week.&quot;, 3, 40);
+    return;
+  endif
+  guild.setprop(&quot;movetime&quot;, ReadGameClock() + (7*24*3600));
+  guildstone.movable := 1;
+  guildstone.newbie := 1;
+  MoveItemToContainer(guildstone, who.backpack);
+  guildstone.graphic := UOBJ_PACKED_GUIDSTONE_GRAPHIC;
+  guildstone.usescript := &quot;:guildstone:guildMove&quot;;
+  SendSysMessage(who, &quot;Double click on the stone in your backpack to place the stone.&quot;, 3, 70);
+endfunction
+
+function AcceptCandidate(who)
+  var count := 0;
+  var rc := 120;
+  var pc := 0;
+  OldGFInitGump();
+  OldGFPage(pc);
+  pc := pc + 1;
+  OldGFResizePic(110,  25, 5120,  470, 470);
+  OldGFResizePic(120,  35, 5054,  450, 450);
+  OldGFResizePic(133, 415, 5120,  420,  45);
+  OldGFResizePic(137, 420, 5100,  410,  35);
+  OldGFResizePic(140, 110, 2620,  410, 280);
+  OldGFTextLine (240,  50,   0, &quot;Guild Recruit Acceptance Page&quot;);
+  OldGFTextLine (160,  70, 900, &quot;Guild Master: &quot; + gm[1]);
+  OldGFTextLine (140,  90,   0, &quot;Recruit Listing&quot;);
+  var ok := OldGFButtonID (285, 425, 5042, 5043, 1);
+  var total := 0;
+  var rg := 1;
+  OldGFSetRadioGroup(rg);
+  foreach gstatus in (guild.getprop(&quot;recruits&quot;))
+    var enemy := SystemFindObjectBySerial(gstatus, SYSFIND_SEARCH_OFFLINE_MOBILES);
+    if(enemy)
+      count := count + 1;
+      if(count &gt; 13)
+        count := 1;
+        rc := 120;
+        OldGFButtonPage(315, 396, 5540, 5541, pc);
+        if(pc &gt; 2)
+          OldGFButtonPage(275, 396, 5537, 5538, (pc - 2));
+        endif
+        OldGFPage(pc);
+        pc := pc + 1;
+        rg := rg + 1;
+        OldGFSetRadioGroup(rg);
+      endif
+      OldGFTextLine(175, rc, 300, enemy.name);
+      OldGFRadioButton(150, rc, 210, 211, 0, enemy.serial);
+      rc := rc + 20;
+      total := total + 1;
+    endif
+  endforeach
+  if(total == 0)
+    OldGFTextLine(150, rc, 300, &quot;No Current Recruits&quot;);
+  endif
+  OldGFTextLine (340,  90,   0, &quot;total recruits: &quot; + total);
+  var res := OldGFSendGump(who);
+  if(res[ok.keyid]);
+    if(total == 0)
+      sleep(2);
+      return;
+    endif
+    var choose := 0;
+    foreach k in (res.keys)
+      if((k &gt;= 1) and (k != ok.keyid))
+        choose := SystemFindObjectBySerial(k, SYSFIND_SEARCH_OFFLINE_MOBILES);
+      endif
+    endforeach
+    if(choose)
+      if(GetObjProperty(choose, &quot;guild_id&quot;))
+        SendSysMessage(who, choose.name + &quot; is already in a guild.&quot;, 3, 40);
+      else
+        SendSysMessage(choose, &quot;You have been accepted to the guild &quot; + guild.getprop(&quot;guildname&quot;) + &quot;.&quot;);
+        guild.addmember(choose);
+        SetObjProperty(choose, &quot;guild_id&quot;, guild_id);
+        SetObjProperty(choose, &quot;fealty&quot;, gm[2]);
+        SetObjProperty(choose, &quot;abv&quot;, &quot;0&quot;);
+        guildstone.Toggle_Showing(choose, guild);
+        choose.title_suffix := &quot;&quot;;
+        var ev := struct;
+        ev.+status := 1;
+        ev.+message := choose.name + &quot; has joined the guild.&quot;;
+        guildstone.guildchat(ev, guild);
+      endif
+    endif
+    var holder := {};
+    foreach person in (guild.getprop(&quot;recruits&quot;))
+      if(person != choose.serial)
+        holder.append(person);
+      endif
+    endforeach
+    guild.setprop(&quot;recruits&quot;, holder);
+  endif
+endfunction
+
+function RefuseCandidate(who)
+  var count := 0;
+  var rc := 120;
+  var pc := 0;
+  OldGFInitGump();
+  OldGFPage(pc);
+  pc := pc + 1;
+  OldGFResizePic(110,  25, 5120,  470, 470);
+  OldGFResizePic(120,  35, 5054,  450, 450);
+  OldGFResizePic(133, 415, 5120,  420,  45);
+  OldGFResizePic(137, 420, 5100,  410,  35);
+  OldGFResizePic(140, 110, 2620,  410, 280);
+  OldGFTextLine (240,  50,   0, &quot;Guild Recruit Rejection Page&quot;);
+  OldGFTextLine (160,  70, 900, &quot;Guild Master: &quot; + gm[1]);
+  OldGFTextLine (140,  90,   0, &quot;Recruit Listing&quot;);
+  var ok := OldGFButtonID (285, 425, 5042, 5043, 1);
+  var total := 0;
+  var rg := 1;
+  OldGFSetRadioGroup(rg);
+  foreach gstatus in (guild.getprop(&quot;recruits&quot;))
+    var enemy := SystemFindObjectBySerial(gstatus, SYSFIND_SEARCH_OFFLINE_MOBILES);
+    if(enemy)
+      count := count + 1;
+      if(count &gt; 13)
+        count := 1;
+        rc := 120;
+        OldGFButtonPage(315, 396, 5540, 5541, pc);
+        if(pc &gt; 2)
+          OldGFButtonPage(275, 396, 5537, 5538, (pc - 2));
+        endif
+        OldGFPage(pc);
+        pc := pc + 1;
+        rg := rg + 1;
+        OldGFSetRadioGroup(rg);
+      endif
+      OldGFTextLine(175, rc, 300, enemy.name);
+      OldGFRadioButton(150, rc, 210, 211, 0, enemy.serial);
+      rc := rc + 20;
+      total := total + 1;
+    endif
+  endforeach
+  if(total == 0)
+    OldGFTextLine(150, rc, 300, &quot;No Current Recruits&quot;);
+  endif
+  OldGFTextLine (340,  90,   0, &quot;total recruits: &quot; + total);
+  var res := OldGFSendGump(who);
+  if(res[ok.keyid]);
+    if(total == 0)
+      sleep(2);
+      return;
+    endif
+    var choose := 0;
+    foreach k in (res.keys)
+      if((k &gt;= 1) and (k != ok.keyid))
+        choose := SystemFindObjectBySerial(k, SYSFIND_SEARCH_OFFLINE_MOBILES);
+      endif
+    endforeach
+    if(choose)
+      SendSysMessage(choose, &quot;You have been denied entry to the guild &quot; + guild.getprop(&quot;guildname&quot;) + &quot;.&quot;);
+      var holder := {};
+      foreach person in (guild.getprop(&quot;recruits&quot;))
+        if(person != choose.serial)
+          holder.append(person);
+        endif
+      endforeach
+      guild.setprop(&quot;recruits&quot;, holder);
+      var ev := struct;
+      ev.+status := 1;
+      ev.+message := choose.name + &quot; has been denied access to the guild.&quot;;
+      guildstone.guildchat(ev, guild);
+    endif
+  endif
+endfunction
+
+function SetGMTitle(who)
+  var tname := SendTextEntryGump(who, &quot;What's the new guildmaster title name?&quot;,0,1,MAX_GM_TITLE_SIZE, &quot;Type the name&quot;);
+  if(!tname)
+    return;
+  endif
+  if(len(tname)&gt;MAX_GM_TITLE_SIZE)
+    SendSysMessage(who, &quot;Your title can't have more than &quot; + MAX_GM_TITLE_SIZE + &quot; characters.&quot;, 3, 40);
+    sleep(2);
+    return;
+  endif
+  if(!guildstone.Character_Validation(tname))
+    SendSysMessage(who, &quot;You are using invalid characters.&quot;, 3, 40);
+    sleep(2);
+    return;
+  endif
+  var abv := &quot;[&quot; + guild.getprop(&quot;guildabv&quot;) + &quot;]&quot;;
+  SetObjProperty(gm[3], &quot;guildtitle&quot;, tname);
+  gm[3].title_guild := tname + &quot;, &quot; + abv;
+  SetObjProperty(who, &quot;abv&quot;, &quot;1&quot;);
+endfunction
+
+function GrantTitle(who)
+  var guildmembers := guild.members;
+  var count := 0;
+  var rc := 120;
+  var pc := 0;
+  OldGFInitGump();
+  OldGFPage(pc);
+  pc := pc + 1;
+  OldGFResizePic(110,  25, 5120,  470, 470);
+  OldGFResizePic(120,  35, 5054,  450, 450);
+  OldGFResizePic(133, 415, 5120,  420,  45);
+  OldGFResizePic(137, 420, 5100,  410,  35);
+  OldGFResizePic(140, 110, 2620,  410, 280);
+  OldGFTextLine (240,  50,   0, &quot;Declare Fealty&quot;);
+  OldGFTextLine (160,  70, 900, &quot;Guild Master: &quot; + gm[1]);
+  OldGFTextLine (140,  90,   0, &quot;Member Name&quot;);
+  /*var cancel :=*/ OldGFButtonID(240, 426, 5200, 5201, 1);
+  var ok     := OldGFButtonID(350, 426, 5042, 5043, 1);
+  OldGFPage(pc);
+  pc := pc + 1;
+  var rg := 1;
+  OldGFSetRadioGroup(rg);
+  rg := rg + 1;
+  foreach member in guildmembers
+    if(member != gm[3])
+      count := count + 1;
+      if(count &gt; 13)
+        count := 1;
+        rc := 120;
+        OldGFButtonPage(315, 393, 5540, 5541, pc);
+        if(pc &gt; 2)
+          OldGFButtonPage(275, 393, 5537, 5538, (pc - 2));
+        endif
+        OldGFPage(pc);
+        pc := pc + 1;
+        rg := rg + 1;
+        OldGFSetRadioGroup(rg);
+      endif
+      OldGFRadioButton(150, rc + 2, 2103, 2104, 0, member.serial);
+      OldGFTextLine(185, rc, 940, member.name);
+      count := count + 1;
+      rc := rc + 20;
+    endif
+  endforeach
+  if(count == 0)
+    OldGFTextLine(150, rc, 300, &quot;No Current Members&quot;);
+  endif
+  var choose;
+  var box := OldGFSendGump(who);
+  if(count == 0)
+    return;
+  endif
+  if(box[ok.keyid])
+    foreach k in(box.keys)
+      if((k != ok.keyid) and (k != 0))
+        choose := k;
+        break;
+      endif
+    endforeach
+    var tname := SendTextEntryGump(who, &quot;What's the new member title?&quot; , 0, 1, MAX_GUILD_TITLE_SIZE, &quot;Type the title&quot;);
+    if(!tname)
+      SendSysMessage(who, &quot;Cancelled.&quot;, 3, 40);
+      sleep(2);
+      return;
+    elseif(len(tname) &gt; MAX_GUILD_TITLE_SIZE)
+      SendSysMessage(who, &quot;Your title can't have more than &quot;+MAX_GUILD_TITLE_SIZE+&quot; characters.&quot;, 3, 40);
+      sleep(2);
+      return;
+    endif
+    if(!guildstone.Character_Validation(tname))
+      SendSysMessage(who, &quot;You are using invalid characters.&quot;, 3, 40);
+      sleep(2);
+      return;
+    endif
+    foreach member in (guild.members)
+      if(member.serial == choose)
+        var abv := &quot;[&quot; + guild.getprop(&quot;guildabv&quot;) + &quot;]&quot;;
+        SetObjProperty(member, &quot;guildtitle&quot;, tname);
+        member.title_guild := tname + &quot;, &quot; + abv;
+        SetObjProperty(who, &quot;abv&quot;, &quot;1&quot;);
+        break;
+      endif
+    endforeach
+    sleep(2);
+    return;
+  else
+    SendSysMessage(who, &quot;Cancelled&quot;, 3, 40);
+    sleep(2);
+    return;
+  endif
+endfunction
\ No newline at end of file

Added: trunk/096/pkg/OLD/items/guildstone/itemdesc.cfg
===================================================================
--- trunk/096/pkg/OLD/items/guildstone/itemdesc.cfg	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/guildstone/itemdesc.cfg	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,27 @@
+item 0xa390
+{
+    Name            guildstone
+    Desc            Guild Stone
+    weight          20
+    Graphic         0x0ED4
+    movable         0
+    script          guildStone
+    DestroyScript   guildDestroy
+    ControlScript	guildControl
+	MethodScript	guildMethods
+    decay           0
+    CProp	        guild_id i0
+}
+
+item 0xa391
+{
+    Name            guilddeed
+    Graphic         0x14EF
+    Desc            Guild Deed
+    weight          2
+    newbie          1
+    Script          guildDeed
+    VendorBuysFor   7500
+    VendorSellsFor  15000
+    Tooltip         A deed to a Guild Stone, double click it to create the guild.
+}

Added: trunk/096/pkg/OLD/items/guildstone/pkg.cfg
===================================================================
--- trunk/096/pkg/OLD/items/guildstone/pkg.cfg	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/guildstone/pkg.cfg	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,8 @@
+# $Id: pkg.cfg 684 2005-10-27 18:48:28Z muaddiblsd $
+#
+#
+Enabled		0
+Name		guildstone
+Maintainer	Distro Team
+Email		<A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">distro at polserver.com</A>
+Version		1.0
\ No newline at end of file

Added: trunk/096/pkg/OLD/items/lighting/change.src
===================================================================
--- trunk/096/pkg/OLD/items/lighting/change.src	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/lighting/change.src	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,31 @@
+//
+// created by Zulu  <A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">zuluhotel at home.com</A>
+// made Jan 15, 2000 - updated Jan 17, 2000
+//
+//   elem.change     #	(decimal)
+//   elem.changesnd  #	(decimal)
+//   elem.originsnd  #	(decimal)
+//   elem.staff	     #	(1-4)
+//
+
+use uo;
+use cfgfile;
+
+program change(who, item )
+  var cfg := ReadConfigFile(&quot;:*:itemdesc&quot;);
+  var elem := FindConfigElem(cfg, item.objtype);
+  if(elem.staff &gt; who.cmdlevel)
+    return;
+  endif
+  if(item.graphic == item.objtype)
+    if(elem.changesnd)
+      PlaySoundEffect(who, elem.changesnd);
+    endif
+    item.graphic := elem.change;
+  else
+    if(elem.originsnd)
+      PlaySoundEffect(who, elem.originsnd );
+    endif
+    item.graphic := item.objtype;
+  endif
+endprogram
\ No newline at end of file

Added: trunk/096/pkg/OLD/items/lighting/itemdesc.cfg
===================================================================
--- trunk/096/pkg/OLD/items/lighting/itemdesc.cfg	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/lighting/itemdesc.cfg	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,895 @@
+# $Id: itemdesc.cfg 684 2005-10-27 18:48:28Z muaddiblsd $
+#
+#
+#
+# created by Zulu  <A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">zuluhotel at home.com</A>
+# made Jan 15, 2000 - updated Jan 20, 2000
+#
+# thanks to Helldrige <A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">boum0 at frankiz.polytechnique.fr</A> for his updates
+#
+#   Cprop change     i#	(decimal)
+#   Cprop changesnd  i#	(decimal)
+#   Cprop originsnd  i#	(decimal)
+#   Cprop staff  i#		(1-4)
+#
+
+Item 0x0e2d
+{#unlit
+    Name Crystalball1
+    Script          change
+    Facing	        2
+    VendorSellsFor  30
+    VendorBuysFor   12
+    change	        3630
+    changesnd	    247
+}
+
+Item 0x0e2e
+{#lit
+    Name Crystalball2
+    Script change
+    Facing	2
+    VendorSellsFor  30
+    VendorBuysFor   12
+    change	3629
+    changesnd	247
+}
+
+Item 0x0f64
+{#unlit
+    Name Torch1
+    Script change
+    Facing	29
+    VendorSellsFor  7
+    VendorBuysFor   3
+    change	2578
+    changesnd	85
+    originsnd	72
+}
+
+Item 0x0a12
+{#lit
+    Name            Torch2
+    Script          change
+    Facing	        29
+    VendorSellsFor  7
+    VendorBuysFor   3
+    change	        3940
+    changesnd	    72
+    originsnd	    85
+}
+
+Item 0x0a0a
+{# wall unlit (n)
+    Name Torch3
+    Script change
+    Facing 5
+    movable 0
+    VendorSellsFor  30
+    VendorBuysFor   12
+    change	2572
+    changesnd	85
+    originsnd	72
+}
+
+Item 0x0a0c
+{#wall lit (n)
+    Name Torch4
+    Script change
+    Facing 5
+    movable 0
+    VendorSellsFor  30
+    VendorBuysFor   12
+    change	2570
+    changesnd	72
+    originsnd	85
+}
+
+Item 0x0a05
+{#wall unlit (w)
+    Name Torch5
+    Script change
+    Facing 8
+    movable 0
+    VendorSellsFor  30
+    VendorBuysFor   12
+    change	2565
+    changesnd	85
+    originsnd	72
+}
+
+Item 0x0a07
+{#wall lit (w)
+    Name Torch6
+    Script change
+    Facing 8
+    movable 0
+    VendorSellsFor  30
+    VendorBuysFor   12
+    change	2567
+    changesnd	72
+    originsnd	85
+}
+
+Item 0x0a02
+{#wall lit (n)
+    Name wallsconce1
+    Script change
+    Facing	11
+    movable 0
+    VendorSellsFor  40
+    VendorBuysFor   17
+    change	2560
+}
+
+Item 0x0a00
+{#wall unlit(n)
+    Name wallsconce2
+    Script change
+    Facing	11
+    movable 0
+    VendorSellsFor  40
+    VendorBuysFor   17
+    change	2562
+}
+
+Item 0x09fd
+{#wall lit (w)
+    Name wallsconce4
+    Script change
+    Facing	14
+    movable 0
+    VendorSellsFor  40
+    VendorBuysFor   17
+    change	2555
+}
+
+Item 0x09fb
+{#wall unlit(w)
+    Name wallsconce3
+    Script change
+    Facing	14
+    movable 0
+    VendorSellsFor  40
+    VendorBuysFor   17
+    change	2557
+}
+
+Item 0x0b20
+{
+    Name lamppost1
+    Script change
+    Facing 29
+    movable 0
+    change	2849
+    originsnd	72
+    staff		1
+}
+
+Item 0x0b21
+{
+    Name lamppost2
+    Script change
+    Facing 29
+    movable 0
+    change	2848
+    changesnd	72
+    staff		1
+}
+
+Item 0x0b22
+{
+    Name lamppost3
+    Script change
+    Facing 29
+    movable 0
+    change	2851
+    originsnd	72
+    staff		1
+}
+
+Item 0x0b23
+{
+    Name lamppost4
+    Script change
+    Facing 29
+    movable 0
+    change	2850
+    changesnd	72
+    staff		1
+}
+
+Item 0x0b24
+{
+    Name lamppost5
+    Script change
+    Facing 29
+    movable 0
+    change	2853
+    originsnd	72
+    staff		1
+}
+
+Item 0x0b25
+{
+    Name lamppost6
+    Script change
+    Facing 29
+    movable 0
+    change	2852
+    changesnd	72
+    staff		1
+}
+
+Item 0x1853
+{
+    Name skullcandle1
+    Script change
+    Facing	2
+   VendorSellsFor  100
+   VendorBuysFor   20
+    change	6228
+}
+
+Item 0x1854
+{
+   Name skullcandle2
+    Script change
+    Facing	2
+   VendorSellsFor  100
+   VendorBuysFor   20
+    change	6227
+}
+
+Item 0x1857
+{
+    Name skullcandle3
+    Script change
+    Facing	2
+   VendorSellsFor  100
+   VendorBuysFor   20
+    change	6232
+}
+
+Item 0x1858
+{
+   Name skullcandle4
+    Script change
+    Facing	2
+   VendorSellsFor  100
+   VendorBuysFor   20
+    change	6231
+}
+
+Item 0x1849
+{
+    Name heatingstand1
+    Script change
+    Facing	2
+   VendorSellsFor  50
+   VendorBuysFor   20
+    change	6218
+}
+
+Item 0x184a
+{
+    Name heatingstand2
+    Script change
+    Facing	2
+   VendorSellsFor  50
+   VendorBuysFor   20
+    change	6217
+}
+
+Item 0x184d
+{
+    Name heatingstand3
+    Script change
+    Facing	2
+   VendorSellsFor  50
+   VendorBuysFor   20
+    change	6222
+}
+
+Item 0x184e
+{
+    Name heatingstand4
+    Script change
+    Facing	2
+   VendorSellsFor  50
+   VendorBuysFor   20
+    change	6221
+}
+
+Item 0x0b26
+{#lit
+    Name candelabra1
+    Script change
+    Facing	1
+   VendorSellsFor  300
+   VendorBuysFor   120
+    change	2601
+}
+
+Item 0x0a29
+{#unlit
+    Name candelabra2
+    Script change
+    Facing	1
+   VendorSellsFor  300
+   VendorBuysFor   120
+    change	2854
+}
+
+Item 0x0b1d
+{#lit
+    Name candelabra3
+    Script change
+    Facing	1
+   VendorSellsFor  200
+   VendorBuysFor   80
+    change	2599
+}
+
+Item 0x0a27
+{#unlit
+    Name candelabra4
+    Script change
+    Facing	1
+   VendorSellsFor  200
+   VendorBuysFor   80
+    change	2845
+}
+
+Item 0x0A0F
+{#lit
+    Name candle1
+    Script change
+    Facing 2
+   VendorSellsFor  20
+   VendorBuysFor   10
+    change	2600
+}
+
+Item 0x0A28
+{#unlit
+    Name candle2
+    Desc candle
+    Script change
+    Facing 2
+   VendorSellsFor  20
+   VendorBuysFor   10
+    change	2575
+}
+
+Item 0x0b1a
+{#lit
+    Name candle3
+    Script change
+    Facing	1
+   VendorSellsFor  100
+   VendorBuysFor   40
+    change	2598
+}
+
+Item 0x0a26
+{#unlit
+    Name candle4
+    Script change
+    Facing	1
+   VendorSellsFor  100
+   VendorBuysFor   40
+    change	2842
+}
+
+Item 0x142c
+{#lit
+    Name candle5
+    Script change
+    Facing	2
+   VendorSellsFor  10
+   VendorBuysFor   4
+    change	5167
+}
+
+Item 0x142f
+{#unlit
+    Name candle6
+    Script change
+    Facing	2
+   VendorSellsFor  10
+   VendorBuysFor   4
+    change	5164
+}
+
+Item 0x1430
+{#lit
+    Name candle7
+    Script change
+    Facing	2
+   VendorSellsFor  10
+   VendorBuysFor   4
+    change	5171
+}
+
+Item 0x1433
+{#unlit
+    Name candle8
+    Script change
+    Facing	2
+   VendorSellsFor  10
+   VendorBuysFor   4
+    change	5168
+}
+
+Item 0x1434
+{#lit
+    Name candle9
+    Script change
+    Facing	2
+   VendorSellsFor  10
+   VendorBuysFor   4
+    change	5175
+}
+
+Item 0x1437
+{#unlit
+    Name candle0
+    Script change
+    Facing	2
+   VendorSellsFor  10
+   VendorBuysFor   4
+    change	5172
+}
+
+Item 0x1c14
+{#candle of love
+    Name candlea
+    Facing	2
+   VendorSellsFor  200
+   VendorBuysFor   100
+}
+
+Item 0x0a22
+{#high
+    Name lantern1
+    Script change
+    Facing	29
+   VendorSellsFor  50
+   VendorBuysFor   22
+    change	2597
+}
+
+Item 0x0a23
+{#medium
+    Name lantern2
+    Script change
+    Facing	1
+   VendorSellsFor  50
+   VendorBuysFor   22
+    change	2597
+}
+
+Item 0x0a24
+{#low
+    Name lantern3
+    Script change
+    Facing	2
+   VendorSellsFor  50
+   VendorBuysFor   22
+    change	2597
+}
+
+Item 0x0a25
+{#off
+    Name lantern4
+    Script change
+    Facing	1
+   VendorSellsFor  50
+   VendorBuysFor   22
+    change	2594
+}
+
+Item 0x0a15
+{#flickering
+    Name lantern5
+    Script change
+    Facing	30
+   VendorSellsFor  50
+   VendorBuysFor   22
+    change	2584
+}
+
+Item 0x0a18
+{#off
+    Name lantern6
+    Script change
+    Facing	1
+   VendorSellsFor  50
+   VendorBuysFor   22
+    change	2581
+}
+
+Item 0x0e31
+{
+    Name brazier1
+    Facing	1
+    movable 0
+    VendorSellsFor  1000
+    VendorBuysFor   200
+}
+
+Item 0x19aa
+{
+    Name brazier2
+    Facing	1
+    movable 0
+    VendorSellsFor  1000
+    VendorBuysFor   200
+}
+
+Item 0x19bb
+{#lit
+    Name brazier3
+    Facing	1
+    Script change
+    VendorSellsFor  600
+    VendorBuysFor   200
+    change	7979
+}
+
+Item 0x1f2b
+{#unlit
+    Name brazier4
+    Facing	1
+    Script change
+    VendorSellsFor  600
+    VendorBuysFor   200
+    change	6587
+}
+
+Item 0x3709
+{
+    Name firecol
+    Facing 2
+    movable 0
+}
+
+Item 0x0de3
+{
+    Name campfire
+    Facing	2
+    movable 0
+    SaveOnExit      0
+}
+
+Item 0x0fac
+{
+    Name firepit
+    Facing	2
+    movable 0
+}
+
+Item 0x046b
+{#(n)
+    Facing	12
+    movable 0
+}
+
+Item 0x0462
+{# (w)
+    Facing	19
+    movable 0
+}
+
+Item 0x0930
+{# (n)
+    Facing	12
+    movable 0
+}
+
+Item 0x092b
+{# (w)
+    Facing	19
+    movable 0
+}
+
+Item 0x0475
+{# (w)
+    Facing	19
+    movable 0
+}
+
+Item 0x047b
+{# (n)
+    Facing	12
+    movable 0
+}
+
+Item 0x0937
+{# (w)
+    Facing	19
+    movable 0
+}
+
+Item 0x0945
+{# (n)
+    Facing	12
+    movable 0
+}
+Item 0x0953
+{# (w)
+    Facing	19
+    movable 0
+}
+
+Item 0x0961
+{# (n)
+    Facing	12
+    movable 0
+}
+
+# north walls with square windows
+#
+Item 0x000e
+{
+    Facing 24
+    movable 0
+}
+
+Item 0x0022
+{
+    Facing 24
+    movable 0
+}
+
+Item 0x0098
+{
+    Facing 24
+    movable 0
+}
+
+Item 0x00ba
+{
+    Facing 24
+    movable 0
+}
+
+Item 0x00bc
+{
+    Facing 24
+    movable 0
+}
+
+Item 0x00ca
+{
+    Facing 24
+    movable 0
+}
+
+Item 0x005c
+{
+    Facing 24
+    movable 0
+}
+
+Item 0x013a
+{
+    Facing 24
+    movable 0
+}
+
+Item 0x0154
+{
+    Facing 24
+    movable 0
+}
+
+Item 0x0156
+{
+    Facing 24
+    movable 0
+}
+
+Item 0x015c
+{
+    Facing 24
+    movable 0
+}
+
+Item 0x01c4
+{
+    Facing 24
+    movable 0
+}
+
+Item 0x0207
+{
+    Facing 24
+    movable 0
+}
+
+# west walls with square windows
+#
+Item 0x000f
+{
+    Facing 25
+    movable 0
+}
+
+Item 0x0023
+{
+    Facing 25
+    movable 0
+}
+
+Item 0x0099
+{
+    Facing 25
+    movable 0
+}
+
+Item 0x00b9
+{
+    Facing 25
+    movable 0
+}
+
+Item 0x00bb
+{
+    Facing 25
+    movable 0
+}
+
+Item 0x00cb
+{
+    Facing 25
+    movable 0
+}
+
+Item 0x013b
+{
+    Facing 25
+    movable 0
+}
+
+Item 0x0155
+{
+    Facing 25
+    movable 0
+}
+
+Item 0x0157
+{
+    Facing 25
+    movable 0
+}
+
+Item 0x015d
+{
+    Facing 25
+    movable 0
+}
+
+Item 0x01c5
+{
+    Facing 25
+    movable 0
+}
+
+Item 0x0208
+{
+    Facing 25
+    movable 0
+}
+
+# north walls with round windows
+#
+Item 0x003b
+{
+    Facing 28
+    movable 0
+}
+
+Item 0x005e
+{
+    Facing 28
+    movable 0
+}
+
+Item 0x0083
+{
+    Facing 28
+}
+
+Item 0x008d
+{
+    Facing 28
+    movable 0
+}
+
+Item 0x00fc
+{
+    Facing 28
+    movable 0
+}
+
+Item 0x0102
+{
+    Facing 28
+    movable 0
+}
+
+Item 0x0108
+{
+    Facing 28
+    movable 0
+}
+
+Item 0x0163
+{
+    Facing 28
+    movable 0
+}
+
+Item 0x01d3
+{
+    Facing 28
+    movable 0
+}
+
+Item 0x0209
+{
+    Facing 28
+    movable 0
+}
+
+Item 0x0295
+{
+    Facing 28
+    movable 0
+}
+
+Item 0x029b
+{
+    Facing 28
+    movable 0
+}
+
+Item 0x02ac
+{
+    Facing 28
+    movable 0
+}
+
+Item 0x03de
+{
+    Facing 28
+    movable 0
+}
+
+# walls with different windows
+#
+Item 0x0252
+{
+    Facing 16
+    movable 0
+}
+
+Item 0x0253
+{
+    Facing 17
+    movable 0
+}
+
+Item 0x0254
+{
+    Facing 20
+    movable 0
+}
+
+Item 0x03dd
+{
+    Facing 16
+    movable 0
+}

Added: trunk/096/pkg/OLD/items/lighting/pkg.cfg
===================================================================
--- trunk/096/pkg/OLD/items/lighting/pkg.cfg	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/lighting/pkg.cfg	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,8 @@
+# $Id: pkg.cfg 684 2005-10-27 18:48:28Z muaddiblsd $
+#
+#
+Enabled		0
+Name		lighting
+Maintainer	Distro Team
+Email		<A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">distro at polserver.com</A>
+Version		1.0
\ No newline at end of file

Added: trunk/096/pkg/OLD/items/wands/getSpellID.inc
===================================================================
--- trunk/096/pkg/OLD/items/wands/getSpellID.inc	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/wands/getSpellID.inc	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,12 @@
+///////////////////////////////////////////////////
+//
+// GetSpellId - SpellId is stored in itemdesc.cfg
+//
+///////////////////////////////////////////////////
+use cfgfile;
+
+function GetSpellID(magicitem)
+	var itemdesc_cfg := ReadConfigFile(&quot;itemdesc&quot;);
+
+	return itemdesc_cfg[ magicitem.objtype ].spellid;
+endfunction

Added: trunk/096/pkg/OLD/items/wands/magicWands.src
===================================================================
--- trunk/096/pkg/OLD/items/wands/magicWands.src	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/wands/magicWands.src	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,381 @@
+use uo;
+use os;
+use cfgfile;
+
+include &quot;:attributes:attributes&quot;;
+include &quot;:itemutils:canAccess&quot;;
+include &quot;include/tileEffects&quot;;
+include &quot;include/client&quot;;
+include &quot;include/OLD/sound&quot;;
+include &quot;include/OLD/statMod&quot;;
+
+
+var EVID_DISCHARGE := 0x123457;
+
+
+program magicWands(who, item)
+  EraseObjProperty(who, &quot;IsMeditating&quot;);
+  EraseObjProperty(who, &quot;HealTimer&quot;);
+  if(!can_access(who, item))
+    return;
+  endif
+  if(!ReserveItem(item))
+    return;
+  endif
+  if(!IsWandEquipped(who, item))
+    SendSysMessage(who,&quot;You need to equip that to use it.&quot;);
+    return;
+  endif
+  var charges := CInt(GetObjProperty(item, &quot;charges&quot;));
+  var spellid := CInt(GetObjProperty(item, &quot;SpellId&quot;));
+  if(!spellid)
+    SendSysMessage(who, &quot;This wand is broken.&quot;);
+    return;
+  endif
+  if(charges)
+    if(spellid == 65)
+      identifyit(who, item);
+    else
+      Detach();
+      StartEffect(who, spellid, item);
+    endif
+  else
+    SendSysMessage(who, &quot;That item is out of charges.&quot;);
+  endif
+endprogram
+
+function StartEffect(who, spellid, item)
+  SendSysMessage(who, &quot;Select a target.&quot;);
+  var trg := Target(who);
+  if(!trg)
+    SendSysMessage(who, &quot;Canceled.&quot;);
+    return;
+  endif
+  var charges := CInt(GetObjProperty(item, &quot;charges&quot;));
+  charges := charges - 1;
+  SetObjProperty(item, &quot;charges&quot;, charges);
+  if(charges == 0)
+    PrintTextAbovePrivate(item, &quot;That is out of charges.&quot;, who);
+  endif
+  if(!CheckLineOfSight(who, trg))
+    SendSysMessage(who, &quot;You can't see that.&quot;);
+    return;
+  endif
+  if(!AP_GetVital(trg, &quot;Hits&quot;))
+    SendSysMessage(who, &quot;You can only use that on living things.&quot;);
+    return;
+  endif
+  if(trg.dead)
+    SendSysMessage(who, &quot;You can't cast that on ghosts.&quot;);
+    return;
+  endif
+  case(spellid)
+    1: cast_clumsy(who, trg);
+    3: cast_feeblemind(who, trg);
+    4: cast_heal(who, trg);
+    8: cast_weaken(who, trg);
+   12: cast_harm(who, trg);
+   18: cast_fireball(who, trg);
+   29: cast_greatheal(who, trg);
+   30: cast_lightning(who, trg);
+   31: cast_manadrain(who, trg);
+  endcase
+endfunction
+
+function cast_clumsy(caster, cast_on)
+  SetObjProperty(cast_on, &quot;LastHit&quot;, {caster.name, caster.serial, &quot;clumsy&quot;});
+  if(Reflected(cast_on))
+    cast_on := caster;
+  endif
+  PlaySoundEffect(cast_on, SFX_SPELL_CURE);
+  PlayObjectCenteredEffect(cast_on, FX_CURSE_EFFECT, 7,7);
+  if(!CanMod(cast_on, &quot;dex&quot;))
+    SendSysMessage(caster,&quot;Already under the influence!&quot;);
+    return;
+  endif
+  var magery := 20;
+  var mod_amount := Resisted(10, cast_on, (GetModAmount(magery)));
+  var duration := GetModDuration(magery);
+  DoTempMod(cast_on, &quot;dex&quot;, 0 - mod_amount, duration);
+endfunction
+
+function cast_feeblemind(caster, cast_on)
+  SetObjProperty(cast_on, &quot;LastHit&quot;, {caster.name,caster.serial, &quot;feeblemind&quot; });
+  if (Reflected(cast_on))
+    cast_on := caster;
+  endif
+  PlaySoundEffect(cast_on, SFX_SPELL_FEEBLEMIND);
+  PlayObjectCenteredEffect( cast_on, FX_CURSE_EFFECT, 7, 7 );
+  if (!CanMod(cast_on, &quot;int&quot;))
+    SendSysMessage(caster,&quot;Already under the influence!&quot;);
+    return;
+  endif
+  var magery := 20;
+  var mod_amount := Resisted(20, cast_on, (GetModAmount(magery)));
+  var duration := GetModDuration(magery);
+  DoTempMod(cast_on, &quot;int&quot;, 0 - mod_amount, duration);
+endfunction
+
+function cast_heal(caster, cast_on)
+  caster := caster; // stops ecompile &quot;not used&quot; warning
+  var healed := RandomDiceRoll(&quot;3d2&quot;);
+  healed := 6 + healed;
+  if(cast_on.isA(POLCLASS_NPC))
+    healed := healed * 2;
+  endif
+  HealDamage(cast_on, healed);
+  PlayObjectCenteredEffect(cast_on, FX_SPARK_EFFECT, 7, 0x10);
+  PlaySoundEffect(cast_on, SFX_SPELL_GREATER_HEAL);
+endfunction
+
+function cast_weaken(caster, cast_on)
+  SetObjProperty(cast_on, &quot;LastHit&quot;, {caster.name,caster.serial, &quot;weaken&quot; });
+  if(Reflected(cast_on))
+    cast_on := caster;
+  endif
+  PlaySoundEffect(cast_on, SFX_SPELL_WEAKEN);
+  PlayObjectCenteredEffect( cast_on, FX_CURSE_EFFECT, 7,7);
+  if(!CanMod(cast_on, &quot;str&quot;))
+    return;
+  endif
+  var magery := 20;
+  var mod_amount := Resisted(20, cast_on, (GetModAmount(magery)));
+  var duration := GetModDuration(magery);
+  DoTempMod(cast_on, &quot;str&quot;, 0 - mod_amount, duration);
+endfunction
+
+function cast_harm(caster, cast_on)
+  var dmg := CalcSpellDamage(2, 20,cast_on);
+  SetObjProperty(cast_on, &quot;LastHit&quot;, {caster.name,caster.serial, &quot;harm&quot;});
+  if (Reflected(cast_on))
+    cast_on := caster;
+  endif
+  PlaySoundEffect(cast_on, SFX_SPELL_HARM);
+  PlayObjectCenteredEffect(cast_on, FX_GLOW_SPIKE, 0x0a,0x1e);
+  if(AP_GetVital(cast_on, &quot;Hits&quot;) &gt;= 1)
+    if(cast_on.npctemplate)
+      dmg := dmg * 2;
+    endif
+    ApplyRawDamage(cast_on, Resisted(20, cast_on, dmg));
+  endif
+endfunction
+
+function cast_fireball(caster, cast_on)
+  var dmg := CalcSpellDamage(3, 30,cast_on);
+  SetObjProperty(cast_on, &quot;LastHit&quot;, {caster.name,caster.serial, &quot;harm&quot;});
+  if (Reflected(cast_on))
+    cast_on := caster;
+  endif
+  PlayMovingEffect( caster, cast_on, FX_FIREBALL, 5, 1 );
+  PlaySoundEffect( caster, 0x15f);
+  if(AP_GetVital(cast_on, &quot;Hits&quot;) &gt;= 1)
+    if(cast_on.npctemplate)
+      dmg := dmg * 2;
+    endif
+    ApplyRawDamage(cast_on, Resisted(20, cast_on, dmg));
+  endif
+endfunction
+
+function cast_greatheal(caster, cast_on)
+  caster := caster; // stops ecompile &quot;not used&quot; warning
+  var healed := RandomDiceRoll(&quot;2d6&quot;);
+  healed := 30 + (4 + healed);
+  if(cast_on.isA(POLCLASS_NPC))
+    healed := healed * 2;
+  endif
+  HealDamage(cast_on, healed);
+  PlayObjectCenteredEffect(cast_on, FX_SPARK_EFFECT, 7, 0x10);
+  PlaySoundEffect(cast_on, SFX_SPELL_GREATER_HEAL);
+endfunction
+
+function cast_lightning(caster, cast_on)
+  SetObjProperty(cast_on, &quot;LastHit&quot;, {caster.name,caster.serial, &quot;lightning bolt&quot;});
+  var bdmg := RandomDiceRoll(&quot;4d4&quot;);
+  var dmg := Resisted(40, cast_on, bdmg);
+  if (dmg &lt; 1)
+    dmg := 1;
+  endif
+  if(Reflected(cast_on))
+    cast_on := caster;
+  endif
+  PlaySoundEffect(cast_on, SFX_SPELL_LIGHTNING);
+  PlayLightningBoltEffect(cast_on);
+  if(cast_on.isA(POLCLASS_NPC))
+    dmg := dmg * 2;
+  endif
+  ApplyRawDamage(cast_on, dmg);
+endfunction
+
+function cast_manadrain(caster, cast_on)
+  SetObjProperty(cast_on, &quot;LastHit&quot;, {caster.name,caster.serial, &quot;mana drain&quot; });
+  if (Reflected(cast_on))
+    var tmp := cast_on;
+    cast_on := caster;
+    caster := tmp;
+  endif
+  //var target_resist := GetEffectiveSkill(cast_on, SKILLID_MAGICRESISTANCE); // uncomment if needed
+  var diff := Resisted(40, cast_on, (RandomInt(30)));
+  if(diff &gt; 0)
+    if(diff &gt; AP_GetVitalMaximumValue(cast_on, &quot;Mana&quot;))
+      diff := AP_GetVitalMaximumValue(cast_on, &quot;Mana&quot;);
+    endif
+    PlaySoundEffect(caster, SFX_SPELL_MANA_DRAIN);
+    PlayObjectCenteredEffect(cast_on, FX_HEAL_EFFECT, 7, 0x10);
+    if((AP_GetVital(cast_on, &quot;Mana&quot;) - diff) &lt; 0)
+      diff := AP_GetVital(cast_on, &quot;Mana&quot;);
+    endif
+    AP_SetVital(cast_on, &quot;Mana&quot;, (AP_GetVital(cast_on, &quot;Mana&quot;) - diff));
+  endif
+endfunction
+
+function Reflected(cast_on)
+  var reflect := Cint(GetObjProperty(cast_on, &quot;mr&quot;));
+  if(reflect == 1)
+    sleepms(500);
+    PlaySoundEffect(cast_on, SFX_SPELL_MAGIC_REFLECTION);
+    PlayObjectCenteredEffect( cast_on, FX_CURSE_EFFECT, 10,10);
+    SendSysMessage(cast_on, &quot;Your magic reflect spell saved you!&quot;);
+    EraseObjProperty(cast_on, &quot;mr&quot;);
+    return 1;
+  elseif(reflect == 2)
+    var holder, pid;
+    var eqp := GetObjProperty(cast_on, &quot;EquipTimers&quot;);
+    foreach thing in ListEquippedItems(cast_on)
+      foreach entry in eqp
+        if((thing.serial == entry[1]) and (entry[2] == &quot;ref&quot;))
+          holder := GetObjProperty(thing, &quot;pid&quot;);
+          break;
+        endif
+      endforeach
+    endforeach
+    pid := getprocess(holder);
+    if(pid)
+      var k := struct;
+      k.+type := EVID_DISCHARGE;
+      pid.sendevent(k);
+    else
+      EraseObjProperty(cast_on, &quot;mr&quot;);
+    endif
+  endif
+  return 0;
+endfunction
+
+function CalcSpellDamage(circle, caster, cast_on)
+  cast_on := cast_on; // stops ecompile &quot;not used&quot; warning
+  var die_string := circle+&quot;d8&quot;;
+  var dmg := RandomDiceRoll(die_string);
+  dmg := dmg + (CInt(caster) / 10);
+  if(dmg &gt; (circle * 8))
+    dmg := circle * 8;
+  endif
+  return dmg;
+endfunction
+
+function Resisted(magery, cast_on, amt)
+  var halfamt := amt/2;
+  if(cast_on.dead)
+    return 0;
+  endif
+  if( SkillCheck(cast_on, RESISTING_SPELLS, magery) &gt; 0 )
+    SendSysMessage(cast_on, &quot;You feel yourself resisting magical energy!&quot;);
+    PlaySoundEffect(cast_on, SFX_SPELL_WEAKEN);
+    PlayObjectCenteredEffect( cast_on, FX_CURSE_EFFECT, 5,5);
+    amt := halfamt;
+    return amt;
+  else
+    return amt;
+  endif
+endfunction
+
+function IsWandEquipped(who,wand)
+  if((!Accessible(who,wand)) || (Distance(who, wand) &gt; 1))
+    return 0;
+  endif
+  foreach item in ListEquippedItems(who)
+    if(wand.serial == item.serial)
+      return 1;
+    endif
+  endforeach
+  return 0;
+endfunction
+
+function identifyit(who, item)
+  EraseObjProperty(who, &quot;IsMeditating&quot;);
+  var charges := CInt(GetObjProperty(item, &quot;charges&quot;));
+  var the_item, ncharges;
+  SendSysMessage(who, &quot;Select an object to identify.&quot;);
+  the_item := Target(who, TGTOPT_CHECK_LOS);
+  if(!the_item)
+    SendSysMessage(who, &quot;Targetting cancelled.&quot;);
+    return;
+  endif
+  charges := charges - 1;
+  SetObjProperty(item, &quot;charges&quot;, charges);
+  if(charges == 0)
+    PrintTextAbovePrivate(item, &quot;That is out of charges.&quot;, who);
+  endif
+  if(the_item.isA(POLCLASS_MOBILE))
+    SendSysMessage(who, &quot;That's not an item!&quot;);
+    return;
+  endif
+  var name := &quot;&quot;;
+  var itsname := the_item.desc;
+  if(GetObjProperty(the_item, &quot;silvermod&quot;))
+    name :=  &quot;silver&quot; + name;
+  endif
+  if(GetObjProperty(the_item, &quot;durability&quot;))
+    name := name + &quot; &quot; + GetObjProperty(the_item, &quot;durability&quot;);
+  endif
+  if(GetObjProperty(the_item, &quot;accuracy&quot;))
+    name := name + &quot; &quot; + GetObjProperty(the_item, &quot;accuracy&quot;);
+  endif
+  itsname[&quot;a &quot;] := &quot;&quot;;
+  itsname[&quot;an &quot;] := &quot;&quot;;
+  itsname[&quot;magic &quot;] := &quot;&quot;;
+  name := name + &quot; &quot; + itsname;
+  if(GetObjProperty(the_item, &quot;damagemod&quot;))
+    name := name + &quot; &quot; + GetObjProperty(the_item, &quot;damagemod&quot;);
+  endif
+  name.erase(1);
+  if((!GetObjProperty(the_item, &quot;IDed&quot;)) and (name != &quot;&quot;))
+    SetName(the_item, name);
+  endif
+  var msg := &quot;It appears to be&quot;;
+  itsname := the_item.desc;
+  if(itsname[1] == &quot; &quot;)
+    if(Cint(itsname[2]) == 0)
+      case(Cstr(itsname[2]))
+        &quot;a&quot;: msg := msg + &quot; an&quot;;
+        &quot;e&quot;: msg := msg + &quot; an&quot;;
+        &quot;i&quot;: msg := msg + &quot; an&quot;;
+        &quot;o&quot;: msg := msg + &quot; an&quot;;
+        &quot;u&quot;: msg := msg + &quot; an&quot;;
+      endcase
+    endif
+  else
+    msg := msg + &quot; &quot;;
+    if(Cint(itsname[1]) == 0)
+      case(Cstr(itsname[1]))
+        &quot;a&quot;: msg := msg + &quot; an &quot;;
+        &quot;e&quot;: msg := msg + &quot; an &quot;;
+        &quot;i&quot;: msg := msg + &quot; an &quot;;
+        &quot;o&quot;: msg := msg + &quot; an &quot;;
+        &quot;u&quot;: msg := msg + &quot; an &quot;;
+      endcase
+    endif
+  endif
+  msg := msg + itsname;
+  SendSysMessage( who, msg);
+  SetObjProperty( the_item, &quot;IDed&quot;, 1 );
+  if(GetObjProperty(the_item, &quot;charges&quot;) )
+    ncharges := CStr(GetObjProperty(the_item, &quot;charges&quot;) );
+    if(ncharges)
+      SendSysMessage(who, &quot;It has &quot; + ncharges + &quot; charges.&quot;);
+    endif
+  endif
+  if(GetObjProperty(the_item, &quot;type&quot;) == &quot;cursed&quot;)
+    if(CheckSkill(who, ITEM_IDENTIFICATION, 65, 0) )
+      SendSysMessage(who, &quot;* This item is cursed! *&quot;);
+    endif
+  endif
+endfunction
\ No newline at end of file

Added: trunk/096/pkg/OLD/items/wands/pkg.cfg
===================================================================
--- trunk/096/pkg/OLD/items/wands/pkg.cfg	2006-05-12 06:14:13 UTC (rev 1334)
+++ trunk/096/pkg/OLD/items/wands/pkg.cfg	2006-05-12 06:14:35 UTC (rev 1335)
@@ -0,0 +1,8 @@
+# $Id: pkg.cfg 684 2005-10-27 18:48:28Z muaddiblsd $
+#
+#
+Enabled		0
+Name		wands
+Maintainer	Distro Team
+Email		<A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">distro at polserver.com</A>
+Version		1.0


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001291.html">[Poldistro-svn] r1334 - trunk/096/pkg/items
</A></li>
	<LI>Next message: <A HREF="001302.html">[Poldistro-svn] r1336 - in trunk/096/pkg/systems/combat: . config weaponHitScripts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1308">[ date ]</a>
              <a href="thread.html#1308">[ thread ]</a>
              <a href="subject.html#1308">[ subject ]</a>
              <a href="author.html#1308">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/poldistro-svn">More information about the Poldistro-svn
mailing list</a><br>
</body></html>
