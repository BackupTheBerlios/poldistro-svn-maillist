<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Poldistro-svn] r490 - in trunk/096/pkg/items: . walkOn walkOn/commands walkOn/commands/seer walkOn/config walkOn/energyField walkOn/fireField walkOn/paraField walkOn/poisonField walkOn/resurrect walkOn/spiderWeb walkOn/teleport
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/poldistro-svn/2005-October/index.html" >
   <LINK REL="made" HREF="mailto:poldistro-svn%40lists.berlios.de?Subject=Re%3A%20%5BPoldistro-svn%5D%20r490%20-%20in%20trunk/096/pkg/items%3A%20.%20walkOn%20walkOn/commands%20walkOn/commands/seer%20walkOn/config%20walkOn/energyField%20walkOn/fireField%20walkOn/paraField%20walkOn/poisonField%20walkOn/resurrect%20walkOn/spiderWeb%20walkOn/teleport&In-Reply-To=%3C200510091555.j99Ft7Cm029110%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000462.html">
   <LINK REL="Next"  HREF="000464.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Poldistro-svn] r490 - in trunk/096/pkg/items: . walkOn walkOn/commands walkOn/commands/seer walkOn/config walkOn/energyField walkOn/fireField walkOn/paraField walkOn/poisonField walkOn/resurrect walkOn/spiderWeb walkOn/teleport</H1>
    <B>Austin Heilman at BerliOS</B> 
    <A HREF="mailto:poldistro-svn%40lists.berlios.de?Subject=Re%3A%20%5BPoldistro-svn%5D%20r490%20-%20in%20trunk/096/pkg/items%3A%20.%20walkOn%20walkOn/commands%20walkOn/commands/seer%20walkOn/config%20walkOn/energyField%20walkOn/fireField%20walkOn/paraField%20walkOn/poisonField%20walkOn/resurrect%20walkOn/spiderWeb%20walkOn/teleport&In-Reply-To=%3C200510091555.j99Ft7Cm029110%40sheep.berlios.de%3E"
       TITLE="[Poldistro-svn] r490 - in trunk/096/pkg/items: . walkOn walkOn/commands walkOn/commands/seer walkOn/config walkOn/energyField walkOn/fireField walkOn/paraField walkOn/poisonField walkOn/resurrect walkOn/spiderWeb walkOn/teleport">austin at berlios.de
       </A><BR>
    <I>Sun Oct  9 17:55:07 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000462.html">[Poldistro-svn] r489 - trunk/096/pkg/items
</A></li>
        <LI>Next message: <A HREF="000464.html">[Poldistro-svn] r491 - trunk/096/pkg/items/walkOn/commands/seer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#463">[ date ]</a>
              <a href="thread.html#463">[ thread ]</a>
              <a href="subject.html#463">[ subject ]</a>
              <a href="author.html#463">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: austin
Date: 2005-10-09 17:55:07 +0200 (Sun, 09 Oct 2005)
New Revision: 490

Added:
   trunk/096/pkg/items/walkOn/
   trunk/096/pkg/items/walkOn/commands/
   trunk/096/pkg/items/walkOn/commands/seer/
   trunk/096/pkg/items/walkOn/commands/seer/maketele.src
   trunk/096/pkg/items/walkOn/config/
   trunk/096/pkg/items/walkOn/config/icp.cfg
   trunk/096/pkg/items/walkOn/energyField/
   trunk/096/pkg/items/walkOn/energyField/walkOn.src
   trunk/096/pkg/items/walkOn/fireField/
   trunk/096/pkg/items/walkOn/fireField/control.src
   trunk/096/pkg/items/walkOn/fireField/walkOn.src
   trunk/096/pkg/items/walkOn/include/
   trunk/096/pkg/items/walkOn/itemdesc.cfg
   trunk/096/pkg/items/walkOn/paraField/
   trunk/096/pkg/items/walkOn/paraField/control.src
   trunk/096/pkg/items/walkOn/paraField/walkOn.src
   trunk/096/pkg/items/walkOn/pkg.cfg
   trunk/096/pkg/items/walkOn/poisonField/
   trunk/096/pkg/items/walkOn/poisonField/control.src
   trunk/096/pkg/items/walkOn/poisonField/walkOn.src
   trunk/096/pkg/items/walkOn/resurrect/
   trunk/096/pkg/items/walkOn/resurrect/walkOn.src
   trunk/096/pkg/items/walkOn/spiderWeb/
   trunk/096/pkg/items/walkOn/spiderWeb/walkOn.src
   trunk/096/pkg/items/walkOn/teleport/
   trunk/096/pkg/items/walkOn/teleport/use.src
   trunk/096/pkg/items/walkOn/teleport/walkOn.src
Log:


Added: trunk/096/pkg/items/walkOn/commands/seer/maketele.src
===================================================================

Added: trunk/096/pkg/items/walkOn/config/icp.cfg
===================================================================
--- trunk/096/pkg/items/walkOn/config/icp.cfg	2005-10-09 15:52:29 UTC (rev 489)
+++ trunk/096/pkg/items/walkOn/config/icp.cfg	2005-10-09 15:55:07 UTC (rev 490)
@@ -0,0 +1,14 @@
+ICP Register
+{
+	Name		Walkon Tiles
+	Version		1.0
+	
+	Description	Tiles with walkon scripts. [P]
+	Description	Telepad, resurrection tile, poison field, fire field, etc.
+	
+	Creator		Austin
+	C_Email		<A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">AustinHeilman at gmail.com</A>
+	
+	Maintainer	Distro Team
+	M_Email		<A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">pol-distro-support at sourceforge.net</A>
+}
\ No newline at end of file

Added: trunk/096/pkg/items/walkOn/energyField/walkOn.src
===================================================================

Added: trunk/096/pkg/items/walkOn/fireField/control.src
===================================================================
--- trunk/096/pkg/items/walkOn/fireField/control.src	2005-10-09 15:52:29 UTC (rev 489)
+++ trunk/096/pkg/items/walkOn/fireField/control.src	2005-10-09 15:55:07 UTC (rev 490)
@@ -0,0 +1,58 @@
+/*
+ * $Id$
+ *
+ */
+
+use uo;
+use os;
+use util;
+
+program controlScript(field)
+	SetObjProperty(field, &quot;#PID&quot;, GetPid());
+
+	var creator := CInt(GetObjProperty(field, &quot;Creator&quot;));
+	if ( creator )
+		creator := SystemFindObjectBySerial(creator);
+		SetScriptController(creator);
+	endif
+
+	var dmg_dice := GetObjProperty(field, &quot;DamageDice&quot;);
+	if ( !dmg_dice )
+		dmg_dice := &quot;1d5&quot;;
+	endif
+
+	while ( field )
+		PrintTextAbove(field, &quot;*tick*&quot;);
+		
+		BurnNearbyMobiles(field, dmg_dice);
+
+		if ( ReadGameClock() % 3 == 0 )
+			// Play once every 3 seconds.
+			PlaySoundEffect(field, 0x1DE);
+		endif
+
+		var event := Wait_For_Event(1);
+		if ( event )
+			//Someone just walked onto the tile.
+			BurnMobile(event, dmg_dice);
+		endif
+	endwhile
+endprogram
+
+function BurnNearbyMobiles(field, dmg_dice)
+	var nearby := ListMobilesNearLocationEX(field.x, field.y, field.z, 0, LISTEX_FLAG_NORMAL+LISTEX_FLAG_HIDDEN, field.realm);
+	foreach mobile in ( nearby )
+		BurnMobile(mobile, dmg_dice);
+
+		sleepms(2);
+	endforeach
+
+	return (nearby.size());
+endfunction
+
+function BurnMobile(mobile, dmg_dice)
+	var dmg := RandomDiceRoll(dmg_dice); // - resistance ?
+	ApplyRawDamage(mobile, dmg);
+
+	return 1;
+endfunction

Added: trunk/096/pkg/items/walkOn/fireField/walkOn.src
===================================================================
--- trunk/096/pkg/items/walkOn/fireField/walkOn.src	2005-10-09 15:52:29 UTC (rev 489)
+++ trunk/096/pkg/items/walkOn/fireField/walkOn.src	2005-10-09 15:55:07 UTC (rev 490)
@@ -0,0 +1,20 @@
+/*
+ * $Id$
+ *
+ */
+
+use uo;
+use os;
+use util;
+
+program walkOn(mobile, tile)
+	var pid := CInt(GetObjProperty(tile, &quot;#PID&quot;));
+	if ( pid )
+		var process := GetProcess(pid);
+		process.SendEvent(mobile);
+		
+		return 1;
+	endif
+	
+	return 0;
+endprogram
\ No newline at end of file

Added: trunk/096/pkg/items/walkOn/itemdesc.cfg
===================================================================
--- trunk/096/pkg/items/walkOn/itemdesc.cfg	2005-10-09 15:52:29 UTC (rev 489)
+++ trunk/096/pkg/items/walkOn/itemdesc.cfg	2005-10-09 15:55:07 UTC (rev 490)
@@ -0,0 +1,106 @@
+Item 0x398C
+{
+	Name		firefield_ew
+
+	Facing		2
+
+	Movable		0
+	SaveOnExit	0
+
+	ControlScript	fireField/control
+	WalkOnScript	fireField/walkOn
+}
+Item 0x3996
+{
+	Name		firefield_ns
+
+	Facing		2
+
+	Movable		0
+	SaveOnExit	0
+
+	ControlScript	fireField/control
+	WalkOnScript	fireField/walkOn
+}
+
+Item 0x3915
+{
+	Name		poisonfield_ns
+	Facing		2
+
+	SaveOnExit	0
+	Movable		0
+
+	ControlScript	poisonField/control
+	WalkOnScript	poisonField/walkOn
+}
+Item 0x3920
+{
+	Name		poisonfield_ew
+	Facing		2
+
+	SaveOnExit	0
+	Movable		0
+
+	ControlScript	poisonField/control
+	WalkOnScript	poisonField/walkOn
+}
+
+Item 0x3967
+{
+	Name		parafield_ew
+	Facing		29
+
+	Movable		0
+
+	ControlScript	paraField/control
+	WalkOnScript	paraField/walkOn
+}
+
+Item 0x3979
+{
+	Name		parafield_ns
+	Facing		29
+
+	Movable		0
+
+	ControlScript	paraField/control
+	WalkOnScript	paraField/walkOn
+}
+
+Item 0x6203
+{
+	Name		telepad
+	Desc		tele pad
+	Color		1001
+	Graphic		0x17E5
+
+	OldObjType	0x6200 // 'SystemTeleporter'
+
+	Movable		0
+	Invisible	1
+
+	Script		teleport/use
+	WalkOnScript	teleport/walkOn
+}
+
+Item 0xEE01
+{
+	Name		restile
+	Name		rescob1
+	Name		rescob2
+	Name		rescob3
+	Name		rescob4
+	Graphic		0x1822
+	Color		1001
+	
+	OldObjType	0xEE02
+	OldObjType	0xEE03
+	OldObjType	0xEE04
+
+	Invisible	1
+	Movable		0
+
+	WalkOnScript	resurrect/walkOn
+}
+

Added: trunk/096/pkg/items/walkOn/paraField/control.src
===================================================================

Added: trunk/096/pkg/items/walkOn/paraField/walkOn.src
===================================================================

Added: trunk/096/pkg/items/walkOn/pkg.cfg
===================================================================
--- trunk/096/pkg/items/walkOn/pkg.cfg	2005-10-09 15:52:29 UTC (rev 489)
+++ trunk/096/pkg/items/walkOn/pkg.cfg	2005-10-09 15:55:07 UTC (rev 490)
@@ -0,0 +1,14 @@
+Enabled		1
+Name		walkon
+
+Version		1.0
+
+CoreRequired	96
+
+Creator		Austin Heilman
+Email		<A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">AustinHeilman at gmail.com</A>
+Maintainer	Distro Team
+Email		<A HREF="https://lists.berlios.de/mailman/listinfo/poldistro-svn">pol-distro-support at sourceforge.net</A>
+
+#Requires none
+#Conflicts none

Added: trunk/096/pkg/items/walkOn/poisonField/control.src
===================================================================

Added: trunk/096/pkg/items/walkOn/poisonField/walkOn.src
===================================================================

Added: trunk/096/pkg/items/walkOn/resurrect/walkOn.src
===================================================================
--- trunk/096/pkg/items/walkOn/resurrect/walkOn.src	2005-10-09 15:52:29 UTC (rev 489)
+++ trunk/096/pkg/items/walkOn/resurrect/walkOn.src	2005-10-09 15:55:07 UTC (rev 490)
@@ -0,0 +1,12 @@
+// $Id$
+
+use uo;
+use os;
+
+program walkon(mobile, tile)
+	if ( mobile.dead )
+		Resurrect(mobile);
+	else
+		SendSysMessage(mobile, &quot;You are at peace...&quot;);
+	endif
+endprogram

Added: trunk/096/pkg/items/walkOn/spiderWeb/walkOn.src
===================================================================

Added: trunk/096/pkg/items/walkOn/teleport/use.src
===================================================================
--- trunk/096/pkg/items/walkOn/teleport/use.src	2005-10-09 15:52:29 UTC (rev 489)
+++ trunk/096/pkg/items/walkOn/teleport/use.src	2005-10-09 15:55:07 UTC (rev 490)
@@ -0,0 +1,76 @@
+/*
+ * $Id$
+ *
+ */
+
+use uo;
+use os;
+use polsys;
+
+include &quot;:gumps:gumps&quot;;
+include &quot;:gumps:gumps_ex&quot;;
+
+unload_scripts(&quot;&quot;);
+
+const REALM_TEXT	:= 0xA001;
+const X_TEXT		:= 0xA002;
+const Y_TEXT		:= 0xA003;
+const Z_TEXT		:= 0xA004;
+
+const CANCEL_BTN	:= 0xB000;
+const OKAY_BTN		:= 0xB001;
+
+program useScript(who, tile)
+	var dest := GetObjProperty(tile, &quot;Destination&quot;);
+	if ( !dest )
+		dest := struct;
+		dest.+realm:=tile.realm;
+		dest.+x:=tile.x;
+		dest.+y:=tile.y;
+		dest.+z:=tile.z;
+	endif
+	
+	var gump := GFCreateGump();
+	GFResizePic(gump, 0, 0, GFCfgConst(&quot;Defaults&quot;, &quot;BackGround&quot;), 450, 230);
+	GFResizePic(gump, 10, 10, GFCfgConst(&quot;Defaults&quot;, &quot;ForeGround&quot;), 430, 40);
+	GFTextMid(gump, 10, 20, 430, 2100, &quot;Teleporter Setup Menu&quot;);
+	
+	GFResizePic(gump, 10, 55, GFCfgConst(&quot;Defaults&quot;, &quot;ForeGround&quot;), 430, 50);
+	GFTextLine(gump, 20, 60, 2100, &quot;Use the fields below to change the coordinates the&quot;);
+	GFTextLine(gump, 20, 80, 2100, &quot;teleporter sends any mobiles to that walk over it.&quot;);
+	
+	GFResizePic(gump, 10, 110, GFCfgConst(&quot;Defaults&quot;, &quot;ForeGround&quot;), 430, 111);
+	GFTextLine(gump, 20, 120, 2100, &quot;Realm&quot;);
+	GFResizePic(gump, 120, 115, GFCfgConst(&quot;Backgrounds&quot;, &quot;GOLDTRIM&quot;), 100, 30);
+	GFTextEntry(gump, 127, 120, 80, 20, 2100, dest.realm, REALM_TEXT);
+	
+	GFTextLine(gump, 20, 143, 2100, &quot;X Coordinate&quot;);
+	GFResizePic(gump, 120, 138, GFCfgConst(&quot;Backgrounds&quot;, &quot;GOLDTRIM&quot;), 100, 30);
+	GFTextEntry(gump, 127, 143, 80, 20, 2100, CInt(dest.x), X_TEXT);
+	
+	GFTextLine(gump, 20, 166, 2100, &quot;Y Coordinate&quot;);
+	GFResizePic(gump, 120, 161, GFCfgConst(&quot;Backgrounds&quot;, &quot;GOLDTRIM&quot;), 100, 30);
+	GFTextEntry(gump, 127, 166, 80, 20, 2100, CInt(dest.y), Y_TEXT);
+	
+	GFTextLine(gump, 20, 189, 2100, &quot;Z Coordinate&quot;);
+	GFResizePic(gump, 120, 184, GFCfgConst(&quot;Backgrounds&quot;, &quot;GOLDTRIM&quot;), 100, 30);
+	GFTextEntry(gump, 127, 189, 80, 20, 2100, CInt(dest.z), Z_TEXT);
+	
+	GFAddButton(gump, 304, 135, 2076, 2075, GF_CLOSE_BTN, OKAY_BTN);
+	GFAddButton(gump, 300, 175, 2121, 2120, GF_CLOSE_BTN, CANCEL_BTN);
+	
+	var input := GFSendGump(who, gump);
+	if ( input[OKAY_BTN] )
+		dest.realm := CStr(GFExtractData(input, REALM_TEXT));
+		dest.x := CInt(GFExtractData(input, X_TEXT));
+		dest.y := CInt(GFExtractData(input, Y_TEXT));
+		dest.z := CInt(GFExtractData(input, Z_TEXT));
+		
+		SetObjProperty(tile, &quot;Destination&quot;, dest);
+		SendSysMessage(who, &quot;Done.&quot;);
+		return 1;
+	else
+		SendSysMessage(who, &quot;Cancelled.&quot;);
+		return 0;
+	endif
+endprogram

Added: trunk/096/pkg/items/walkOn/teleport/walkOn.src
===================================================================
--- trunk/096/pkg/items/walkOn/teleport/walkOn.src	2005-10-09 15:52:29 UTC (rev 489)
+++ trunk/096/pkg/items/walkOn/teleport/walkOn.src	2005-10-09 15:55:07 UTC (rev 490)
@@ -0,0 +1,68 @@
+/*
+ * $Id$
+ *
+ */
+
+use uo;
+use os;
+use polsys;
+
+program walkOn(who, tile)
+	if ( JustTeleported(who) )
+		return 0;
+	endif
+		
+	var dest := GetObjProperty(tile, &quot;Destination&quot;);
+	
+	TeleportMobile(who, dest);
+	if ( !who.npctemplate )
+		TeleTamedPets(who, dest);
+	endif
+	
+	return 1;
+endprogram
+
+function JustTeleported(mobile)
+	var tele_time := CInt(GetObjProperty(mobile, &quot;#Teleported&quot;));
+	if ( tele_time &gt; ReadMillisecondClock()-500 )
+		// Mobile just teleported Too soon to teleport again.
+		return 1;
+	else
+		// Safe to teleport the mobile
+		return 0;
+	endif
+endfunction
+
+function TeleportMobile(mobile, byref dest)
+	SetObjProperty(mobile, &quot;#Teleported&quot;, ReadMillisecondClock());
+	
+	var moved;
+	if ( mobile.realm != dest.realm )
+		moved := MoveObjectToRealm(mobile, dest.realm, dest.x, dest.y, dest.z, MOVECHAR_FORCELOCATION);
+	else
+		moved := MoveCharacterToLocation(mobile, dest.x, dest.y, dest.z, MOVECHAR_FORCELOCATION);
+	endif
+	
+	if ( moved.errortext )
+		SendSysMessage(mobile, &quot;Teleport Error: &quot;+moved.errortext);
+		return 0;
+	endif
+	
+	return 1;
+endfunction
+
+function TeleTamedPets(who, byref dest)
+	foreach mobile in (ListMobilesNearLocationEX(dest.x, dest.y, dest.z, 8, LISTEX_FLAG_NORMAL+LISTEX_FLAG_HIDDEN, dest.realm))
+		if ( (mobile.master).serial == who.serial )
+			if ( JustTeleported(mobile) )
+				continue;
+			else
+				TeleportMobile(mobile, dest);
+			endif
+		endif
+		sleepms(2);
+	endforeach
+endfunction
+
+	
+	
\ No newline at end of file


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000462.html">[Poldistro-svn] r489 - trunk/096/pkg/items
</A></li>
	<LI>Next message: <A HREF="000464.html">[Poldistro-svn] r491 - trunk/096/pkg/items/walkOn/commands/seer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#463">[ date ]</a>
              <a href="thread.html#463">[ thread ]</a>
              <a href="subject.html#463">[ subject ]</a>
              <a href="author.html#463">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/poldistro-svn">More information about the Poldistro-svn
mailing list</a><br>
</body></html>
